(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e=e||self,t(e.ZPlan={}))})(this,function(e){"use strict";var At=Math.abs,Mt=Math.max,Ft=Math.min,Ot=Math.floor,Ut=Math.ceil,Nt=Math.round;function t(e){var t=typeof e;return"string"==t||"number"==t}function a(e){return c(e)||d(e)}function s(e){return d(e)||!1===e||p(e)||c(e)}function o(e){return"function"==typeof e}function r(e){return"string"==typeof e}function l(e){return"number"==typeof e}function d(e){return null===e}function p(e){return!0===e}function c(e){return void 0===e}function u(e){throw e||(e="a runtime error occured! Use Inferno in development environment to find the error."),new Error("Inferno Error: "+e)}function m(e,t){var a={};if(e)for(var n in e)a[n]=e[n];if(t)for(var s in t)a[s]=t[s];return a}function _(e,t,a,n,s,o,r,l){return{childFlags:e,children:t,className:a,dom:null,flags:n,key:void 0===s?null:s,parentVNode:null,props:void 0===o?null:o,ref:void 0===r?null:r,type:l}}function y(e,t,a,n,s,o,r,l){var i=void 0===s?1:s,d=_(i,n,a,e,r,o,l,t);return 0===i&&C(d,d.children),d}function v(e,t,n,s,r){0<(2&e)&&(e=t.prototype&&o(t.prototype.render)?4:8);var l=t.defaultProps;if(!a(l))for(var i in n||(n={}),l)c(n[i])&&(n[i]=l[i]);if(0<(8&e)){var d=t.defaultHooks;if(!a(d))if(!r)r=d;else for(var p in d)c(r[p])&&(r[p]=d[p])}var u=_(1,null,null,e,s,n,r,t),h=Wt.createVNode;return o(h)&&h(u),u}function w(e,t){return _(1,a(e)?"":e,null,16,t,null,null,null)}function T(e){var t=e.flags,a;if(14&t){var n=e.props,s;if(!d(n))for(var o in s={},n)s[o]=n[o];a=v(t,e.type,s,e.key,e.ref)}else 481&t?a=y(t,e.type,e.className,e.children,e.childFlags,e.props,e.key,e.ref):16&t?a=w(e.children,e.key):1024&t&&(a=e);return a}function R(){return w("",null)}function D(e,a,o,l){for(var i=e.length,p;o<i;o++)if(p=e[o],!s(p)){var c=l+"$"+o;if(jt(p))D(p,a,0,c);else{if(t(p))p=w(p,c);else{var u=p.key,h=r(u)&&"$"===u[0];(!d(p.dom)||h)&&(p=T(p)),p.key=d(u)||h?c:l+u}a.push(p)}}}function x(e){return"svg"===e?32:"input"===e?64:"select"===e?256:"textarea"===e?128:1}function C(e,a){var o=1,p;if(s(a))p=a;else if(r(a))o=2,p=w(a);else if(l(a))o=2,p=w(a+"");else if(jt(a)){var c=a.length;if(0===c)p=null,o=1;else{(Object.isFrozen(a)||!0===a.$)&&(a=a.slice()),o=8;for(var u=0,h;u<c;u++)if(h=a[u],s(h)||jt(h)){p=p||a.slice(0,u),D(a,p,u,"");break}else if(t(h))p=p||a.slice(0,u),p.push(w(h,"$"+u));else{var m=h.key,g=d(h.dom),f=d(m),_=!f&&"$"===m[0];!g||f||_?(p=p||a.slice(0,u),(!g||_)&&(h=T(h)),(f||_)&&(h.key="$"+u),p.push(h)):p&&p.push(h)}p=p||a,p.$=!0}}else p=a,d(a.dom)||(p=T(a)),o=2;return e.children=p,e.childFlags=o,e}function S(e,t){return o(t)?{data:e,event:t}:null}function b(e,t){e.appendChild(t)}function P(e,t,n){a(n)?b(e,t):e.insertBefore(t,n)}function E(e,t){return!0===t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)}function z(e,t,a){e.replaceChild(t,a)}function I(e,t){e.removeChild(t)}function L(e){for(var t;(t=e.shift())!==void 0;)t()}function A(e,t,a){var n=$t[e],s=a.$EV;t?(!n&&(Xt[e]=U(e),$t[e]=0),!s&&(s=a.$EV={}),!s[e]&&$t[e]++,s[e]=t):s&&s[e]&&($t[e]--,1===n&&(document.removeEventListener(F(e),Xt[e]),Xt[e]=null),s[e]=t)}function M(e,t,a,n,s){for(var o=t;!d(o);){if(a&&o.disabled)return;var r=o.$EV;if(r){var l=r[n];if(l&&(s.dom=o,l.event?l.event(l.data,e):l(e),e.cancelBubble))return}o=o.parentNode}}function F(e){return e.substr(2).toLowerCase()}function O(){this.cancelBubble=!0,this.immediatePropagationStopped||this.stopImmediatePropagation()}function U(e){var t=function(t){var a=t.type,n="click"===a||"dblclick"===a;if(n&&0!==t.button)return t.stopPropagation(),!1;t.stopPropagation=O;var s={dom:document};return Object.defineProperty(t,"currentTarget",{configurable:!0,get:function(){return s.dom}}),void M(t,t.target,n,e,s)};return document.addEventListener(F(e),t),t}function N(e,t){var a=document.createElement("i");return a.innerHTML=t,a.innerHTML===e.innerHTML}function V(e,t){return!!(t&&t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html&&N(e,t.dangerouslySetInnerHTML.__html))}function W(t,a,n){if(t[a]){var e=t[a];e.event?e.event(e.data,n):e(n)}else{var s=a.toLowerCase();t[s]&&t[s](n)}}function B(t,a){var n=function(n){n.stopPropagation();var e=this.$V;if(e){var s=e.props||qt,l=e.dom;if(r(t))W(s,t,n);else for(var d=0;d<t.length;d++)W(s,t[d],n);if(o(a)){var p=this.$V,c=p.props||qt;a(c,l,!1,p)}}};return Object.defineProperty(n,"wrapped",{configurable:!1,enumerable:!1,value:!0,writable:!1}),n}function H(e){return"checkbox"===e||"radio"===e}function Y(e){e.stopPropagation()}function q(e,t){H(t.type)?(e.onchange=Kt,e.onclick=Y):e.oninput=Zt}function G(e,t){var n=e.type,s=e.value,o=e.checked,r=e.multiple,l=e.defaultValue,i=!a(s);n&&n!==t.type&&t.setAttribute("type",n),a(r)||r===t.multiple||(t.multiple=r),a(l)||i||(t.defaultValue=l+""),H(n)?(i&&(t.value=s),!a(o)&&(t.checked=o)):i&&t.value!==s?(t.defaultValue=s,t.value=s):!a(o)&&(t.checked=o)}function $(e,t){var a=e.type;if("optgroup"===a){var n=e.children,s=e.childFlags;if(12&s)for(var o=0,r=n.length;o<r;o++)X(n[o],t);else 2===s&&X(n,t)}else X(e,t)}function X(e,t){var n=e.props||qt,s=e.dom;s.value=n.value,jt(t)&&-1!==t.indexOf(n.value)||n.value===t?s.selected=!0:(!a(t)||!a(n.selected))&&(s.selected=n.selected||!1)}function Z(e){e.onchange=Jt}function K(e,t,n,s){var o=!!e.multiple;a(e.multiple)||o===t.multiple||(t.multiple=o);var r=s.childFlags;if(0==(1&r)){var l=s.children,d=e.value;if(n&&a(d)&&(d=e.defaultValue),12&r)for(var p=0,c=l.length;p<c;p++)$(l[p],d);else 2===r&&$(l,d)}}function J(e,t){e.oninput=Qt,t.onChange&&(e.onchange=ea)}function Q(e,t,n){var s=e.value,o=t.value;if(!a(s))o!==s&&(t.defaultValue=s,t.value=s);else if(n){var r=e.defaultValue;a(r)||r===o||(t.defaultValue=r,t.value=r)}}function ee(e,t,a,n,s,o){64&e?G(n,a):256&e?K(n,a,s,t):128&e&&Q(n,a,s),o&&(a.$V=t)}function te(e,t,a){64&e?q(t,a):256&e?Z(t):128&e&&J(t,a)}function ae(e){return e.type&&H(e.type)?!a(e.checked):!a(e.value)}function ne(e,t){se(e),t&&e.dom&&(I(t,e.dom),e.dom=null)}function se(e){var t=e.flags;if(481&t){var n=e.ref,s=e.props;o(n)&&n(null);var r=e.children,l=e.childFlags;if(12&l?oe(r):2===l&&se(r),!d(s))for(var i in s)switch(i){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":A(i,null,e.dom);break;default:}}else{var p=e.children;if(p)if(14&t){var c=e.ref;4&t?(o(p.componentWillUnmount)&&p.componentWillUnmount(),o(c)&&c(null),p.$UN=!0,p.$LI&&se(p.$LI)):(!a(c)&&o(c.onComponentWillUnmount)&&c.onComponentWillUnmount(e.dom,e.props||qt),se(p))}else 1024&t&&ne(p,e.type)}}function oe(e){for(var t=0,a=e.length;t<a;t++)se(e[t])}function re(e,t){oe(t),e.textContent=""}function le(t,a){return function(n){t(a.data,n)}}function ie(e,t,n,s){var r=e.toLowerCase();if(!o(n)&&!a(n)){var l=n.event;l&&o(l)&&(s[r]=le(l,n))}else{var i=s[r];i&&i.wrapped||(s[r]=n)}}function de(e,t){return"animationIterationCount"===e||"borderImageOutset"===e||"borderImageSlice"===e||"borderImageWidth"===e||"boxFlex"===e||"boxFlexGroup"===e||"boxOrdinalGroup"===e||"columnCount"===e||"fillOpacity"===e||"flex"===e||"flexGrow"===e||"flexNegative"===e||"flexOrder"===e||"flexPositive"===e||"flexShrink"===e||"floodOpacity"===e||"fontWeight"===e||"gridColumn"===e||"gridRow"===e||"lineClamp"===e||"lineHeight"===e||"opacity"===e||"order"===e||"orphans"===e||"stopOpacity"===e||"strokeDasharray"===e||"strokeDashoffset"===e||"strokeMiterlimit"===e||"strokeOpacity"===e||"strokeWidth"===e||"tabSize"===e||"widows"===e||"zIndex"===e||"zoom"===e?t:t+"px"}function pe(e,t,n){var s=n.style,o,i;if(r(t))return void(s.cssText=t);if(!a(e)&&!r(e)){for(o in t)i=t[o],i!==e[o]&&(s[o]=l(i)?de(o,i):i);for(o in e)a(t[o])&&(s[o]="")}else for(o in t)i=t[o],s[o]=l(i)?de(o,i):i}function ce(e,t,n,s,o,r,l){switch(e){case"onClick":case"onDblClick":case"onFocusIn":case"onFocusOut":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onMouseDown":case"onMouseMove":case"onMouseUp":case"onSubmit":case"onTouchEnd":case"onTouchMove":case"onTouchStart":A(e,n,s);break;case"children":case"childrenType":case"className":case"defaultValue":case"key":case"multiple":case"ref":break;case"autoFocus":s.autofocus=!!n;break;case"allowfullscreen":case"autoplay":case"capture":case"checked":case"controls":case"default":case"disabled":case"hidden":case"indeterminate":case"loop":case"muted":case"novalidate":case"open":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"selected":s[e]=!!n;break;case"defaultChecked":case"value":case"volume":if(r&&"value"===e)return;var i=a(n)?"":n;s[e]!==i&&(s[e]=i);break;case"dangerouslySetInnerHTML":var p=t&&t.__html||"",c=n&&n.__html||"";p===c||a(c)||N(s,c)||(!d(l)&&(12&l.childFlags?oe(l.children):2===l.childFlags&&se(l.children),l.children=null,l.childFlags=1),s.innerHTML=c);break;default:"o"===e[0]&&"n"===e[1]?ie(e,t,n,s):a(n)?s.removeAttribute(e):"style"===e?pe(t,n,s):o&&Yt[e]?s.setAttributeNS(Yt[e],e,n):s.setAttribute(e,n);}}function ue(e,t,a,n,s){var o=!1,r=0<(448&t);for(var l in r&&(o=ae(a),o&&te(t,n,a)),a)ce(l,null,a[l],n,s,o,null);r&&ee(t,e,n,a,!0,o)}function he(e,t,n,s){var r=new t(n,s);if(e.children=r,r.$V=e,r.$BS=!1,r.context=s,r.props===qt&&(r.props=n),r.$UN=!1,o(r.componentWillMount)){if(r.$BR=!0,r.componentWillMount(),r.$PSS){var l=r.state,i=r.$PS;if(d(l))r.state=i;else for(var p in i)l[p]=i[p];r.$PSS=!1,r.$PS=null}r.$BR=!1}o(Wt.beforeRender)&&Wt.beforeRender(r);var c=me(r.render(n,r.state,s),e),u;return o(r.getChildContext)&&(u=r.getChildContext()),r.$CX=a(u)?s:m(s,u),o(Wt.afterRender)&&Wt.afterRender(r),r.$LI=c,r}function me(e,a){return s(e)?e=R():t(e)?e=w(e,null):(e.dom&&(e=T(e)),14&e.flags&&(e.parentVNode=a)),e}function ge(e,t,a,n){var s=e.flags;return 481&s?_e(e,t,a,n):14&s?ve(e,t,a,n,0<(4&s)):512&s||16&s?fe(e,t):1024&s?(ge(e.children,e.type,a,!1),e.dom=fe(R(),t)):void 0}function fe(e,t){var a=e.dom=document.createTextNode(e.children);return d(t)||b(t,a),a}function _e(e,t,n,s){var r=e.flags,l=e.children,i=e.props,p=e.className,c=e.ref,u=e.childFlags;s=s||0<(32&r);var h=E(e.type,s);if(e.dom=h,a(p)||""===p||(s?h.setAttribute("class",p):h.className=p),d(t)||b(t,h),0==(1&u)){var m=!0===s&&"foreignObject"!==e.type;2===u?ge(l,h,n,m):12&u&&ye(l,h,n,m)}return d(i)||ue(e,r,i,h,s),o(c)&&De(h,c),h}function ye(e,t,a,n){for(var s=0,o=e.length,r;s<o;s++)r=e[s],d(r.dom)||(e[s]=r=T(r)),ge(r,t,a,n)}function ve(e,t,a,n,s){var o=e.type,r=e.props||qt,l=e.ref,i;if(s){var p=he(e,o,r,a);e.dom=i=ge(p.$LI,null,p.$CX,n),we(e,l,p),p.$UPD=!1}else{var c=me(o(r,a),e);e.children=c,e.dom=i=ge(c,null,a,n),Re(r,l,i)}return d(t)||b(t,i),i}function ke(e){return function(){e.componentDidMount()}}function we(e,t,a){o(t)&&t(a),o(a.componentDidMount)&&Gt.push(ke(a))}function Te(e,t,a){return function(){return e.onComponentDidMount(t,a)}}function Re(e,t,n){a(t)||(o(t.onComponentWillMount)&&t.onComponentWillMount(e),o(t.onComponentDidMount)&&Gt.push(Te(t,n,e)))}function De(e,t){Gt.push(function(){return t(e)})}function xe(e,t,a,n,s){var o=e.type,r=e.ref,l=e.props||qt;if(s){var i=he(e,o,l,a),d=i.$LI;be(d,t,i.$CX,n),e.dom=d.dom,we(e,r,i),i.$UPD=!1}else{var p=me(o(l,a),e);be(p,t,a,n),e.children=p,e.dom=p.dom,Re(l,r,t)}}function Ce(e,t,n,s){var r=e.children,l=e.props,p=e.className,c=e.flags,u=e.ref;if(s=s||0<(32&c),1!==t.nodeType||t.tagName.toLowerCase()!==e.type){var h=_e(e,null,n,s);e.dom=h,z(t.parentNode,h,t)}else{e.dom=t;var m=t.firstChild,g=e.childFlags;if(0==(1&g)){for(var f=null;m;)f=m.nextSibling,8===m.nodeType&&("!"===m.data?t.replaceChild(document.createTextNode(""),m):t.removeChild(m)),m=f;if(m=t.firstChild,2===g)d(m)?ge(r,t,n,s):(f=m.nextSibling,be(r,m,n,s),m=f);else if(12&g)for(var _=0,y=r.length,v;_<y;_++)v=r[_],d(m)?ge(v,t,n,s):(f=m.nextSibling,be(v,m,n,s),m=f);for(;m;)f=m.nextSibling,t.removeChild(m),m=f}else d(t.firstChild)||V(t,l)||(t.textContent="",448&c&&(t.defaultValue=""));d(l)||ue(e,c,l,t,s),a(p)?""!==t.className&&t.removeAttribute("class"):s?t.setAttribute("class",p):t.className=p,o(u)&&De(t,u)}}function Se(e,t){if(3!==t.nodeType){var a=fe(e,null);e.dom=a,z(t.parentNode,a,t)}else{var n=e.children;t.nodeValue!==n&&(t.nodeValue=n),e.dom=t}}function be(e,t,a,n){var s=e.flags;14&s?xe(e,t,a,n,0<(4&s)):481&s?Ce(e,t,a,n):16&s?Se(e,t):512&s?e.dom=t:u()}function Pe(e,t,a){var n=t.firstChild;if(!d(n))for(s(e)||be(e,n,qt,!1),n=t.firstChild;n=n.nextSibling;)t.removeChild(n);0<Gt.length&&L(Gt),t.$V=e,o(a)&&a()}function Ee(e,t,a,n,s){se(e),z(a,ge(t,null,n,s),e.dom)}function ze(e,t,a,n,s){if(e!==t){var o=0|t.flags;e.flags!==o||2048&o?Ee(e,t,a,n,s):481&o?Le(e,t,a,n,s):14&o?Fe(e,t,a,n,s,0<(4&o)):16&o?Oe(e,t,a):512&o?t.dom=e.dom:Ie(e,t,n)}}function Ie(e,t,a){var n=e.type,o=t.type,r=t.children;if(Ae(e.childFlags,t.childFlags,e.children,r,n,a,!1),t.dom=e.dom,n!==o&&!s(r)){var l=r.dom;n.removeChild(l),o.appendChild(l)}}function Le(e,t,n,s,r){var l=t.type;if(e.type!==l)Ee(e,t,n,s,r);else{var i=e.dom,d=t.flags,p=e.props,c=t.props,u=!1,h=!1,m;if(t.dom=i,r=r||0<(32&d),p!==c){var g=p||qt;if(m=c||qt,m!==qt)for(var f in u=0<(448&d),u&&(h=ae(m)),m){var _=g[f],y=m[f];_!==y&&ce(f,_,y,i,r,h,e)}if(g!==qt)for(var v in g)m.hasOwnProperty(v)||a(g[v])||ce(v,g[v],null,i,r,h,e)}var k=e.children,w=t.children,T=t.ref,R=e.className,D=t.className;k!==w&&Ae(e.childFlags,t.childFlags,k,w,i,s,r&&"foreignObject"!==l),u&&ee(d,t,i,m,!1,h),R!==D&&(a(D)?i.removeAttribute("class"):r?i.setAttribute("class",D):i.className=D),o(T)&&e.ref!==T&&De(i,T)}}function Ae(e,t,a,n,s,o,r){switch(e){case 2:switch(t){case 2:ze(a,n,s,o,r);break;case 1:ne(a,s);break;default:ne(a,s),ye(n,s,o,r);}break;case 1:switch(t){case 2:ge(n,s,o,r);break;case 1:break;default:ye(n,s,o,r);}break;default:if(12&t){var l=a.length,i=n.length;0===l?0<i&&ye(n,s,o,r):0===i?re(s,a):8===t&&8===e?Ne(a,n,s,o,r,l,i):Ue(a,n,s,o,r,l,i)}else 1===t?re(s,a):(re(s,a),ge(n,s,o,r));}}function Me(e,t,n,s,r,l,i,d,p){var c=e.state,u=e.props;n.children=e;var h;if(!e.$UN){if(u!==s||s===qt){if(!p&&o(e.componentWillReceiveProps)){if(e.$BR=!0,e.componentWillReceiveProps(s,l),e.$UN)return;e.$BR=!1}e.$PSS&&(t=m(t,e.$PS),e.$PSS=!1,e.$PS=null)}var g=!!e.shouldComponentUpdate;if(d||!g||g&&e.shouldComponentUpdate(s,t,l)){o(e.componentWillUpdate)&&(e.$BS=!0,e.componentWillUpdate(s,t,l),e.$BS=!1),e.props=s,e.state=t,e.context=l,o(Wt.beforeRender)&&Wt.beforeRender(e),h=e.render(s,t,l),o(Wt.afterRender)&&Wt.afterRender(e);var f="$NO_OP"!==h,_;if(o(e.getChildContext)&&(_=e.getChildContext()),_=a(_)?l:m(l,_),e.$CX=_,f){var y=e.$LI,v=e.$LI=me(h,n);ze(y,v,r,_,i),o(e.componentDidUpdate)&&e.componentDidUpdate(u,c)}}else e.props=s,e.state=t,e.context=l;n.dom=e.$LI.dom}}function Fe(e,t,n,s,r,l){var i=t.type,d=e.key,p=t.key;if(e.type!==i||d!==p)Ee(e,t,n,s,r);else{var c=t.props||qt;if(l){var u=e.children;u.$UPD=!0,u.$V=t,Me(u,u.state,t,c,n,s,r,!1,!1),u.$UPD=!1}else{var h=!0,m=e.props,g=t.ref,f=!a(g),_=e.children;if(t.dom=e.dom,t.children=_,f&&o(g.onComponentShouldUpdate)&&(h=g.onComponentShouldUpdate(m,c)),!1!==h){f&&o(g.onComponentWillUpdate)&&g.onComponentWillUpdate(m,c);var y=i(c,s);"$NO_OP"!==y&&(y=me(y,t),ze(_,y,n,s,r),t.children=y,t.dom=y.dom,f&&o(g.onComponentDidUpdate)&&g.onComponentDidUpdate(m,c))}else 14&_.flags&&(_.parentVNode=t)}}}function Oe(e,t,a){var n=t.children,s=a.firstChild,o;d(s)?(a.textContent=n,o=a.firstChild):(o=e.dom,n!==e.children&&(o.nodeValue=n)),t.dom=o}function Ue(e,t,a,n,s,o,r){for(var l=o>r?r:o,d=0,p,c;d<l;d++)p=t[d],c=e[d],p.dom&&(p=t[d]=T(p)),ze(c,p,a,n,s),e[d]=p;if(o<r)for(d=l;d<r;d++)p=t[d],p.dom&&(p=t[d]=T(p)),ge(p,a,n,s);else if(o>r)for(d=l;d<o;d++)ne(e[d],a)}function Ne(e,t,a,n,s,o,r){var l=o-1,d=r-1,p=0,c=e[p],u=t[p],h,m;outer:{for(;c.key===u.key;){if(u.dom&&(t[p]=u=T(u)),ze(c,u,a,n,s),e[p]=u,p++,p>l||p>d)break outer;c=e[p],u=t[p]}for(c=e[l],u=t[d];c.key===u.key;){if(u.dom&&(t[d]=u=T(u)),ze(c,u,a,n,s),e[l]=u,l--,d--,p>l||p>d)break outer;c=e[l],u=t[d]}}if(p>l){if(p<=d){m=d+1;for(var g=m<r?t[m].dom:null;p<=d;)u=t[p],u.dom&&(t[p]=u=T(u)),p++,P(a,ge(u,null,n,s),g)}}else if(p>d)for(;p<=l;)ne(e[p++],a);else{var f=p,_=p,y=l-p+1,v=d-p+1,k=[];for(h=0;h<v;h++)k.push(0);var w=y===o,R=!1,D=0,x=0;if(4>r||32>(y|v)){for(h=f;h<=l;h++)if(c=e[h],x<v){for(p=_;p<=d;p++)if(u=t[p],c.key===u.key){if(k[p-_]=h+1,w)for(w=!1;h>f;)ne(e[f++],a);D>p?R=!0:D=p,u.dom&&(t[p]=u=T(u)),ze(c,u,a,n,s),x++;break}!w&&p>d&&ne(c,a)}else w||ne(c,a);}else{var C={};for(h=_;h<=d;h++)C[t[h].key]=h;for(h=f;h<=l;h++)if(c=e[h],!(x<v))w||ne(c,a);else if(p=C[c.key],void 0!==p){if(w)for(w=!1;h>f;)ne(e[f++],a);u=t[p],k[p-_]=h+1,D>p?R=!0:D=p,u.dom&&(t[p]=u=T(u)),ze(c,u,a,n,s),x++}else w||ne(c,a)}if(w)re(a,e),ye(t,a,n,s);else if(R){var S=Ve(k);for(p=S.length-1,h=v-1;0<=h;h--)0===k[h]?(D=h+_,u=t[D],u.dom&&(t[D]=u=T(u)),m=D+1,P(a,ge(u,null,n,s),m<r?t[m].dom:null)):0>p||h!==S[p]?(D=h+_,u=t[D],m=D+1,P(a,u.dom,m<r?t[m].dom:null)):p--}else if(x!==v)for(h=v-1;0<=h;h--)0===k[h]&&(D=h+_,u=t[D],u.dom&&(t[D]=u=T(u)),m=D+1,P(a,ge(u,null,n,s),m<r?t[m].dom:null))}}function Ve(e){var t=e.slice(),a=[0],n=e.length,s,o,r,l,d;for(s=0;s<n;s++){var p=e[s];if(0!==p){if(o=a[a.length-1],e[o]<p){t[s]=o,a.push(s);continue}for(r=0,l=a.length-1;r<l;)d=0|(r+l)/2,e[a[d]]<p?r=d+1:l=d;p<e[a[r]]&&(0<r&&(t[s]=a[r-1]),a[r]=s)}}for(r=a.length,l=a[r-1];0<r--;)a[r]=l,l=t[l];return a}function je(e,t,n){if("$NO_OP"!==e){var r=t.$V;if(a(r)?!s(e)&&(e.dom&&(e=T(e)),d(t.firstChild)?(ge(e,t,qt,!1),t.$V=e):Pe(e,t),r=e):a(e)?(ne(r,t),t.$V=null):(e.dom&&(e=T(e)),ze(r,e,t,qt,!1),r=t.$V=e),0<Gt.length&&L(Gt),o(n)&&n(),o(Wt.renderComplete)&&Wt.renderComplete(r),r&&14&r.flags)return r.children}}function We(e){return aa?aa.then(e):na(e)}function Be(e,t,n,s){o(t)&&(t=t(e.state,e.props,e.context));var r=e.$PS;if(a(r))e.$PS=t;else for(var l in t)r[l]=t[l];if(e.$PSS||e.$BR)e.$PSS=!0,e.$BR&&o(n)&&Gt.push(n.bind(e));else if(!e.$UPD)e.$PSS=!0,e.$UPD=!0,Ye(e,s,n),e.$UPD=!1;else{var i=e.$QU;d(i)&&(i=e.$QU=[],We(He(e,i))),o(n)&&i.push(n)}}function He(e,t){return function(){e.$QU=null,e.$UPD=!0,Ye(e,!1,function(){for(var a=0,n=t.length;a<n;a++)t[a].call(e)}),e.$UPD=!1}}function Ye(e,t,a){if(!e.$UN){if(t||!e.$BR){e.$PSS=!1;var n=e.$PS,s=e.state,r=m(s,n),l=e.props,i=e.context;e.$PS=null;var p=e.$V,c=e.$LI,u=c.dom&&c.dom.parentNode;if(Me(e,r,p,l,u,i,0<(32&p.flags),t,!0),e.$UN)return;if(0==(1024&e.$LI.flags))for(var h=e.$LI.dom;!d(p=p.parentVNode);)0<(14&p.flags)&&(p.dom=h);0<Gt.length&&L(Gt)}else e.state=e.$PS,e.$PS=null;o(a)&&a.call(e)}}function qe(e){var t=typeof e;return"string"==t||"number"==t}function Ge(e){return"string"==typeof e}function $e(e){return void 0===e}function Xe(e,t){if(!e)return"div";var a=t&&$e(t.id),n=e.split(la),s=null;ia.test(n[1])&&(s="div");for(var o=0,r=n.length,l,d;o<r;o++)if(d=n[o],!!d){var p=d.charAt(0);s?"."===p?(void 0===l&&(l=[]),l.push(d.substring(1,d.length))):"#"===p&&a&&(t.id=d.substring(1,d.length)):s=d}return l&&(t.className&&l.push(t.className),t.className=l.join(" ")),s||"div"}function Ze(e){return qe(e)||e&&ra(e)}function Ke(e,t,a){e=e||{};var n=t?Xe(a,e):a,s={},o=null,r=null,l=null,i=null;for(var d in e)t&&("className"==d||"class"==d)?i=e[d]:"key"==d?o=e[d]:"ref"==d?r=e[d]:"hooks"==d?r=e[d]:"children"==d?l=e[d]:t||"onComponent"!==d.substr(0,11)?s[d]=e[d]:(r||(r={}),r[d]=e[d]);return{tag:n,props:s,key:o,ref:r,children:l,className:i}}function Je(e,t,a){!a&&Ze(t)&&(a=t,t={});var n=Ge(e),s=Ke(t,n,e),o=s.tag,r=s.props,l=s.key,i=s.ref,d=s.children,p=s.className;return n?y(x(o),o,p,a||d,0,r,l,i):((d||a)&&(r.children=d||a),v(2,o,r,l,i))}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function h(e,t){return t={exports:{}},e(t,t.exports),t.exports}function Qe(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame(function(){var a=e.__resizeTrigger__,n=a&&a.__resizeListeners__;n&&n.forEach(function(e){e.call(a,t)})})}function et(e,t){return td.call(e,t)}function tt(e){if(Array.isArray(e)){for(var t=Array(e.length),a=0;a<t.length;a++)t[a]=""+a;return t}if(Object.keys)return Object.keys(e);var t=[];for(var n in e)et(e,n)&&t.push(n);return t}function at(e){for(var t=0,a=e.length,n;t<a;){if(n=e.charCodeAt(t),48<=n&&57>=n){t++;continue}return!1}return!0}function nt(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function st(e,t){var a;for(var n in e)if(et(e,n)){if(e[n]===t)return nt(n)+"/";if("object"==typeof e[n]&&(a=st(e[n],t),""!=a))return nt(n)+"/"+a}return""}function ot(e){if(e===void 0)return!0;if(e)if(Array.isArray(e)){for(var t=0,a=e.length;t<a;t++)if(ot(e[t]))return!0;}else if("object"==typeof e)for(var n=tt(e),s=n.length,t=0;t<s;t++)if(ot(e[n[t]]))return!0;return!1}function rt(e){return Cd.get(e)}function lt(e,t){return e.observers.get(t)}function it(e,t){e.observers.delete(t.callback)}function dt(e){var t=Cd.get(e.object);pt(t.value,e.object,e.patches,""),e.patches.length&&sd.applyPatch(t.value,e.patches);var a=e.patches;return 0<a.length&&(e.patches=[],e.callback&&e.callback(a)),a}function pt(e,a,n,s){if(a!==e){"function"==typeof a.toJSON&&(a=a.toJSON());for(var o=nd._objectKeys(a),r=nd._objectKeys(e),l=!1,i=r.length-1;0<=i;i--){var d=r[i],p=e[d];if(nd.hasOwnProperty(a,d)&&(void 0!==a[d]||void 0===p||!1!==Array.isArray(a))){var c=a[d];"object"==typeof p&&null!=p&&"object"==typeof c&&null!=c?pt(p,c,n,s+"/"+nd.escapePathComponent(d)):p!==c&&n.push({op:"replace",path:s+"/"+nd.escapePathComponent(d),value:nd._deepClone(c)})}else n.push({op:"remove",path:s+"/"+nd.escapePathComponent(d)}),l=!0}if(l||o.length!=r.length)for(var i=0,d;i<o.length;i++)d=o[i],nd.hasOwnProperty(e,d)||void 0===a[d]||n.push({op:"add",path:s+"/"+nd.escapePathComponent(d),value:nd._deepClone(a[d])})}}function ct(e){var t,a;this.promise=new e(function(e,n){if(t!==void 0||a!==void 0)throw TypeError("Bad Promise constructor");t=e,a=n}),this.resolve=ha(t),this.reject=ha(a)}function ut(e,t){function a(){this.constructor=e}Mc(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}function ht(a,n){var e={};for(var t in a)Object.prototype.hasOwnProperty.call(a,t)&&0>n.indexOf(t)&&(e[t]=a[t]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,t=Object.getOwnPropertySymbols(a);s<t.length;s++)0>n.indexOf(t[s])&&Object.prototype.propertyIsEnumerable.call(a,t[s])&&(e[t[s]]=a[t[s]]);return e}function mt(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],n=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function gt(t,a){var s="function"==typeof Symbol&&t[Symbol.iterator];if(!s)return t;var o=s.call(t),l=[],i,d;try{for(;(void 0===a||0<a--)&&!(i=o.next()).done;)l.push(i.value)}catch(e){d={error:e}}finally{try{i&&!i.done&&(s=o["return"])&&s.call(o)}finally{if(d)throw d.error}}return l}function ft(e){return"[object RegExp]"===Uc.call(e)}function _t(e){return"[object Function]"===Uc.call(e)}function yt(e){return Nt(100*e)/100}function vt(e){var t=e.length;if(0<t){if(1===t){var a=e[0],n=a.clientX,s=a.clientY;return{x:Nt(n),y:Nt(s)}}var o=e.reduce(function(e,t){return e.x+=t.clientX,e.y+=t.clientY,e},{x:0,y:0});return{x:Nt(o.x/t),y:Nt(o.y/t)}}}function kt(e){var t=e.inputType,a=e.points,n=e.changedPoints,s=e.nativeEvent,o=a.length,r=performance.now(),l=vt(a)||vt(n),i=l.x,d=l.y,p=s.currentTarget;return Fc(Fc({},e),{x:i,y:d,timestamp:r,isStart:"start"===t,isEnd:"end"===t&&0===o||"cancel"===t,pointLength:o,currentTarget:p,getOffset:function(e){void 0===e&&(e=p);var t=e.getBoundingClientRect();return{x:i-Nt(t.left),y:d-Nt(t.top)}}})}function wt(e,t,a){var n=t.target,s=t.currentTarget,o=t.type,r=ht(t,["target","currentTarget","type"]),l;return void 0===Event?(l=document.createEvent("HTMLEvents"),l.initEvent(o,null===a||void 0===a?void 0:a.bubbles,null===a||void 0===a?void 0:a.cancelable)):l=new Event(o,a),Object.assign(l,r,{match:function(){return t.targets.every(function(e){return l.currentTarget.contains(e)})}}),e.dispatchEvent(l)}function Tt(e,t){if(!t.isPreventDefault)return!1;var a=!0;if(null!==e.target){var n=t.preventDefaultExclude;if(!ft(n))_t(n)&&(a=!n(e));else if("tagName"in e.target){var s=e.target.tagName;a=!n.test(s)}}return a}function Rt(e,t,a){return qc?(Kc.forEach(function(n){e.addEventListener(n,t,a)}),function(){Kc.forEach(function(a){e.removeEventListener(a,t)})}):(e.addEventListener("mousedown",t,a),window.addEventListener("mousemove",t,a),window.addEventListener("mouseup",t,a),function(){e.removeEventListener("mousedown",t),window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",t)})}function Dt(e,t,a){var n=null===a||void 0===a?void 0:a.name;if(void 0===n||void 0===e.recognizerMap[n]){var s=new t(a);e.recognizerMap[s.name]=s,s.recognizerMap=e.recognizerMap,e.recognizers.push(e.recognizerMap[s.name])}}function xt(e,t){var a,n;if(void 0===t)e.recognizers=[],e.recognizerMap={};else try{for(var s=mt(e.recognizers.entries()),o=s.next();!o.done;o=s.next()){var r=gt(o.value,2),l=r[0],i=r[1];if(t===i.options.name){e.recognizers.splice(l,1),delete e.recognizerMap[t];break}}}catch(e){a={error:e}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}}function Ct(e,t){var a=t.type,n=t.target,s=t.targets;e.emit(a,t,function(e){if(void 0!==(null===e||void 0===e?void 0:e.target)){var t=e.target;return s.every(function(e){return t.contains(e)})}return!0});e.emit("at:after",t),!e.options.domEvents||void 0===e.el||null===n||(wt(n,t,e.options.domEvents),wt(n,Fc(Fc({},t),{type:"at:after"}),e.options.domEvents))}function St(e){var t=e.startV,a=e.prevV,n=e.activeV,s=yt(eu(n)/eu(a)),o=yt(eu(n)/eu(t));return{scale:o,deltaScale:s}}function bt(e){return{x:e.points[1].clientX-e.points[0].clientX,y:e.points[1].clientY-e.points[0].clientY}}function Pt(){return function(e){var t=e.prevInput,a=e.startMultiInput;if(void 0!==a&&void 0!==t&&e.id!==a.id&&1<e.pointLength)return{startV:bt(a),prevV:bt(t),activeV:bt(e)}}}function Et(e){-1!==["end","cancel","r","f"].indexOf(e.status)&&(e.status="p")}function zt(e,t,a){var n={1:(s={},s.p=(o={},o.move="start",o),s.start=(r={},r.move="move",r.end="end",r.cancel="cancel",r),s.move=(l={},l.move="move",l.end="end",l.cancel="cancel",l),s),0:(i={},i.start=(d={},d.move="cancel",d.end="end",d.cancel="cancel",d),i.move=(p={},p.start="f",p.move="cancel",p.end="end",p.cancel="cancel",p),i)},s,o,r,l,i,d,p;return void 0===n[+e][t]?t:n[+e][t][a]||t}function It(e,t,a){var n=e.test(t);Et(e);var s=t.inputType;e.status=zt(n,e.status,s);var o=e.computed;e.isRecognized=["start","move"].includes(e.status);var r=e.name,l=e.status,i=e.isRecognized;return i&&a(r,o),(i||["end","cancel"].includes(e.status))&&a(r+l,o),n}function Lt(e){if(e instanceof Element||e instanceof HTMLDocument)return e;return e&&""!=e?document.querySelector(e):void 0}var Vt=!!("undefined"!=typeof window&&window.document),jt=Array.isArray,Wt={afterRender:null,beforeRender:null,createVNode:null,renderComplete:null},Bt="http://www.w3.org/1999/xlink",Ht="http://www.w3.org/XML/1998/namespace",Yt={"xlink:actuate":Bt,"xlink:arcrole":Bt,"xlink:href":Bt,"xlink:role":Bt,"xlink:show":Bt,"xlink:title":Bt,"xlink:type":Bt,"xml:base":Ht,"xml:lang":Ht,"xml:space":Ht},qt={},Gt=[],$t={},Xt={},Zt=B("onInput",G),Kt=B(["onClick","onChange"],G);Y.wrapped=!0;var Jt=B("onChange",K),Qt=B("onInput",Q),ea=B("onChange"),ta=Vt?document.body:null,aa="undefined"==typeof Promise?null:Promise.resolve(),na="undefined"==typeof requestAnimationFrame?setTimeout:requestAnimationFrame.bind(window),sa=function(e,t){this.state=null,this.$BR=!1,this.$BS=!0,this.$PSS=!1,this.$PS=null,this.$LI=null,this.$V=null,this.$UN=!1,this.$CX=null,this.$UPD=!0,this.$QU=null,this.props=e||qt,this.context=t||qt};sa.prototype.forceUpdate=function(e){this.$UN||Be(this,{},e,!0)},sa.prototype.setState=function(e,t){this.$UN||!this.$BS&&Be(this,e,t,!1)},sa.prototype.render=function(){};var oa=!!("undefined"!=typeof window&&window.document),ra=Array.isArray,la=/([.#]?[a-zA-Z0-9_:-]+)/,ia=/^\.|#/,da="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,pa=h(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),ca=h(function(e){var t=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=t)}),ua=ca.version,ha=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e},ma=function(e,t,a){return(ha(e),void 0===t)?e:1===a?function(n){return e.call(t,n)}:2===a?function(n,a){return e.call(t,n,a)}:3===a?function(n,a,s){return e.call(t,n,a,s)}:function(){return e.apply(t,arguments)}},ga=function(e){return"object"==typeof e?null!==e:"function"==typeof e},fa=function(e){if(!ga(e))throw TypeError(e+" is not an object!");return e},_a=function(e){try{return!!e()}catch(t){return!0}},ya=!_a(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),va=pa.document,ka=ga(va)&&ga(va.createElement),wa=function(e){return ka?va.createElement(e):{}},Ta=!ya&&!_a(function(){return 7!=Object.defineProperty(wa("div"),"a",{get:function(){return 7}}).a}),Ra=function(e,t){if(!ga(e))return e;var a,n;if(t&&"function"==typeof(a=e.toString)&&!ga(n=a.call(e)))return n;if("function"==typeof(a=e.valueOf)&&!ga(n=a.call(e)))return n;if(!t&&"function"==typeof(a=e.toString)&&!ga(n=a.call(e)))return n;throw TypeError("Can't convert object to primitive value")},Da=Object.defineProperty,xa=ya?Object.defineProperty:function(e,t,a){if(fa(e),t=Ra(t,!0),fa(a),Ta)try{return Da(e,t,a)}catch(t){}if("get"in a||"set"in a)throw TypeError("Accessors not supported!");return"value"in a&&(e[t]=a.value),e},f={f:xa},Ca=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Sa=ya?function(e,t,a){return f.f(e,t,Ca(1,a))}:function(e,t,a){return e[t]=a,e},ba={}.hasOwnProperty,Pa=function(e,t){return ba.call(e,t)},Ea="prototype",za=function(e,t,a){var n=e&za.F,s=e&za.G,o=e&za.S,r=e&za.P,l=e&za.B,i=e&za.W,d=s?ca:ca[t]||(ca[t]={}),p=d[Ea],c=s?pa:o?pa[t]:(pa[t]||{})[Ea],u,h,m;for(u in s&&(a=t),a)h=!n&&c&&void 0!==c[u],h&&Pa(d,u)||(m=h?c[u]:a[u],d[u]=s&&"function"!=typeof c[u]?a[u]:l&&h?ma(m,pa):i&&c[u]==m?function(e){var t=function(t,a,n){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,a);}return new e(t,a,n)}return e.apply(this,arguments)};return t[Ea]=e[Ea],t}(m):r&&"function"==typeof m?ma(Function.call,m):m,r&&((d.virtual||(d.virtual={}))[u]=m,e&za.R&&p&&!p[u]&&Sa(p,u,m)))};za.F=1,za.G=2,za.S=4,za.P=8,za.B=16,za.W=32,za.U=64,za.R=128;var Ia=za,La=function(e){if(e==null)throw TypeError("Can't call method on  "+e);return e},Aa="\t\n\x0B\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",Ma="["+Aa+"]",Fa="\u200B\x85",Oa=RegExp("^"+Ma+Ma+"*"),Ua=RegExp(Ma+Ma+"*$"),Na=function(e,t,a){var n={},s=_a(function(){return!!Aa[e]()||Fa[e]()!=Fa}),o=n[e]=s?t(Va):Aa[e];a&&(n[a]=o),Ia(Ia.P+Ia.F*s,"String",n)},Va=Na.trim=function(e,t){return e=La(e)+"",1&t&&(e=e.replace(Oa,"")),2&t&&(e=e.replace(Ua,"")),e},ja=Na,Wa=pa.parseInt,Ba=ja.trim,Ha=/^[-+]?0[xX]/,Ya=8!==Wa(Aa+"08")||22!==Wa(Aa+"0x16")?function(e,t){var a=Ba(e+"",3);return Wa(a,t>>>0||(Ha.test(a)?16:10))}:Wa;Ia(Ia.S+Ia.F*(Number.parseInt!=Ya),"Number",{parseInt:Ya});var qa=ca.Number.parseInt,Ga=h(function(e){e.exports={default:qa,__esModule:!0}}),$a=n(Ga),Xa=function(e){return Object(La(e))},Za="__core-js_shared__",Ka=pa[Za]||(pa[Za]={}),Ja=function(e){return Ka[e]||(Ka[e]={})},Qa=0,en=Math.random(),tn=function(e){return"Symbol(".concat(e===void 0?"":e,")_",(++Qa+en).toString(36))},an=Ja("keys"),nn=function(e){return an[e]||(an[e]=tn(e))},sn=nn("IE_PROTO"),on=Object.prototype,rn=Object.getPrototypeOf||function(e){return e=Xa(e),Pa(e,sn)?e[sn]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?on:null},ln=function(e,t){var a=(ca.Object||{})[e]||Object[e],n={};n[e]=t(a),Ia(Ia.S+Ia.F*_a(function(){a(1)}),"Object",n)};ln("getPrototypeOf",function(){return function(e){return rn(Xa(e))}});var dn=ca.Object.getPrototypeOf,pn=h(function(e){e.exports={default:dn,__esModule:!0}}),cn=n(pn),un=h(function(e,t){t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}}),hn=n(un);Ia(Ia.S+Ia.F*!ya,"Object",{defineProperty:f.f});var mn=ca.Object,gn=function(e,t,a){return mn.defineProperty(e,t,a)},fn=h(function(e){e.exports={default:gn,__esModule:!0}});n(fn);var _n=h(function(e,t){t.__esModule=!0;var a=function(e){return e&&e.__esModule?e:{default:e}}(fn);t.default=function(){function e(e,t){for(var n=0,s;n<t.length;n++)s=t[n],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),(0,a.default)(e,s.key,s)}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}()}),yn=n(_n),vn=function(e){return isNaN(e=+e)?0:(0<e?Ot:Ut)(e)},kn=!0,wn=Sa,Tn={},Rn={}.toString,Dn=function(e){return Rn.call(e).slice(8,-1)},xn=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==Dn(e)?e.split(""):Object(e)},Cn=function(e){return xn(La(e))},Sn=function(e){return 0<e?Ft(vn(e),9007199254740991):0},bn=function(e,t){return e=vn(e),0>e?Mt(e+t,0):Ft(e,t)},Pn=function(e){return function(t,a,n){var s=Cn(t),o=Sn(s.length),r=bn(n,o),l;if(e&&a!=a){for(;o>r;)if(l=s[r++],l!=l)return!0;}else for(;o>r;r++)if((e||r in s)&&s[r]===a)return e||r||0;return!e&&-1}}(!1),En=nn("IE_PROTO"),zn=function(e,t){var a=Cn(e),n=0,s=[],o;for(o in a)o!=En&&Pa(a,o)&&s.push(o);for(;t.length>n;)Pa(a,o=t[n++])&&(~Pn(s,o)||s.push(o));return s},In=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ln=Object.keys||function(e){return zn(e,In)},An=ya?Object.defineProperties:function(e,t){fa(e);for(var a=Ln(t),n=a.length,s=0,o;n>s;)f.f(e,o=a[s++],t[o]);return e},Mn=pa.document,Fn=Mn&&Mn.documentElement,On=nn("IE_PROTO"),Un=function(){},Nn="prototype",Vn=function(){var e=wa("iframe"),t=In.length,a="<",n=">",s;for(e.style.display="none",Fn.appendChild(e),e.src="javascript:",s=e.contentWindow.document,s.open(),s.write(a+"script"+n+"document.F=Object"+a+"/script"+n),s.close(),Vn=s.F;t--;)delete Vn[Nn][In[t]];return Vn()},jn=Object.create||function(e,t){var a;return null===e?a=Vn():(Un[Nn]=fa(e),a=new Un,Un[Nn]=null,a[On]=e),void 0===t?a:An(a,t)},Wn=h(function(e){var t=Ja("wks"),a=pa.Symbol,n="function"==typeof a,s=e.exports=function(e){return t[e]||(t[e]=n&&a[e]||(n?a:tn)("Symbol."+e))};s.store=t}),Bn=f.f,Hn=Wn("toStringTag"),Yn=function(e,t,a){e&&!Pa(e=a?e:e.prototype,Hn)&&Bn(e,Hn,{configurable:!0,value:t})},qn={};Sa(qn,Wn("iterator"),function(){return this});var Gn=function(e,t,a){e.prototype=jn(qn,{next:Ca(1,a)}),Yn(e,t+" Iterator")},$n=Wn("iterator"),Xn=!([].keys&&"next"in[].keys()),Zn="keys",Kn="values",Jn=function(){return this},Qn=function(e,t,a,n,s,o,r){Gn(a,t,n);var l=function(e){return!Xn&&e in c?c[e]:e===Zn?function(){return new a(this,e)}:e===Kn?function(){return new a(this,e)}:function(){return new a(this,e)}},i=t+" Iterator",d=s==Kn,p=!1,c=e.prototype,u=c[$n]||c["@@iterator"]||s&&c[s],h=u||l(s),m=s?d?l("entries"):h:void 0,g="Array"==t?c.entries||u:u,f,_,y;if(g&&(y=rn(g.call(new e)),y!==Object.prototype&&y.next&&(Yn(y,i,!0),!kn&&"function"!=typeof y[$n]&&Sa(y,$n,Jn))),d&&u&&u.name!==Kn&&(p=!0,h=function(){return u.call(this)}),(!kn||r)&&(Xn||p||!c[$n])&&Sa(c,$n,h),Tn[t]=h,Tn[i]=Jn,s)if(f={values:d?h:l(Kn),keys:o?h:l(Zn),entries:m},r)for(_ in f)_ in c||wn(c,_,f[_]);else Ia(Ia.P+Ia.F*(Xn||p),t,f);return f},es=function(e){return function(t,n){var o=La(t)+"",s=vn(n),r=o.length,l,i;return 0>s||s>=r?e?"":void 0:(l=o.charCodeAt(s),55296>l||56319<l||s+1===r||56320>(i=o.charCodeAt(s+1))||57343<i?e?o.charAt(s):l:e?o.slice(s,s+2):(l-55296<<10)+(i-56320)+65536)}}(!0);Qn(String,"String",function(e){this._t=e+"",this._i=0},function(){var e=this._t,t=this._i,a;return t>=e.length?{value:void 0,done:!0}:(a=es(e,t),this._i+=a.length,{value:a,done:!1})});var ts=function(e,t){return{value:t,done:!!e}},as=Qn(Array,"Array",function(e,t){this._t=Cn(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,a=this._i++;return!e||a>=e.length?(this._t=void 0,ts(1)):"keys"==t?ts(0,a):"values"==t?ts(0,e[a]):ts(0,[a,e[a]])},"values");Tn.Arguments=Tn.Array;for(var ns=Wn("toStringTag"),ss="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),os=0;os<ss.length;os++){var rs=ss[os],ls=pa[rs],is=ls&&ls.prototype;is&&!is[ns]&&Sa(is,ns,rs),Tn[rs]=Tn.Array}var ds={f:Wn},ps=ds.f("iterator"),cs=h(function(e){e.exports={default:ps,__esModule:!0}});n(cs);var us=h(function(e){var t=tn("meta"),a=f.f,n=0,s=Object.isExtensible||function(){return!0},o=!_a(function(){return s(Object.preventExtensions({}))}),r=function(e){a(e,t,{value:{i:"O"+ ++n,w:{}}})},l=e.exports={KEY:t,NEED:!1,fastKey:function(e,a){if(!ga(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Pa(e,t)){if(!s(e))return"F";if(!a)return"E";r(e)}return e[t].i},getWeak:function(e,a){if(!Pa(e,t)){if(!s(e))return!0;if(!a)return!1;r(e)}return e[t].w},onFreeze:function(e){return o&&l.NEED&&s(e)&&!Pa(e,t)&&r(e),e}}}),hs=us.KEY,ms=us.NEED,gs=us.fastKey,fs=us.getWeak,_s=us.onFreeze,ys=f.f,vs=function(e){var t=ca.Symbol||(ca.Symbol={});"_"==e.charAt(0)||e in t||ys(t,e,{value:ds.f(e)})},ks=Object.getOwnPropertySymbols,ws={f:ks},Ts={}.propertyIsEnumerable,Rs={f:Ts},Ds=function(e){var t=Ln(e),a=ws.f;if(a)for(var n=a(e),s=Rs.f,o=0,r;n.length>o;)s.call(e,r=n[o++])&&t.push(r);return t},xs=Array.isArray||function(e){return"Array"==Dn(e)},Cs=In.concat("length","prototype"),Ss=Object.getOwnPropertyNames||function(e){return zn(e,Cs)},bs={f:Ss},Ps=bs.f,Es={}.toString,zs="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Is=function(e){try{return Ps(e)}catch(t){return zs.slice()}},Ls={f:function(e){return zs&&"[object Window]"==Es.call(e)?Is(e):Ps(Cn(e))}},As=Object.getOwnPropertyDescriptor,Ms=ya?As:function(e,t){if(e=Cn(e),t=Ra(t,!0),Ta)try{return As(e,t)}catch(t){}return Pa(e,t)?Ca(!Rs.f.call(e,t),e[t]):void 0},Fs={f:Ms},Os=us.KEY,Us=Fs.f,Ns=f.f,Vs=Ls.f,js=pa.Symbol,Ws=pa.JSON,Bs=Ws&&Ws.stringify,Hs="prototype",Ys=Wn("_hidden"),qs=Wn("toPrimitive"),Gs={}.propertyIsEnumerable,$s=Ja("symbol-registry"),Xs=Ja("symbols"),Zs=Ja("op-symbols"),Ks=Object[Hs],Js="function"==typeof js,Qs=pa.QObject,eo=!Qs||!Qs[Hs]||!Qs[Hs].findChild,to=ya&&_a(function(){return 7!=jn(Ns({},"a",{get:function(){return Ns(this,"a",{value:7}).a}})).a})?function(e,t,a){var n=Us(Ks,t);n&&delete Ks[t],Ns(e,t,a),n&&e!==Ks&&Ns(Ks,t,n)}:Ns,ao=function(e){var t=Xs[e]=jn(js[Hs]);return t._k=e,t},no=Js&&"symbol"==typeof js.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof js},so=function(e,t,a){return e===Ks&&so(Zs,t,a),fa(e),t=Ra(t,!0),fa(a),Pa(Xs,t)?(a.enumerable?(Pa(e,Ys)&&e[Ys][t]&&(e[Ys][t]=!1),a=jn(a,{enumerable:Ca(0,!1)})):(!Pa(e,Ys)&&Ns(e,Ys,Ca(1,{})),e[Ys][t]=!0),to(e,t,a)):Ns(e,t,a)},oo=function(e,t){fa(e);for(var a=Ds(t=Cn(t)),n=0,s=a.length,o;s>n;)so(e,o=a[n++],t[o]);return e},ro=function(e){var t=Gs.call(this,e=Ra(e,!0));return(this!==Ks||!Pa(Xs,e)||Pa(Zs,e))&&(!(t||!Pa(this,e)||!Pa(Xs,e)||Pa(this,Ys)&&this[Ys][e])||t)},lo=function(e,t){if(e=Cn(e),t=Ra(t,!0),e!==Ks||!Pa(Xs,t)||Pa(Zs,t)){var a=Us(e,t);return a&&Pa(Xs,t)&&!(Pa(e,Ys)&&e[Ys][t])&&(a.enumerable=!0),a}},io=function(e){for(var t=Vs(Cn(e)),a=[],n=0,s;t.length>n;)Pa(Xs,s=t[n++])||s==Ys||s==Os||a.push(s);return a},po=function(e){for(var t=e===Ks,a=Vs(t?Zs:Cn(e)),n=[],s=0,o;a.length>s;)Pa(Xs,o=a[s++])&&(!t||Pa(Ks,o))&&n.push(Xs[o]);return n};Js||(js=function(){if(this instanceof js)throw TypeError("Symbol is not a constructor!");var e=tn(0<arguments.length?arguments[0]:void 0),t=function(a){this===Ks&&t.call(Zs,a),Pa(this,Ys)&&Pa(this[Ys],e)&&(this[Ys][e]=!1),to(this,e,Ca(1,a))};return ya&&eo&&to(Ks,e,{configurable:!0,set:t}),ao(e)},wn(js[Hs],"toString",function(){return this._k}),Fs.f=lo,f.f=so,bs.f=Ls.f=io,Rs.f=ro,ws.f=po,ya&&!kn&&wn(Ks,"propertyIsEnumerable",ro,!0),ds.f=function(e){return ao(Wn(e))}),Ia(Ia.G+Ia.W+Ia.F*!Js,{Symbol:js});for(var co=["hasInstance","isConcatSpreadable","iterator","match","replace","search","species","split","toPrimitive","toStringTag","unscopables"],uo=0;co.length>uo;)Wn(co[uo++]);for(var ho=Ln(Wn.store),mo=0;ho.length>mo;)vs(ho[mo++]);Ia(Ia.S+Ia.F*!Js,"Symbol",{for:function(e){return Pa($s,e+="")?$s[e]:$s[e]=js(e)},keyFor:function(e){if(!no(e))throw TypeError(e+" is not a symbol!");for(var t in $s)if($s[t]===e)return t},useSetter:function(){eo=!0},useSimple:function(){eo=!1}}),Ia(Ia.S+Ia.F*!Js,"Object",{create:function(e,t){return t===void 0?jn(e):oo(jn(e),t)},defineProperty:so,defineProperties:oo,getOwnPropertyDescriptor:lo,getOwnPropertyNames:io,getOwnPropertySymbols:po}),Ws&&Ia(Ia.S+Ia.F*(!Js||_a(function(){var e=js();return"[null]"!=Bs([e])||"{}"!=Bs({a:e})||"{}"!=Bs(Object(e))})),"JSON",{stringify:function(e){for(var t=[e],a=1,n,s;arguments.length>a;)t.push(arguments[a++]);if(s=n=t[1],(ga(n)||void 0!==e)&&!no(e))return xs(n)||(n=function(e,t){if("function"==typeof s&&(t=s.call(this,e,t)),!no(t))return t}),t[1]=n,Bs.apply(Ws,t)}}),js[Hs][qs]||Sa(js[Hs],qs,js[Hs].valueOf),Yn(js,"Symbol"),Yn(Math,"Math",!0),Yn(pa.JSON,"JSON",!0);var go=Object.freeze({});vs("asyncIterator"),vs("observable"),function(e){return e&&e.default||e}(go);var fo=ca.Symbol,_o=h(function(e){e.exports={default:fo,__esModule:!0}});n(_o);var yo=h(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=a(cs),s=a(_o),o="function"==typeof s.default&&"symbol"==typeof n.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};t.default="function"==typeof s.default&&"symbol"===o(n.default)?function(e){return"undefined"==typeof e?"undefined":o(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":"undefined"==typeof e?"undefined":o(e)}}),vo=n(yo),ko=h(function(e,t){t.__esModule=!0;var a=function(e){return e&&e.__esModule?e:{default:e}}(yo);t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"===("undefined"==typeof t?"undefined":(0,a.default)(t))||"function"==typeof t)?t:e}}),wo=n(ko),To=function(e,t){if(fa(e),!ga(t)&&null!==t)throw TypeError(t+": can't set as prototype!")},Ro={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,a){try{a=ma(Function.call,Fs.f(Object.prototype,"__proto__").set,2),a(e,[]),t=!(e instanceof Array)}catch(a){t=!0}return function(e,n){return To(e,n),t?e.__proto__=n:a(e,n),e}}({},!1):void 0),check:To};Ia(Ia.S,"Object",{setPrototypeOf:Ro.set});var Do=ca.Object.setPrototypeOf,xo=h(function(e){e.exports={default:Do,__esModule:!0}});n(xo),Ia(Ia.S,"Object",{create:jn});var Co=ca.Object,So=function(e,t){return Co.create(e,t)},bo=h(function(e){e.exports={default:So,__esModule:!0}});n(bo);var Po=h(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=a(xo),s=a(bo),o=a(yo);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":(0,o.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(n.default?(0,n.default)(e,t):e.__proto__=t)}}),Eo=n(Po),zo=ca.JSON||(ca.JSON={stringify:JSON.stringify}),Io=function(){return zo.stringify.apply(zo,arguments)},Lo=h(function(e){e.exports={default:Io,__esModule:!0}}),Ao=n(Lo),Mo={minWidth:20,headHeightStr:"40px",rowHeight:28,rowHeightStr:"28px",scrollHeight:20},Fo=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.state={resizingCol:null,canSelectAll:!0,shouldUpdate:!0,allVisibleColState:Ao(a.props.columns.allVisibleCol())},a}return Eo(t,e),yn(t,[{key:"onMouseDown",value:function(e,t){var a=t.target,n=t.pageX-a.getBoundingClientRect().left;n<Mo.minWidth?e.state.resizingCol=a.previousElementSibling:a.clientWidth-n<Mo.minWidth&&(e.state.resizingCol=a)}},{key:"onMouseMove",value:function(e,t){var a=t.target,n=t.pageX-a.getBoundingClientRect().left;0<a.cellIndex&&n<Mo.minWidth||a.clientWidth-n<Mo.minWidth?a.parentNode.classList.add("zgrid_resizing"):a.parentNode.classList.remove("zgrid_resizing")}},{key:"componentDidMount",value:function(){var e=this;document.addEventListener("mousemove",function(t){if(e.state.resizingCol){var a=t.pageX-e.state.resizingCol.getBoundingClientRect().left;if(a>Mo.minWidth){e.state.resizingCol.style.width=a+"px";var n=e.state.resizingCol.cellIndex,s=e.state.resizingCol.closest(".zgrid").querySelectorAll(".zgrid_top_cell")[n];s.style.width=a+"px"}}}),document.addEventListener("mouseup",function(t){if(e.state.resizingCol){var a=t.pageX-e.state.resizingCol.getBoundingClientRect().left,n=e.state.resizingCol.getAttribute("colname");a<Mo.minWidth&&(a=Mo.minWidth+10),e.props.columns.setByName(n,"width",a+"px"),e.state.resizingCol.parentNode.classList.remove("zgrid_resizing"),e.state.resizingCol=null}})}},{key:"onMouseUp",value:function(e,t){t.target.parentNode.classList.remove("zgrid_resizing")}},{key:"onContextMenu",value:function(e,t){t.preventDefault();var a=t.target.getAttribute("colname");e.props.columns.freezeOrNot(a)}},{key:"onThClick",value:function(e){e.state.canSelectAll&&e.props.model.selectShowAll()}},{key:"onThMouseDown",value:function(e,t){e.onMouseDown(e,t),e.state.canSelectAll=!0}},{key:"onThMouseMove",value:function(e,t){e.props.model.isDrag?e.props.model.movedAtFirst():(e.onMouseMove(e,t),e.state.canSelectAll=!1)}},{key:"onThMouseUp",value:function(e,t){e.props.model.isDrag?e.props.model.finishDrag():e.onMouseUp(e,t)}},{key:"render",value:function(){var e=this,t="zgrid_head";this.props.scrollY&&(t+=" zgrid_head_scroll");var a="zgrid_head_row";this.props.model.isMovedFirst&&(a+=" zgrid_drag_at");var n=Ao(this.props.columns.allVisibleCol());return(n!=this.state.allVisibleColState&&(this.state.shouldUpdate=!0,this.state.allVisibleColState=n),!this.state.shouldUpdate)?"$NO_OP":(this.state.shouldUpdate=!1,Je("div",{class:t},Je("table",{class:"zgrid_head_table"},Je("tbody",{},Je("tr",{class:a,style:{height:Mo.headHeightStr}},this.props.columns.allVisibleCol().map(function(t){var a="zgrid_head_cell";return t.freeze&&(a+=" freeze_left"),"index"==t.name?Je("th",{class:a,style:"width:"+t.width,align:"right",onClick:S(e,e.onThClick),onMouseDown:S(e,e.onThMouseDown),onMouseMove:S(e,e.onThMouseMove),onMouseUp:S(e,e.onThMouseUp),onContextMenu:S(e,e.onContextMenu),colName:t.name},""):Je("td",{class:a,style:"width:"+t.width,onMouseDown:S(e,e.onMouseDown),onMouseMove:S(e,e.onMouseMove),onContextMenu:S(e,e.onContextMenu),colName:t.name},t.head_name)}))))))}}]),t}(sa),Oo=pa.parseFloat,Uo=ja.trim,No=1/Oo(Aa+"-0")==-Infinity?Oo:function(e){var t=Uo(e+"",3),a=Oo(t);return 0===a&&"-"==t.charAt(0)?-0:a};Ia(Ia.S+Ia.F*(Number.parseFloat!=No),"Number",{parseFloat:No});var Vo=ca.Number.parseFloat,jo=h(function(e){e.exports={default:Vo,__esModule:!0}}),Wo=n(jo),Bo=navigator.language||navigator.userLanguage;Bo=Bo.substr(0,2);var Ho={plan:{dependUnit:"\u65E5"},pikaday:{previousMonth:"\u4E0A\u6708",nextMonth:"\u4E0B\u6708",months:["\u4E00\u6708","\u4E8C\u6708","\u4E09\u6708","\u56DB\u6708","\u4E94\u6708","\u516D\u6708","\u4E03\u6708","\u516B\u6708","\u4E5D\u6708","\u5341\u6708","\u5341\u4E00\u6708","\u5341\u4E8C\u6708"],weekdays:["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],weekdaysShort:["\u65E5","\u4E00","\u4E8C","\u4E09","\u56DB","\u4E94","\u516D"]}};"en"==Bo&&(Ho={plan:{dependUnit:"\u65E5"},pikaday:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]}});var Yo=Ho;Ia(Ia.S,"Number",{isNaN:function(e){return e!=e}});var qo=ca.Number.isNaN,Go=h(function(e){e.exports={default:qo,__esModule:!0}}),$o=n(Go),Xo=Wn("toStringTag"),Zo="Arguments"==Dn(function(){return arguments}()),Ko=function(e,t){try{return e[t]}catch(t){}},Jo=function(e){var t,a,n;return e===void 0?"Undefined":null===e?"Null":"string"==typeof(a=Ko(t=Object(e),Xo))?a:Zo?Dn(t):"Object"==(n=Dn(t))&&"function"==typeof t.callee?"Arguments":n},Qo=Wn("iterator"),er=ca.isIterable=function(e){var t=Object(e);return t[Qo]!==void 0||"@@iterator"in t||Tn.hasOwnProperty(Jo(t))},tr=h(function(e){e.exports={default:er,__esModule:!0}});n(tr);var ar=Wn("iterator"),nr=ca.getIteratorMethod=function(e){if(e!=null)return e[ar]||e["@@iterator"]||Tn[Jo(e)]},sr=ca.getIterator=function(e){var t=nr(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return fa(t.call(e))},or=h(function(e){e.exports={default:sr,__esModule:!0}}),rr=n(or),lr=h(function(e,t){function a(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var n=a(tr),s=a(or);t.default=function(){function e(e,t){var a=[],n=!0,o=!1,r=void 0;try{for(var l=(0,s.default)(e),i;!(n=(i=l.next()).done)&&(a.push(i.value),!(t&&a.length===t));n=!0);}catch(e){o=!0,r=e}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if((0,n.default)(Object(t)))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}),ir=n(lr),dr={clone:function(e){return e?new Date(e):null},parseDayStr:function(e){var t=e.split("-"),a=ir(t,3),n=a[0],s=a[1],o=a[2];return new Date(n,s-1,o)},setUnix:function(e){return new Date(1e3*e)},getUnix:function(e){return Ot(e.getTime()/1e3)},isAfterOrSame:function(e,t){return e.getTime()>=t.getTime()},isSame:function(e,t){return e.getTime()==t.getTime()},isNotSame:function(e,t){return e.getTime()!=t.getTime()},isAfter:function(e,t){return e.getTime()>t.getTime()},isBefore:function(e,t){return e.getTime()<t.getTime()},isBeforeOrSame:function(e,t){return e.getTime()<=t.getTime()},isBetween:function(e,t,a){return t.getTime()<=e.getTime()&&e.getTime()<=a.getTime()},getSecondsOfDay:function(e){return 3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()},getStartOfDay:function(e){return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0))},subtractDays:function(e,t){e.setUTCDate(e.getUTCDate()-t)},addDays:function(e,t){e.setUTCDate(e.getUTCDate()+t)},diffDays:function(e,t){return Ot((e.getTime()-t.getTime())/864e5)},addSeconds:function(e,t){e.setUTCSeconds(e.getUTCSeconds()+t)},subtractSeconds:function(e,t){e.setUTCSeconds(e.getUTCSeconds()-t)},format:function(e){var t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),s=t;return s+=10>a?"-0"+a:"-"+a,s+=10>n?"-0"+n:"-"+n,s},formatUTC:function(e){var t=e.getUTCFullYear(),a=e.getUTCMonth()+1,n=e.getUTCDate(),s=t;return s+=10>a?"-0"+a:"-"+a,s+=10>n?"-0"+n:"-"+n,s},getTimeBySeconds:function(e){var t=$a(e/3600),a=$a(e%3600/60),n=e%60;return 10>t&&(t="0"+t),10>a&&(a="0"+a),10>n&&(n="0"+n),t+":"+a+":"+n},convertToUTC:function(e){return new Date(e.getTime()-1e3*(60*e.getTimezoneOffset()))},convertToLocal:function(e){return new Date(e.getTime()+1e3*(60*e.getTimezoneOffset()))},isValid:function(e){var t=e.split("-"),a=ir(t,3),n=a[0],s=a[1],o=a[2];if(n=$a(n),s=$a(s),o=$a(o),$o(o)||$o(s)||$o(n))return!1;--s;var r=new Date(n,s,o);return r.getDate()==o&&r.getMonth()==s&&r.getFullYear()==n}},pr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.state={shouldUpdate:!0,datepicker:null},a.props.row.comInstance=a,a}return Eo(t,e),yn(t,[{key:"getTdContent",value:function(e){var t=this;if("action"==e.type){var a=this.props.row.getValue(e.name);return a?Je("button",{class:"zgrid_cell_btn zplan-btn",onClick:S({instance:this,col:e},this.onActionBtnClick)},a):null}if(this.props.row.isCurrentRow()&&this.props.row.editCol==e.name&&"checkbox"!=e.type){var n={instance:this,col:e};if("text"==e.type){var s=Je("input",{class:"zgrid_cell_input",type:"text",defaultValue:this.props.row.getValue(e.name),onBlur:S(n,this.onTdInputChange)});if(e.indent){if(this.props.row.hasChild()){var o="zgrid_cell_expanded";return this.props.row.collapsed()&&(o="zgrid_cell_collapsed"),[Je("i",{class:o,onClick:S(this,this.changeCollapsed)},""),s]}return s}return s}if("date"==e.type)return Je("div",{class:"zgrid_cell_date"},[Je("input",{class:"zgrid_cell_input zgrid_datepicker",type:"text",defaultValue:this.props.row.getValue(e.name),onBlur:S(n,this.onTdInputChange)}),Je("div",{class:"zgrid_datepicker_btn"},Je("span",{class:"zgrid_datepicker_caret"}))]);if("number"==e.type)return Je("input",{class:"zgrid_cell_input",type:"number",defaultValue:this.props.row.getValue(e.name),onBlur:S(n,this.onTdInputChange)});if("select"==e.type||"advancedSelect"==e.type){var r=[];return r="select"==e.type?e.options:this.props.row.getOptions(e.name),r=r.map(function(a){var n={value:a[0]};return a[0]==t.props.row.getValue(e.name)&&(n.selected="selected"),Je("option",n,a[1])}),Je("select",{class:"zgrid_cell_select",onChange:S(n,this.onTdInputChange)},r)}}else{if("date"==e.type)return this.props.row.getValue(e.name);if("checkbox"==e.type){if(this.props.row.showCheckBox(e.name)){var l=this.props.row.getValue(e.name);!0!=l&&(l=!1);var d={class:"zgrid_cell_input zgrid_cell_checkbox",type:"checkbox",checked:l};return this.props.row.isReadonly(e.name)?d.disabled="disabled":d.onClick=S({instance:this,col:e},this.onTdInputChange),Je("input",d)}return""}if("select"==e.type||"advancedSelect"==e.type){var p=this.props.row.getValue(e.name),c="",u=[];u="select"==e.type?e.options:this.props.row.getOptions(e.name);for(var h=0,m;h<u.length;h++)if(m=u[h],m[0]==p){c=m[1];break}return c}if(e.indent){if(this.props.row.hasChild()){var g="zgrid_cell_expanded";return this.props.row.collapsed()&&(g="zgrid_cell_collapsed"),[Je("i",{class:g,onClick:S(this,this.changeCollapsed)},""),this.props.row.getValue(e.name)]}return this.props.row.getValue(e.name)}var f=this.props.row.getValue(e.name);return null!=f&&null!=f?f.toString():null}}},{key:"changeCollapsed",value:function(e,t){e.props.row.selectCol="name",e.props.row.selectColType="text",t.stopPropagation(),t.preventDefault(),e.props.row.owner.clearSelectedRows(),e.props.row.setValue("collapsed")}},{key:"onActionBtnClick",value:function(e,t){var a=e.instance,n=e.col;t.stopPropagation(),t.preventDefault(),a.props.row.actionClick(n.name)}},{key:"onTdClick",value:function(e){var t=e.instance,a=e.col;"checkbox"!=a.type&&(t.props.row.isReadonly(a.name)||t.props.row.selectCol!=a.name?(t.props.row.selectCol=a.name,t.props.row.selectColType=a.type,t.props.row.editCol=null,!t.props.row.isReadonly(a.name)&&("date"==a.type||"select"==a.type||"advancedSelect"==a.type)&&(t.props.row.editCol=a.name),t.state.datepicker&&(t.state.datepicker.destroy(),t.state.datepicker=null),t.state.shouldUpdate=!0,t.props.row.owner.clearSelectedRows(),t.props.row.setAsCurrent(),t.props.row.owner.updateAll()):t.props.row.editCol!=a.name&&(t.props.row.editCol=a.name,t.state.shouldUpdate=!0,t.forceUpdate()))}},{key:"onTdDblClick",value:function(e){var t=e.instance,a=e.col;t.props.row.onDblClick(a.name)}},{key:"onTdInputChange",value:function(e,t){var a=e.instance,n=e.col,s=t.target.value;"date"==n.type?(s=dr.parseDayStr(s),s=dr.convertToUTC(s),s=dr.getUnix(s)):"checkbox"==n.type?s=t.target.checked:"number"==n.type&&(s=Wo(s)),a.props.row.setValue(n.name,s)}},{key:"onThClick",value:function(e,t){e.props.row.isSelected||(!t.ctrlKey&&e.props.row.owner.clearSelectedRows(),e.props.row.selected(),e.props.row.setAsCurrentWithSelect(),e.props.row.owner.updateAll())}},{key:"onThMouseDown",value:function(e,t){e.props.row.isSelected?e.props.row.owner.beginDrag():(!t.ctrlKey&&e.props.row.owner.clearSelectedRows(),e.props.row.owner.beginDragSelected(e.props.row),e.props.row.selected(),e.props.row.setAsCurrentWithSelect(),e.props.row.owner.updateAll())}},{key:"onThMouseMove",value:function(e){if(e.props.row.owner.isDragSelected){e.props.row.selected();var t=e.props.row.setAsCurrentWithSelect();t&&e.props.row.owner.updateAll()}else e.props.row.owner.isDrag&&e.props.row.movedAt()}},{key:"onThMouseUp",value:function(e){if(e.props.row.owner.isDragSelected){e.props.row.selected();var t=e.props.row.setAsCurrentWithSelect();e.props.row.owner.finishDragSelected(),t&&e.props.row.owner.updateAll()}else e.props.row.owner.isDrag&&e.props.row.owner.finishDrag()}},{key:"clearSelectState",value:function(){this.state.shouldUpdate=!0,this.state.datepicker&&(this.state.datepicker.destroy(),this.state.datepicker=null)}},{key:"bindDatePicker",value:function(){if(this.props.row.editCol==this.props.row.selectCol&&"date"==this.props.row.selectColType){null!=this.state.datepicker&&(this.state.datepicker.destroy(),this.state.datepicker=null);var e=this.ref.querySelector(".zgrid_datepicker"),t=this.ref.querySelector(".zgrid_datepicker_btn");if(this.state.datepicker=new Pikaday({showTime:!1,i18n:Yo.pikaday,field:e,trigger:t,format:"YYYY-MM-DD",toString:function(e){return dr.format(e)},onClose:function(){var t=e.value;dr.isValid(t)?(e.value=t,e.dispatchEvent(new Event("blur"))):e.value=""}}),"finish_date"==this.props.row.editCol){var a=dr.parseDayStr(this.props.row.getValue("start_date"));this.state.datepicker.setMinDate(a)}}}},{key:"bindInputHelper",value:function(){var e=this.props.row;if(e.isCurrentRow()){var t=this.ref.closest(".zgrid_body").querySelector(".zgrid_input_helper"),a=this.ref.querySelector(".zgrid_active");if(null!=t&&null!=a)if((null==t.value||""==t.value)&&"true"!=t.getAttribute("is-composing")||t.getAttribute("cell-index")!=e.idx.toString()||t.getAttribute("cell-name")!=e.editCol){var n=a.getBoundingClientRect();t.style.position="fixed",t.style.top=n.top+"px",t.style.left=n.left+"px";var s=a.textContent;("checkbox"==e.selectColType||"select"==e.selectColType||"advancedSelect"==e.selectColType)&&(s=null),t.setAttribute("old-value",s),t.setAttribute("cell-type",e.selectColType),t.setAttribute("cell-index",e.idx),t.setAttribute("cell-name",e.selectCol),t.value=null,t.focus()}else if("text"==e.selectColType||"number"==e.selectColType){var o=a.querySelector("input");o.focus(),o.value=t.value,t.value=null}}}},{key:"componentDidUpdate",value:function(){if(this.state.shouldUpdate=!1,!this.props.row.isReadonly(this.props.row.selectCol))this.bindDatePicker(),this.bindInputHelper();else{var e=document.querySelector(".zgrid_active");e&&e.focus()}}},{key:"componentWillUpdate",value:function(e){e.row!=this.props.row&&(e.row.comInstance=this,this.state.shouldUpdate=!0,this.clearSelectState())}},{key:"componentDidMount",value:function(){this.state.shouldUpdate=!1,this.props.row.isCurrentRow()&&!this.props.row.isReadonly(this.props.row.selectCol)&&(this.bindDatePicker(),this.bindInputHelper())}},{key:"touch",value:function(){this.state.shouldUpdate=!0}},{key:"render",value:function(){var e=this;if(!this.state.shouldUpdate)return"$NO_OP";var t="zgrid_row";return this.props.row.isSearched&&(t+=" zgrid_searched_row"),this.props.row.isCurrentRow()&&(t+=" zgrid_current_row"),this.props.row.isSelected&&(t+=" zgrid_selected_row"),this.props.row.isMovedAt()&&(t+=" zgrid_drag_at"),this.props.row.isDiff()&&(t+=" zgrid_diff_row"),this.props.row.isMarked()&&(t+=" zgrid_marked_row"),Je("tr",{class:t,style:{height:Mo.rowHeightStr},key:this.props.row.getValue("id"),ref:function(t){e.ref=t}},this.props.columns.map(function(t){var a="";if(t.freeze&&(a=" freeze_left"),"index"==t.name)return Je("th",{class:"zgrid_cell zgrid_th"+a,key:t.name,align:"right",onClick:S(e,e.onThClick),onMouseDown:S(e,e.onThMouseDown),onMouseMove:S(e,e.onThMouseMove),onMouseUp:S(e,e.onThMouseUp)},e.props.row.getGridRowIndex());var n={class:"zgrid_cell"+a,tabindex:"0",key:t.name,onClick:S({instance:e,col:t},e.onTdClick)};if(e.props.row.selectCol==t.name&&(n.class+=" zgrid_active"),e.props.row.isReadonly(t.name)&&(n.class+=" zgrid_readonly"),t.indent){var s=10*(e.props.row.level()-1)+12;e.props.row.hasChild()||(s+=18),n.style={paddingLeft:s+"px"}}if(t.db_clickable&&(n.onDblClick=S({instance:e,col:t},e.onTdDblClick)),t.hint){var o=e.props.row.getValue(t.name);null!=o&&null!=o&&(n.title=o.toString())}var r=e.props.row.getCellClass(t.name);return n.class=n.class+" "+r,Je("td",n,e.getTdContent(t))}))}}]),t}(sa),cr=function(e){function t(){return hn(this,t),wo(this,(t.__proto__||cn(t)).apply(this,arguments))}return Eo(t,e),yn(t,[{key:"onWheel",value:function(e,t){var a=t.target;a.classList.contains(".zgrid_body")||(a=a.closest(".zgrid_body")),a.scrollTop+=t.deltaY}},{key:"onScroll",value:function(e,t){var a=t.target.scrollLeft;t.target.closest(".zgrid").querySelector(".zgrid_head").scrollLeft=a;for(var n=t.target.closest(".zgrid").querySelectorAll(".freeze_left"),s=0;s<n.length;s++)n[s].style.transform="translate("+a+"px, 0px)";var o=t.target.scrollTop,r=$a(o/Mo.rowHeight);0>r&&(r=0),e.props.model.updateShowAt(r),t.target.scrollTop=o;var l=t.target.closest(".zplan-spliter-panel");if(l){var d=l.querySelector(".zchart_body");d&&(d.scrollTop=o)}}},{key:"moveDown",value:function(e){var t=e.nextShow();if(t){var a=t.setAsCurrentWithSelect();a&&this.props.model.updateAll()}else this.props.model.addRow()}},{key:"moveUp",value:function(e){var t=e.prevShow();if(t){var a=t.setAsCurrentWithSelect();a&&this.props.model.updateAll()}}},{key:"onKeyDown",value:function(e,t){33==t.keyCode||34==t.keyCode?t.preventDefault():35<=t.keyCode&&40>=t.keyCode&&null==e.ref.querySelector(".zgrid_cell_input:focus")&&null==e.ref.querySelector(".zgrid_active .zgrid_cell_checkbox")&&t.preventDefault()}},{key:"onKeyUp",value:function(e,t){if(!(null==e.props.model.currentRow||e.props.model.isReadonly()))if(27==t.keyCode){var a=e.ref.querySelector(".zgrid_input_helper"),n=a.getAttribute("cell-type"),s=e.ref.querySelector(".zgrid_active");if("date"==n){var o=s.querySelector(".zgrid_cell_input");o.value=o.getAttribute("value")}else if("text"==n||"number"==n){var r=a.getAttribute("old-value");s.querySelector(".zgrid_cell_input").value=r}a.focus()}else if(13==t.keyCode){var l=e.ref.querySelector(".zgrid_active .zgrid_cell_input");l&&l.blur(),t.shiftKey?e.moveUp(e.props.model.currentRow):e.moveDown(e.props.model.currentRow)}else if(38==t.keyCode)null==e.ref.querySelector(".zgrid_cell_input:focus")&&(t.altKey&&t.shiftKey?e.props.model.moveUpRows():e.moveUp(e.props.model.currentRow));else if(40==t.keyCode)null==e.ref.querySelector(".zgrid_cell_input:focus")&&(t.altKey&&t.shiftKey?e.props.model.moveDownRows():e.moveDown(e.props.model.currentRow));else if(37==t.keyCode)null==e.ref.querySelector(".zgrid_cell_input:focus")&&null!=e.ref.querySelector(".zgrid_active")&&(t.altKey&&t.shiftKey?e.props.model.upgradeRows():e.props.model.currentRow.activePrevCol());else if(39==t.keyCode)null==e.ref.querySelector(".zgrid_cell_input:focus")&&null!=e.ref.querySelector(".zgrid_active")&&(t.altKey&&t.shiftKey?e.props.model.degradeRows():e.props.model.currentRow.activeNextCol());else if(45==t.keyCode)null==e.ref.querySelector(".zgrid_cell_input:focus")&&e.props.model.addRow(e.props.model.currentRow);else{if(null==e.ref.querySelector(".zgrid_cell_input:focus")&&(46==t.keyCode&&e.props.model.deleteSelectedOrCurrentRows(),t.ctrlKey&&(88==t.keyCode?e.props.model.cutSelectedOrCurrentRows():67==t.keyCode?e.props.model.copySelectedOrCurrentRows():86==t.keyCode?e.props.model.pasteCuttedOrCopiedRows():90==t.keyCode?t.shiftKey?e.props.model.redo():e.props.model.undo():89==t.keyCode&&e.props.model.redo()),t.altKey&&t.shiftKey&&80==t.keyCode&&e.props.model.isSupportCMD())){var i=e.props.model.getCMDTips(),d=prompt(i);e.props.model.execCMD(d)}e.inputHelperTyping(t)}}},{key:"inputHelperTyping",value:function(e){var t=this.ref.querySelector(".zgrid_input_helper"),a=t.getAttribute("cell-type"),n=this.ref.querySelector(".zgrid_active");if("checkbox"==a){if(32==e.keyCode){var s=n.querySelector(".zgrid_cell_checkbox");s&&s.click()}}else if("select"==a)n.click();else if("date"==a){var o=n.querySelector(".zgrid_datepicker");o!==document.activeElement&&(n.querySelector(".zgrid_datepicker").value=t.value)}else{var r=t.value;if(null!=r&&""!=r){var l=n.querySelector(".zgrid_cell_input");null==l?"true"!=t.getAttribute("is-composing")&&n.click():l!==document.activeElement&&(l.focus(),l.value=t.value,t.value=null)}}}},{key:"emptyRowClick",value:function(e){e.props.model.addRow()}},{key:"renderEmptyRow",value:function(){var e=this.props.columns;return Je("tr",{key:"blank",class:"zgrid_empty_row",style:{height:Mo.rowHeight+"px"},onClick:S(this,this.emptyRowClick)},e.map(function(e){var t="zgrid_cell";return e.freeze&&(t+=" freeze_left"),"index"==e.name?Je("th",{class:t,align:"right",key:e.name},""):Je("td",{class:t,tabindex:"0",key:e.name},"")}))}},{key:"renderRows",value:function e(){var e=[],t=this.props.columns;e.push(Je("tr",{key:"top",class:"zgrid_top_row",style:"height:"+this.props.topRowNum*Mo.rowHeight+"px"},t.map(function(e){return Je("td",{class:"zgrid_top_cell",style:{height:"0px",width:e.width}},"")})));for(var a=0;a<this.props.rows.length;a++)e.push(Je(pr,{parent:this,columns:t,row:this.props.rows[a]}));return 0<this.props.bottomRowNum?e.push(Je("tr",{key:"bottom",style:"height:"+this.props.bottomRowNum*Mo.rowHeight+"px"},"")):!this.props.readonly&&e.push(this.renderEmptyRow()),e}},{key:"componentDidMount",value:function(){var e=this,t=this.ref.querySelector(".zgrid_input_helper");t.addEventListener("compositionstart",function(e){e.target.setAttribute("is-composing","true")}),t.addEventListener("compositionend",function(t){t.target.removeAttribute("is-composing"),e.ref.querySelector(".zgrid_active").click()})}},{key:"render",value:function(){var e=this,t="overflow-y: scroll;";return this.props.scrollY||(t="overflow-y: hidden;"),Je("div",{class:"zgrid_body",style:t,onKeyDown:S(this,this.onKeyDown),onKeyUp:S(this,this.onKeyUp),onScroll:S(this,this.onScroll),onWheel:S(this,this.onWheel),ref:function(t){e.ref=t}},[Je("table",{class:"zgrid_body_table",tabindex:"0"},Je("tbody",{},this.renderRows())),Je("input",{class:"zgrid_input_helper"})])}}]),t}(sa),ur=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.props.model.gridInstance=a,a.ref=null,a}return Eo(t,e),yn(t,[{key:"getVisibleRowNum",value:function(){var e=this.ref.querySelector(".zgrid_body").offsetHeight-Mo.scrollHeight;return $a(e/Mo.rowHeight)}},{key:"componentDidMount",value:function(){this.props.model.visibleRowNum=this.getVisibleRowNum()}},{key:"scrollToPos",value:function(e){var t=e*Mo.rowHeight,a=this.ref.querySelector(".zgrid_body");a.scrollTop=t;var n=this.ref.closest(".zplan-spliter-panel");if(n){var s=n.querySelector(".zchart_body");s&&(s.scrollTop=t)}}},{key:"render",value:function(){var e=this;return Je("div",{class:"zgrid",ref:function(t){e.ref=t}},[Je(Fo,{columns:this.props.model.columns,scrollY:this.props.scrollY,model:this.props.model}),Je(cr,{parent:this,model:this.props.model,columns:this.props.model.columns.allVisibleCol(),scrollY:this.props.scrollY,rows:this.props.model.showRows,topRowNum:this.props.model.topRowNum,bottomRowNum:this.props.model.bottomRowNum,readonly:this.props.model.isReadonly()})])}}]),t}(sa),hr=function(e){function t(){return hn(this,t),wo(this,(t.__proto__||cn(t)).apply(this,arguments))}return Eo(t,e),yn(t,[{key:"renderHeadTop",value:function(){for(var e=[],t=this.props.chart.state.dayPx,a=0;a<this.props.chart.state.headPeriods.length;a++){for(var n=ir(this.props.chart.state.headPeriods[a],2),s=n[0],o=n[1],r=0,l=0;l<o.length;l++){var d=ir(o[l],2),p=d[1];r+=p}e.push(Je("th",{class:"zchart_head_cell",colspan:o.length,style:{width:r*t+"px"}},s))}return Je("tr",{class:"zchart_top_head_row"},e)}},{key:"renderHeadBottom",value:function(){for(var e=[],t=this.props.chart.state.dayPx,a=0;a<this.props.chart.state.headPeriods.length;a++)for(var n=ir(this.props.chart.state.headPeriods[a],2),s=n[1],o=0;o<s.length;o++){var r=ir(s[o],2),l=r[0],d=r[1];e.push(Je("th",{class:"zchart_head_cell",style:{width:d*t+"px"}},l))}return Je("tr",{class:"zchart_bottom_head_row"},e)}},{key:"render",value:function(){return this.props.shouldUpdate?Je("div",{class:"zchart_head"},Je("table",{class:"zchart_head_table",cellSpacing:0,cellPadding:0,style:{height:Mo.headHeightStr,width:this.props.chart.state.width+1+"px"}},Je("thead",{},[this.renderHeadTop(),this.renderHeadBottom()]))):"$NO_OP"}}]),t}(sa),mr=8,gr=16,fr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e)),n=a._getTaskStartDate(),s=a._getTaskFinishDate(),o=a._getTaskShowIndex();return a.state={shouldUpdate:!0,startDate:n,finishDate:s,showIndex:o,startPosX:a._getPosX(n),finishPosX:a._getPosX(s),posY:a.getPosY(o),isCritical:a.props.task.isCritical,hasChild:a.props.task.hasChild()},a}return Eo(t,e),yn(t,[{key:"_getTaskStartDate",value:function(){return this.props.task.computedData.start_date}},{key:"_getTaskFinishDate",value:function(){return this.props.task.computedData.finish_date}},{key:"_getTaskShowIndex",value:function(){return this.props.task.showIndex}},{key:"_getPosX",value:function(e){return this.props.chart.calcPos(e)}},{key:"getPosY",value:function(e){return e*Mo.rowHeight+7}},{key:"getTaskClassName",value:function(){var e="";return e=this.props.task.hasChild()?"zgantt_parent_task":"zgantt_task",this.props.task.isCritical&&(e+=" zgantt_critical_task"),e}},{key:"getRhombusPoints",value:function(e,t){return e+8+","+(t+8)+" "+(e+14)+","+(t+2)+" "+(e+20)+","+(t+8)+" "+(e+14)+","+(t+14)}},{key:"updateState",value:function(){var e=this._getTaskStartDate(),t=this._getTaskFinishDate(),a=this._getTaskShowIndex();(this.props.mustUpdate||e.getTime()!=this.state.startDate.getTime())&&(this.state.startDate=e,this.state.startPosX=this._getPosX(e),this.state.shouldUpdate=!0),(this.props.mustUpdate||t.getTime()!=this.state.finishDate.getTime())&&(this.state.finishDate=t,this.state.finishPosX=this._getPosX(t),this.state.shouldUpdate=!0),(this.props.mustUpdate||a!=this.state.showIndex)&&(this.state.showIndex=a,this.state.posY=this.getPosY(a),this.state.shouldUpdate=!0),(this.props.mustUpdate||this.props.task.isCritical!=this.state.isCritical)&&(this.state.isCritical=this.props.task.isCritical,this.state.shouldUpdate=!0),(this.props.mustUpdate||this.props.task.hasChild()!=this.state.hasChild)&&(this.state.hasChild=this.props.task.hasChild(),this.state.shouldUpdate=!0)}},{key:"render",value:function(){if(this.updateState(),!this.state.shouldUpdate)return"$NO_OP";if(this.state.shouldUpdate=!1,this.props.task.isMilestone())return Je("polygon",{class:this.getTaskClassName(),points:this.getRhombusPoints(this.state.startPosX-13,this.state.posY)});var e=this.state.startPosX,t=this.state.posY,a=this.state.finishPosX-e;if(0==a&&(a=1),this.props.task.hasChild()){var n=this.state.finishPosX-mr;return Je("g",{class:this.getTaskClassName()},[Je("rect",{x:e,y:t,width:mr,height:gr}),Je("rect",{x:e,y:t,width:a,height:.5*gr}),Je("rect",{x:n,y:t,width:mr,height:gr})])}return Je("rect",{class:this.getTaskClassName(),x:e,y:t,width:a,height:gr})}}]),t}(sa),_r=8,yr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e)),n=a.getStartDate(),s=a.getFinishDate(),o=a.getStartShowIndex(),r=a.getFinishShowIndex(),l=a._getPosX(n),i=a._getPosX(s),d=a.getPosYAndArc(o,r,i),p=ir(d,3),c=p[0],u=p[1],h=p[2];return a.state={shouldUpdate:!0,startDate:n,finishDate:s,startShowIndex:o,finishShowIndex:r,startPosX:l,finishPosX:i,startPosY:c,finishPosY:u,arc:h,isCritical:a.isCritical(a.props.relation)},a}return Eo(t,e),yn(t,[{key:"getStartDate",value:function(){return this.props.relation.fromTime()}},{key:"getFinishDate",value:function(){return this.props.relation.toTime()}},{key:"getStartShowIndex",value:function(){return this.props.relation.from.showIndex}},{key:"getFinishShowIndex",value:function(){return this.props.relation.to.showIndex}},{key:"_getPosX",value:function(e){return this.props.chart.calcPos(e)}},{key:"getPosYAndArc",value:function(e,t,a){var n=0,s=0,o="";return e>t?(n=e*Mo.rowHeight+14,s=t*Mo.rowHeight+23+6,o="A 2,2 45, 0,0 "+(a+2)+","+(n-2)):(n=e*Mo.rowHeight+15,s=t*Mo.rowHeight+1,o="A 2,2 45, 0,1 "+(a+2)+","+(n+2)),[n,s,o]}},{key:"isCritical",value:function(e){return e.from.isCritical&&e.to.isCritical}},{key:"getRelClassName",value:function(){var e="zgantt_relation";return this.state.isCritical&&(e+=" zgantt_critical_relation"),e}},{key:"getPathD",value:function(){var e=this.state.startPosX,t=this.state.startPosY,a=this.state.finishPosX,n=this.state.finishPosY,s=this.state.arc;return"M"+(e-1)+" "+t+" H"+a+" "+s+" V"+n}},{key:"getArrowPathD",value:function(){var e=this.state.startPosY,t=this.state.finishPosX,a=this.state.finishPosY,n=1;return a>e?"M"+(t-_r/2+n)+" "+a+" L"+(t+_r/2+n)+" "+a+" L"+(t+n)+" "+(a+_r)+" Z":"M"+(t-_r/2+n)+" "+a+" L"+(t+_r/2+n)+" "+a+" L"+(t+n)+" "+(a-_r)+" Z"}},{key:"updateState",value:function(){var e=this.getStartDate();(this.props.mustUpdate||e.getTime()!=this.state.startDate.getTime())&&(this.state.startDate=e,this.state.startPosX=this._getPosX(e),this.state.shouldUpdate=!0);var t=this.getFinishDate(),a=null;(this.props.mustUpdate||t.getTime()!=this.state.finishDate.getTime())&&(this.state.finishDate=t,a=this._getPosX(t),this.state.shouldUpdate=!0);var n=this.getStartShowIndex(),s=this.getFinishShowIndex();if(this.props.mustUpdate||null!=a||n!=this.state.startShowIndex||s!=this.state.finishShowIndex){null==a&&(a=this.state.finishPosX);var o=this.getPosYAndArc(n,s,a),r=ir(o,3),l=r[0],i=r[1],d=r[2];this.state.finishPosX=a,this.state.startShowIndex=n,this.state.finishShowIndex=s,this.state.startPosY=l,this.state.finishPosY=i,this.state.arc=d,this.state.shouldUpdate=!0}var p=this.isCritical(this.props.relation);(this.props.mustUpdate||p!=this.state.isCritical)&&(this.state.isCritical=p,this.state.shouldUpdate=!0)}},{key:"render",value:function(){return(this.updateState(),!this.state.shouldUpdate)?"$NO_OP":(this.state.shouldUpdate=!1,Je("g",{},[Je("path",{class:this.getRelClassName(),d:this.getPathD()}),Je("path",{d:this.getArrowPathD()})]))}}]),t}(sa),vr=function(e){function t(){return hn(this,t),wo(this,(t.__proto__||cn(t)).apply(this,arguments))}return Eo(t,e),yn(t,[{key:"renderTasks",value:function(){for(var e=this.props.chart.getRowsAndShowRange(),t=ir(e,3),a=t[0],n=t[1],s=t[2],o=[],r=this.props.mustUpdate,l=1,d;l<a.length;l++)if(d=a[l],d.isShow&&d.idx>=n&&d.idx<=s&&o.push(Je(fr,{chart:this.props.chart,task:d,mustUpdate:r})),d.idx<n)for(var p=0,c;p<d.fromRelations.length;p++)c=d.fromRelations[p],c.from.isShow&&c.to.isShow&&c.from.idx>=n&&o.push(Je(yr,{chart:this.props.chart,relation:c,mustUpdate:r}));else if(d.idx<=s)for(var u=0,h;u<d.fromRelations.length;u++)h=d.fromRelations[u],h.from.isShow&&h.to.isShow&&o.push(Je(yr,{chart:this.props.chart,relation:h,mustUpdate:r}));else for(var m=0,g;m<d.fromRelations.length;m++)g=d.fromRelations[m],g.from.isShow&&g.to.isShow&&g.from.idx<=s&&o.push(Je(yr,{chart:this.props.chart,relation:g,mustUpdate:r}));return Je("g",{class:"zgantt_task_group"},o)}},{key:"renderCurrentRowLine",value:function(){var e=this.props.currentRow;if(e){var t=e.showIndex*Mo.rowHeight,a=t+Mo.rowHeight,n=this.props.chart.state.width;return Je("g",{},[Je("line",{x1:0,y1:t,x2:n,y2:t,class:"zgantt_selection_line"}),Je("line",{x1:0,y1:a,x2:n,y2:a,class:"zgantt_selection_line"})])}}},{key:"renderOffDays",value:function(){for(var e=[],t=this.props.chart.state.dayPx,a=0,n;a<this.props.days.length;a++)if(n=this.props.days[a],0>n){var s=this.props.chart.calcOffDayPos(a);e.push(Je("rect",{class:"zchart_bg_holy_col",x:s,y:0,width:t,height:this.props.chart.getHeight()}))}return Je("g",{},e)}},{key:"render",value:function(){return Je("svg",{class:"zchart_canvas",style:{height:this.props.chart.getHeight(),width:this.props.chart.getWidth()}},[this.renderOffDays(),this.renderTasks(),this.renderCurrentRowLine()])}}]),t}(sa),kr=20,wr=function(){function e(t,a){hn(this,e),this.chart=a,this.stage=new createjs.Stage(t),this.container=new createjs.Container,this.tasksContainer=new createjs.Container,this.partitionContainer=new createjs.Container,this.calendarContainer=new createjs.Container,this.frozenLineContainer=new createjs.Container,this.dragOffset=new createjs.Point,this.width=0,this.height=0,this.tasksWidth=0,this.tasksHeight=0,this.partitionWidth=0,this.stage.addChild(this.container),this.container.addChild(this.calendarContainer),this.container.addChild(this.tasksContainer),this.container.addChild(this.partitionContainer),this.container.addChild(this.frozenLineContainer)}return yn(e,[{key:"setMaxPartitionLevel",value:function(e){this.partitionWidth=this.chart.shouldShowPartitionHead()?50+e*kr:0}},{key:"addTask",value:function(e){this.tasksContainer.addChild(e)}},{key:"addOffDay",value:function(e,t,a){var n=new createjs.Shape;n.graphics.beginFill("#fff5e6"),n.graphics.moveTo(e,0).rect(e,0,t,a),n.set({minX:e,maxX:e+t}),this.calendarContainer.addChild(n)}},{key:"getWrapText",value:function(e,t,a){var n=new createjs.Text(e,"12px Arial"),s=[],o="",r=2*$a(t/12);2>r&&(r=2);var l=$a(a/12);1>l&&(l=1);for(var d=e.split(""),p=0;p<d.length;p++){var c=d[p],u=this._stringWidth(c),h=this._stringWidth(o);if(!(1==u&&h+u>=r||1<u&&h+u>r))o+=c;else if(s.push(o),o=c,s.length>l)break}return""!=o&&s.push(o),n.text=s.join("\n"),n.lineWidth=t,n}},{key:"addPartitions",value:function(e,t){var a=new createjs.Shape,n=new createjs.Shape;n.graphics.beginFill("#ffffff").drawRect(0,this.calcPosY(0)-10,this.partitionWidth,this.tasksHeight+20),this.partitionContainer.addChild(n),a.graphics.setStrokeStyle(1).beginStroke("#add8e6");for(var s=0;s<e.length;s++){var o=e[s],r=o.level*kr,l=this.calcPosY(o.startPertRow),d=this.partitionWidth,p=this.calcPosY(o.finishPertRow),c=d-r,u=this.getWrapText(o.getName(),c,p-l);u.x=r,u.y=l,a.graphics.moveTo(r,l).rect(r,l,c,p-l),a.graphics.moveTo(r,l).lineTo(t,l),a.graphics.moveTo(d,p).lineTo(t,p),this.partitionContainer.addChild(u)}this.partitionContainer.addChild(a)}},{key:"drawFrozenLine",value:function(e,t,a){t=new Date(1e3*t);var n=this.calcPos(t);e.graphics.setStrokeStyle(1).beginStroke(a).setStrokeDash().moveTo(n,0).lineTo(n,this.tasksHeight)}},{key:"drawDiffLine",value:function(e,t,a,n){t=new Date(1e3*t);var s=this.calcPos(t);e.graphics.setStrokeStyle(1).beginStroke(n).moveTo(s,0);for(var o=0,r;o<a.length;o++)if(r=a[o],null!=r&&null!=r){var l=this.calcPos(r),d=this.calcPosY(o);e.graphics.lineTo(l,d)}e.graphics.lineTo(s,this.tasksHeight)}},{key:"drawSpecialLine",value:function(e,t,a,n){e.graphics.setStrokeStyle(2).beginStroke(n).setStrokeDash([4,2]);for(var o=0,r;o<t.length;o++)if(r=t[o],null!=r&&null!=r){var l=this.calcPos(a[o]),d=this.calcPos(r),p=this.calcPosY(o);e.graphics.moveTo(l,p).lineTo(d,p)}}},{key:"addFrozenLines",value:function(e,t){var a=new createjs.Shape;this.drawFrozenLine(a,e.current_time,"#ff0000"),this.drawDiffLine(a,e.current_time,t.current.frozenPoints,"#ff34b3"),this.drawSpecialLine(a,t.current.special,t.current.frozenPoints,"#eeb422");for(var n=0,s;n<t.history.length;n++)s=t.history[n],this.drawFrozenLine(a,s.time,"#d1d1d1"),this.drawDiffLine(a,s.time,s.frozenPoints,"#d1d1d1"),this.drawSpecialLine(a,s.special,s.frozenPoints,"#d1d1d1");this.frozenLineContainer.addChild(a)}},{key:"calcPos",value:function(e){return this.chart.shouldShowPartitionHead()?this.chart.calcPos(e)+this.partitionWidth:this.chart.calcPos(e)}},{key:"calcPosY",value:function(e){return e*Mo.rowHeight+50}},{key:"clear",value:function(){this.tasksContainer.removeAllChildren(),this.partitionContainer.removeAllChildren(),this.calendarContainer.removeAllChildren(),this.frozenLineContainer.removeAllChildren()}},{key:"resize",value:function(){var e=this.stage.canvas.parentNode,t=e.clientWidth,a=e.clientHeight;this.width!=t&&(this.stage.canvas.width=t,this.width=t),this.height!=a&&(this.stage.canvas.height=a,this.height=a)}},{key:"updateVisible",value:function(){var e=this.tasksContainer.numChildren,t=-1*this.container.x-this.width,a=-1*this.container.y-this.height,n=t+3*this.width,s=a+3*this.height;0>t&&(t=0),0>a&&(a=0),n>this.tasksWidth&&(n=this.tasksWidth),s>this.tasksHeight&&(s=this.tasksHeight);for(var o=0,r;o<e;o++)r=this.tasksContainer.getChildAt(o),r.visible=!(r.minX>n||r.minY>s||r.maxX<t||r.maxY<a);for(var l=this.calendarContainer.numChildren,d=0,p;d<l;d++)p=this.calendarContainer.getChildAt(d),p.visible=!(p.minX>n||p.minY>s)}},{key:"updateChartHead",value:function(){var e=this.stage.canvas.closest(".zchart").querySelector(".zchart_head");e.style.paddingLeft=this.chart.shouldShowPartitionHead()?this.partitionWidth+"px":""}},{key:"update",value:function(){this.resize(),this.updateVisible(),this.stage.update(),this.updateChartHead()}},{key:"getRealX",value:function(e){return-(this.container.x-e)}},{key:"getRealY",value:function(){return-this.container.y}},{key:"moveTo",value:function(e,t){if(e<this.tasksWidth){this.partitionContainer.x=e,this.container.x=-e,this.container.y=-t;var a=this.stage.canvas.closest(".zchart");a.querySelector(".zchart_head_table").style.left=-e+"px";var n=a.querySelector(".zchart_partition_head");n&&(n.style.top=43-t+"px"),this.update()}}},{key:"draggable",value:function(){var e=this,t=function(t){var a=t.stageX-e.dragOffset.x,n=t.stageY-e.dragOffset.y;0<a?a=0:a<-e.tasksWidth&&(a=-e.tasksWidth),0<n?n=0:n<-e.tasksHeight&&(n=-e.tasksHeight),e.partitionContainer.x=e.partitionContainer.x+e.container.x-a,e.container.x=a,e.container.y=n;var s=e.stage.canvas.closest(".zchart");s.querySelector(".zchart_head_table").style.left=a+"px";var o=s.querySelector(".zchart_partition_head");o&&(o.style.top=43+n+"px"),e.update()};this.stage.addEventListener("stagemousedown",function(){e.dragOffset.x=e.stage.mouseX-e.container.x,e.dragOffset.y=e.stage.mouseY-e.container.y,e.stage.addEventListener("stagemousemove",t)}),this.stage.addEventListener("stagemouseup",function(){e.stage.removeEventListener("stagemousemove",t),e.update()})}},{key:"_stringWidth",value:function(e){var t=0,a=!0,n=!1,s=void 0;try{for(var o=rr(e),r,l;!(a=(r=o.next()).done);a=!0)l=r.value,t+="a"<=l&&"z">=l||"0"<=l&&"9">=l?1:2}catch(e){n=!0,s=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw s}}return t}}]),e}(),Tr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.ref=null,a.drawer=null,a.props.chart.pertInstance=a,a.state={shouldUpdate:!0,maxRow:0,lastCurrentRow:null},a}return Eo(t,e),yn(t,[{key:"getHeight",value:function(){return this.state.maxRow*Mo.rowHeight+80}},{key:"getWidth",value:function(){return this.props.chart.getWidth()}},{key:"updateOffDays",value:function(){for(var e=this.props.dayPx,t=0;t<this.props.days.length;t++)if(0>this.props.days[t]){var a=this.props.chart.calcOffDayPos(t)+this.drawer.partitionWidth;this.drawer.addOffDay(a,e,this.getHeight())}}},{key:"updatePartitions",value:function(){this.props.chart.shouldShowPartitionHead()&&this.drawer.addPartitions(this.props.model.partitions,this.getWidth())}},{key:"updateDrawer",value:function(){var e=this.props.model;if(e.isNeedUpdateZpertChart()){this.drawer.clear(),this.state.maxRow=0,this.drawer.setMaxPartitionLevel(e.maxPartitionLevel);for(var t=0;t<e.dots.length;t++)e.dots[t].drawn=!1;for(var a=0,n;a<e.rows.length;a++)n=e.rows[a],n.isShowInPert()&&(n.pertDrawer.drawer=this.drawer,n.pertDrawer.update(),this.drawer.addTask(n.pertDrawer.container),n.pertRow>this.state.maxRow&&(this.state.maxRow=n.pertRow));this.state.maxRow+=5,this.drawer.tasksHeight=this.getHeight(),this.updateOffDays(),this.updatePartitions(),this.drawer.tasksWidth=this.getWidth(),this.drawer.update(),e.updatedZpertChart()}}},{key:"componentDidMount",value:function(){var e=new wr(this.ref,this.props.chart);this.drawer=e,this.updateDrawer(),this.zoomable(),this.drawer.draggable()}},{key:"componentWillUpdate",value:function(e){if(e.model.currentRow&&e.model.currentRow!=this.state.lastCurrentRow){this.state.lastCurrentRow=e.model.currentRow;var t=this.drawer.calcPos(this.state.lastCurrentRow.computedData.start_date)-this.drawer.partitionWidth,a=this.drawer.calcPosY(this.state.lastCurrentRow.pertRow);a-=50,0>t&&(t=0),0>a&&(a=0),this.drawer.moveTo(t,a)}}},{key:"render",value:function(){var e=this;return this.state.shouldUpdate?(this.state.shouldUpdate=!1,Je("canvas",{id:"zhcart_pert_canvas",class:"zchart_canvas",ref:function(t){e.ref=t}})):(this.updateDrawer(),"$NO_OP")}},{key:"zoomable",value:function(){var e=this,t=function(t){var a=0;t.wheelDelta?a=t.wheelDelta:t.detail&&(a=t.detail);var n=e.props.dayPx;0>a?e.props.chart.zoomOut():e.props.chart.zoomIn();var s=e.props.dayPx,o=(e.drawer.getRealX(t.layerX)-e.drawer.partitionWidth)/n*s+e.drawer.partitionWidth-t.layerX,r=e.drawer.getRealY();0>o&&(o=0),e.drawer.moveTo(o,r),t.preventDefault()};this.ref.addEventListener("mousewheel",t),this.ref.addEventListener("DOMMouseScroll",t)}}]),t}(sa),Rr=[1,2,3,4,5,6,7,8,9,10,11,13,15,16,18,20,21,23,25,28,31,35,40,45,50,55,60],Dr=[1,2],xr=[3,4],Cr=[5,7],Sr=[8,10],br=[11,15],Pr=[16,20],Er=[21,60],zr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));a.props.zplan.chartInstance=a;var n=a.getDayPx();return a.ref=null,a.pertInstance=null,a.state={dayPx:n,startDate:a.getStartDate(n),finishDate:a.getFinishDate(n),width:0,headPeriods:[],shouldUpdateHeadPeriods:!0,calendar:a.getCurrentCalendar()},a}return Eo(t,e),yn(t,[{key:"getDayPx",value:function(){return Rr[this.getDayPxConfig()]}},{key:"getDayPxConfig",value:function(){return this.props.model.viewConfig.calendar_day_px_id}},{key:"setDayPxConfig",value:function(e){this.props.model.viewConfig.calendar_day_px_id=e}},{key:"getCurrentCalendar",value:function(){return this.props.model.currentCalendar()}},{key:"isInRange",value:function(e,t){return e[0]<=t&&t<=e[1]}},{key:"getRoundDate",value:function(e,t,a){e=dr.getStartOfDay(e);var n=null,s=0,o=e.getUTCDate(),r=1;if("start"==a&&(r=-1),this.isInRange(Er,t))s=2,n=dr.clone(e),dr.addDays(n,s*r);else if(this.isInRange(Pr,t))s=3,n=dr.clone(e),dr.addDays(n,s*r+2);else if(this.isInRange(br,t))s=4,n=dr.clone(e),dr.addDays(n,s*r+3);else if(this.isInRange(Sr,t))s=6,n=dr.clone(e),dr.addDays(n,s*r+5);else if(this.isInRange(Cr,t))s=8,n=dr.clone(e),dr.addDays(n,s*r+7);else if(this.isInRange(xr,t)){s=11,n=dr.clone(e),dr.addDays(n,s*r);var l=n.getUTCDate();30<=l?n.setUTCDate(21):(l=10*$a(l/10)+1,n.setUTCDate(l))}else this.isInRange(Dr,t)&&(s=32,n=dr.clone(e),dr.addDays(n,s*r),n.setUTCDate(1));return"finish"==a&&dr.addDays(n,7),n}},{key:"getStartDate",value:function(e){var t=this.props.model.root().computedData.start_date;return this.getRoundDate(t,e,"start")}},{key:"getFinishDate",value:function(e){var t=this.props.model.root().computedData.finish_date;return this.getRoundDate(t,e,"finish")}},{key:"getHeadTopTitle",value:function(e,t){return this.isInRange(Dr,t)?e.getUTCFullYear()+"\u5E74":e.getUTCFullYear()+"\u5E74"+(e.getUTCMonth()+1)+"\u6708"}},{key:"getHeadBottomTitle",value:function(e,t){if(this.isInRange(Dr,t))return e.getUTCMonth()+1+"\u6708";if(this.isInRange(xr,t)){if(1==e.getUTCDate())return"\u4E0A\u65EC";if(11==e.getUTCDate())return"\u4E2D\u65EC";if(21==e.getUTCDate())return"\u4E0B\u65EC"}else return e.getUTCDate().toString()}},{key:"getNextHeadBottomDate",value:function(e,t){var a=null;return this.isInRange(Er,t)?(a=dr.clone(e),dr.addDays(a,1)):this.isInRange(Pr,t)?(a=dr.clone(e),dr.addDays(a,2)):this.isInRange(br,t)?(a=dr.clone(e),dr.addDays(a,3)):this.isInRange(Sr,t)?(a=dr.clone(e),dr.addDays(a,5)):this.isInRange(Cr,t)?(a=dr.clone(e),dr.addDays(a,7)):this.isInRange(xr,t)?(a=dr.clone(e),21==e.getUTCDate()?(dr.addDays(a,30),a.setUTCDate(1)):dr.addDays(a,10)):this.isInRange(Dr,t)&&(a=dr.clone(e),dr.addDays(a,32),a.setUTCDate(1)),a}},{key:"updateHeadPeriods",value:function(){var e=this.state.startDate,t=dr.clone(e),a=this.state.finishDate,n=this.state.dayPx,s=this.getHeadTopTitle(t,n),o=[],r=0;for(this.state.headPeriods=[];t.getTime()<a.getTime();){var l=this.getHeadTopTitle(t,n);s!=l&&(this.state.headPeriods.push([s,o]),s=l,o=[]);var i=this.getNextHeadBottomDate(t,n),d=(i.getTime()-t.getTime())/3600/24/1e3;r+=d,o.push([this.getHeadBottomTitle(t,n),d]),t=i}0<o.length&&this.state.headPeriods.push([s,o]),this.state.width=r*this.state.dayPx}},{key:"getRowsAndShowRange",value:function(){var e=this.props.model.showRows,t=e[0],a=e[e.length-1],n=t?t.idx:0,s=a?a.idx:0;return[this.props.model.rows,n,s]}},{key:"calcPos",value:function(e){var t=dr.getStartOfDay(e),a=(t.getTime()-this.state.startDate.getTime())/3600/24/1e3*this.state.dayPx,n=this.state.calendar.getMinStartSeconds(),s=this.state.calendar.getMaxEndSeconds(),o=dr.getSecondsOfDay(e);return o<n?o=n:o>s&&(o=s),a+=(o-n)/(s-n)*this.state.dayPx,Ot(a)}},{key:"calcOffDayPos",value:function(e){var t=dr.clone(this.state.calendar.startDate);return dr.addDays(t,e),this.calcPos(t)}},{key:"getHeight",value:function(){return this.props.model.lastShowRow?(this.props.model.lastShowRow.showIndex+2)*Mo.rowHeight:0}},{key:"getWidth",value:function(){return this.state.width}},{key:"isNeedScrollWithGrid",value:function(){return!!this.props.model.isShowGantt()}},{key:"zoomIn",value:function(){var e=this.getDayPxConfig();if(e<Rr.length-1){if(e+=1,this.setDayPxConfig(e),this.props.model.isShowPert())for(var t=0;t<this.props.model.rows.length;t++)this.props.model.rows[t].pertDrawer.touch();this.props.model.toUpdateZpertChart(),this.forceUpdate()}}},{key:"zoomOut",value:function(){var e=this.getDayPxConfig();if(0<e){if(e-=1,this.setDayPxConfig(e),this.props.model.isShowPert())for(var t=0;t<this.props.model.rows.length;t++)this.props.model.rows[t].pertDrawer.touch();this.props.model.toUpdateZpertChart(),this.forceUpdate()}}},{key:"updateHeadAndBodyCss",value:function(){this.shouldShowPartitionHead()||(this.ref.querySelector(".zchart_head").style.paddingLeft="")}},{key:"componentDidMount",value:function(){var e=this;this.updateHeadAndBodyCss();var t=this.ref.querySelector(".zchart_body"),a=t.closest(".zplan-spliter-panel").querySelector(".zgrid_body");t.addEventListener("scroll",function(){if(e.isNeedScrollWithGrid()){a.scrollTop=t.scrollTop,a.dispatchEvent(new Event("scroll"));var n=t.scrollLeft;e.ref.querySelector(".zchart_head_table").style.left=-n+"px"}});var n=function(n){if(e.isNeedScrollWithGrid()){var s=t.scrollTop+n.deltaY;a.scrollTop=s,a.dispatchEvent(new Event("scroll"))}};t.addEventListener("mousewheel",n),t.addEventListener("DOMMouseScroll",n)}},{key:"componentDidUpdate",value:function(){this.updateHeadAndBodyCss()}},{key:"renderChartBody",value:function(e){var t=null,a="zchart_body";return this.props.model.isShowGantt()?(a+=" zchart_body_scroll",t=Je(vr,{chart:this,currentRow:this.props.model.currentRow,days:this.state.calendar.days,mustUpdate:e})):t=Je(Tr,{chart:this,model:this.props.model,days:this.state.calendar.days,dayPx:this.state.dayPx}),Je("div",{class:a},t)}},{key:"updateState",value:function(){var e=this.getDayPx(),t=this.getStartDate(e),a=this.getFinishDate(e),n=!1;(this.state.dayPx!=e||this.state.startDate.getTime()!=t.getTime()||this.state.finishDate.getTime()!=a.getTime())&&(this.state.dayPx=e,this.state.startDate=t,this.state.finishDate=a,this.state.shouldUpdateHeadPeriods=!0);var s=this.getCurrentCalendar();return this.state.calendar!=s&&(this.state.calendar=s,this.state.shouldUpdateHeadPeriods=!0),this.state.shouldUpdateHeadPeriods&&(this.updateHeadPeriods(),n=!0,this.state.shouldUpdateHeadPeriods=!1),n}},{key:"renderPartitionHead",value:function(){if(this.shouldShowPartitionHead()){for(var e=[],t=0,a=!0,n=0;n<this.props.model.partitions.length;n++){var s=this.props.model.partitions[n],o=(s.pertRow-t)*Mo.rowHeight;a&&(o+=50),a=!1,e.push(Je("tr",{class:"zchart_partition_head_tr"},Je("th",{class:"zchart_partition_head_th",style:"height:"+o+"px"},s.name))),t=s.pertRow}return Je("table",{class:"zchart_partition_head",cellSpacing:0,cellPadding:0,style:"top:43px"},Je("thead",{},e))}}},{key:"shouldShowPartitionHead",value:function(){return this.props.model.isShowPert()&&1<this.props.model.partitions.length}},{key:"render",value:function(){var e=this,t=this.updateState();return Je("div",{class:"zchart",ref:function(t){e.ref=t}},[Je(hr,{chart:this,shouldUpdate:t}),this.renderChartBody(t)])}},{key:"resizeZpert",value:function(){this.props.model.isShowPert()&&this.pertInstance&&this.pertInstance.drawer.update()}}]),t}(sa),Ir=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.ref=null,a}return Eo(t,e),yn(t,[{key:"componentDidMount",value:function(){}},{key:"_renderHeader",value:function(){return Je("div",{class:"zscore-header",style:{height:Mo.headHeightStr,lineHeight:Mo.headHeightStr}},[Je("span",{class:"zscore-header-title"},"\u8BA1\u5212\u5F97\u5206(\u603B\u5206"+this.props.model.score.fullScore+"):"),Je("span",{class:"zscore-header-score"},this.props.model.score.score)])}},{key:"_markTasks",value:function(e,t){var a=e.instance,n=e.type,s=e.tasks;a.props.model.score.markedType=n,a.props.model.score.markedTasks=s,a.props.model.shouldMarked=!0,a.props.model.updateAll(),t.preventDefault()}},{key:"_selectTask",value:function(e,t){var a=e.instance,n=e.task;n.setAsCurrentWithSelect(),a.props.model.updateAll(),t.preventDefault()}},{key:"_renderCritical",value:function(){var e=this.props.model.score.notices.critical,t=[Je("span",{class:"zscore-item-title"},e.title),Je("span",{class:"zscore-item-score"},e.score.toString())],a=[Je("div",{class:"zscore-item-notice"},e.notice)];if(0<e.tasks.length){e.type==this.props.model.score.markedType?t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:"",tasks:[]},this._markTasks)},"\u53D6\u6D88\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C")):t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:e.type,tasks:e.tasks},this._markTasks)},"\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C"));for(var n=[],s=0,o;s<e.tasks.length;s++)o=e.tasks[s],n.push(Je("div",{class:"zscore-item-task",onClick:S({instance:this,task:o},this._selectTask)},o.idx+". "+o.getValue("name")));a.push(n)}return Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderLogicRelations",value:function(){var e=this.props.model.score.notices.logicRelations,t=[Je("span",{class:"zscore-item-title"},e.title),Je("span",{class:"zscore-item-score"},e.score.toString())],a=[Je("div",{class:"zscore-item-notice"},e.notice)];if(0<e.tasks.length){e.type==this.props.model.score.markedType?t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:"",tasks:[]},this._markTasks)},"\u53D6\u6D88\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C")):t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:e.type,tasks:e.tasks},this._markTasks)},"\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C"));for(var n=[],s=0,o;s<e.links.length;s++)o=e.links[s],n.push(Je("div",{class:"zscore-item-link"},Je("a",{class:"open_url",href:"javascript:void(0)","data-url":o.href},o.name)));a.push(n)}return Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderTasksLength",value:function(){var e=this.props.model.score.notices.tasksLength,t=[Je("span",{class:"zscore-item-title"},e.title),Je("span",{class:"zscore-item-score"},e.score.toString())],a=[Je("div",{class:"zscore-item-notice"},e.notice)];return Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderTaskDurations",value:function(){var e=this.props.model.score.notices.taskDurations,t=[Je("span",{class:"zscore-item-title"},e.title),Je("span",{class:"zscore-item-score"},e.score.toString())],a=[Je("div",{class:"zscore-item-notice"},e.notice)];return Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderOffDay",value:function(){var e=this.props.model.score.notices.offDay,t=[Je("span",{class:"zscore-item-title"},e.title),Je("span",{class:"zscore-item-score"},e.score.toString())],a=[Je("div",{class:"zscore-item-notice"},e.notice)];if(0<e.links.length){for(var n=[],s=0,o;s<e.links.length;s++)o=e.links[s],n.push(Je("div",{class:"zscore-item-link"},Je("a",{class:"open_url",href:"javascript:void(0)","data-url":o.href},o.name)));a.push(n)}return Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderSFRelation",value:function(){var e=this.props.model.score.notices.sfRelation,t=[Je("span",{class:"zscore-item-title"},e.title)],a=[Je("div",{class:"zscore-item-notice"},e.notice)];return 0<e.tasks.length&&(e.type==this.props.model.score.markedType?t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:"",tasks:[]},this._markTasks)},"\u53D6\u6D88\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C")):t.push(Je("span",{class:"zscore-item-mark-tasks-btn",onClick:S({instance:this,type:e.type,tasks:e.tasks},this._markTasks)},"\u6807\u6CE8\u95EE\u9898\u5DE5\u4F5C"))),Je("div",{class:"zscore-item"},[Je("div",{class:"zscore-item-header"},t),Je("div",{class:"zscore-item-body"},a)])}},{key:"_renderBody",value:function(){return Je("div",{class:"zscore-body"},[this._renderCritical(),this._renderLogicRelations(),this._renderTasksLength(),this._renderTaskDurations(),this._renderOffDay(),this._renderSFRelation()])}},{key:"render",value:function(){var e=this;return Je("div",{class:"zscore",ref:function(t){e.ref=t}},[this._renderHeader(),this._renderBody()])}}]),t}(sa),Lr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.state={shouldUpdate:!0,duration:"",start:"",finish:"",isCurrentRow:!1},a}return Eo(t,e),yn(t,[{key:"updateState",value:function(){var e=this.props.row.getMsTask(),t="",a="",n="",s=this.props.row.isCurrentRow();this.state.isCurrentRow!=s&&(this.state.isCurrentRow=s,this.state.shouldUpdate=!0),null!=e&&(t=e.durationStr,a=dr.formatUTC(dr.setUnix(e.start)),n=dr.formatUTC(dr.setUnix(e.finish))),t!=this.state.duration&&(this.state.duration=t,this.state.shouldUpdate=!0),a!=this.state.start&&(this.state.start=a,this.state.shouldUpdate=!0),n!=this.state.finish&&(this.state.finish=n,this.state.shouldUpdate=!0)}},{key:"render",value:function(){if(this.updateState(),!this.state.shouldUpdate)return"$NO_OP";this.state.shouldUpdate=!1;var e="";return this.state.isCurrentRow&&(e="current_row"),Je("tr",{class:e,style:{height:Mo.rowHeightStr}},[Je("td",{},this.state.duration),Je("td",{},this.state.start),Je("td",{},this.state.finish)])}}]),t}(sa),Ar=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.ref=null,a}return Eo(t,e),yn(t,[{key:"componentDidMount",value:function(){var e=this.ref.querySelector(".zcompare-body"),t=e.closest(".zplan-spliter-panel").querySelector(".zgrid_body");e.scrollTop=t.scrollTop,t.addEventListener("scroll",function(){e.scrollTop=t.scrollTop})}},{key:"_renderHeader",value:function(){return Je("table",{class:"zcompare-table"},Je("thead",{},Je("tr",{style:{height:Mo.headHeightStr}},[Je("td",{style:{width:"120px"}},"\u5DE5\u671F"),Je("td",{style:{width:"120px"}},"\u5F00\u59CB\u65F6\u95F4"),Je("td",{style:{width:"120px"}},"\u7ED3\u675F\u65F6\u95F4")])))}},{key:"_renderBody",value:function(){for(var e=[Je("tr",{style:{height:this.props.model.topRowNum*Mo.rowHeight+"px"}},[Je("td",{style:{width:"120px"}},""),Je("td",{style:{width:"120px"}},""),Je("td",{style:{width:"120px"}},"")])],t=0;t<this.props.model.showRows.length;t++)e.push(Je(Lr,{row:this.props.model.showRows[t]}));return Je("div",{class:"zcompare-body"},Je("table",{class:"zcompare-table"},Je("tbody",{},e)))}},{key:"render",value:function(){var e=this;return Je("div",{class:"zcompare",ref:function(t){e.ref=t}},[this._renderHeader(),this._renderBody()])}}]),t}(sa),Mr=function(e,t){function a(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Qe)}var n=this,s=n.document,o=s.attachEvent,r;if("undefined"!=typeof navigator&&(r=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!e.__resizeListeners__)if(e.__resizeListeners__=[],o)e.__resizeTrigger__=e,e.attachEvent("onresize",Qe);else{"static"===getComputedStyle(e).position&&(e.style.position="relative");var l=e.__resizeTrigger__=s.createElement("object");l.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),l.setAttribute("class","resize-sensor"),l.setAttribute("tabindex","-1"),l.__resizeElement__=e,l.onload=a,l.type="text/html",r&&e.appendChild(l),l.data="about:blank",r||e.appendChild(l)}e.__resizeListeners__.push(t)},Fr="undefined"==typeof window?Mr:Mr.bind(window),Or=function(e,t){var a=document.attachEvent,n=e.__resizeListeners__||[];if(t){var s=n.indexOf(t);-1!==s&&n.splice(s,1)}else n=e.__resizeListeners__=[];if(!n.length){if(a)e.detachEvent("onresize",Qe);else if(e.__resizeTrigger__){var o=e.__resizeTrigger__.contentDocument,r=o&&o.defaultView;r&&(r.removeEventListener("resize",Qe),delete r.__resizeTrigger__),e.__resizeTrigger__=!e.removeChild(e.__resizeTrigger__)}delete e.__resizeListeners__}};Fr.unbind=Or;var Ur=7,Nr=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.ref=null,a.props.model.planInstance=a,a.chartInstance=null,a.spliterPanelEl=null,a.spliterEl=null,a.leftPanelEl=null,a.rightPanelEl=null,a.onResizeSpliterPanel=a.onResizeSpliterPanel.bind(a),a}return Eo(t,e),yn(t,[{key:"getSpliterPosConfig",value:function(){return this.props.model.viewConfig.splitter_pos}},{key:"setSpliterPosConfig",value:function(e){e&&(this.props.model.viewConfig.splitter_pos=e)}},{key:"setSpliterPos",value:function(e){var t=this.spliterPanelEl.clientWidth;if(t<=20+Ur+20)e=$a(t/2);else{var a=t-Ur-20;e>a&&(e=a),20>e&&(e=20)}this.leftPanelEl.style.width=e+"px",this.spliterEl.style.left=e+"px",this.rightPanelEl.style.left=e+Ur+"px";var n=this.rightPanelEl.style.width,s=this.spliterPanelEl.clientWidth-e-Ur;0>s&&(s=0),s+="px",s!=n&&(this.rightPanelEl.style.width=s,null!=this.chartInstance&&this.chartInstance.resizeZpert())}},{key:"onSpliterMouseDown",value:function(e,t){var a=e.leftPanelEl.offsetWidth,n=t.pageX,s=function(t){var s=a+t.pageX-n;e.setSpliterPos(s),t.preventDefault()};window.addEventListener("mousemove",s),window.addEventListener("mouseup",function t(){window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",t),e.setSpliterPosConfig(e.leftPanelEl.style.width),null!=e.chartInstance&&e.chartInstance.resizeZpert()})}},{key:"onResizeSpliterPanel",value:function(){this.setSpliterPos($a(this.spliterEl.style.left))}},{key:"componentDidMount",value:function(){this.setSpliterPos($a(this.spliterEl.style.left)),Fr(this.spliterPanelEl,this.onResizeSpliterPanel)}},{key:"componentWillUnmount",value:function(){Or(this.spliterPanelEl,this.onResizeSpliterPanel)}},{key:"isGridNeedScroll",value:function(){return this.props.model.isShowPert()||this.props.model.isShowScore()||this.props.model.isShowCompareDiff()}},{key:"renderLeftPanel",value:function(){var e=[];return this.props.model.isShowCompareDiff()&&e.push(Je("div",{class:"compare-title"},[Je("span",{},"\u6309\u903B\u8F91\u5173\u7CFB\u8BA1\u7B97\u540E:"),Je("span",{class:"compare-desc"},"\u5BFC\u5165\u540E\u7ED3\u679C\u53EF\u80FD\u4E0EProject\u5185\u5BB9\u4E0D\u540C\uFF0C\u8FD9\u4E9B\u4E0D\u540C\u4EE5\u80CC\u666F\u8272\u533A\u5206")])),e.push(Je(ur,{model:this.props.model,scrollY:this.isGridNeedScroll()})),e}},{key:"renderRightPanel",value:function(){return this.props.model.isShowScore()?Je(Ir,{zplan:this,model:this.props.model}):this.props.model.isShowCompareDiff()?[Je("div",{class:"compare-title"},"\u539F\u59CBProject\u4FE1\u606F:"),Je(Ar,{model:this.props.model})]:Je(zr,{zplan:this,model:this.props.model})}},{key:"renderSpliter",value:function(){var e=this;return Je("div",{class:"zplan-spliter-panel",ref:function(t){e.spliterPanelEl=t}},[Je("div",{id:"grid_panel",class:"zplan-spliter-left",style:{width:this.getSpliterPosConfig()},ref:function(t){e.leftPanelEl=t}},this.renderLeftPanel()),Je("div",{class:"zplan-spliter",style:{left:$a(this.getSpliterPosConfig()),width:Ur+"px"},ref:function(t){e.spliterEl=t},onMouseDown:S(this,this.onSpliterMouseDown)}),Je("div",{id:"chart_panel",class:"zplan-spliter-right",style:{left:$a(this.getSpliterPosConfig())+Ur},ref:function(t){e.rightPanelEl=t}},this.renderRightPanel())])}},{key:"render",value:function(){var e=this;return Je("div",{class:"zplan",ref:function(t){e.ref=t}},[this.renderSpliter()])}}]),t}(sa);Ia(Ia.S,"Number",{isInteger:function(e){return!ga(e)&&isFinite(e)&&Ot(e)===e}});var Vr=ca.Number.isInteger,jr=h(function(e){e.exports={default:Vr,__esModule:!0}}),Wr=n(jr),Br=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.props.model.scaffoldInstance=a,a}return Eo(t,e),yn(t,[{key:"componentDidUpdate",value:function(){}},{key:"insertRow",value:function(e,t){e.props.model.addRow(e.props.model.currentRow),t.preventDefault()}},{key:"deleteRow",value:function(e,t){e.props.model.deleteSelectedOrCurrentRows(),t.preventDefault()}},{key:"renderCRUDBtnGroup",value:function(){return this.props.model.isReadonly()?null:Je("div",{class:"zplan-scaffold-toolbar"},Je("div",{class:"zplan-btn-group"},[Je("button",{class:"zplan-btn zplan-tooltip zplan-tooltip-bottom","aria-label":"\u63D2\u5165",onClick:S(this,this.insertRow)},[Je("i",{class:"zplan-icon-tianjia"})]),Je("button",{class:"zplan-btn zplan-tooltip zplan-tooltip-bottom","aria-label":"\u5220\u9664",onClick:S(this,this.deleteRow)},[Je("i",{class:"zplan-icon-delete"})])]))}},{key:"undergroundChanged",value:function(e,t){var a=t.target.value;a=$a(a),Wr(a)&&0<=a?e.props.model.undergroundFloor!=a&&(e.props.model.touchShow(),0<a&&null==e.props.model.undergroundFloor&&e.props.model.initUndergroundFloor(a),e.props.model.undergroundFloor=a,e.props.model.afterFloorSettingChanged()):e.props.model.addErrorMessage("\u5E94\u8BE5\u586B\u5199\u5927\u4E8E\u7B49\u4E8E\u96F6\u7684\u6570\u5B57"),e.props.model.updateAll()}},{key:"groundChanged",value:function(e,t){var a=t.target.value;a=$a(a),Wr(a)&&0<=a?e.props.model.groundFloor!=a&&(e.props.model.touchShow(),0<a&&null==e.props.model.groundFloor&&e.props.model.initGroundFloor(a),e.props.model.groundFloor=a,e.props.model.afterFloorSettingChanged()):e.props.model.addErrorMessage("\u5E94\u8BE5\u586B\u5199\u5927\u4E8E\u7B49\u4E8E\u96F6\u7684\u6570\u5B57"),e.props.model.updateAll()}},{key:"buildingPrefixChanged",value:function(e,t){e.props.model.buildingPrefix=t.target.value}},{key:"renderBaseinfo",value:function(){return this.props.model.isReadonly()?null:Je("div",{class:"zplan-scaffold-baseinfo zplan-form-inline"},[Je("div",{class:"zplan-form-group"},[Je("label",{for:"undergroundInput"},"\u5730\u4E0B\u5C42\u6570:"),Je("input",{id:"undergroundInput",class:"zplan-form-control",type:"number",onBlur:S(this,this.undergroundChanged),defaultValue:this.props.model.undergroundFloor||""})]),Je("div",{class:"zplan-form-group"},[Je("label",{for:"groundInput"},"\u5730\u4E0A\u5C42\u6570:"),Je("input",{id:"groundInput",class:"zplan-form-control",type:"number",onBlur:S(this,this.groundChanged),defaultValue:this.props.model.groundFloor||""})]),Je("div",{class:"zplan-form-group"},[Je("label",{for:"buildingPrefix"},"\u697C\u680B\u524D\u7F00:"),Je("input",{id:"buildingPrefix",class:"zplan-form-control",type:"text",onBlur:S(this,this.buildingPrefixChanged),defaultValue:this.props.model.buildingPrefix||""})])])}},{key:"addInfoChanged",value:function(e,t){var a=e.instance,n=e.name;a.props.model[n]=t.target.checked,a.props.model.updateAll()}},{key:"renderAddOptions",value:function(){return this.props.model.isReadonly()?null:Je("div",{class:"zplan-scaffold-addinfo"},[Je("label",{class:"zplan-checkbox-inline"},[Je("input",{type:"checkbox",checked:this.props.model.shouldAddBuildingPrefixBeforeFloorName||!1,onClick:S({instance:this,name:"shouldAddBuildingPrefixBeforeFloorName"},this.addInfoChanged)}),"\u697C\u5C42\u5206\u533A\u540D\u79F0\u524D\u52A0\u5165\u697C\u680B\u524D\u7F00"]),Je("label",{class:"zplan-checkbox-inline"},[Je("input",{type:"checkbox",checked:this.props.model.shouldAddBuildingPrefixBeforeTaskName||!1,onClick:S({instance:this,name:"shouldAddBuildingPrefixBeforeTaskName"},this.addInfoChanged)}),"\u5DE5\u4F5C\u540D\u79F0\u524D\u52A0\u5165\u697C\u680B\u524D\u7F00"]),Je("label",{class:"zplan-checkbox-inline"},[Je("input",{type:"checkbox",checked:this.props.model.shouldAddFloorNameBeforeTaskName||!1,onClick:S({instance:this,name:"shouldAddFloorNameBeforeTaskName"},this.addInfoChanged)}),"\u5DE5\u4F5C\u540D\u79F0\u524D\u52A0\u5165\u697C\u5C42\u540D"])])}},{key:"render",value:function(){return Je("div",{class:"zplan-scaffold"},[this.renderBaseinfo(),this.renderCRUDBtnGroup(),Je("div",{class:"zplan-scaffold-body"},Je(ur,{model:this.props.model,scrollY:!0})),this.renderAddOptions()])}}]),t}(sa),Hr=function(t,a,e,n){try{return n?a(fa(e)[0],e[1]):a(e)}catch(a){var s=t["return"];throw void 0!==s&&fa(s.call(t)),a}},Yr=Wn("iterator"),qr=Array.prototype,Gr=function(e){return e!==void 0&&(Tn.Array===e||qr[Yr]===e)},$r=function(e,t,a){t in e?f.f(e,t,Ca(0,a)):e[t]=a},Xr=Wn("iterator"),Zr=!1;try{var Kr=[7][Xr]();Kr["return"]=function(){Zr=!0}}catch(t){}var Jr=function(e,t){if(!t&&!Zr)return!1;var a=!1;try{var n=[7],s=n[Xr]();s.next=function(){return{done:a=!0}},n[Xr]=function(){return s},e(n)}catch(t){}return a};Ia(Ia.S+Ia.F*!Jr(function(){}),"Array",{from:function(e){var t=Xa(e),a="function"==typeof this?this:Array,n=arguments.length,s=1<n?arguments[1]:void 0,o=void 0!==s,r=0,l=nr(t),i,d,p,c;if(o&&(s=ma(s,2<n?arguments[2]:void 0,2)),null!=l&&!(a==Array&&Gr(l)))for(c=l.call(t),d=new a;!(p=c.next()).done;r++)$r(d,r,o?Hr(c,s,[p.value,r],!0):p.value);else for(i=Sn(t.length),d=new a(i);i>r;r++)$r(d,r,o?s(t[r],r):t[r]);return d.length=r,d}});var Qr=ca.Array.from,el=h(function(e){e.exports={default:Qr,__esModule:!0}}),tl=n(el),al=h(function(e,t){t.__esModule=!0;var a=function(e){return e&&e.__esModule?e:{default:e}}(el);t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,a.default)(e)}}),nl=n(al),sl=100,ol={DEFAULT:0,CIRCLE:1},rl=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.percent=0,a.remainingPercent=sl,a.props=e,a.style=ol.DEFAULT,e.style==ol.CIRCLE&&(a.style=ol.CIRCLE),a.tip=a.props.tip||"",a}return Eo(t,e),yn(t,[{key:"_setPercent",value:function(){+this.props.percent===this.props.percent&&(this.props.percent>sl?this.percent=sl:0<=this.props.percent&&(this.percent=this.props.percent),this.remainingPercent=sl-this.percent)}},{key:"_getClassNameOfPercent",value:function(){return 40>this.percent?"zplan-progress-red":60>this.percent?"zplan-progress-orange":80>this.percent?"zplan-progress-green":"zplan-progress-blue"}},{key:"_renderRefreshBtn",value:function(){return Je("svg",{class:"zplan-progress-refresh",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},Je("path",{d:"M133.25 575.734H0v319.853l94.74-87.064a511.828 511.828 0 0 0 924.822-232.789H890.277a383.887 383.887 0 0 1-700.285 145.277l158.071-145.277H133.251zM511.765 0A511.828 511.828 0 0 0 3.966 447.793h129.285A383.887 383.887 0 0 1 839.549 311.92L703.675 447.793h319.853V127.941l-91.606 91.606A510.996 510.996 0 0 0 511.764 0z"}))}},{key:"_renderProgress",value:function(){var e="";if(this.props.onClick&&(e+=" zplan-progress-clickable"),0<this.tip.length&&(e+=" zplan-tooltip"),this.style==ol.CIRCLE){var t=this.props.shouldShowRefresh?this._renderRefreshBtn():Je("span",{},this.percent.toString());return Je("div",{class:"zplan-progress-bubble"+e,"aria-label":this.tip,onClick:S(this,this.onBarClick)},Je("div",{class:"bubble-inner"},[Je("div",{class:"bubble-percent"},t),Je("div",{class:"bubble-water",style:{top:this.remainingPercent+"%"}}),Je("div",{class:"bubble-glare"})]))}return Je("div",{class:"zplan-progress-default"+e,"aria-label":this.tip,onClick:S(this,this.onBarClick)},Je("span",{class:"progress-inner",style:{right:this.remainingPercent+"%"}}))}},{key:"onBarClick",value:function(e){e.props.onClick&&e.props.onClick()}},{key:"render",value:function(){return this._setPercent(),Je("div",{class:"zplan-progress-bar "+this._getClassNameOfPercent()},this._renderProgress())}}]),t}(sa),ll=Rs.f,il=function(e){return function(t){for(var a=Cn(t),n=Ln(a),s=n.length,o=0,r=[],l;s>o;)ll.call(a,l=n[o++])&&r.push(e?[l,a[l]]:a[l]);return r}},dl=il(!1);Ia(Ia.S,"Object",{values:function(e){return dl(e)}});var pl=ca.Object.values,cl=h(function(e){e.exports={default:pl,__esModule:!0}}),ul=n(cl),hl=function(e,t,a){for(var n in t)a&&e[n]?e[n]=t[n]:Sa(e,n,t[n]);return e},ml=function(e,t,a,n){if(!(e instanceof t)||n!==void 0&&n in e)throw TypeError(a+": incorrect invocation!");return e},gl=h(function(e){var t={},a={},n=e.exports=function(e,n,s,o,r){var l=r?function(){return e}:nr(e),i=ma(s,o,n?2:1),d=0,p,c,u,h;if("function"!=typeof l)throw TypeError(e+" is not iterable!");if(Gr(l)){for(p=Sn(e.length);p>d;d++)if(h=n?i(fa(c=e[d])[0],c[1]):i(e[d]),h===t||h===a)return h;}else for(u=l.call(e);!(c=u.next()).done;)if(h=Hr(u,i,c.value,n),h===t||h===a)return h};n.BREAK=t,n.RETURN=a}),fl=Wn("species"),_l=function(e){var t="function"==typeof ca[e]?ca[e]:pa[e];ya&&t&&!t[fl]&&f.f(t,fl,{configurable:!0,get:function(){return this}})},yl=function(e,t){if(!ga(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e},vl=f.f,kl=us.fastKey,wl=ya?"_s":"size",Tl=function(e,t){var a=kl(t),n;if("F"!==a)return e._i[a];for(n=e._f;n;n=n.n)if(n.k==t)return n},Rl={getConstructor:function(e,t,a,n){var s=e(function(e,o){ml(e,s,t,"_i"),e._t=t,e._i=jn(null),e._f=void 0,e._l=void 0,e[wl]=0,null!=o&&gl(o,a,e[n],e)});return hl(s.prototype,{clear:function(){for(var e=yl(this,t),a=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete a[n.i];e._f=e._l=void 0,e[wl]=0},delete:function(e){var a=yl(this,t),n=Tl(a,e);if(n){var s=n.n,o=n.p;delete a._i[n.i],n.r=!0,o&&(o.n=s),s&&(s.p=o),a._f==n&&(a._f=s),a._l==n&&(a._l=o),a[wl]--}return!!n},forEach:function(e){yl(this,t);for(var a=ma(e,1<arguments.length?arguments[1]:void 0,3),n;n=n?n.n:this._f;)for(a(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!Tl(yl(this,t),e)}}),ya&&vl(s.prototype,"size",{get:function(){return yl(this,t)[wl]}}),s},def:function(e,t,a){var n=Tl(e,t),s,o;return n?n.v=a:(e._l=n={i:o=kl(t,!0),k:t,v:a,p:s=e._l,n:void 0,r:!1},!e._f&&(e._f=n),s&&(s.n=n),e[wl]++,"F"!==o&&(e._i[o]=n)),e},getEntry:Tl,setStrong:function(e,t,a){Qn(e,t,function(e,a){this._t=yl(e,t),this._k=a,this._l=void 0},function(){for(var e=this,t=e._k,a=e._l;a&&a.r;)a=a.p;return e._t&&(e._l=a=a?a.n:e._t._f)?"keys"==t?ts(0,a.k):"values"==t?ts(0,a.v):ts(0,[a.k,a.v]):(e._t=void 0,ts(1))},a?"entries":"values",!a,!0),_l(t)}},Dl=Wn("species"),xl=function(e){var t;return xs(e)&&(t=e.constructor,"function"==typeof t&&(t===Array||xs(t.prototype))&&(t=void 0),ga(t)&&(t=t[Dl],null===t&&(t=void 0))),void 0===t?Array:t},Cl=function(e,t){return new(xl(e))(t)},Sl=f.f,bl=function(e,t){var a=1==e,n=4==e,s=6==e,o=t||Cl;return function(t,r,l){for(var i=Xa(t),d=xn(i),p=ma(r,l,3),c=Sn(d.length),u=0,h=a?o(t,c):2==e?o(t,0):void 0,m,g;c>u;u++)if((5==e||s||u in d)&&(m=d[u],g=p(m,u,i),e))if(a)h[u]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return u;case 2:h.push(m);}else if(n)return!1;return s?-1:3==e||n?n:h}}(0),Pl="Set",El=function(e,t,a,n,s,o){var r=pa[e],l=r,i=s?"set":"add",d=l&&l.prototype,p={};return ya&&"function"==typeof l&&(o||d.forEach&&!_a(function(){new l().entries().next()}))?(l=t(function(t,a){ml(t,l,e,"_c"),t._c=new r,null!=a&&gl(a,s,t[i],t)}),bl(["add","clear","delete","forEach","get","has","set","keys","values","entries","toJSON"],function(e){var t="add"==e||"set"==e;e in d&&!(o&&"clear"==e)&&Sa(l.prototype,e,function(n,a){if(ml(this,l,e),!t&&o&&!ga(n))return"get"==e&&void 0;var s=this._c[e](0===n?0:n,a);return t?this:s})}),o||Sl(l.prototype,"size",{get:function(){return this._c.size}})):(l=n.getConstructor(t,e,s,i),hl(l.prototype,a),us.NEED=!0),Yn(l,e),p[e]=l,Ia(Ia.G+Ia.W+Ia.F,p),o||n.setStrong(l,e,s),l}(Pl,function(e){return function(){return e(this,0<arguments.length?arguments[0]:void 0)}},{add:function(e){return Rl.def(yl(this,Pl),e=0===e?0:e,e)}},Rl),zl=function(e,t){var a=[];return gl(e,!1,a.push,a,t),a};Ia(Ia.P+Ia.R,"Set",{toJSON:function(e){return function(){if(Jo(this)!=e)throw TypeError(e+"#toJSON isn't generic");return zl(this)}}("Set")});(function(e){Ia(Ia.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})})("Set");(function(e){Ia(Ia.S,e,{from:function(e){var t=arguments[1],a,s,o,r;return(ha(this),a=void 0!==t,a&&ha(t),null==e)?new this:(s=[],a?(o=0,r=ma(t,arguments[2],2),gl(e,!1,function(e){s.push(r(e,o++))})):gl(e,!1,s.push,s),new this(s))}})})("Set");var Il=ca.Set,Ll=h(function(e){e.exports={default:Il,__esModule:!0}}),Al=n(Ll),Ml=function(){function e(t){hn(this,e),this.idx=t,this.inTasks=[],this.outTasks=[],this.outLinks=[],this.inLinks=[],this.unixTime=null,this.date=null}return yn(e,[{key:"isHead",value:function(){if(this.inTasks.some(function(e){return!e.isMilestone()}))return!1;for(var e=0,t;e<this.inLinks.length;e++)if(t=this.inLinks[e],0<t.beginDot.inLinks.length||t.beginDot.inTasks.some(function(e){return!e.isMilestone()})||t.beginDot.outTasks.some(function(e){return!e.isMilestone()}))return!1;return!0}},{key:"isTail",value:function(){if(this.outTasks.some(function(e){return!e.isMilestone()}))return!1;for(var e=0,t;e<this.outLinks.length;e++)if(t=this.outLinks[e],0<t.endDot.outLinks.length||t.endDot.inTasks.some(function(e){return!e.isMilestone()})||t.endDot.outTasks.some(function(e){return!e.isMilestone()}))return!1;return!0}},{key:"getDate",value:function(){return null==this.date&&(this.date=new Date(1e3*this.unixTime)),this.date}}]),e}(),Fl=function(){function e(t,a,n,s){hn(this,e),this.idx=t,this.id=a.id,this.type=a.type,this.name=a.name,this.duration=a.duration,this.start=a.plan_start_time,this.stop=a.plan_stop_time,this.beginDot=n,this.endDot=s,this.dependType=a.depend_type||"FS",this.beginDot.outLinks.push(this),this.endDot.inLinks.push(this),this.hasLogicPrevRelations=null,this.hasLogicNextRelations=null}return yn(e,[{key:"checkLogicPrevRelations",value:function(){if(null==this.hasLogicPrevRelations){for(var e=[],a=0,n;a<this.beginDot.inTasks.length;a++)if(n=this.beginDot.inTasks[a],n.isMilestone())e.push(n);else{this.hasLogicPrevRelations=!0;break}if(null==this.hasLogicPrevRelations){e.push.apply(e,nl(this.beginDot.inLinks));for(var s=0,o;s<e.length;s++)if(o=e[s],o.checkLogicPrevRelations()){this.hasLogicPrevRelations=!0;break}null==this.hasLogicPrevRelations&&(this.hasLogicPrevRelations=!1)}}return this.hasLogicPrevRelations}},{key:"checkLogicNextRelations",value:function(){if(null==this.hasLogicNextRelations){for(var e=[],a=0,n;a<this.endDot.outTasks.length;a++)if(n=this.endDot.outTasks[a],n.isMilestone())e.push(n);else{this.hasLogicNextRelations=!0;break}if(null==this.hasLogicNextRelations){e.push.apply(e,nl(this.endDot.outLinks));for(var s=0,o;s<e.length;s++)if(o=e[s],o.checkLogicNextRelations()){this.hasLogicNextRelations=!0;break}null==this.hasLogicNextRelations&&(this.hasLogicNextRelations=!1)}}return this.hasLogicNextRelations}},{key:"isSuspended",value:function(){switch(this.dependType){case"SS":return 0==this.beginDot.outTasks.length||0==this.endDot.outTasks.length;case"SF":return 0==this.beginDot.outTasks.length||0==this.endDot.inTasks.length;case"FS":return 0==this.beginDot.inTasks.length||0==this.endDot.outTasks.length;case"FF":return 0==this.beginDot.inTasks.length||0==this.endDot.inTasks.length;}}},{key:"hasFreetime",value:function(){if(this.start!=this.beginDot.unixTime||this.stop!=this.endDot.unixTime)return!0}}]),e}(),Ol={DEFAULT:0,INVALID:1},Ul=function(){function e(t,a,n,s,o){hn(this,e),this.idx=t,this.calendar=o,this.id=a.id,this.type=a.type,this.name=a.name,this.duration=a.duration,this.beginDot=n,this.endDot=s,this.level=a.level,this.start=a.plan_start_time,this.stop=a.plan_stop_time,this.isKeyTask=a.is_keywork,this.parent=null,this.children=[],this.isPartition=a.draw_type==2,this.isCollapsed=a.collapsed,this.workStyleIdx=a.work_style_idx||0,this.isVisible=!this.isRoot(),this.beginDot.outTasks.push(this),this.endDot.inTasks.push(this),this.hasLogicPrevRelations=null,this.hasLogicNextRelations=null,this.firstNoPrevChild=null,this.firstNoNextChild=null}return yn(e,[{key:"isRoot",value:function(){return this.level==0}},{key:"isMilestone",value:function(){return this.type==3}},{key:"addChild",value:function(e){e.parent=this,e.isVisible=!this.isCollapsed,this.children.push(e)}},{key:"inspectShowContent",value:function(e,t){var a=Ol.DEFAULT,n=e[this.workStyleIdx];return a=n.use_my_flags&8?n.show_content:t,a!=Ol.INVALID}},{key:"checkLogicPrevRelations",value:function(){if(null==this.hasLogicPrevRelations){for(var e=[],a=0,n;a<this.beginDot.inTasks.length;a++)if(n=this.beginDot.inTasks[a],n.isMilestone())e.push(n);else{this.hasLogicPrevRelations=!0;break}if(null==this.hasLogicPrevRelations){e.push.apply(e,nl(this.beginDot.inLinks));for(var s=0,o;s<e.length;s++)if(o=e[s],o.checkLogicPrevRelations()){this.hasLogicPrevRelations=!0;break}null==this.hasLogicPrevRelations&&(0==this.calendar.calcDuration(this.beginDot.getDate(),this.parent.beginDot.getDate())||this.start==this.parent.start?this.parent.checkLogicPrevRelations()?null==this.parent.firstNoPrevChild?(this.hasLogicPrevRelations=!0,this.parent.firstNoPrevChild=this):this.parent.firstNoPrevChild.beginDot==this.beginDot?this.hasLogicPrevRelations=!0:this.hasLogicPrevRelations=!1:this.hasLogicPrevRelations=!1:this.hasLogicPrevRelations=!1)}}return this.hasLogicPrevRelations}},{key:"checkLogicNextRelations",value:function(){if(null==this.hasLogicNextRelations){for(var e=[],a=0,n;a<this.endDot.outTasks.length;a++)if(n=this.endDot.outTasks[a],n.isMilestone())e.push(n);else{this.hasLogicNextRelations=!0;break}if(null==this.hasLogicNextRelations){e.push.apply(e,nl(this.endDot.outLinks));for(var s=0,o;s<e.length;s++)if(o=e[s],o.checkLogicNextRelations()){this.hasLogicNextRelations=!0;break}null==this.hasLogicNextRelations&&(0==this.calendar.calcDuration(this.endDot.getDate(),this.parent.endDot.getDate())||this.stop==this.parent.stop?this.parent.checkLogicNextRelations()?null==this.parent.firstNoNextChild?(this.hasLogicNextRelations=!0,this.parent.firstNoNextChild=this):this.parent.firstNoNextChild.endDot==this.endDot?this.hasLogicNextRelations=!0:this.hasLogicNextRelations=!1:this.hasLogicNextRelations=!1:this.hasLogicNextRelations=!1)}}return this.hasLogicNextRelations}},{key:"inspectLogicRelations",value:function(){return this.checkLogicPrevRelations(),this.checkLogicNextRelations(),this.hasLogicPrevRelations&&this.hasLogicNextRelations}}]),e}(),Nl={DATE:0,WEEK:1,MONTH:2,YEAR:3},Vl=function(){function e(t){hn(this,e),this.calData=t}return yn(e,[{key:"_convertRuleTypeAndTimes",value:function(e,t,a){return e==Nl.DATE?["0",dr.formatUTC(dr.setUnix(t)),dr.formatUTC(dr.setUnix(a-1))]:e==Nl.WEEK?["1",0==t?"7":t.toString(),0==a?"7":a.toString()]:e==Nl.MONTH?["2",t.toString(),a.toString()]:e==Nl.YEAR?["3",(t/100).toString(),(a/100).toString()]:void 0}},{key:"_convertRules",value:function(){var e=this,t=this.calData.vacation_rules||[];return t.map(function(t){var a=e._convertRuleTypeAndTimes(t.type,t.start,t.stop),n=ir(a,3),s=n[0],o=n[1],r=n[2];return{name:t.name,type:s,start:o,finish:r,status:!1==t.is_valid?"0":"1",worktype:!1==t.is_vacation?"1":"0"}})}},{key:"_convertTimes",value:function(e){for(var t=0,a=[],n=0;n<e.length;n++){var s=e[n],o=s[0],r=s[1];t+=r-o,a.push({start:o,end:r})}return[t,a]}},{key:"convert",value:function(){var e=this._convertTimes(this.calData.work_periods),t=ir(e,2),a=t[0],n=t[1];return{id:this.calData.id,name:this.calData.name,rules:this._convertRules(),times:n,seconds:a}}}]),e}(),jl=function(){function e(t,a){hn(this,e),this.owner=t,this.data=a,this.isShow=!0,this.comInstance=null,this.idx=null,this.parent=null,this.selectCol=null,this.selectColType=null,this.editCol=null,this.showIndex=null,this.isSelected=!1}return yn(e,[{key:"getValue",value:function(e){return this.data[e]}},{key:"getCellClass",value:function(){return""}},{key:"isCurrentRow",value:function(){return this==this.owner.currentRow}},{key:"clearComSelectState",value:function(){this.selectCol=null,this.selectColType=null,this.editCol=null,this.comInstance&&this.comInstance.clearSelectState()}},{key:"prev",value:function(){return 0<this.idx?this.owner.rows[this.idx-1]:null}},{key:"prevShow",value:function(){for(var e=this.idx-1,t;0<=e;e--)if(t=this.owner.rows[e],t){if(t.isShow)return t;continue}else return null}},{key:"next",value:function(){return this.idx<this.owner.rows.length-1?this.owner.rows[this.idx+1]:null}},{key:"nextShow",value:function(){for(var e=this.idx+1,t;e<this.owner.rows.length;e++)if(t=this.owner.rows[e],t){if(t.isShow)return t;continue}else return null}},{key:"activePrevCol",value:function(){if(this.comInstance&&this.selectCol){var e=this.owner.columns.prevCol(this.selectCol);e&&(this.selectCol=e.name,this.selectColType=e.type,this.editCol=this.isReadonly(e.name)||"date"!=e.type?null:e.name),this.touch(),this.comInstance.forceUpdate()}else console.error("make sure this is current row and has an actived col")}},{key:"activeNextCol",value:function(){if(this.comInstance&&this.selectCol){var e=this.owner.columns.nextCol(this.selectCol);e&&(this.selectCol=e.name,this.selectColType=e.type,this.editCol=this.isReadonly(e.name)||"date"!=e.type?null:e.name),this.touch(),this.comInstance.forceUpdate()}else console.error("make sure this is current row and has an actived col")}},{key:"calcParent",value:function(){if(0<=this.level()){var e=this.prev();if(e)if(this.level()>e.level())this.parent=e;else if(this.level()==e.level())this.parent=e.parent;else if(this.level()<e.level())for(;e.parent;)if(e=e.parent,this.level()==e.level()){this.parent=e.parent;break}this.setShow()}}},{key:"hasChild",value:function(){if(Wr(this.level())){var e=this.next();return e&&e.level()>this.level()}return!1}},{key:"setShow",value:function(){this.isShow=null==this.parent||!this.parent.collapsed()&&this.parent.isShow}},{key:"showCheckBox",value:function(){return!0}},{key:"changeCollapsed",value:function(){this.touch();for(var e=this.next();e&&(e.setShow(),e.touch(),e=e.next(),e&&!(e.level()<=this.level())););this.owner.showRangeChanged()}},{key:"setAsCurrent",value:function(){return this.owner.updateCurrentRow(this)}},{key:"setAsCurrentWithSelect",value:function(){return this.owner.updateCurrentRowSelect(this),this.owner.updateCurrentRow(this)}},{key:"setValue",value:function(e,t){null==this.data[e]?console.error("set an wrong column: "+e):this.data[e]!=t&&("collapsed"==e?(this.data.collapsed=!this.data.collapsed,this.changeCollapsed(),this.setAsCurrent(),this.owner.updateAll()):this.data[e]=t)}},{key:"setIdx",value:function(e){this.idx=e}},{key:"touch",value:function(){this.comInstance&&this.comInstance.touch()}},{key:"isReadonly",value:function(){return!1}},{key:"level",value:function(){return this.data.level}},{key:"collapsed",value:function(){return this.data.collapsed}},{key:"selected",value:function(){this.owner.selectedRow(this)}},{key:"movedAt",value:function(){this.owner.movedAt(this)}},{key:"isMovedAt",value:function(){return this.owner.currentMovedAt&&this.owner.currentMovedAt==this&&!this.owner.isMovedFirst}},{key:"leaves",value:function e(){for(var t=this.next(),e=[];t&&t.level()>this.level();)t.hasChild()||e.push(t),t=t.next();return e}},{key:"shouldRemove",value:function(){}},{key:"toCopyData",value:function(){return Ao(this.data)}},{key:"getGridRowIndex",value:function(){return this.idx}},{key:"isDiff",value:function(){return!1}},{key:"isMarked",value:function(){return!1}},{key:"actionClick",value:function(){}}]),e}(),Wl=function(){function e(t,a){hn(this,e),this.owner=t,this.data=a,this.cols={};for(var n=0;n<a.length;n++)this.cols[a[n].name]=n}return yn(e,[{key:"getByName",value:function(e){return this.data[this.cols[e]]}},{key:"setByName",value:function(e,t,a){var n=this.getByName(e);n?(n[t]=a,this.owner.updateAll()):console.error("set an wrong column")}},{key:"prevCol",value:function e(t){var a=this.cols[t];if(1<a){var e=this.data[a-1];return e?e:null}return null}},{key:"nextCol",value:function e(t){var a=this.cols[t];if(a){var e=this.data[a+1];return e?e:null}return null}},{key:"allVisibleCol",value:function(){return this.data}},{key:"freezeOrNot",value:function(e){var t=this.getByName(e);t&&this.setByName(e,"freeze",!t.freeze),this.owner.touchShow(),this.owner.updateAll()}},{key:"isReadonly",value:function(e){var t=this.getByName(e);return t?!0==t.readonly||!1==t.readonly?t.readonly:(t.readonly=!1,!1):void console.error("try to read wrong col: "+e)}}]),e}(),Bl=30,Hl=function(){function e(){hn(this,e),this.gridInstance=null,this.visibleRowNum=null}return yn(e,[{key:"init",value:function(){this.rows=[],this.columns=null,this.currentShowAt=0,this.topRowNum=0,this.bottomRowNum=0,this.showRangeChange=!0,this.showRows=[],this.selectedRows=[],this.dragSelectedRows=[],this.isDragSelected=!1,this.dragSelectedAt=null,this.isDrag=!1,this.currentMovedAt=null,this.isMovedFirst=!1,this.currentRow=null,this.cuttedOrCopiedRows=[],this.lastShowRow=null,this.shouldScrollGrid=!1}},{key:"loadRows",value:function(e){for(var t=0,a;t<e.length;t++)a=new jl(this,e[t]),a.setIdx(t),a.calcParent(),this.rows.push(a)}},{key:"loadColumns",value:function(e){this.columns=new Wl(this,e)}},{key:"updateRows",value:function(e){this.rows=e}},{key:"updateShowAttrs",value:function(){if(this.showRangeChange){this.showRows=[],this.topRowNum=0,this.bottomRowNum=0;var e=0;this.lastShowRow=null;for(var t=0,a;t<this.rows.length;t++)a=this.rows[t],a.isShow?(this.topRowNum<this.currentShowAt?(this.topRowNum+=1,a.comInstance=null):this.showRows.length<this.visibleRowNum+Bl?this.showRows.push(a):(this.bottomRowNum+=1,a.comInstance=null),a.showIndex=e,this.lastShowRow=a,e+=1):(a.comInstance=null,a.showIndex=null);this.showRangeChange=!1,this.shouldScrollGrid=!0}}},{key:"pluckDiff",value:function(){}},{key:"touchShow",value:function(){for(var e=0;e<this.showRows.length;e++)this.showRows[e].touch()}},{key:"beforeUpdateAll",value:function(){}},{key:"afterUpdateAll",value:function(){}},{key:"updateAll",value:function(){this.beforeUpdateAll(),this.updateShowAttrs(),this.pluckDiff(),this.gridInstance&&(this.gridInstance.forceUpdate(),this.shouldScrollGrid&&this.scrollGridInstance()),this.afterUpdateAll()}},{key:"updateCurrentRowSelect",value:function(e){this.currentRow&&(e.selectCol=this.currentRow.selectCol,e.selectColType=this.currentRow.selectColType,this.currentRow.clearComSelectState()),null==e.selectCol&&(e.selectCol="name",e.selectColType="text"),e.isReadonly(e.selectCol)||"date"!=e.selectColType||(e.editCol=e.selectCol)}},{key:"ensureVisible",value:function(e){this.updateShowAttrs(),e.showIndex<this.currentShowAt?(this.currentShowAt=e.showIndex,this.showRangeChanged()):e.showIndex==this.currentShowAt?(this.currentShowAt-=1,this.showRangeChanged()):e.showIndex>this.currentShowAt+this.visibleRowNum?(this.currentShowAt=e.showIndex-this.visibleRowNum+1,this.showRangeChanged()):e.showIndex==this.currentShowAt+this.visibleRowNum&&(this.currentShowAt+=1,this.showRangeChanged())}},{key:"updateCurrentRow",value:function(e){var t=!1;if(!e.isShow)console.error("select an invisible row");else if(this.currentRow!=e){var a=null;this.currentRow&&(this.currentRow.clearComSelectState(),a=this.currentRow),this.currentRow=e,this.ensureVisible(e),e.touch(),t=!0,this.afterUpdateCurrentRow()}return t}},{key:"afterUpdateCurrentRow",value:function(){}},{key:"updateShowAt",value:function(e){e!=this.currentShowAt&&e<this.topRowNum+this.bottomRowNum+this.visibleRowNum+Bl-1&&(this.currentShowAt=e,this.showRangeChanged(),this.updateAll())}},{key:"showRangeChanged",value:function(){this.showRangeChange=!0}},{key:"isReadonly",value:function(){return!1}},{key:"addRow",value:function(){}},{key:"scrollGridInstance",value:function(){this.shouldScrollGrid=!1,this.gridInstance.scrollToPos(this.currentShowAt)}},{key:"clearSelectedRows",value:function(){for(var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=0,a;t<this.selectedRows.length;t++)a=this.selectedRows[t],a.isSelected=!1,e&&a.touch();this.selectedRows=[]}},{key:"clearDragSelectedRow",value:function(){for(var e=0,t;e<this.dragSelectedRows.length;e++)t=this.dragSelectedRows[e],t.isSelected=!1,t.touch();this.dragSelectedRows=[]}},{key:"calcRowsParent",value:function(){for(var e=0,t;e<this.rows.length;e++)t=this.rows[e],t.calcParent(),t.touch()}},{key:"selectedRow",value:function(e){if(this.isDragSelected){var t=this.dragSelectedAt,a=e;this.dragSelectedAt.idx<=e.idx?t=this.dragSelectedAt:this.dragSelectedAt.idx>e.idx&&(t=e,a=this.dragSelectedAt),this.clearDragSelectedRow();for(var n=a.idx;t&&t.idx<=a.idx;){if(t.isSelected=!0,t.touch(),this.dragSelectedRows.push(t),t.collapsed())for(var s=t.next();s&&s.level()>t.level();)s.isSelected=!0,s.touch(),this.dragSelectedRows.push(s),s=s.next();else if(t.hasChild())for(var o=t.next();o&&o.level()>t.level();)o.idx>n&&(o.isSelected=!0,o.touch(),this.dragSelectedRows.push(o),n+=1),o=o.next();t=t.nextShow()}for(var r=0,l;r<this.selectedRows.length;r++)l=this.selectedRows[r],l.isSelected=!0,l.touch()}else{e.isSelected=!0,e.touch(),this.selectedRows.push(e);for(var d=e.next();d&&d.level()>e.level();)d.isSelected=!0,d.touch(),this.selectedRows.push(d),d=d.next();this.selectedRows=this.selectedRows.sort(function(e,t){return e.idx-t.idx})}}},{key:"beginDragSelected",value:function(e){this.isDragSelected=!0,this.dragSelectedAt=e,this.dragSelectedRows.push(e)}},{key:"finishDragSelected",value:function(){this.isDragSelected=!1,this.dragSelectedAt=null,this.selectedRows=this.rows.filter(function(e){return e.isSelected}),this.dragSelectedRows=[]}},{key:"beginDrag",value:function(){this.isDrag=!0}},{key:"finishDrag",value:function(){if(this.isDrag=!1,this.currentMovedAt){this.currentMovedAt.touch();var e=[],t=[],a=[];if(this.isMovedFirst){var n=this.moveSelectedRowsBefore(this.currentMovedAt),s=ir(n,3);e=s[0],t=s[1],a=s[2]}else{var o=this.moveSelectedRowsAfter(this.currentMovedAt),r=ir(o,3);e=r[0],t=r[1],a=r[2]}this.updateRows(a),this.calcRowsParent(),this.afterDragMove(e,t),this.showRangeChanged()}this.currentMovedAt=null,this.isMovedFirst=!1,this.updateAll()}},{key:"afterDragMove",value:function(){}},{key:"movedAt",value:function(e){(!e.isSelected&&this.currentMovedAt!=e||this.isMovedFirst)&&(this.currentMovedAt&&this.currentMovedAt.touch(),this.isMovedFirst=!1,this.currentMovedAt=e,this.ensureVisible(e),e.touch(),this.updateAll())}},{key:"movedAtFirst",value:function(){if(!0!=this.isMovedFirst){this.currentMovedAt&&this.currentMovedAt.touch();for(var e=0;e<this.rows.length;e++)if(this.rows[e].isShow){this.currentMovedAt=this.rows[e];break}this.currentMovedAt&&this.ensureVisible(this.currentMovedAt),this.isMovedFirst=!0,this.updateAll()}}},{key:"selectShowAll",value:function(){this.selectedRows=[];for(var e=0,t;e<this.rows.length;e++)t=this.rows[e],t.isShow&&(this.selectedRows.push(t),t.isSelected=!0,t.touch());this.updateAll()}},{key:"moveSelectedRowsBefore",value:function(e){for(var t=[],a=0,n=this.rows,s=[],o=0,r;o<e.idx;o++)r=this.rows[o],r.isSelected||(t.push(r),r.setIdx(a),a+=1);for(var l=0,d;l<this.selectedRows.length;l++)d=this.selectedRows[l],s.push([d.idx,d.level()]),d.parent&&d.parent.isSelected?d.setValue("level",d.parent.level()+1):d.setValue("level",e.level()),t.push(d),d.setIdx(a),a+=1;for(var p=e.idx,c;p<this.rows.length;p++)c=this.rows[p],c.isSelected||(t.push(c),c.setIdx(a),a+=1);return[n,s,t]}},{key:"moveSelectedRowsAfter",value:function(e){var t=[],a=0,n=e.nextShow(),s=e.idx+1,o=e.level();n?(s=n.idx,o=n.level()):e.next()&&(s=this.rows.length);for(var r=this.rows,l=[],d=0,p;d<s;d++)p=this.rows[d],p.isSelected||(t.push(p),p.setIdx(a),a+=1);for(var c=0,u;c<this.selectedRows.length;c++)u=this.selectedRows[c],l.push([u.idx,u.level()]),u.parent&&u.parent.isSelected?u.setValue("level",u.parent.level()+1):u.setValue("level",o),t.push(u),u.setIdx(a),a+=1;for(var h=s,m;h<this.rows.length;h++)m=this.rows[h],m.isSelected||(t.push(m),m.setIdx(a),a+=1);return[r,l,t]}},{key:"deleteSelectedOrCurrentRows",value:function(){if(this.currentRow){var e=this.selectedRows;if(this.selectedRows=[],0==e.length&&(e=[this.currentRow],this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)e.push(t),t=t.next();for(var a={},n=0;n<e.length;n++)a[e[n].idx]=!0;for(var s=[],o=0,r=0,l;r<this.rows.length;r++)l=this.rows[r],a[l.idx]?l.shouldRemove(a):(s.push(l),l.setIdx(o),o+=1,l.touch());this.updateRows(s),this.showRangeChanged(),this.afterDeleteSelectedOrCurrentRows();var d=this.tryToGetAnVisibleRow(this.currentRow.idx);d?d.setAsCurrentWithSelect():this.currentRow=null,this.updateAll()}}},{key:"afterDeleteSelectedOrCurrentRows",value:function(){}},{key:"cutSelectedOrCurrentRows",value:function(){if(this.currentRow){var e=this.selectedRows;if(0==e.length&&(e=[this.currentRow],this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)e.push(t),t=t.next();var a={};this.cuttedOrCopiedRows=[];for(var n=0,s;n<e.length;n++)s=e[n],this.cuttedOrCopiedRows.push(s.toCopyData()),a[s.idx]=!0;for(var o=[],r=0,l=0,d;l<this.rows.length;l++)d=this.rows[l],a[d.idx]?d.shouldRemove(a):(o.push(d),d.setIdx(r),r+=1,d.touch());this.updateRows(o),this.showRangeChanged();var p=this.tryToGetAnVisibleRow(this.currentRow.idx);p?p.setAsCurrentWithSelect():this.currentRow=null,this.calcRowsParent(),this.afterCutSelectedOrCurrentRows(),this.updateAll()}}},{key:"tryToGetAnVisibleRow",value:function(e){for(var t=this.rows[e];t&&!t.isShow;)t=t.next();if(null==t)for(;0<=e&&(t=this.rows[e],!(t&&t.isShow));)e-=1;return t&&t.isShow?t:null}},{key:"afterCutSelectedOrCurrentRows",value:function(){}},{key:"copySelectedOrCurrentRows",value:function(){if(this.currentRow){var e=this.selectedRows;if(0==e.length&&(e=[this.currentRow],this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)e.push(t),t=t.next();this.cuttedOrCopiedRows=[];for(var a=0;a<e.length;a++)this.cuttedOrCopiedRows.push(e[a].toCopyData())}}},{key:"pasteCuttedOrCopiedRows",value:function(){if(this.currentRow){for(var e=[],t=0;t<this.cuttedOrCopiedRows.length;t++)e.push(new jl(this,JSON.parse(this.cuttedOrCopiedRows[t])));this.insertRowsBefore(this.currentRow,e)}}},{key:"insertRowsBefore",value:function(e,t){for(var a=e.idx,n=t.length,s=a,o;s<this.rows.length;s++)this.rows[s].setIdx(this.rows[s].idx+n);for(var r={},l=0,d;l<t.length;l++)d=t[l],d.setIdx(a+l),r[d.idx]=!0;for(var p=0,c;p<t.length;p++)c=t[p],c.parent&&r[c.parent.idx]?c.setValue("level",c.parent.level()+1):c.setValue("level",e.level());(o=this.rows).splice.apply(o,[a,0].concat(nl(t))),this.updateRows(this.rows),this.showRangeChanged(),this.calcRowsParent(),this.afterInsertRowsBefore(t),t[0].setAsCurrentWithSelect(),this.updateAll()}},{key:"afterInsertRowsBefore",value:function(){}},{key:"upgradeRows",value:function(){if(this.currentRow){var e=this.selectedRows;if(0==e.length&&(e=[this.currentRow],this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)e.push(t),t=t.next();for(var a={},n=0;n<e.length;n++)a[e[n].idx]=!0;for(var s=0,o;s<e.length;s++)o=e[s],1<o.level()&&(o.parent&&a[o.parent.idx]?o.setValue("level",o.parent.level()+1):o.level()-1<=o.prev().level()+1&&o.setValue("level",o.level()-1));this.calcRowsParent(),this.afterUpgradeRows(e,a),this.updateAll()}}},{key:"afterUpgradeRows",value:function(){}},{key:"degradeRows",value:function(){if(this.currentRow){var e=this.selectedRows;if(0==e.length&&(e=[this.currentRow],this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)e.push(t),t=t.next();for(var a={},n=0;n<e.length;n++)a[e[n].idx]=!0;for(var s=0,o;s<e.length;s++)o=e[s],0<o.level()&&(o.parent&&a[o.parent.idx]?o.setValue("level",o.parent.level()+1):o.prev()!=o.parent&&o.setValue("level",o.level()+1));this.calcRowsParent(),this.afterDegradeRows(e,a),this.updateAll()}}},{key:"afterDegradeRows",value:function(){}},{key:"moveUpRows",value:function(){if(this.currentRow){var e=!1;if(0==this.selectedRows.length&&(this.selectedRows=[this.currentRow],this.currentRow.isSelected=!0,this.currentRow.touch(),e=!0,this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)this.selectedRows.push(t),t.isSelected=!0,t.touch(),t=t.next();var a=this.selectedRows[0],n=a.prevShow();if(n){var s=this.moveSelectedRowsBefore(n),o=ir(s,3),r=o[0],l=o[1],i=o[2];this.updateRows(i),e&&this.clearSelectedRows(!1),this.calcRowsParent(),this.aftermoveUpRows(r,l),this.showRangeChanged(),this.ensureVisible(this.currentRow),this.updateAll()}else e&&this.clearSelectedRows(!1)}}},{key:"aftermoveUpRows",value:function(){}},{key:"moveDownRows",value:function(){if(this.currentRow){var e=!1;if(0==this.selectedRows.length&&(this.selectedRows=[this.currentRow],this.currentRow.isSelected=!0,this.currentRow.touch(),e=!0,this.currentRow.hasChild()))for(var t=this.currentRow.next();t&&t.level()>this.currentRow.level();)this.selectedRows.push(t),t.isSelected=!0,t.touch(),t=t.next();var a=this.selectedRows[this.selectedRows.length-1],n=a.nextShow();if(n){var s=this.moveSelectedRowsAfter(n),o=ir(s,3),r=o[0],l=o[1],i=o[2];this.updateRows(i),e&&this.clearSelectedRows(!1),this.calcRowsParent(),this.aftermoveDownRows(r,l),this.showRangeChanged(),this.ensureVisible(this.currentRow),this.updateAll()}else e&&this.clearSelectedRows(!1)}}},{key:"aftermoveDownRows",value:function(){}},{key:"isSupportCMD",value:function(){return!1}},{key:"getCMDTips",value:function(){return""}},{key:"execCMD",value:function(){}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}]),e}(),Yl=il(!0);Ia(Ia.S,"Object",{entries:function(e){return Yl(e)}});var ql=ca.Object.entries,Gl=h(function(e){e.exports={default:ql,__esModule:!0}}),$l=n(Gl),Xl={DATE_TYPE:"0",WEEK_TYPE:"1",MONTH_TYPE:"2",YEAR_TYPE:"3"},Zl={OFF_DAY:"0",WORK_DAY:"1"},Kl=function(e){function t(e,a){hn(this,t);var n=wo(this,(t.__proto__||cn(t)).call(this,e,a));return n._convertStartAndFinish(),n.posIdx=null,n}return Eo(t,e),yn(t,[{key:"setIdx",value:function(e){this.idx=e,this.posIdx=e+1}},{key:"_convertStartAndFinish",value:function(){if(this.data.type==Xl.DATE_TYPE)this.startDate=dr.parseDayStr(this.data.start),this.startDate=dr.convertToUTC(this.startDate),this.finishDate=dr.parseDayStr(this.data.finish),this.finishDate=dr.convertToUTC(this.finishDate);else if(this.data.type==Xl.WEEK_TYPE||this.data.type==Xl.MONTH_TYPE)this.startDate=$a(this.data.start),this.finishDate=$a(this.data.finish);else if(this.data.type==Xl.YEAR_TYPE){var e=this.data.start.split(".",2).map(function(e){return $a(e)}),t=ir(e,2),a=t[0],n=t[1];this.startDate=100*a+n;var s=this.data.finish.split(".",2).map(function(e){return $a(e)}),o=ir(s,2),r=o[0],l=o[1];this.finishDate=100*r+l}}},{key:"isReadonly",value:function(){return this.owner.isReadonly()}},{key:"isValid",value:function(){return!0}},{key:"isWorkDay",value:function(){return this.data.worktype==Zl.WORK_DAY}},{key:"_getDayTypeByNum",value:function(e){var t=0;return(e>=this.startDate&&e<=this.finishDate||this.startDate>this.finishDate&&(this.startDate<=e||e<=this.finishDate))&&(this.isWorkDay()?t=this.posIdx:t=-this.posIdx),t}},{key:"getDateType",value:function(e){var t=0;if(this.isValid())if(this.data.type==Xl.DATE_TYPE)dr.isBetween(e,this.startDate,this.finishDate)&&(this.isWorkDay()?t=this.posIdx:t=-this.posIdx);else if(this.data.type==Xl.WEEK_TYPE){var a=e.getUTCDay();0==a&&(a=7),t=this._getDayTypeByNum(a)}else this.data.type==Xl.MONTH_TYPE?t=this._getDayTypeByNum(e.getUTCDate()):this.data.type==Xl.YEAR_TYPE&&(t=this._getDayTypeByNum(100*(e.getUTCMonth()+1)+e.getUTCDate()));return t}},{key:"tryToRecalc",value:function(e){try{this.owner.recalcRules(this.posIdx)}catch(r){this.addErrorMessage("\u8BBE\u7F6E\u6709\u8BEF");for(var t=$l(e),a=0;a<t.length;a++){var n=ir(t[a],2),s=n[0],o=n[1];this.data[s]=o}this._convertStartAndFinish(),this.owner.clearAndRecalc()}}},{key:"_setRowType",value:function(e){if(e!=this.data.type){var t={type:this.data.type};if(this.data.type=e,this.data.type==Xl.DATE_TYPE){var a=new Date;a=dr.convertToUTC(a),a=dr.formatUTC(a),this.data.start=a,this.data.finish=a}else this.data.type==Xl.WEEK_TYPE?(this.data.start="1",this.data.finish="1"):this.data.type==Xl.MONTH_TYPE?(this.data.start="1",this.data.finish="1"):this.data.type==Xl.YEAR_TYPE&&(this.data.start="1.1",this.data.finish="1.1");this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t)}}},{key:"addErrorMessage",value:function(e){this.owner.owner.addErrorMessage(e)}},{key:"_checkMonthAndDay",value:function(e,t){return[1,3,5,7,8,10,12].some(function(t){return t==e})?1<=t&&31>=t:[4,6,9,11].some(function(t){return t==e})?1<=t&&30>=t:2==e&&1<=t&&29>=t}},{key:"_setRowStart",value:function(e){var t={start:this.data.start,finish:this.data.finish};if(this.data.type==Xl.DATE_TYPE){var a=dr.parseDayStr(e);"Invalid Date"==a?this.addErrorMessage("\u65F6\u95F4\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u65F6\u95F4\uFF0C\u4F8B\u59822017-11-25"):(a=dr.convertToUTC(a),this.data.start=dr.formatUTC(a),this.data.start>this.data.finish&&(this.data.finish=this.data.start),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.WEEK_TYPE){var n=$a(e);$o(n)||1>n||7<n?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u661F\u671F\uFF0C1\u52307\uFF0C\u4EE3\u8868\u661F\u671F\u4E00\u5230\u661F\u671F\u65E5"):(this.data.start=n.toString(),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.MONTH_TYPE){var s=$a(e);$o(s)||1>s||31<s?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u65E5\u671F\uFF0C1\u523031"):(this.data.start=s.toString(),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.YEAR_TYPE){var o=e.split(".",2),r=ir(o,2),l=r[0],i=r[1];l=$a(l),i=$a(i),$o(l)||$o(i)||!this._checkMonthAndDay(l,i)?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6708\u4EFD\u548C\u65E5\u671F\uFF0C\u598211.15"):(this.data.start=l+"."+i,this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}}},{key:"_setRowFinish",value:function(e){var t={start:this.data.start,finish:this.data.finish};if(this.data.type==Xl.DATE_TYPE){var a=dr.parseDayStr(e);"Invalid Date"==a?this.addErrorMessage("\u65F6\u95F4\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u65F6\u95F4\uFF0C\u4F8B\u59822017-11-25"):(a=dr.convertToUTC(a),this.data.finish=dr.formatUTC(a),this.data.start>this.data.finish&&(this.data.start=this.data.finish),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.WEEK_TYPE){var n=$a(e);$o(n)||1>n||7<n?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u661F\u671F\uFF0C1\u52307\uFF0C\u4EE3\u8868\u661F\u671F\u4E00\u5230\u661F\u671F\u65E5"):(this.data.finish=n.toString(),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.MONTH_TYPE){var s=$a(e);$o(s)||1>s||31<s?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u65E5\u671F\uFF0C1\u523031"):(this.data.finish=s.toString(),this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}else if(this.data.type==Xl.YEAR_TYPE){var o=e.split(".",2),r=ir(o,2),l=r[0],i=r[1];l=$a(l),i=$a(i),$o(l)||$o(i)||!this._checkMonthAndDay(l,i)?this.addErrorMessage("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6708\u4EFD\u548C\u65E5\u671F\uFF0C\u598211.15"):(this.data.finish=l+"."+i,this._convertStartAndFinish(),this.isValid()&&this.tryToRecalc(t))}}},{key:"_setRowWorktype",value:function(e){var t={worktype:this.data.worktype};this.data.worktype=e,this.isValid()&&this.tryToRecalc(t)}},{key:"setValue",value:function(e,t){"name"==e?this.data[e]=t:"type"==e?this._setRowType(t):"start"==e?this._setRowStart(t):"finish"==e?this._setRowFinish(t):"worktype"==e&&this._setRowWorktype(t)}},{key:"getGridRowIndex",value:function(){return this.idx+1}}]),t}(jl),Jl={DATE_TYPE:"0",WEEK_TYPE:"1",MONTH_TYPE:"2",YEAR_TYPE:"3"},Ql={OFF_DAY:"0",WORK_DAY:"1"},ei=function(e){function t(e){hn(this,t);var a=[{name:"index",type:"text",width:"32px",readonly:!0,head_name:""},{name:"name",type:"text",width:"120px",head_name:"\u540D\u79F0"},{name:"type",type:"select",width:"70px",head_name:"\u7C7B\u578B",options:[[Jl.DATE_TYPE,"\u6309\u65E5\u671F"],[Jl.WEEK_TYPE,"\u6BCF\u5468"],[Jl.MONTH_TYPE,"\u6BCF\u6708"],[Jl.YEAR_TYPE,"\u6BCF\u5E74"]]},{name:"start",type:"text",width:"90px",head_name:"\u5F00\u59CB"},{name:"finish",type:"text",width:"90px",head_name:"\u7ED3\u675F"},{name:"worktype",type:"select",width:"90px",head_name:"\u5DE5\u4F5C\u6216\u4F11\u606F",options:[[Ql.WORK_DAY,"\u5DE5\u4F5C\u65E5"],[Ql.OFF_DAY,"\u4F11\u606F\u65E5"]]}];return wo(this,(t.__proto__||cn(t)).call(this,e,a))}return Eo(t,e),t}(Wl),ti={roundTwoDecimals:function(e){e*=100;var t=1;return 0>e&&(t=-1,e*=t),t*Nt(e)/100}},ai=function(e){function t(e,a){hn(this,t);var n=wo(this,(t.__proto__||cn(t)).call(this));return n.owner=e,n.data=a,n.init(),n.loadRows(a.rules),n.loadColumns(),n.startDate=null,n.endDate=null,n.days=[],n.tasks=[],n.updateShowAttrs(),n}return Eo(t,e),yn(t,[{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"delTask",value:function(e){this.tasks=this.tasks.filter(function(a){return a!=e})}},{key:"loadRows",value:function(e){for(var t=0,a;t<e.length;t++)a=new Kl(this,e[t]),a.setIdx(t),a.calcParent(),this.rows.push(a)}},{key:"loadColumns",value:function(){this.columns=new ei(this)}},{key:"isReadonly",value:function(){return this.owner.isReadonly()}},{key:"getDateType",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,a=t;null==a&&(a=this.rows.length-1);for(var n=0,s;0<=a&&(s=this.rows[a],n=s.getDateType(e),0==n);)a--;return n}},{key:"getWorkSeconds",value:function(e){if(this.dayOff(e))return 0;for(var t=dr.getSecondsOfDay(e),a=0,n=0,s;n<this.data.times.length&&(s=this.data.times[n],!(s.start>=t));n++)a+=s.end<=t?s.end-s.start:t-s.start;return a}},{key:"dayOff",value:function(e){if(this.startDate){var t=dr.getStartOfDay(e);if(dr.isBefore(t,this.startDate)){dr.subtractDays(t,31);for(var a=dr.clone(t),n=0;dr.isAfter(this.startDate,a);)this.days.splice(n,0,this.getDateType(a)),dr.addDays(a,1),n++;this.startDate=t}else if(dr.isAfter(t,this.endDate))for(dr.addDays(t,31);dr.isBefore(this.endDate,t);)dr.addDays(this.endDate,1),this.days.push(this.getDateType(this.endDate));if(this.days.length>1e5)throw new Error("\u8D85\u51FA\u65F6\u95F4\u8303\u56F4")}else{this.startDate=dr.getStartOfDay(e);for(var s=dr.clone(this.startDate),o=0;31>o;o++)this.days.push(this.getDateType(s)),dr.addDays(s,1);dr.subtractDays(s,1),this.endDate=dr.clone(s)}return 0>this.days[dr.diffDays(e,this.startDate)]}},{key:"getMinStartSeconds",value:function(){return this.data.times[0].start}},{key:"getMaxEndSeconds",value:function(){return this.data.times[this.data.times.length-1].end}},{key:"getDaySeconds",value:function(){return this.data.seconds}},{key:"getDayStartFinishAndDuration",value:function(e){for(var t=dr.getStartOfDay(e);this.dayOff(t);)dr.addDays(t,1);var a=dr.clone(t),n=dr.clone(t);dr.addSeconds(a,this.getMinStartSeconds()),dr.addSeconds(n,this.getMaxEndSeconds());var s=this.getDaySeconds();return[a,n,s]}},{key:"getStartTime",value:function(e,t){var a=dr.clone(e),n=null;if(!this.dayOff(a))for(var s=0,o;s<this.data.times.length;s++)if(o=this.data.times[s],o.start>=t){n=o.start;break}else if(o.end<t)continue;else{n=t;break}if(null==n){for(dr.addDays(a,1);this.dayOff(a);)dr.addDays(a,1);n=this.getMinStartSeconds()}return dr.addSeconds(a,n),a}},{key:"calcDurDaysByDuration",value:function(e){return ti.roundTwoDecimals(e/this.getDaySeconds())}},{key:"calcDurationByDurDays",value:function(e){return e*this.getDaySeconds()}},{key:"calcTime",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return 0<t?this._calcFinishTimeForPositiveDur(e,t):0>t?this._calcFinishTimeForNegativeDur(e,-t):e}},{key:"calcNextWorkTime",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(0==t)return e;var a=dr.getStartOfDay(e),n=dr.getSecondsOfDay(e);if(this.dayOff(a)||n==this.getMaxEndSeconds()){for(dr.addDays(a,1);this.dayOff(a);)dr.addDays(a,1);return dr.addSeconds(a,this.getMinStartSeconds()),a}return this.getStartTime(a,n)}},{key:"calcPrevWorkTime",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(0==t)return e;var a=dr.getStartOfDay(e),n=dr.getSecondsOfDay(e);if(this.dayOff(a)||n==this.getMinStartSeconds()){for(dr.subtractDays(a,1);this.dayOff(a);)dr.subtractDays(a,1);return dr.addSeconds(a,this.getMaxEndSeconds()),a}return this.getStartTime(a,n)}},{key:"_calcSamedayFinishTimeByPosiDur",value:function(e,t){for(var a=dr.getStartOfDay(e),n=0,s=dr.getSecondsOfDay(e),o=0,r;o<this.data.times.length;o++)if(r=this.data.times[o],r.start>=s){if(n=n+r.end-r.start,n>=t){var l=r.end-n+t;dr.addSeconds(a,l);break}}else if(r.end<=s)continue;else if(n=n+r.end-s,n>=t){var d=r.end-n+t;dr.addSeconds(a,d);break}return a}},{key:"_calcFinishTimeForPositiveDur",value:function(e,t){var a=null,n=dr.getStartOfDay(e),s=0;if(this.dayOff(n)||(s=this.getDaySeconds()-this.getWorkSeconds(e)),s>t)a=this._calcSamedayFinishTimeByPosiDur(e,t);else if(s==t)a=n,dr.addSeconds(a,this.getMaxEndSeconds());else{for(dr.addDays(n,1);s+this.getDaySeconds()<t;)this.dayOff(n)||(s+=this.getDaySeconds()),dr.addDays(n,1);if(s==t)a=n;else{for(;this.dayOff(n);)dr.addDays(n,1);a=this._calcSamedayFinishTimeByPosiDur(n,t-s)}}return a}},{key:"_calcSamedayFinishTimeByNegaDur",value:function(e,t,a){for(var n=dr.clone(e),s=0,o=this.data.times.length-1,r;0<=o;o--)if(r=this.data.times[o],r.start>=t)continue;else if(r.end<=t){if(s=s+r.end-r.start,s>=a){var l=r.start+s-a;dr.addSeconds(n,l);break}}else if(s=s+t-r.start,s>=a){var d=r.start+s-a;dr.addSeconds(n,d);break}return n}},{key:"_calcFinishTimeForNegativeDur",value:function(e,t){var a=null,n=dr.getStartOfDay(e),s=this.getWorkSeconds(e);if(s>t){var o=dr.getSecondsOfDay(e);a=this._calcSamedayFinishTimeByNegaDur(n,o,t)}else if(s==t)a=n,dr.addSeconds(a,this.getMinStartSeconds());else{for(dr.subtractDays(n,1);s+this.getDaySeconds()<t;)this.dayOff(n)||(s+=this.getDaySeconds()),dr.subtractDays(n,1);if(s==t)a=n;else{for(;this.dayOff(n);)dr.subtractDays(n,1);a=this._calcSamedayFinishTimeByNegaDur(n,this.getMaxEndSeconds(),t-s)}}return a}},{key:"calcDuration",value:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=0,s=1,o=null,r=null;dr.isBeforeOrSame(e,t)?(o=dr.clone(e),r=dr.clone(t)):(o=dr.clone(t),r=dr.clone(e),s=-1);var l=dr.getStartOfDay(o),i=dr.getStartOfDay(r);if(dr.isSame(l,i))n=this.getWorkSeconds(r)-this.getWorkSeconds(o);else{for(this.dayOff(l)&&a||(n+=this.getDaySeconds()-this.getWorkSeconds(o)),dr.addDays(l,1);dr.isBefore(l,i);)this.dayOff(l)&&a||(n+=this.getDaySeconds()),dr.addDays(l,1);this.dayOff(l||!a)||(n+=this.getWorkSeconds(r))}return n*s}},{key:"getName",value:function(){return this.data.name}},{key:"getTimeRange",value:function(){for(var e=[],t=0;t<this.data.times.length;t++){var a=this.data.times[t],n=dr.getTimeBySeconds(a.start),s=dr.getTimeBySeconds(a.end);e.push([n,s])}return e}},{key:"updateRows",value:function(e){this.rows=e,this.data.rules=e.map(function(e){return e.data})}},{key:"updateAll",value:function(){this.updateShowAttrs(),this.shouldScrollGrid&&this.scrollGridInstance(),this.owner.toUpdateZpertChart(),this.owner.updateAll()}},{key:"recalcRules",value:function(e){for(var t=0;t<this.days.length;t++){var a=this.days[t],n=1;if(0>a&&(n=-1),n*a<=e){var s=dr.clone(this.startDate);dr.addDays(s,t),this.days[t]=this.getDateType(s,e-1)}}this.owner.recalcTasksTime(),this.updateAll()}},{key:"clearAndRecalc",value:function(){this.startDate=null,this.endDate=null,this.days=[],this.owner.recalcTasksTime(),this.updateAll()}},{key:"addRow",value:function(e){if(this.isReadonly())return void this.owner.addErrorMessage("\u65E0\u6CD5\u7F16\u8F91\u53EA\u8BFB\u9879\u76EE");var t=!1;null==e&&(e=this.lastShowRow,null==e&&(e=this.rows[0]),t=!0);var a=new Date;a=dr.convertToUTC(a),a=dr.formatUTC(a);var n={name:"",type:"0",start:a,finish:a,status:"0",worktype:"0"},s=new Kl(this,n);t?(s.setIdx(this.rows.length),s.calcParent(),this.rows.push(s),this.updateRows(this.rows),this.showRangeChanged(),s.setAsCurrentWithSelect(),this.updateAll()):this.insertRowsBefore(e,[s])}},{key:"afterInsertRowsBefore",value:function(){for(var e=0;e<this.days.length;e++){var t=this.days[e],a=dr.clone(this.startDate);dr.addDays(a,e),this.days[e]=this.getDateType(a)}}},{key:"afterDeleteSelectedOrCurrentRows",value:function(){this.startDate=null,this.endDate=null,this.days=[],this.owner.recalcTasksTime()}},{key:"upgradeRows",value:function(){}},{key:"degradeRows",value:function(){}},{key:"afterMoveRows",value:function(e){for(var t=0,a=0;a<e.length;a++)e[a].idx!=a&&(t=a+1);for(var n=0;n<this.days.length;n++){var s=this.days[n],o=1;if(0>s&&(o=-1),o*s<=t){var r=dr.clone(this.startDate);dr.addDays(r,n),this.days[n]=this.getDateType(r,t-1)}}this.owner.recalcTasksTime()}},{key:"aftermoveUpRows",value:function(e){this.afterMoveRows(e)}},{key:"aftermoveDownRows",value:function(e){this.afterMoveRows(e)}},{key:"pasteCuttedOrCopiedRows",value:function(){if(this.currentRow){for(var e=[],t=0;t<this.cuttedOrCopiedRows.length;t++)e.push(new Kl(this,JSON.parse(this.cuttedOrCopiedRows[t])));this.insertRowsBefore(this.currentRow,e)}}},{key:"afterDragMove",value:function(e){this.afterMoveRows(e)}},{key:"afterCutSelectedOrCurrentRows",value:function(){this.startDate=null,this.endDate=null,this.days=[],this.owner.recalcTasksTime()}},{key:"updateName",value:function(e){if(this.data.name!=e){for(var t=!1,a=ul(this.owner.calendars),n=0;n<a.length;n++)if(a[n].data.name==e){t=!0;break}t?this.owner.updateAll():(this.data.name=e,this.owner.updateCalendarOptions())}}},{key:"_calcSecondsByRanges",value:function(e){for(var t=0,a=0,n;a<e.length;a++)n=e[a],t=t+n.end-n.start;return t}},{key:"deleteRange",value:function(e){e=$a(e);var t=this.data.times.filter(function(t,a){return a!=e}),a=this._calcSecondsByRanges(t);if(0<a){this.data.times=t,this.data.seconds=a;for(var n=0,s;n<this.tasks.length;n++)s=this.tasks[n],s.updateDurationDays(),s.updateDepends();this.clearAndRecalc()}else this.owner.addErrorMessage("\u4E00\u5929\u5185\u7684\u5DE5\u4F5C\u65F6\u95F4\u4E0D\u80FD\u4E3A\u96F6"),this.updateAll()}},{key:"_parseRangeValue",value:function(e){var t=e.split(":",2),a=ir(t,2),n=a[0],s=a[1];n=$a(n),s=$a(s);var o=null;return Wr(n)&&Wr(s)&&(0<=n&&24>n&&0<=s&&60>s||24==n&&0==s)&&(o=3600*n+60*s),o}},{key:"updateRangeStart",value:function(e,t){e=$a(e);var a=this._parseRangeValue(t);if(Wr(a)){var n=!0;if(e==this.data.times.length){var s=a+3600;86400<s&&(s=86400),a<this.data.times[this.data.times.length-1].end?n=!1:this.data.times.push({start:a,end:s})}else{var o=0,r=86400;if(0<e&&(o=this.data.times[e-1].end),e<this.data.times.length-1&&(r=this.data.times[e+1].start),a<o||t>r)n=!1;else{var l=this.data.times[e].end;a>=l&&(l+=3600,l>r&&(l=r)),this.data.times[e].start=a,this.data.times[e].end=l}}if(n){this.data.seconds=this._calcSecondsByRanges(this.data.times);for(var d=0,p;d<this.tasks.length;d++)p=this.tasks[d],p.updateDurationDays(),p.updateDepends();this.clearAndRecalc()}else this.owner.addErrorMessage("\u5F00\u59CB\u65F6\u95F4\u4E0D\u80FD\u65E9\u4E8E\u524D\u4E00\u7ED3\u675F\u65F6\u95F4\uFF0C\u4E5F\u4E0D\u80FD\u665A\u4E8E\u540E\u4E00\u5F00\u59CB\u65F6\u95F4"),this.updateAll()}else this.owner.addErrorMessage("\u65F6\u95F4\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u5185\u5BB9\uFF0C\u4F8B\u598218:00"),this.updateAll()}},{key:"updateRangeEnd",value:function(e,t){e=$a(e);var a=this._parseRangeValue(t);if(Wr(a)){var n=!0,s=0;if(0<e&&(s=this.data.times[e-1].end),e==this.data.times.length){var o=a-3600;o<s&&(o=s),o>a?n=!1:this.data.times.push({start:o,end:a})}else{var r=86400;if(e<this.data.times.length-1&&(r=this.data.times[e+1].start),a>r||a<s)n=!1;else{var l=this.data.times[e].start;l>=a&&(l-=3600,l<s&&(l=s)),this.data.times[e].start=l,this.data.times[e].end=a}}if(n){this.data.seconds=this._calcSecondsByRanges(this.data.times);for(var d=0,p;d<this.tasks.length;d++)p=this.tasks[d],p.updateDurationDays(),p.updateDepends();this.clearAndRecalc()}else this.owner.addErrorMessage("\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u65E9\u4E8E\u524D\u4E00\u7ED3\u675F\u65F6\u95F4\uFF0C\u4E5F\u4E0D\u80FD\u665A\u4E8E\u540E\u4E00\u5F00\u59CB\u65F6\u95F4"),this.updateAll()}else this.owner.addErrorMessage("\u65F6\u95F4\u683C\u5F0F\u9519\u8BEF\uFF0C\u8BF7\u8F93\u5165\u6B63\u786E\u5185\u5BB9\uFF0C\u4F8B\u598218:00"),this.updateAll()}}]),t}(Hl),ni=function(){function e(){hn(this,e),this._init(),this.data={}}return yn(e,[{key:"_init",value:function(){this.dots=[],this.links=[],this.tasks=[],this.missRelationsTasks=[],this.breakLinks=[],this.breakpoints={},this.calendars={},this.isParentShowSingleLine=!1}},{key:"load",value:function(e){if(this.data=JSON.parse(e),2==this.data.version){this._init(),(null==this.data.prop.is_parent_show_single_line||this.data.prop.is_parent_show_single_line)&&(this.isParentShowSingleLine=!0);for(var t=this.data.default_calendar_id||0,a=0;a<this.data.calendars.length;a++){var n=this.data.calendars[a],s=new Vl(n);this.calendars[n.id]=new ai(null,s.convert())}for(var o=0;o<this.data.dots_size;o++)this.dots.push(new Ml(o));for(var r={},l=0;l<this.data.tasks.length;l++){var d=this.data.tasks[l],p=d.calendar_id||t,c=new Ul(l,d,this.dots[d.begin_dot],this.dots[d.end_dot],this.calendars[p]);this.tasks.push(c);var u=r[c.level-1];u&&u.addChild(c),r[c.level]=c}if(this.data.links)for(var h=0,m;h<this.data.links.length;h++)m=this.data.links[h],this.links.push(new Fl(h,m,this.dots[m.begin_dot],this.dots[m.end_dot]));this._setDotUnixTime();var g=this.tasks[0];g.hasLogicPrevRelations=!0,g.hasLogicNextRelations=!0;for(var f=1;f<this.tasks.length;f++)this.tasks[f].inspectLogicRelations()}}},{key:"_setDotUnixTime",value:function(){for(var e=0,t;e<this.tasks.length;e++)t=this.tasks[e],t.beginDot.unixTime=null==t.beginDot.unixTime?t.start:Ft(t.beginDot.unixTime,t.start),0==t.endDot.outTasks.length&&0==t.endDot.outLinks.length&&(t.endDot.unixTime=Mt(t.endDot.unixTime,t.stop));for(var a=0,n;a<this.links.length;a++)n=this.links[a],n.beginDot.unixTime=null==n.beginDot.unixTime?n.start:Ft(n.beginDot.unixTime,n.start),0==n.endDot.outTasks.length&&0==n.endDot.outLinks.length&&(n.endDot.unixTime=Mt(n.endDot.unixTime,n.stop))}},{key:"inspectPlan",value:function(){if(2==this.data.version){var e=0,t=0,a=this._inspectPlanCritical();e+=a.score,t+=a.maxScore;var n=this._inspectPlanLogicRelations();e+=n.score,t+=n.maxScore;var s=this._inspectPlanTasksLength();e+=s.score,t+=s.maxScore;var o=this._inspectPlanTaskDurations();e+=o.score,t+=o.maxScore;var r=this._inspectPlanOffDay();e+=r.score,t+=r.maxScore;var l=this._inspectPlanMilestones();e+=l.score,t+=l.maxScore;var d=this._inspectPlanLinks();e+=d.score,t+=d.maxScore;for(var p=0,c=0,u=1;u<this.tasks.length;u++)this.tasks[u].isMilestone()?c+=1:p+=1;return{score:e,maxScore:t,workCount:p,milestoneCount:c,critical:a,logicRelations:n,tasksLength:s,taskDurations:o,offDay:r,milestones:l,links:d}}}},{key:"_inspectPlanCritical",value:function(){var e=this.tasks[0],t=e.stop;if(e.stop==e.start)return{score:0,maxScore:20};if(1==this.tasks.length)return{score:0,maxScore:20};for(var a=1,n;a<this.tasks.length;a++)n=this.tasks[a],n.isKeyTask&&n.start<t&&(t=n.start);var s=Ot(20*(e.stop-t)/(e.stop-e.start));return{score:s,maxScore:20}}},{key:"_inspectPlanLogicRelations",value:function(){for(var e=40,t=0,a=1,n;a<this.tasks.length;a++)(n=this.tasks[a],!(n.hasLogicPrevRelations&&n.hasLogicNextRelations||n.isMilestone()||0<n.children.length))&&(this.missRelationsTasks.push({idx:n.idx}),t+=1);if(1==this.tasks.length)return{score:0,maxScore:e};var s=Ot(e-t*e/(this.tasks.length-1));return{score:s,maxScore:e}}},{key:"_inspectPlanTasksLength",value:function(){var e=Ot((this.tasks.length-1)/100);return 10<e&&(e=10),{score:e,maxScore:10}}},{key:"_inspectPlanTaskDurations",value:function(){for(var e=this.tasks[0].duration,t=10,a=0,n=0,s=1,o;s<this.tasks.length;s++)if(o=this.tasks[s],0==o.children.length){n+=1;var r=100*o.duration;r<3*e?a+=1:r<6*e?a+=.7:r<10*e?a+=.5:r<20*e&&(a+=.3)}return a=0==n?0:Ot(a*t/n),{score:a,maxScore:t}}},{key:"_inspectPlanOffDay",value:function(){if(1==this.tasks.length)return{score:0,maxScore:10};var e=this.tasks[0],t=Ut(e.duration/31536000);if(0==t)return{score:10,maxScore:10};var a=Ut((e.stop-e.start)/86400),n=0;null!=this.data.default_calendar_id&&(n=this.data.default_calendar_id);for(var s=null,o=0,r;o<this.data.calendars.length;o++)if(r=this.data.calendars[o],r.id==n){s=r;break}for(var l=0,d=0,p;d<s.work_periods.length;d++)p=s.work_periods[d],l+=p[1]-p[0];var c=Ut(e.duration/l),u=Ot(10*(a-c)/t);return 10<u&&(u=10),{score:u,maxScore:10}}},{key:"_inspectPlanMilestones",value:function(){for(var e=0,t=0,a=0,n;a<this.tasks.length;a++)n=this.tasks[a],n.isMilestone()&&(e+=1,!n.beginDot.inTasks.some(function(e){return!e.isMilestone()})&&!n.endDot.outTasks.some(function(e){return!e.isMilestone()})&&(t+=1));var s=5;return 0<e&&(s=5-Ot(5*t/e)),{score:s,maxScore:5}}},{key:"_inspectPlanLinks",value:function(){for(var e=0,t=0,a;t<this.links.length;t++)a=this.links[t],a.isSuspended()&&(e+=1,this.breakLinks.push({idx:a.idx}));var n=5-e;return 0>n&&(n=0),{score:n,maxScore:5}}},{key:"inspectGb",value:function(){if(2==this.data.version){var e=this._inspectGbStructure(),t=this._inspectGbBreakpoint(),a=this._inspectGbTaskShowContent(),n=this._inspectGbLinkFreetime(),s=this._inspectGbLinkDuration(),o=this._inspectGbSameDots();return{structure:e,breakpoint:t,showContent:a,linkFreetime:n,linkDuration:s,sameDots:o,passed:e&&t&&a&&n&&s&&o}}}},{key:"_inspectGbStructure",value:function(){for(var e={isPassed:!0,isSingleLine:!0},t=!1,a=1,n;a<this.tasks.length;a++)if(n=this.tasks[a],0<n.children.length&&!n.isPartition&&(t=!0,!n.isCollapsed)){e.isPassed=!1;break}return t&&!this.isParentShowSingleLine&&(e.isSingleLine=!1),e}},{key:"_inspectGbBreakpoint",value:function(){for(var e=new Al,t=new Al,a=1,n;a<this.tasks.length;a++)(n=this.tasks[a],!(!n.isVisible||n.isPartition||n.isMilestone()))&&(n.beginDot.isHead()&&e.add(n.beginDot),n.endDot.isTail()&&t.add(n.endDot));for(var s=new Al,o=new Al,r=0,l;r<this.links.length;r++)l=this.links[r],l.beginDot.isHead()&&s.add(l.beginDot),l.endDot.isTail()&&o.add(l.endDot);var d=new Al([].concat(nl(e),nl(s))),p=new Al([].concat(nl(t),nl(o)));if(1<d.size||1<p.size){var c=tl(d).sort(function(e,t){return e.unixTime-t.unixTime}),u=tl(p).sort(function(e,t){return e.unixTime-t.unixTime}),h=c.shift(),m=u.pop();h&&(this.breakpoints.begin_dot=h.idx),m&&(this.breakpoints.end_dot=m.idx);var g={};e.forEach(function(e){if(e!=h)for(var t=0,a;t<e.outTasks.length;t++)(a=e.outTasks[t],!(!a.isVisible||a.isPartition||a.isMilestone()))&&(g[a.id]={idx:a.idx,front:!0,behind:!1})}),t.forEach(function(e){if(e!=m)for(var t=0,a;t<e.inTasks.length;t++)(a=e.inTasks[t],!(!a.isVisible||a.isPartition||a.isMilestone()))&&(g[a.id]?g[a.id].behind=!0:g[a.id]={idx:a.idx,front:!1,behind:!0})}),this.breakpoints.break_works=ul(g);var f={};return s.forEach(function(t){if(t!=h&&!e.has(t)){var a=t.outLinks[0];f[a.id]={idx:a.idx,front:!0,behind:!1}}}),o.forEach(function(e){if(e!=m&&!t.has(e)){var a=e.inLinks[0];f[a.id]?f[a.id].behind=!0:f[a.id]={idx:a.idx,front:!1,behind:!0}}}),this.breakpoints.break_links=ul(f),!1}return!0}},{key:"_inspectGbTaskShowContent",value:function(){if(this.data.work_styles){for(var e=0,t;e<this.tasks.length;e++)if((t=this.tasks[e],t.isVisible&&!t.isPartition)&&!t.inspectShowContent(this.data.work_styles,this.data.prop.show_content))return!1;return!0}return!0}},{key:"_inspectGbLinkFreetime",value:function(){for(var e=0,t;e<this.links.length;e++)if(t=this.links[e],t.hasFreetime())return!0==this.data.prop.is_link_show_freetime;return!0}},{key:"_inspectGbLinkDuration",value:function(){for(var e=0;e<this.links.length;e++)if(this.links[e].duration)return!1;return!0}},{key:"_inspectGbSameDots",value:function(){for(var e=0,t;e<this.dots.length;e++)if(t=this.dots[e],1<t.outTasks.length)for(var a=new Al,n=0;n<t.outTasks.length;n++)if(a.add(t.outTasks[n].endDot),a.size!=n+1)return!1;return!0}}]),e}(),si=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.props=e,a.inspect=null,a.shouldShowRefresh=!1,a.canRefresh=!0,a.shouldUpdate=!0,a.initializing=!0,a}return Eo(t,e),yn(t,[{key:"componentDidMount",value:function(){document.querySelector("body").classList.add("zplan-inspection-body")}},{key:"_load",value:function(e){e?(this.inspect=new ni,this.inspect.load(e)):this.inspect=null,this.shouldShowRefresh=!1,this.canRefresh=!0,this.shouldUpdate=!0,this.initializing=!1,this.forceUpdate()}},{key:"markAsLazyUpdated",value:function(){this.shouldShowRefresh=!0,this.shouldUpdate=!0,this.forceUpdate()}},{key:"update",value:function(e){var t=this;window.cefQuery({request:"{\"name\":\"load_project\"}",persistent:!1,onSuccess:function(a){t._load(a),e&&e()},onFailure:function(){t._load(),e&&e()}})}},{key:"_render",value:function(){return null}},{key:"render",value:function(){return this.shouldUpdate?(this.shouldUpdate=!1,Je("div",{class:"zplan-inspection"},this._render())):"$NO_OP"}}]),t}(sa),oi=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.inspectRes=null,a}return Eo(t,e),yn(t,[{key:"_renderCounter",value:function(){return[Je("div",{class:"inspection-plan-counter"},["\u5DE5\u4F5C",Je("div",{class:"count"},this.inspectRes.workCount.toString())]),Je("div",{class:"inspection-plan-counter counter-divider"}),Je("div",{class:"inspection-plan-counter"},["\u91CC\u7A0B\u7891",Je("div",{class:"count"},this.inspectRes.milestoneCount.toString())])]}},{key:"_getClassNameOfScore",value:function(e){return 40>e?"inspection-notice-red":60>e?"inspection-notice-orange":80>e?"inspection-notice-green":"inspection-notice-blue"}},{key:"_renderNotice",value:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],s=100*(e.score/e.maxScore);return[Je("div",{class:"inspection-content-row inspection-notice"},[Je("div",{class:"inspection-notice-title"},[t,Je("span",{class:"inspection-score-tip zplan-tooltip","aria-label":a})]),Je("span",{class:"inspection-notice-socre "+this._getClassNameOfScore(s)},e.score.toString())]),Je("div",{class:"inspection-content-row"},Je(rl,{percent:s,style:ol.DEFAULT}))].concat(nl(n))}},{key:"onBreakpointBtnClick",value:function(e){var t={name:"find_breakpoints",args:{break_works:e.inspect.missRelationsTasks,break_links:[]}};window.cefQuery({request:Ao(t),persistent:!1,onSuccess:function(){},onFailure:function(){}})}},{key:"onBreakLinksBtnClick",value:function(e){var t={name:"find_break_link_points",args:{break_links:e.inspect.breakLinks}};window.cefQuery({request:Ao(t),persistent:!1,onSuccess:function(){},onFailure:function(){}})}},{key:"_renderScore",value:function(){var e=this,t={percent:Ot(100*this.inspectRes.score/this.inspectRes.maxScore),style:ol.CIRCLE};this.shouldShowRefresh&&(t.tip="\u70B9\u51FB\u5237\u65B0",t.onClick=function(){e.update()},t.shouldShowRefresh=!0);var a=[Je("div",{class:"inspection-content-row inspection-score-row"},Je(rl,t))];return this.shouldShowRefresh&&(a.push(Je("div",{class:"inspection-content-row"},Je("div",{},"\u5DE5\u4F5C\u9879\u8F83\u591A"))),a.push(Je("div",{class:"inspection-content-row"},Je("div",{},[Je("span",{},"\u8BF7\u5355\u51FB"),Je("span",{class:"inspection-refresh"},"\u5237\u65B0"),Je("span",{},"\u6309\u94AE\u624B\u52A8\u5237\u65B0")])))),a}},{key:"_renderLogicRelations",value:function(){var e=[];return this.shouldShowRefresh||this.inspectRes.logicRelations.score==this.inspectRes.logicRelations.maxScore||(e=[Je("div",{class:"inspection-content-row inspection-btns"},[Je("button",{class:"inspection-btn inspection-btn-red",onClick:S(this,this.onBreakpointBtnClick)},"\u5BFB\u627E\u65AD\u70B9")])]),this._renderNotice(this.inspectRes.logicRelations,"\u903B\u8F91\u5173\u7CFB","\u68C0\u67E5\u5DE5\u4F5C\u662F\u5426\u7F3A\u5C11\u524D\u7F6E\u6216\u540E\u7F6E\u5DE5\u4F5C\uFF0C\u82E5\u7F3A\u5C11\u4F1A\u5F71\u54CD\u5DE5\u7A0B\u5173\u952E\u7EBF\u8DEF\u548C\u5DE5\u671F\u7684\u8BA1\u7B97\uFF0C\u70B9\u51FB\u3010\u5BFB\u627E\u65AD\u70B9\u3011\u53EF\u5B9A\u4F4D\u7F51\u7EDC\u56FE\u65AD\u70B9\u4F4D\u7F6E",e)}},{key:"_renderLinks",value:function(){var e=[];return this.shouldShowRefresh||this.inspectRes.links.score==this.inspectRes.links.maxScore||(e=[Je("div",{class:"inspection-content-row inspection-btns"},[Je("button",{class:"inspection-btn inspection-btn-red",onClick:S(this,this.onBreakLinksBtnClick)},"\u5BFB\u627E\u60AC\u7A7A\u5173\u7CFB")])]),this._renderNotice(this.inspectRes.links,"\u60AC\u7A7A\u5173\u7CFB","\u68C0\u67E5\u662F\u5426\u5B58\u5728\u4E00\u7AEF\u60AC\u7A7A\u7684\u5173\u7CFB\uFF0C\u6B64\u7C7B\u5173\u7CFB\u5EFA\u8BAE\u8865\u5168\u6216\u5220\u9664",e)}},{key:"_render",value:function(){return this.initializing?void 0:this.inspect?(this.inspectRes=this.inspect.inspectPlan(),this.inspectRes?Je("div",{class:"inspection-content"},[].concat(nl(this._renderScore()),[Je("div",{class:"inspection-content-row counter-board"},this._renderCounter())],nl(this._renderNotice(this.inspectRes.critical,"\u5173\u952E\u7EBF\u8DEF","\u68C0\u67E5\u662F\u5426\u6709\u8D2F\u7A7F\u8BA1\u5212\u59CB\u7EC8\u7684\u5173\u952E\u8DEF\u7EBF\uFF0C\u82E5\u5173\u952E\u7EBF\u8DEF\u4E0D\u5B8C\u6574\uFF0C\u5DE5\u671F\u8BA1\u7B97\u53EF\u80FD\u6709\u8BEF\uFF0C\u540C\u65F6\u56F4\u7ED5\u5173\u952E\u7EBF\u8DEF\u53EF\u5F00\u5C55\u5DE5\u671F\u4F18\u5316\u548C\u5DE5\u7A0B\u8D76\u5DE5")),nl(this._renderLogicRelations()),nl(this._renderNotice(this.inspectRes.tasksLength,"\u8BE6\u7EC6\u5EA6","\u68C0\u67E5\u8BA1\u5212\u7684\u5DE5\u4F5C\u8BE6\u7EC6\u5EA6")),nl(this._renderNotice(this.inspectRes.taskDurations,"\u7CBE\u7EC6\u5EA6","\u68C0\u67E5\u8BA1\u5212\u7684\u5DE5\u4F5C\u5DE5\u671F\u8BBE\u7F6E\u7CBE\u5EA6")),nl(this._renderNotice(this.inspectRes.offDay,"\u5047\u671F\u8BBE\u7F6E","\u68C0\u67E5\u8BA1\u5212\u7684\u5047\u671F\u8BBE\u7F6E\u662F\u5426\u7B26\u5408\u8981\u6C42")),nl(this._renderNotice(this.inspectRes.milestones,"\u60AC\u7A7A\u91CC\u7A0B\u7891","\u68C0\u67E5\u91CC\u7A0B\u7891\u662F\u5426\u4E0E\u5DE5\u4F5C\u76F8\u8FDE")),nl(this._renderLinks()))):Je("div",{class:"inspection-content"},[Je("div",{class:"inspection-error"},"\u4E0D\u652F\u6301\u8BC4\u5206")])):Je("div",{class:"inspection-content"},[Je("div",{class:"inspection-error"},"\u6CA1\u6709\u8BA1\u5212\u6570\u636E")])}}]),t}(si),ri=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.inspectRes=null,a}return Eo(t,e),yn(t,[{key:"_renderTopTip",value:function(){return Je("span",{class:"inspection-gb-tip zplan-tooltip zplan-tooltip-bottom","aria-label":"\u5168\u90E8\u68C0\u67E5\u9879\u5747\u901A\u8FC7\u540E\u4E3A\u68C0\u67E5\u901A\u8FC7\uFF0C\u5426\u5219\u4E3A\u68C0\u67E5\u672A\u901A\u8FC7\u3002\u6CE8\uFF1A\u6240\u6709\u6807\u51C6\u5747\u4E3A2015\u7248\u300A\u5DE5\u7A0B\u7F51\u7EDC\u8BA1\u5212\u6280\u672F\u89C4\u7A0B\u300B\u3002\u5176\u4E2D\uFF0C\"\u5FC5\"\u8868\u793A\u5F88\u4E25\u683C\uFF0C\u975E\u8FD9\u6837\u505A\u4E0D\u53EF\uFF1B\"\u5E94\"\u8868\u793A\u4E25\u683C\uFF0C\u5728\u6B63\u5E38\u60C5\u51B5\u4E0B\u5747\u5E94\u8FD9\u6837\u505A\uFF1B\u201C\u672A\u201D\u8868\u793A\u672A\u5B9A\u4E49"})}},{key:"onRefreshBtnClick",value:function(e){e.update()}},{key:"onBtnClick",value:function(e){var t=e.instance,a=e.name,n=e.args,s=void 0===n?null:n,o={name:a};s&&(o.args=s),window.cefQuery({request:Ao(o),persistent:!1,onSuccess:function(){t.update()},onFailure:function(){t.update()}})}},{key:"_renderResultOrRefreshBtn",value:function(){var e=[];return this.shouldShowRefresh?e.push(Je("div",{class:"inspection-gb-refresh"},Je("button",{onClick:S(this,this.onRefreshBtnClick)},[Je("span",{class:"inspection-gb-icon"}),"\u91CD\u65B0\u68C0\u67E5"]))):this.inspectRes.passed?e.push(Je("div",{class:"inspection-gb-pass"},[Je("span",{class:"inspection-gb-icon"}),Je("span",{},"\u68C0\u67E5\u901A\u8FC7"),this._renderTopTip()])):e.push(Je("div",{class:"inspection-gb-not-pass"},[Je("span",{class:"inspection-gb-icon"}),Je("span",{},"\u68C0\u67E5\u672A\u901A\u8FC7"),this._renderTopTip()])),Je("div",{class:"inspection-content-row inspection-gb-top"},e)}},{key:"_renderInspection",value:function(e,t,a,n,s){var o=e?"inspection-gb-good":"inspection-gb-bad",r="\u7236\u5B50\u7ED3\u6784"===a?"zplan-tooltip-bottom":"zplan-tooltip-top";return Je("div",{class:"inspection-content-row inspection-gb"},[Je("div",{class:"inspection-gb-header"},[Je("span",{class:"inspection-gb-status "+o}),Je("span",{class:"inspection-gb-title zplan-tooltip "+r,"aria-label":t},a),Je("span",{class:"inspection-gb-level "+n})]),Je("div",{class:"inpection-gb-buttons"},s)])}},{key:"_renderStructureInspection",value:function(){var e=this.inspectRes.structure,t=[Je("button",{disabled:e.isPassed,onClick:S({instance:this,name:"convert_parents_to_partitions"},this.onBtnClick)},"\u6240\u6709\u7236\u5DE5\u4F5C\u8BBE\u4E3A\u5206\u533A"),Je("button",{disabled:e.isPassed,onClick:S({instance:this,name:"separate_all_parents"},this.onBtnClick)},"\u6240\u6709\u7236\u5DE5\u4F5C\u4E00\u952E\u89E3\u7EC4"),Je("button",{disabled:e.isPassed&&e.isSingleLine,onClick:S({instance:this,name:"collapse_parents"},this.onBtnClick),style:"white-space: normal"},"\u6298\u53E0\u6240\u6709\u5B50\u7F51\u7EDC\u4E14\u7236\u5DE5\u4F5C\u7528\u5355\u7EBF\u8868\u793A")];return this._renderInspection(e.isPassed&&e.isSingleLine,"\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u4E2D\u6709\u7236\u5B50\u7ED3\u6784\uFF0C\u56FD\u6807\u672A\u5B9A\u4E49\u3002\u4E3A\u7B26\u5408\u5355\u8D77\u5355\u7EC8\u539F\u5219\uFF0C\u82E5\u7236\u5DE5\u4F5C\u672A\u8FDE\u63A5\uFF0C\u53EF\u9009\u62E9\u5C06\u6240\u6709\u7236\u5DE5\u4F5C\u8BBE\u4E3A\u5206\u533A\u3002\u82E5\u5B50\u5DE5\u4F5C\u672A\u8FDE\u63A5\uFF0C\u53EF\u5C06\u8BE6\u7EC6\u5DE5\u4F5C\u6298\u53E0\u8D77\u6765","\u7236\u5B50\u7ED3\u6784","inspection-gb-wei",t)}},{key:"_renderStartAndEndInspection",value:function(){var e=this.inspectRes.breakpoint,t=[Je("button",{disabled:e,onClick:S({instance:this,name:"find_breakpoints",args:this.inspect.breakpoints},this.onBtnClick)},"\u5BFB\u627E\u65AD\u70B9"),Je("button",{disabled:e,onClick:S({instance:this,name:"quick_complete",args:this.inspect.breakpoints},this.onBtnClick)},"\u4E00\u952E\u8865\u5168")];return this._renderInspection(e,"\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u4E2D\u5E94\u53EA\u6709\u4E00\u4E2A\u8D77\u70B9\u8282\u70B9\u3002\u5728\u4E0D\u5206\u671F\u5B8C\u6210\u4EFB\u52A1\u7684\u7F51\u7EDC\u56FE\u4E2D\uFF0C\u5E94\u53EA\u6709\u4E00\u4E2A\u7EC8\u70B9\u8282\u70B9\u3002\u5176\u4ED6\u6240\u6709\u8282\u70B9\u5747\u5E94\u662F\u4E2D\u95F4\u8282\u70B9\u3002\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u5FC5\u987B\u4E25\u683C\u9075\u5B88\u8FD9\u4E00\u6761\u3002","\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u5FC5\u987B\u5355\u8D77\u5355\u7EC8","inspection-gb-bi",t)}},{key:"_renderCustomWorkInspection",value:function(){var e=this.inspectRes.showContent,t=[Je("button",{disabled:e,onClick:S({instance:this,name:"show_content_duration"},this.onBtnClick)},"\u53EA\u663E\u793A\u5DE5\u671F")];return this._renderInspection(e,"\u6709\u5DE5\u4F5C\u663E\u793A\u5F00\u59CB\u5B8C\u6210\u65F6\u95F4\uFF0C\u56FD\u6807\u672A\u5B9A\u4E49","\u5DE5\u4F5C\u81EA\u5B9A\u4E49\u663E\u793A\u5185\u5BB9","inspection-gb-wei",t)}},{key:"_renderRelationInspection",value:function(){var e=this.inspectRes.linkFreetime,t=[Je("button",{disabled:e,onClick:S({instance:this,name:"link_show_freetime"},this.onBtnClick)},"\u8868\u793A\u6210\u6CE2\u5F62\u7EBF")];return this._renderInspection(e,"\u865A\u5DE5\u4F5C\u5FC5\u987B\u4EE5\u5782\u76F4\u65B9\u5411\u7684\u865A\u7BAD\u7EBF\u8868\u793A\uFF0C\u6709\u81EA\u7531\u65F6\u5DEE\u65F6\u5E94\u7528\u6CE2\u5F62\u7EBF\u8868\u793A","\u865A\u5DE5\u4F5C(\u5173\u7CFB\u7EBF)\u81EA\u7531\u65F6\u5DEE\u5E94\u7528\u6CE2\u5F62\u7EBF\u8868\u793A","inspection-gb-ying",t)}},{key:"_renderRelationLagInspection",value:function(){var e=this.inspectRes.linkDuration,t=[Je("button",{disabled:e,onClick:S({instance:this,name:"find_link_has_duration"},this.onBtnClick)},"\u5BFB\u627E\u4E0D\u7B26\u9879"),Je("button",{disabled:e,onClick:S({instance:this,name:"quick_handle_link_duration"},this.onBtnClick)},"\u4E00\u952E\u5904\u7406")];return this._renderInspection(e,"\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u4E2D\uFF0C\u865A\u7BAD\u7EBF\u7684\u552F\u4E00\u529F\u80FD\u662F\u7528\u4EE5\u6B63\u786E\u8868\u8FBE\u76F8\u5173\u5DE5\u4F5C\u7684\u903B\u8F91\u5173\u7CFB\u3002\u5B83\u4E0D\u6D88\u8017\u8D44\u6E90\uFF0C\u6301\u7EED\u65F6\u95F4\u4E3A\u96F6\uFF0C\u6240\u4EE5\u53C8\u79F0\u4E3A\u865A\u5DE5\u4F5C\u3002\u8BA1\u7B97\u5DE5\u4F5C\u65F6\u95F4\u53C2\u6570\u5E94\u5728\u786E\u5B9A\u5404\u9879\u5DE5\u4F5C\u7684\u6301\u7EED\u65F6\u95F4\u4E4B\u540E\u8FDB\u884C\u3002\u865A\u5DE5\u4F5C\u53EF\u89C6\u540C\u5DE5\u4F5C\u8FDB\u884C\u8BA1\u7B97\uFF0C\u5176\u6301\u7EED\u65F6\u95F4\u5E94\u4E3A\u96F6","\u865A\u5DE5\u4F5C\u6301\u7EED\u65F6\u95F4\u5E94\u4E3A\u96F6","inspection-gb-ying",t)}},{key:"_renderMultiWorksInspection",value:function(){var e=this.inspectRes.sameDots,t=[Je("button",{disabled:e,onClick:S({instance:this,name:"find_same_dots_work"},this.onBtnClick)},"\u5BFB\u627E\u4E0D\u7B26\u9879"),Je("button",{disabled:e,onClick:S({instance:this,name:"repair_same_dots_works"},this.onBtnClick)},"\u4E00\u952E\u5904\u7406")];return this._renderInspection(e,"\u4ECE\u4E00\u4E2A\u8282\u70B9\u5F00\u59CB\u5230\u53E6\u4E00\u4E2A\u8282\u70B9\u7ED3\u675F\u7684\u82E5\u5E72\u9879\u5E73\u884C\u7684\u5DE5\u4F5C\uFF0C\u9700\u8981\u589E\u52A0\u865A\u7BAD\u7EBF\uFF0C\u7528\u4EE5\u6B63\u786E\u8868\u8FBE\u76F8\u5173\u5DE5\u4F5C\u7684\u903B\u8F91\u5173\u7CFB","\u76F8\u540C\u9996\u5C3E\u8282\u70B9\u4E0D\u53EF\u591A\u5DE5\u4F5C","inspection-gb-ying",t)}},{key:"_render",value:function(){return this.initializing?void 0:this.inspect?(this.inspectRes=this.inspect.inspectGb(),this.inspectRes?Je("div",{class:"inspection-content"},[this._renderResultOrRefreshBtn(),this._renderStructureInspection(),this._renderStartAndEndInspection(),this._renderCustomWorkInspection(),this._renderRelationInspection(),this._renderRelationLagInspection(),this._renderMultiWorksInspection()]):Je("div",{class:"inspection-content"},[Je("div",{class:"inspection-error"},"\u4E0D\u652F\u6301\u56FD\u6807\u68C0\u67E5")])):Je("div",{class:"inspection-content"},[Je("div",{class:"inspection-error"},"\u6CA1\u6709\u8BA1\u5212\u6570\u636E")])}}]),t}(si),li=0,ii=1,di=2,pi=3,ci=4,ui=5,hi=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.milestones=[],a.isEstimated=!1,a.version=2,a.currentRank=0,a}return Eo(t,e),yn(t,[{key:"update",value:function(){var e=this,t={name:"load_milestones",args:{rank:this.currentRank}};window.cefQuery({request:Ao(t),persistent:!1,onSuccess:function(t){e._load(t)},onFailure:function(){e._load()}})}},{key:"render",value:function(){return console.log("Milestones Update"),Je(".zplan-milestone-warning",{},[Je(".types-filter",{},Je("select",{onChange:S(this,this._filterByRank)},[Je("option",{value:li,selected:this.currentRank==li?"selected":""},"\u663E\u793A\u5168\u90E8\u91CC\u7A0B\u7891"),Je("option",{value:ii,selected:this.currentRank==ii?"selected":""},"\u663E\u793A\u4E00\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:di,selected:this.currentRank==di?"selected":""},"\u663E\u793A\u4E8C\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:pi,selected:this.currentRank==pi?"selected":""},"\u663E\u793A\u4E09\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:ci,selected:this.currentRank==ci?"selected":""},"\u663E\u793A\u56DB\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:ui,selected:this.currentRank==ui?"selected":""},"\u663E\u793A\u4E94\u7EA7\u91CC\u7A0B\u7891")])),this._renderMilestones()])}},{key:"_load",value:function(e){if(e){var t=JSON.parse(e);t.milestones&&(this.milestones=t.milestones),t.is_estimated&&(this.isEstimated=t.is_estimated),t.version&&(this.version=t.version)}this.forceUpdate()}},{key:"_renderMilestones",value:function(){var e=[],t=!0,a=!1,n=void 0;try{for(var s=rr(this.milestones),o;!(t=(o=s.next()).done);t=!0){var r=o.value,l=parseFloat(r.offset).toFixed(2);l=parseFloat(l);var i=Je(".milestone-item",{id:r.id,onClick:S([parseInt(r.id)],this._selectMilestones)},[Je(".info-row",{},[Je("div",{},this._milestoneName(r)),Je(".types-list",{},Je("select",{onClick:S({},this._stopPropagation),onChange:S(r.id,this._modifyMilestoneRank)},[Je("option",{value:ii,selected:null==r.rank||r.rank==ii?"selected":""},"\u4E00\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:di,selected:r.rank==di?"selected":""},"\u4E8C\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:pi,selected:r.rank==pi?"selected":""},"\u4E09\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:ci,selected:r.rank==ci?"selected":""},"\u56DB\u7EA7\u91CC\u7A0B\u7891"),Je("option",{value:ui,selected:r.rank==ui?"selected":""},"\u4E94\u7EA7\u91CC\u7A0B\u7891")]))]),Je(".info-row",{},[this._renderDate(r),this._renderStatus(l)])]);e.push(i)}}catch(e){a=!0,n=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw n}}return Je(".milestone-body",{},e)}},{key:"_milestoneName",value:function(e){return 3==e.type?e.name:"\u9879\u76EE\u5B8C\u6210"}},{key:"_renderDate",value:function(e){return 2==this.version?this._renderV2Date(e):this._renderV1Date(e)}},{key:"_renderV1Date",value:function(e){var t=new Date(1e3*(e.ask_stop_time-1));if(this.isEstimated){var a=new Date(1e3*(e.estimate_stop_time-1));return Je("div",{},[Je("div",{},[Je("span",{},"\u8981\u6C42\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",t))]),Je("div",{},[Je("span",{},"\u9884\u6D4B\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",a))])])}var n=new Date(1e3*(e.compute_stop_time-1));return Je("div",{},[Je("div",{},[Je("span",{},"\u8981\u6C42\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",t))]),Je("div",{},[Je("span",{},"\u8BA1\u5212\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",n))])])}},{key:"_renderV2Date",value:function(e){var t=new Date(1e3*(e.ask_stop_time-1));if(this.isEstimated){var a=new Date(1e3*(e.estimate_stop_time-1));return Je("div",{},[Je("div",{},[Je("span",{},"\u8981\u6C42\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",t))]),Je("div",{},[Je("span",{},"\u9884\u6D4B\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",a))])])}var n=new Date(1e3*(e.plan_stop_time-1));return Je("div",{},[Je("div",{},[Je("span",{},"\u8981\u6C42\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",t))]),Je("div",{},[Je("span",{},"\u8BA1\u5212\uFF1A"),Je("span",{},this._formatDate("yyyy-MM-dd",n))])])}},{key:"_renderStatus",value:function(e){return 0>e?Je(".overdue",{},[Je("span",{},"\u8D85\u671F"),Je("span.offset",{},At(e)),Je("span",{},"\u5929")]):0<e?Je(".ahead",{},[Je("span",{},"\u63D0\u524D"),Je("span.offset",{},e),Je("span",{},"\u5929")]):Je(".on-time",{},Je("span",{},"\u6309\u65F6\u5B8C\u6210"))}},{key:"_filterByRank",value:function(e,t){e.currentRank=parseInt(t.target.value),e.update()}},{key:"_selectMilestones",value:function(e){var t=this,a=document.getElementsByClassName("milestone-item"),n=!0,s=!1,o=void 0;try{for(var r=rr(a),l,i;!(n=(l=r.next()).done);n=!0)i=l.value,i.style.backgroundColor="white"}catch(e){s=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(s)throw o}}var d=document.getElementById(e[0]);d.style.backgroundColor="#F5F5F5";window.cefQuery({request:Ao({name:"select_milestones",args:{ids:e}}),persistent:!1,onSuccess:function(){},onFailure:function(){t._load()}})}},{key:"_modifyMilestoneRank",value:function(e,t){var a=this,n={name:"modify_milestone",args:{id:e,rank:parseInt(t.target.value)}};window.cefQuery({request:Ao(n),persistent:!1,onSuccess:function(){},onFailure:function(){a._load()}})}},{key:"_formatDate",value:function(e,t){var a={"M+":t.getUTCMonth()+1,"d+":t.getUTCDate(),"h+":t.getUTCHours(),"m+":t.getUTCMinutes(),"s+":t.getUTCSeconds(),"q+":Ot((t.getUTCMonth()+3)/3),S:t.getUTCMilliseconds()};for(var n in /(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getUTCFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return e}},{key:"_stopPropagation",value:function(e,t){t.stopPropagation()}}]),t}(sa),mi=function(e){function t(e,a){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a))}return Eo(t,e),yn(t,[{key:"setShow",value:function(){this.isShow=0!=this.level()&&(0==this.parent.level()||!this.parent.collapsed()&&this.parent.isShow)}},{key:"isReadonly",value:function(){return!0}},{key:"getValue",value:function(e){return"images"==e?this.data.imagesSize?"\u67E5\u770B":null:this.data[e]}},{key:"getCellClass",value:function(e){return"totalPercent"==e?this.data.exceeding?"zplan-statistics-over":"":""}},{key:"hide",value:function(){this.isShow=!1;for(var e=this.next();e&&e.level()>this.level()&&e.isShow;)e.isShow=!1,e=e.next()}},{key:"show",value:function(){if(0!=this.level()&&(null==this.parent||this.parent&&!this.parent.data.collapsed)){this.isShow=!0;for(var e=this.parent;e&&0!=e.level()&&!e.isShow;)e.isShow=!0,e=e.parent}}},{key:"changeCollapsed",value:function(){for(var e=this.next();e&&e.level()>this.level();)e.data.collapsed=this.data.collapsed,e=e.next();this.owner.showByConditions()}},{key:"showByConditions",value:function(e){if(!this.isShow){for(var t=0;t<e.length;t++){var a=ir(e[t],2),n=a[0],s=a[1];if(!this.filter(n,s))return}this.show()}}},{key:"filter",value:function(e,t){var a=this.getValue(e);return!!t.some(function(e){return"string"==typeof a?a.includes(e):e==a})}},{key:"setAsCurrent",value:function(){if(this.isShow)return this.owner.updateCurrentRow(this)}},{key:"actionClick",value:function(e){"images"==e&&this.owner.showImagesFunction&&this.owner.showImagesFunction({quantityId:this.getValue("quantityId"),imagesSize:this.getValue("imagesSize")})}}]),t}(jl),gi=h(function(t){(function(e,t){t()})(da,function(){function n(e,t){return"undefined"==typeof t?t={autoBom:!1}:"object"!=typeof t&&(t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function s(t,a,n){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){l(s.response,a,n)},s.onerror=function(){console.error("could not download file")},s.send()}function o(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var p="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof da&&da.global===da?da:void 0,l=p.saveAs||("object"!=typeof window||window!==p?function(){}:"download"in HTMLAnchorElement.prototype?function(e,t,a){var n=p.URL||p.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):o(l.href)?s(e,t,a):r(l,l.target="_blank")):(l.href=n.createObjectURL(e),setTimeout(function(){n.revokeObjectURL(l.href)},4E4),setTimeout(function(){r(l)},0))}:"msSaveOrOpenBlob"in navigator?function(e,t,a){if(t=t||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(n(e,a),t);else if(o(e))s(e,t,a);else{var l=document.createElement("a");l.href=e,l.target="_blank",setTimeout(function(){r(l)})}}:function(t,a,n,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof t)return s(t,a,n);var r="application/octet-stream"===t.type,d=/constructor/i.test(p.HTMLElement)||p.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||r&&d)&&"object"==typeof FileReader){var i=new FileReader;i.onloadend=function(){var e=i.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},i.readAsDataURL(t)}else{var u=p.URL||p.webkitURL,h=u.createObjectURL(t);o?o.location=h:location.href=h,o=null,setTimeout(function(){u.revokeObjectURL(h)},4E4)}});p.saveAs=l.saveAs=l,t.exports=l})}),fi=function(){function e(t,a){hn(this,e),this.name=t,this.data=a}return yn(e,[{key:"export",value:function(){var e=this,t=new xlsx.File,a=t.addSheet(this.name),n=0;if(this.data.header&&(n=this._fillRows(a,n,this.data.header.rows,this.data.header.mergedRanges)),this.data.body)for(var s=this.data.body.mergedRanges,o=0,r;o<this.data.body.rows.length;o++)r=this.data.body.rows[o],n=this._fillRows(a,n,r,s);t.saveAs("blob").then(function(t){return gi.saveAs(t,e.name+".xlsx")})}},{key:"_fillRows",value:function(e,t,a,n){for(var s=0;s<a.length;s++){var o=a[s],r=t+s,l=o.level||0;e.row(r).setLevel(l);for(var d=0;d<o.cols.length;d++){var p=o.cols[d],c=e.cell(r,d);c.value=p.v,p.style&&(c.style.font.color=p.style.fontColor)}}if(n)for(var u=0;u<n.length;u++){var h=ir(n[u],4),m=h[0],g=h[1],f=h[2],_=h[3],y=e.cell(m+t,g);y.hMerge=_-g,y.vMerge=f-m}return t+a.length}}]),e}(),_i=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.rows=[],e.resetShowConditions(),e.showImagesFunction=null,e}return Eo(t,e),yn(t,[{key:"resetShowConditions",value:function(){this.showConditions={options:[],nameOptions:[]}}},{key:"setShowConditions",value:function(e){this.showConditions=e}},{key:"load",value:function(e){this.init(),this.loadRows(e.rows),this.loadColumns(e.columns),this.updateShowAttrs()}},{key:"loadRows",value:function(e){this.rows=[];var t=0;0!=e[0].level&&(e[0].level=0);for(var a=0,n;a<e.length;a++)n=new mi(this,e[a]),n.setIdx(a),0==n.level()&&0!=a&&(t=1,n.data.level=t),n.level()>t+1?(++t,n.data.level=t):t=n.level(),n.calcParent(),this.rows.push(n)}},{key:"isReadonly",value:function(){return!0}},{key:"showByConditions",value:function(){for(var e=[],t=0,a;t<this.rows.length;t++)a=this.rows[t],a.isShow=!1,e.unshift(t);var n=(this.showConditions.idxs||[]).sort(function(e,t){return e-t});if(0<n.length){for(var s=[],o=0;o<n.length;o++)s.push(this.rows[n[o]]);e=[];for(var r=0;r<s.length;r++){var l=s[r],d=null;if(r<s.length-1&&(d=s[r+1]),e.push(l.idx),!(d&&d.parent==l))for(var p=l.next();p&&p.level()>l.level();)e.push(p.idx),p=p.next()}}for(var c=0,u;c<e.length;c++)u=this.rows[e[c]],u.showByConditions(this.showConditions.options);this.touchShow(),this.showRangeChanged(),this.updateAll()}},{key:"exportExcel",value:function(){for(var e=this.rows[0].data.name,t=this.columns.allVisibleCol(),a={cols:t.map(function(e){return{v:e.head_name}})},n=[],s=1,o;s<this.rows.length;s++)if(o=this.rows[s],!!o.isShow){for(var r=[],l=0,d;l<t.length;l++)if(d=t[l],"index"==d.name)r.push({v:o.getGridRowIndex()});else{var p=o.getValue(d.name);d.indent&&(p=" ".repeat(o.level())+p);var c={v:p};"totalPercent"==d.name&&o.data.exceeding&&(c.style={fontColor:"FF0000"}),r.push(c)}var u=o.level();0<u&&--u,n.push([{level:u,cols:r}])}new fi(e,{header:{rows:[a]},body:{rows:n}}).export()}},{key:"expandToSameLevel",value:function(e){for(var t=1,a;t<this.rows.length;t++)a=this.rows[t],a.level()>e||(a.data.collapsed=!(a.level()<e),a.changeCollapsed());this.updateAll()}}]),t}(Hl),yi=function(){function e(){hn(this,e),this.statistics=new _i,this.columns=[],this.departmentId=null,this.maxLevel=0,this.departmentOptions=[],this.workSiteOptions=[],this.quantities={},this.totalAmounts={}}return yn(e,[{key:"_beforeUpdate",value:function(){}},{key:"_isInvisible",value:function(e,t){if(t&&t>e.level)return!1;if(this.departmentId){var a=null;return e.department&&(a=[e.department.first_sector_id,e.department.second_sector_id,e.department.third_sector_id]),!(null==a||a.includes(this.departmentId))}return!1}},{key:"_updateQuantityAmounts",value:function(e){e.price&&(e.shouldUpdate&&(e.amount=ti.roundTwoDecimals(e.value/e.price)),e.realAmount=ti.roundTwoDecimals(e.realValue/e.price),e.totalAmount=ti.roundTwoDecimals(e.totalValue/e.price))}},{key:"_addQuantityValues",value:function(e,t){e.value+=t.value,e.realValue+=t.realValue,e.totalValue+=t.totalValue}},{key:"_getQuantity",value:function(e,t,a){var n=t[e.id]||{id:null,task_id:e.id,amount:0,real_amount:0,desc:"",images_size:0,shouldUpdate:!0},s=a[e.id]||0,o="",r=0,l=0;return e.source_count&&(l=e.source_count.plan||0,r=e.source_count.contract_price||0,o=e.source_count.unit||""),{id:n.id,taskId:n.task_id,amount:n.amount,realAmount:n.real_amount,totalAmount:s,planAmount:l,value:n.amount*r,realValue:n.real_amount*r,totalValue:s*r,planValue:l*r,desc:n.desc,unit:o,price:r,imagesSize:n.images_size,shouldUpdate:n.shouldUpdate}}},{key:"_initQuantities",value:function(e,t,a){for(var n={},s={},o=-1,r=e.res_kinds,l=0;l<e.tasks.length;l++){var d=e.tasks[l],p=this._getQuantity(d,t,a,r),c=n[o];if(d.level>o)c&&this._addQuantityValues(c,p);else if(d.level==o){var u=n[o-1];u&&this._addQuantityValues(u,p),c&&(s[c.taskId]=c)}else{for(c&&(s[c.taskId]=c),n[o]=null,--o;d.level<=o;o--){var h=n[o];h&&this._updateQuantityAmounts(h),s[h.taskId]=h,n[o]=null;var m=n[o-1];m&&this._addQuantityValues(m,h)}var g=n[d.level-1];g&&this._addQuantityValues(g,p)}o=d.level,n[d.level]=p}var f=n[o];for(f&&(s[f.taskId]=f),--o,f=n[o],f&&(this._updateQuantityAmounts(f),s[f.taskId]=f),--o;0<=o;o--){var _=n[o];_&&(this._addQuantityValues(_,f),this._updateQuantityAmounts(_),s[_.taskId]=_),f=_}this.quantities=s}},{key:"_convertOriginalQuantities",value:function(e){for(var t={},a=0,n;a<e.length;a++)n=e[a],t[n.task_id]=n;return t}},{key:"load",value:function(e){var t=e.zpertData,a=e.quantities,n=e.totalAmounts,s=e.departmentId,o=void 0===s?null:s,r=JSON.parse(t);if(1==r.version){r.tasks[0].level=0;for(var l=1;l<r.tasks.length;l++)r.tasks[l].level=1}this.departmentId=o,this._initQuantities(r,this._convertOriginalQuantities(a),n),this._loadZpert(r)}},{key:"addShowImagesFunction",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.statistics.showImagesFunction=e}},{key:"_loadZpert",value:function(e){var t=this,a={columns:this.columns,rows:[]},n=new Al,s=new Al;this.maxLevel=0;for(var o=null,r=e.tasks.length-1,l;0<=r;r--)if(l=e.tasks[r],!(0<r&&this._isInvisible(l,o))){var d=this._convertTask(l);n.add(d.department),d.workSite&&s.add(d.workSite),a.rows.unshift(d),o=d.level,d.level>this.maxLevel&&(this.maxLevel=d.level)}this.statistics.resetShowConditions(),this.departmentOptions=[],n.forEach(function(e){e&&""!=e&&t.departmentOptions.push(e)}),this.workSiteOptions=[],s.forEach(function(e){e&&""!=e&&t.workSiteOptions.push(e)}),this._beforeUpdate(a),this.statistics.load(a)}},{key:"_convertTask",value:function(){return{}}},{key:"filter",value:function(e){this.statistics.setShowConditions(e),this.statistics.showByConditions()}},{key:"exportExcel",value:function(){this.statistics.exportExcel()}},{key:"expandToSameLevel",value:function(e){this.statistics.expandToSameLevel(e)}}]),e}(),vi=function(e){function t(e){hn(this,t);var a=wo(this,(t.__proto__||cn(t)).call(this,e));return a.props=e,a.inspect=null,a.shouldUpdate=!0,a}return Eo(t,e),yn(t,[{key:"update",value:function(){this.shouldUpdate=!0,this.forceUpdate()}},{key:"_onCheckboxChanged",value:function(e){var t=e.instance,a=e.option;a.checked=!a.checked,t.update()}},{key:"render",value:function(){return this.shouldUpdate?(this.shouldUpdate=!1,Je("div",{class:"zplan-statistics"},[Je("div",{class:"zplan-statistics-body"},Je(ur,{model:this.props.model.statistics,scrollY:!1}))])):"$NO_OP"}}]),t}(sa);(function(){window.addEventListener("click",function(e){var t=e.target.closest(".zplan-dropdown-toggle");if(t)e.preventDefault(),t.parentNode.classList.contains("zplan-dropdown-open")?(t.parentNode.classList.remove("zplan-dropdown-open"),t.blur()):t.parentNode.classList.add("zplan-dropdown-open");else{var a=document.querySelector(".zplan-dropdown-open");a&&a.classList.remove("zplan-dropdown-open")}},!1)})(),ln("keys",function(){return function(e){return Ln(Xa(e))}});var ki=ca.Object.keys,wi=h(function(e){e.exports={default:ki,__esModule:!0}}),Ti=n(wi),Ri=function(){function e(t,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"FS";hn(this,e),this.from=t,this.to=a,this.lag=n,this.type=s}return yn(e,[{key:"fromTime",value:function(){return"F"==this.type.charAt(0)?this.from.computedData.finish_date:this.from.computedData.start_date}},{key:"toTime",value:function(){return"S"==this.type.charAt(1)?this.to.computedData.start_date:this.to.computedData.finish_date}},{key:"fromDot",value:function(){return"F"==this.type.charAt(0)?this.from.pertPostdot:this.from.pertPredot}},{key:"toDot",value:function(){return"S"==this.type.charAt(1)?this.to.pertPredot:this.to.pertPostdot}},{key:"lagDays",value:function(){return this.to.calendar.calcDurDaysByDuration(this.lag)}},{key:"dump",value:function(){var e=this.from.idx+this.type,t=this.lagDays();return 0>t?e+=t:0<t&&(e=e+"+"+t),e}},{key:"isEqual",value:function(e){return this.from==e.from&&this.to==e.to&&100*this.lag==100*e.lag&&this.type==e.type}}]),e}(),Di=function(){function e(t){hn(this,e);var a=$a(t/32);this.store=Array(a).fill(0)}return yn(e,[{key:"get",value:function(e){var t=this.store[$a(e/32)];return 0!=(t&1<<e%32)}},{key:"set",value:function(e,t){var a=$a(e/32),n=this.store[a],s=1<<e%32;s=t?n|s:n&~s,this.store[a]=s}}]),e}(),xi=function(){function e(){hn(this,e),this.id=null,this.inTasks=[],this.outTasks=[],this.pertRow=-1,this.isCritical=!1,this.deleted=!1,this.outPertRelations=[],this.inPertRelations=[],this.time=null}return yn(e,[{key:"addInTask",value:function(e){e.pertPostdot=this,this.inTasks.push(e)}},{key:"addOutTask",value:function(e){e.pertPredot=this,this.outTasks.push(e)}},{key:"fusion",value:function(e){if(e!=this){this.inTasks=this.inTasks.concat(e.inTasks),this.outTasks=this.outTasks.concat(e.outTasks);for(var t=0;t<e.outTasks.length;t++)e.outTasks[t].pertPredot=this;for(var a=0;a<e.inTasks.length;a++)e.inTasks[a].pertPostdot=this}}},{key:"uniq",value:function(){this.inTasks=[].concat(nl(new Al(this.inTasks))),this.outTasks=[].concat(nl(new Al(this.outTasks)))}}]),e}(),Ci=12,Si=5.2,bi=[0,-3,0,3,5.2,0],Pi=[-3,0,3,0,0,-5.2],Ei=[-3,0,3,0,0,5.2],zi=[-8,0,0,-8,8,0,0,8],Ii=3,Li=2,Ai=8,Mi="12px Arial",Fi=function(){function e(t){hn(this,e),this.task=t,this.drawer=null,this.container=new createjs.Container,this.shouldUpdate=!0,this.initContainer(),this.xPos=[],this.yPos=[],this.state={name:null,duration:null,start:null,finish:null,pertRow:null,predot:null,postdot:null,postdotRow:null,isMilestone:null,isCurrent:null,isCritical:null,pertRelations:[]}}return yn(e,[{key:"initContainer",value:function(){var e=new createjs.Shape;this.graphics=e.graphics,this.nameText=new createjs.Text("",Mi),this.durationText=new createjs.Text("",Mi),this.predotText=new createjs.Text("",Mi),this.postdotText=new createjs.Text("",Mi),this.lagContainer=new createjs.Container,this.container.addChild(e),this.container.addChild(this.nameText),this.container.addChild(this.durationText),this.container.addChild(this.predotText),this.container.addChild(this.postdotText),this.container.addChild(this.lagContainer),this.predotText.visible=!1,this.postdotText.visible=!1}},{key:"getColor",value:function(){return this.state.isCurrent?"#F703FB":this.state.isCritical?"#FF0000":"#000000"}},{key:"drawNameText",value:function(e,t){this.nameText.text=this.state.name,this.nameText.x=e,this.nameText.y=t,this.nameText.visible=!0}},{key:"drawDurationText",value:function(e,t){this.durationText.text=this.state.duration,this.durationText.x=e,this.durationText.y=t,this.durationText.visible=!0}},{key:"drawTaskLine",value:function(e,t,a,n){this.graphics.setStrokeStyle(1),this.graphics.beginStroke(this.getColor()),this.graphics.moveTo(e,t),this.graphics.lineTo(a,n)}},{key:"drawRhombus",value:function(e,t,a){this.graphics.beginFill(this.getColor()),this.graphics.moveTo(e+a[0],t+a[1]),this.graphics.lineTo(e+a[2],t+a[3]),this.graphics.lineTo(e+a[4],t+a[5]),this.graphics.lineTo(e+a[6],t+a[7]),this.graphics.lineTo(e+a[0],t+a[1]),this.graphics.closePath().endFill()}},{key:"drawTask",value:function(e,t,a,n,s,o,r){this.state.isMilestone?(this.drawNameText(e+5,t+5),this.drawRhombus(e,t,zi)):(s==t?e==n&&(e+=Ai):e+=Ii,r==t?a==o&&(a-=Ai):a-=Ii,this.drawNameText(e+Li,t-Ci),this.drawDurationText(e+Li,t),this.drawTaskLine(e,t,a,t))}},{key:"drawPredotText",value:function(e,t){var a=this.state.predot.id.toString();this.predotText.text=a,this.predotText.x=e-a.length*Ci/4,this.predotText.y=t-Ci/2,this.predotText.visible=!0}},{key:"drawDashLine",value:function(e,t,a,n){this.graphics.setStrokeStyle(1),this.graphics.beginStroke(this.getColor()),this.graphics.setStrokeDash([2,2]),this.graphics.moveTo(e,t),this.graphics.lineTo(a,n),this.graphics.setStrokeDash()}},{key:"drawPredot",value:function(e,t,a,n){this.state.isMilestone||(this.state.predot.drawn?this.predotText.visible=!1:(this.graphics.setStrokeStyle(1),this.graphics.beginStroke(this.getColor()),this.graphics.moveTo(e+Ai,t),this.graphics.drawCircle(e,t,Ai),this.drawPredotText(e,t)),t==n?e<a&&this.drawDashLine(e+Ai,t,a,n):(t<n?t+=Ai:t-=Ai,e+=Ii,this.drawDashLine(e,t,e,n),a+=Ii,e!=a&&this.drawDashLine(e,n,a,n))),this.state.predot.drawn=!0}},{key:"drawPostdotText",value:function(e,t){var a=this.state.postdot.id.toString();this.postdotText.text=a,this.postdotText.x=e-a.length*Ci/4,this.postdotText.y=t-Ci/2,this.postdotText.visible=!0}},{key:"drawArrow",value:function(e,t,a){this.graphics.beginFill(this.getColor()),this.graphics.moveTo(e+a[0],t+a[1]),this.graphics.lineTo(e+a[2],t+a[3]),this.graphics.lineTo(e+a[4],t+a[5]),this.graphics.lineTo(e+a[0],t+a[1]),this.graphics.closePath(),this.graphics.endFill()}},{key:"drawPostdot",value:function(e,t,a,n){if(!this.state.isMilestone)if(this.state.postdot.drawn?this.postdotText.visible=!1:(this.graphics.setStrokeStyle(1),this.graphics.beginStroke(this.getColor()),this.graphics.moveTo(e+Ai,t),this.graphics.drawCircle(e,t,Ai),this.drawPostdotText(e,t)),t==a){var s=e-Ai-Si;e!=n&&this.drawDashLine(n,a,s,a),this.drawArrow(s,t,bi)}else{var o=null;t<a?(t=t+Ai+Si,o=Pi):(t=t-Ai-Si,o=Ei);var r=e-Ii;this.drawDashLine(r,a,r,t),this.drawArrow(r,t,o),e!=n&&this.drawDashLine(n,a,e,a)}this.state.postdot.drawn=!0}},{key:"addPertRelationLagDay",value:function(e,t,a){var n=new createjs.Text(a,Mi);n.x=e,n.y=t,this.lagContainer.addChild(n)}},{key:"drawPloyDashLine",value:function(e,t,a,n,s,o,r,l){this.graphics.setStrokeDash([2,2]),this.graphics.moveTo(e,t),this.graphics.lineTo(a,n),this.graphics.lineTo(s,o),this.graphics.lineTo(r,l),this.graphics.setStrokeDash()}},{key:"drawPertRelations",value:function(){this.lagContainer.removeAllChildren();for(var e=0;e<this.state.pertRelations.length;e++){var t=ir(this.state.pertRelations[e],6),a=t[0],n=t[1],s=t[2],o=t[3],r=t[4],l=t[5];this.xPos.push(a,o);var d=null;-1==s?(this.yPos.push(n,r),a+=Ii,n<r?(n+=Ai,r=r-Ai-Si,d=Ei):(n-=Ai,r=r+Ai+Si,d=Pi),this.drawDashLine(a,n,a,r),this.drawArrow(a,r,d)):(this.yPos.push(n,s,r),n==s&&s==r?(a+=Ai,o=o-Ai-Si,0!=l&&this.addPertRelationLagDay(a,n,l),this.drawDashLine(a,n,o,n),this.drawArrow(o,n,bi)):(s<r?(r=r-Ai-Si,o-=Ii,d=Ei):s>r?(r=r+Ai+Si,o-=Ii,d=Pi):a==o?(n>r?(d=Pi,r=r+Si+Ai):n<r?(r=r-Si-Ai,d=Ei):(console.log("WARN: something was wrong"),d=bi),o+=Ii):(o-=Ii,o=o-Ai-Si,d=bi),a+=Ii,n<s?n+=Ai:n-=Ai,0!=l&&this.addPertRelationLagDay(a,s,l),this.drawPloyDashLine(a,n,a,s,o,s,o,r),this.drawArrow(o,r,d)))}}},{key:"draw",value:function(){var e=this.drawer.calcPos(this.state.start),t=this.drawer.calcPosY(this.state.pertRow),a=this.drawer.calcPos(this.state.finish),n=this.drawer.calcPos(this.state.predot.time),s=this.drawer.calcPosY(this.state.predot.pertRow),o=this.drawer.calcPos(this.state.postdot.time),r=this.drawer.calcPosY(this.state.postdot.pertRow);this.xPos=[e,a,n,o],this.yPos=[t,s,r],this.graphics.clear(),this.drawPredot(n,s,e,t),this.drawTask(e,t,a,n,s,o,r),this.drawPostdot(o,r,t,a),this.drawPertRelations(),this.xPos=this.xPos.sort(function(e,t){return e-t}),this.yPos=this.yPos.sort(function(e,t){return e-t})}},{key:"getTaskStart",value:function(){return this.task.computedData.start_date}},{key:"getTaskFinish",value:function(){return this.task.computedData.finish_date}},{key:"updateStart",value:function(){var e=this.getTaskStart();(null==this.state.start||e.getTime()!=this.state.start.getTime())&&(this.state.start=e,this.shouldUpdate=!0)}},{key:"updateFinish",value:function(){var e=this.getTaskFinish();(null==this.state.finish||e.getTime()!=this.state.finish.getTime())&&(this.state.finish=e,this.shouldUpdate=!0)}},{key:"updatePredot",value:function(){var e=this.task.pertPredot;(null==this.state.predot||e!=this.state.predot)&&(this.state.predot=e,this.shouldUpdate=!0)}},{key:"updatePostdot",value:function(){var e=this.task.pertPostdot;(null==this.state.postdot||e!=this.state.postdot)&&(this.state.postdot=e,this.shouldUpdate=!0)}},{key:"updatePertRow",value:function(){var e=this.task.pertRow;this.state.pertRow!=e&&(this.state.pertRow=e,this.shouldUpdate=!0)}},{key:"updateOtherStates",value:function(){var e=this.task.getValue("name"),t=this.task.getValue("duration_days"),a=this.task.isMilestone(),n=this.task.isCurrentRow(),s=this.task.isCritical;(e!=this.state.name||t!=this.state.duration||a!=this.state.isMilestone||n!=this.state.isCurrent||s!=this.state.isCritical)&&(this.state.name=e,this.state.duration=t,this.state.isMilestone=a,this.state.isCurrent=n,this.state.isCritical=s,this.shouldUpdate=!0)}},{key:"calcPertRelationData",value:function(e){var t=this.drawer.calcPos(e.pertPredot.time),a=this.drawer.calcPosY(e.pertPredot.pertRow),n=null;n=-1==e.pertRow?-1:this.drawer.calcPosY(e.pertRow);var s=this.drawer.calcPos(e.pertPostdot.time),o=this.drawer.calcPosY(e.pertPostdot.pertRow);return[t,a,n,s,o,e.lagDays]}},{key:"updatePertRelations",value:function(){var e=[];if(0==this.state.predot.inTasks.length&&0<this.state.predot.outPertRelations.length)for(var t=0;t<this.state.predot.outPertRelations.length;t++)e.push(this.calcPertRelationData(this.state.predot.outPertRelations[t]));for(var a=0;a<this.state.postdot.outPertRelations.length;a++)e.push(this.calcPertRelationData(this.state.postdot.outPertRelations[a]));Ao(e)!=Ao(this.state.pertRelations)&&(this.state.pertRelations=e,this.shouldUpdate=!0)}},{key:"updateState",value:function(){this.updatePertRow(),this.updateStart(),this.updateFinish(),this.updatePredot(),this.updatePostdot(),this.updateOtherStates(),this.updatePertRelations()}},{key:"update",value:function(){this.updateState(),this.shouldUpdate&&(this.shouldUpdate=!1,this.draw(),this.container.set({minX:this.xPos[0],maxX:this.xPos[this.xPos.length-1],minY:this.yPos[0],maxY:this.yPos[this.yPos.length-1]}))}},{key:"touch",value:function(){this.shouldUpdate=!0}}]),e}(),Oi={GANTT:"gantt",PERT:"pert",SCORE:"score",COMPARE_DIFF:"diff",TEMPLATE:"template"},Ui={ZPERT:"zpert",ZPLAN:"zplan"},Ni={WITHOUT_PARENT_TASK:1,NORMAL:2},Vi={WORK:0,WORKAPSCE:1,MILESTONE:2},ji={NORMAL:[{name:"index",type:"text",width:"45px",readonly:!0,head_name:""},{name:"partition",type:"checkbox",width:"35px",readonly:!1,head_name:"\u5206\u533A"},{name:"name",type:"text",width:"200px",readonly:!1,indent:!0,head_name:"\u4EFB\u52A1\u540D\u79F0"},{name:"duration_days",type:"number",width:"50px",readonly:!1,head_name:"\u5DE5\u671F"},{name:"start_date",type:"date",width:"100px",readonly:!1,head_name:"\u5F00\u59CB\u65F6\u95F4"},{name:"finish_date",type:"date",width:"100px",readonly:!1,head_name:"\u5B8C\u6210\u65F6\u95F4"},{name:"depends",type:"text",width:"70px",readonly:!1,head_name:"\u524D\u7F6E\u4EFB\u52A1"},{name:"calendar_id",type:"select",width:"90px",head_name:"\u4EFB\u52A1\u65E5\u5386",readonly:!1,options:[[0,"\u9ED8\u8BA4\u65E5\u5386"]]}],TEMPLATE:[{name:"index",type:"text",width:"45px",readonly:!0,head_name:""},{name:"pull_in",type:"checkbox",width:"35px",readonly:!1,head_name:"\u5F15\u5165"},{name:"name",type:"text",width:"200px",readonly:!1,indent:!0,db_clickable:!0,head_name:"\u4EFB\u52A1\u540D\u79F0"},{name:"duration_days",type:"number",width:"50px",readonly:!1,head_name:"\u5DE5\u671F"},{name:"depends",type:"text",width:"70px",readonly:!1,head_name:"\u524D\u7F6E\u4EFB\u52A1"},{name:"unit",type:"text",width:"70px",readonly:!1,head_name:"\u5355\u4F4D"},{name:"price",type:"number",width:"70px",readonly:!1,head_name:"\u5355\u4EF7"}]},Wi=["start_date","finish_date","duration_days"],Bi={NOT_EARLIER_THAN:4},Hi=function(e){function t(e,a){hn(this,t);var n=wo(this,(t.__proto__||cn(t)).call(this,e,a));return n.fromRelations=[],n.toRelations=[],n.isCritical=!1,n.calcedCritical=!1,n.pertPredot=null,n.pertPostdot=null,n.calendar=Wr(n.data.calendar_id)?n.owner.calendars[n.data.calendar_id]:n.owner.calendars[n.owner.defaultCalendarId],n.calendar.addTask(n),n.computedData={start_date:null,finish_date:null,duration_days:n.calendar.calcDurDaysByDuration(n.data.duration),constraint_date:null},Wr(n.data.start)&&(n.computedData.start_date=dr.setUnix(n.data.start)),Wr(n.data.finish)&&(n.computedData.finish_date=dr.setUnix(n.data.finish)),Wr(n.data.constraint_type)&&(n.computedData.constraint_date=dr.setUnix(n.data.constraint_date)),n.showingFromRelations=[],n.showingToRelations=[],n.pertRow=-1,n.pertPredot=null,n.pertPostdot=null,n.pertDrawer=new Fi(n),n.pertTasks=[],n.pertRowsDots=[],n.marked=!1,n.shouldPullIn=!1,n.isSearched=!1,n}return Eo(t,e),yn(t,[{key:"deleteFromRelation",value:function(e){var t=this;this.fromRelations=this.fromRelations.filter(function(t){return t.from!=e}),e.toRelations=e.toRelations.filter(function(e){return e.to!=t});var a=this._dumpFromRelations();this.data.depends=a}},{key:"isReadonly",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return"pull_in"!=e&&(!!this.owner.isReadonly()||!!this.data.readonly||!!(e&&""!=e&&this.owner.columns.isReadonly(e))||!!(this.hasChild()&&Wi.some(function(t){return t==e})))}},{key:"isMilestone",value:function(){return this.data.type==Vi.MILESTONE}},{key:"getAddValue",value:function(e){return this.data.add_column?this.data.add_column[e]:null}},{key:"_setAddValue",value:function(e,t){null==this.data.add_column&&(this.data.add_column={});var a=this.owner.columns.getByName(e);this.data.add_column[e]="date"==a.type?t:"number"==a.type?Wo(t):t.toString()}},{key:"getValue",value:function(e){if(Wi.some(function(t){return t==e})){if("start_date"==e)return dr.formatUTC(this.computedData.start_date);if("finish_date"==e){var t=dr.clone(this.computedData.finish_date);return dr.isNotSame(t,this.computedData.start_date)&&dr.subtractSeconds(t,1),dr.formatUTC(t)}return this.computedData.duration_days}if("pull_in"==e)return this.shouldPullIn;if(e.startsWith("addcol")){var a=this.owner.columns.getByName(e),n=this.getAddValue(e);if("date"==a.type){if(""!=n&&null!=n&&null!=n){var s=dr.setUnix(n);return dr.formatUTC(s)}return""}return n}return this.data[e]}},{key:"setValue",value:function(e,t){try{"collapsed"==e?(this.data.collapsed=!this.data.collapsed,this.changeCollapsed(),this.setAsCurrent(),this.owner.updateAll()):"start_date"==e?this._setStartDate(t):"finish_date"==e?this._setFinishDate(t):"duration_days"==e?this._setDurationDays(t):"depends"==e?this._setDepends(t):"partition"==e?this.setPartition(t):"pull_in"==e?this.setPullIn(t):"calendar_id"==e?this.setCalendar(t):e.startsWith("addcol")?this._setAddValue(e,t):this.data[e]=t}catch(e){this.owner.addErrorMessage(e),this.owner.fallback()}}},{key:"setCalendar",value:function(e){e=$a(e),($o(e)||0>e||!this.owner.calendars[e])&&(e=this.owner.defaultCalendarId),e!=this.data.calendar_id&&(this.calendar.delTask(this),this.data.calendar_id=e,this.calendar=this.owner.calendars[this.data.calendar_id],this.calendar.addTask(this),this.updateDurationDays(),this.updateDepends(),this.owner.recalcTasksTime())}},{key:"setPartition",value:function(e){if(e)for(var t=this;t;)t.data.partition=!0,t.touch(),t=t.parent;else{this.data.partition=!1,this.touch();for(var a=this.next();a&&a.level()>this.level();)a.data.partition=!1,a.touch(),a=a.next()}this.owner.updateAll()}},{key:"setPullIn",value:function(e){if(e){this.shouldPullIn=!0,this.touch();for(var t=this.next();t&&t.level()>this.level();)t.shouldPullIn=!0,t.touch(),t=t.next()}else{this.shouldPullIn=!1,this.touch();for(var a=this.next();a&&a.level()>this.level();)a.shouldPullIn=!1,a.touch(),a=a.next()}this.owner.updateAll()}},{key:"canChangeStart",value:function(e){for(var t=null,a=this;a;){for(var n=0;n<a.fromRelations.length;n++){var s=a.fromRelations[n],o=null;if("SS"==s.type)o=s.from.computedData.start_date;else if("FS"==s.type)o=s.from.computedData.finish_date;else continue;null!=o&&(null==t||o>t)&&(t=o)}a=a.parent}return null==t||dr.isAfterOrSame(e,t)}},{key:"canChangeFinish",value:function(e){for(var t=null,a=this;a;){for(var n=0;n<a.fromRelations.length;n++){var s=a.fromRelations[n],o=null;if("SF"==s.type)o=s.from.computedData.start_date;else if("FF"==s.type)o=s.from.computedData.finish_date;else continue;null!=o&&(null==t||o>t)&&(t=o)}a=a.parent}return null==t||dr.isAfterOrSame(e,t)}},{key:"_setStartDate",value:function(e){var t=!1,a=0;if(+e!==e){this.data.constraint_date=null,this.computedData.constraint_date=null,this.data.constraint_type=null;var n=this._getAutoComputedStartTime(),s=ir(n,2),o=s[1],r=this.calendar.calcTime(o,this.data.duration);r=this.calendar.calcPrevWorkTime(r,this.data.duration),a=this.calendar.calcDuration(this.computedData.start_date,o),this.data.start=dr.getUnix(o),this.computedData.start_date=o,this.data.finish=dr.getUnix(r),this.computedData.finish_date=r,t=!0,this.touch()}else{var l=dr.setUnix(e);if(l=this.calendar.calcNextWorkTime(l,this.data.duration),e=dr.getUnix(l),e!=this.data.start){var i=this.calendar.calcTime(l,this.data.duration);i=this.calendar.calcPrevWorkTime(i,this.data.duration),this.canChangeStart(l)&&this.canChangeFinish(i)&&(a=this.calendar.calcDuration(this.computedData.start_date,l),this.data.start=e,this.computedData.start_date=l,this.data.finish=dr.getUnix(i),this.computedData.finish_date=i,0==this.level()?(this.data.constraint_type=null,this.data.constraint_date=null,this.computedData.constraint_date=null):(this.data.constraint_type=Bi.NOT_EARLIER_THAN,this.data.constraint_date=e,this.computedData.constraint_date=dr.clone(l)),t=!0,this.touch())}}t&&this.owner.recalcTasksTime()}},{key:"_setFinishDate",value:function(e){if(Wr(e)){var t=dr.setUnix(e),a=dr.getStartOfDay(t);if(dr.addSeconds(a,this.calendar.getMaxEndSeconds()),dr.isNotSame(a,this.computedData.finish_date)&&this.canChangeFinish(a)){var n=this.calendar.calcDuration(this.computedData.start_date,a),s=!1;if(0<=n){var o=this.calendar.calcPrevWorkTime(a,n);this.data.finish=dr.getUnix(o),this.computedData.finish_date=o,this._changeDuration(n),this.computedData.duration_days=this.calendar.calcDurDaysByDuration(n),s=!0,this.touch()}s&&this.owner.recalcTasksTime()}}}},{key:"_changeDuration",value:function(e){this.data.duration=e,0<this.idx&&this.data.type!=Vi.WORKAPSCE&&(this.data.type=0==e?Vi.MILESTONE:Vi.WORK)}},{key:"_setDurationDays",value:function(e){if(+e===e){if(0>e)return void this.owner.addErrorMessage("\u5DE5\u671F\u4E0D\u80FD\u5C0F\u4E8E\u96F6");if(e!=this.computedData.duration_days){var t=this.calendar.calcDurationByDurDays(e);this._changeDuration(t),this.computedData.duration_days=e;var a=this.calendar.calcTime(this.computedData.start_date,t);a=this.calendar.calcPrevWorkTime(a,t);var n=this.calendar.calcTime(this.computedData.finish_date,-t);n=this.calendar.calcNextWorkTime(n,t),this.canChangeFinish(a)?(this.data.finish=dr.getUnix(a),this.computedData.finish_date=a):this.canChangeStart(n)&&(this.data.start=dr.getUnix(n),this.computedData.start_date=n),this.touch(),this.owner.recalcTasksTime()}}}},{key:"_isLeafLoop",value:function(e,t,a){var n=this;if(a.get(e.idx))return!0;if(t.get(e.idx))return!1;t.set(e.idx,!0);var s=[];s=s.concat(e.fromRelations);for(var o=e.parent;o;)s=s.concat(o.fromRelations),o=o.parent;return s.some(function(e){return n._isLeafLoop(e.from,t,a)})}},{key:"_checkNewFromrelationsValid",value:function(e){var t=this;if(0==e.length)return!0;var a=function(){var a=new Di(t.owner.rows.length),n=new Di(t.owner.rows.length);a.set(t.idx,!0);for(var s=t.leaves(),o=0;o<s.length;o++)a.set(s[o].idx,!0);for(var r=function(s){var o=e[s];if(t.fromRelations.some(function(e){return o.isEqual(e)}))return"continue";var r=o.from;if(r==t)return t.owner.addErrorMessage("\u4E0D\u80FD\u548C\u81EA\u5DF1\u5EFA\u7ACB\u5173\u8054"),{v:{v:!1}};var l=[r];return r.hasChild()&&(l=r.leaves()),l.some(function(e){return a.get(e.idx)})?(t.owner.addErrorMessage("\u4E0D\u80FD\u548C\u81EA\u5DF1\u7684\u7236\u4EFB\u52A1\u6216\u5B50\u4EFB\u52A1\u5EFA\u7ACB\u5173\u8054"),{v:{v:!1}}):l.some(function(e){return t._isLeafLoop(e,n,a)})?(t.owner.addErrorMessage("\u5B58\u5728\u5FAA\u73AF\u4F9D\u8D56\u5173\u7CFB"),{v:{v:!1}}):void 0},l=0,d;l<e.length;l++)switch(d=r(l),d){case"continue":continue;default:if("object"===("undefined"==typeof d?"undefined":vo(d)))return d.v;}return{v:!0}}();if("object"===("undefined"==typeof a?"undefined":vo(a)))return a.v}},{key:"_setDepends",value:function(e){var t=this;e=e.toUpperCase().replace("\uFF0C",",").replace("\u65E5","");var a=this._buildRelations(e);if(this._checkNewFromrelationsValid(a)){for(var n=0,s;n<this.fromRelations.length;n++)s=this.fromRelations[n],s.from.toRelations=s.from.toRelations.filter(function(e){return e.to!=t});this.fromRelations=a;for(var o=0,r;o<this.fromRelations.length;o++)r=this.fromRelations[o],r.from.toRelations.push(r);this.updateDepends(),this.owner.recalcTasksTime()}}},{key:"updateDepends",value:function(){var e=this._dumpFromRelations();this.data.depends!=e&&(this.data.depends=e,this.touch())}},{key:"showCheckBox",value:function(e){return"partition"!=e||!this.collapsed()&&this.hasChild()}},{key:"setShow",value:function(){this.isShow=0!=this.level()&&(0==this.parent.level()||!this.parent.collapsed()&&this.parent.isShow)}},{key:"createRelations",value:function(){this.fromRelations=this._buildRelations(this.data.depends);for(var e=0,t;e<this.fromRelations.length;e++)t=this.fromRelations[e],t.from.toRelations.push(t)}},{key:"_buildRelations",value:function(e){for(var t=this._parseDepends(e),a=[],n=0;n<t.length;n++){var s=t[n],o=this.owner.rows[s.row];o&&a.push(new Ri(o,this,s.lag,s.type))}return a}},{key:"_parseDepends",value:function(e){for(var t=[],a=e.split(","),n=0,s;n<a.length;n++)if(s=a[n],""!=s){var o=this._parseDep(s),r=ir(o,3),l=r[0],d=r[1],p=void 0===d?"FS":d,c=r[2],u=void 0===c?0:c;l?(l=$a(l),u=ti.roundTwoDecimals(Wo(u)),t.push({row:l,type:p,lag:this.calendar.calcDurationByDurDays(u)})):this.owner.addErrorMessage(this.idx+"\u7684\u524D\u7F6E\u4EFB\u52A1\u9519\u8BEF: "+e)}return t}},{key:"_parseDep",value:function(e){var t=/(\d+)(SS|SF|FS|FF){0,1}((-|\+)\d+\.?\d*){0,1}/,a=t.exec(e);return a?[a[1],a[2],a[3]]:[null,null,null]}},{key:"_dumpFromRelations",value:function(){return this.fromRelations=this.fromRelations.sort(function(e,t){return e.from.idx-t.from.idx}),this.fromRelations.map(function(e){return e.dump()}).join(",")}},{key:"recalcFinish",value:function(){var e=this.calendar.calcTime(this.computedData.start_date,this.data.duration);e=this.calendar.calcPrevWorkTime(e,this.data.duration),(null==this.computedData.finish_date||dr.isNotSame(e,this.computedData.finish_date))&&(this.computedData.finish_date=e,this.data.finish=dr.getUnix(e),this.touch())}},{key:"recalcDuration",value:function(){var e=this.calendar.calcDuration(this.computedData.start_date,this.computedData.finish_date);e!=this.data.duration&&(this._changeDuration(e),this.computedData.duration_days=this.calendar.calcDurDaysByDuration(e),this.touch())}},{key:"updateDurationDays",value:function(){var e=this.calendar.calcDurDaysByDuration(this.data.duration);e!=this.computedData.duration_days&&(this.computedData.duration_days=e,this.touch())}},{key:"getStartDateByRelations",value:function(){for(var e=null,t=!0,a=0,n;a<this.fromRelations.length;a++)if(n=this.fromRelations[a],n.from.reCalculated){var s=null;"SS"==n.type?s=this.calendar.calcTime(n.from.computedData.start_date,n.lag):"SF"==n.type?s=this.calendar.calcTime(n.from.computedData.start_date,n.lag-this.data.duration):"FS"==n.type?s=this.calendar.calcTime(n.from.computedData.finish_date,n.lag):"FF"==n.type&&(s=this.calendar.calcTime(n.from.computedData.finish_date,n.lag-this.data.duration)),(null==e||dr.isAfter(s,e))&&(e=s)}else{t=!1;break}return[t,e]}},{key:"_getStartDateByChildren",value:function(){for(var e=!0,t=null,a=this.next();a&&a.level()>this.level();)if(a.reCalculated)t?t>a.data.start&&(t=a.data.start):t=a.data.start,a=a.next();else{e=!1;break}return e&&t?[e,dr.setUnix(t)]:[e,null]}},{key:"_getAutoComputedStartTime",value:function(){var e=null,t=!1,a=this._getStartDateByChildren(),n=ir(a,2),s=n[0],o=n[1];if(!s)return t=!0,[!1,null,t];e=o;for(var r=this.parent;r;){r.data.constraint_type==Bi.NOT_EARLIER_THAN&&(null==e||dr.isBefore(e,r.computedData.constraint_date))&&(e=dr.clone(r.computedData.constraint_date)),0==r.level()&&(null==e||r.computedData.start_date&&dr.isBefore(e,r.computedData.start_date))&&(e=dr.clone(r.computedData.start_date));var l=r.getStartDateByRelations(),i=ir(l,2),d=i[0],p=i[1];if(d)(null==e||p&&dr.isBefore(e,p))&&(e=dr.clone(p));else return[!1,null,t];r=r.parent}var c=this.getStartDateByRelations(),u=ir(c,2),h=u[0],m=u[1];if(!h)return[!1,null,t];if((null==e||e&&m&&dr.isAfter(m,e))&&(e=m),null==e&&(e=dr.clone(this.computedData.constraint_date)),null==e&&(e=dr.clone(this.owner.root().computedData.start_date)),e=this.calendar.calcNextWorkTime(e,this.data.duration),this.data.constraint_type==Bi.NOT_EARLIER_THAN&&dr.isBefore(e,this.computedData.constraint_date)&&(e=dr.clone(this.computedData.constraint_date)),e){var g=this.calendar.calcTime(e,1);e=this.calendar.calcTime(g,-1)}return[!0,e,t]}},{key:"autoRecalcTimes",value:function(){var e=this._getAutoComputedStartTime(),t=ir(e,3),a=t[0],n=t[1],s=t[2];if(a){if(this.computedData.start_date=n,this.data.start=dr.getUnix(n),this.recalcFinish(),this.hasChild()){var o=Mt.apply(Math,nl(this.leaves().map(function(e){return e.data.finish})));o!=1/0&&o!=this.data.finish&&(this.data.finish=o,this.computedData.finish_date=dr.setUnix(o),this.recalcDuration())}return this.touch(),this.reCalculated=!0,[!0,s]}return[!1,s]}},{key:"clearRelations",value:function(){this.fromRelations=[],this.toRelations=[],this.logicFromRelations=[],this.logicToRelations=[]}},{key:"shouldRemove",value:function(e){for(var t=this,a=0,n;a<this.fromRelations.length;a++)n=this.fromRelations[a],null==e[n.from.idx]&&(n.from.toRelations=n.from.toRelations.filter(function(e){return e.to!=t}));for(var s=0,o;s<this.toRelations.length;s++)o=this.toRelations[s],null==e[o.to.idx]&&(o.to.fromRelations=o.to.fromRelations.filter(function(e){return e.from!=t}));this.calendar.delTask(this)}},{key:"toCopyData",value:function(){var e=this.fromRelations.map(function(e){return{id:e.from.data.id,type:e.type,lag:e.lag}}),t=this.toRelations.map(function(e){return{id:e.to.data.id,type:e.type,lag:e.lag}}),a=this.parent;return null!=a&&(a=a.data.id),Ao({taskData:this.data,fromData:e,toData:t,parent:a})}},{key:"calcCritical",value:function(){if(!this.calcedCritical&&!this.hasChild()){for(var e=[],t=this;t;){for(var a=0;a<t.fromRelations.length;a++)e.push(t.fromRelations[a]);for(var n=0;n<t.logicFromRelations.length;n++)e.push(t.logicFromRelations[n]);t=t.parent}if(0==e.length)this.isCritical=!0,this.calcedCritical=!0;else{for(var s=[],o=0;o<e.length;o++){var r=e[o],l=null;l="S"==r.type.charAt(0)?this.calendar.calcTime(r.from.computedData.start_date,r.lag):this.calendar.calcTime(r.from.computedData.finish_date,r.lag);var d=null;d="S"==r.type.charAt(1)?this.computedData.start_date:this.computedData.finish_date,0==this.calendar.calcDuration(l,d)&&s.push(r.from)}for(var p=0;p<s.length;p++)s[p].calcCritical();this.isCritical=0<s.length,this.isCritical||this.data.constraint_type!=Bi.NOT_EARLIER_THAN||this.data.start!=this.data.constraint_date||(this.isCritical=!0),this.calcedCritical=!0}}}},{key:"addPertPredot",value:function(){var e=new xi;this.owner.dots.push(e),e.time=dr.clone(this.computedData.start_date),e.addOutTask(this),e.id=10*this.idx}},{key:"addPertPostdot",value:function(){var e=new xi;this.owner.dots.push(e),e.time=dr.clone(this.computedData.finish_date),e.addInTask(this),e.id=10*this.idx+1}},{key:"isShowInPert",value:function(){var e=this.isShow;if(this.owner.isPertWithoutParent()){var t=this.next();e=e&&(!t||t.level()<=this.level()||!t.isShow)}return e}},{key:"_updateShowingRelationsV1",value:function(){var e=this;if(this.hasChild()){for(var t=new Al,a=new Al,n=this.leaves(),s=0,o;s<n.length;s++){if(o=n[s],o.data.start==this.data.start)for(var r=0,l;r<o.logicFromRelations.length;r++)if(l=o.logicFromRelations[r],l.from.isShowInPert()){for(var d=l.from;null!=d&&!(d.isShowInPert()||d==this);)d=d.parent;d!=this&&d.data.finish==l.from.data.finish&&t.add(d.idx+","+l.type+","+l.lag)}if(o.data.finish==this.data.finish)for(var p=0,c;p<o.logicToRelations.length;p++)if(c=o.logicToRelations[p],c.to.isShowInPert()){for(var u=c.to;null!=u&&!(u.isShowInPert()||u==this);)u=u.parent;u!=this&&u.data.start==c.to.data.start&&a.add(u.idx+","+c.type+","+c.lag)}}t.forEach(function(t){var a=t.split(","),n=ir(a,3),s=n[0],o=n[1],r=n[2];s=$a(s),r=$a(r);var l=e.owner.rows[s],i=new Ri(l,e,r,o);e.showingFromRelations.push(i),l.showingToRelations.push(i)}),a.forEach(function(t){var a=t.split(","),n=ir(a,3),s=n[0],o=n[1],r=n[2];s=$a(s),r=$a(r);var l=e.owner.rows[s],i=new Ri(e,l,r,o);e.showingToRelations.push(i),l.showingFromRelations.push(i)})}else{for(var h=0,m;h<this.logicFromRelations.length;h++)m=this.logicFromRelations[h],m.from.isShowInPert()&&this.showingFromRelations.push(m);for(var g=0,f;g<this.logicToRelations.length;g++)f=this.logicToRelations[g],f.to.isShowInPert()&&this.showingToRelations.push(f)}}},{key:"updateShowingRelations",value:function(){if(this.owner.isPertWithoutParent())this._updateShowingRelationsV1();else{for(var e=0,t;e<this.fromRelations.length;e++)t=this.fromRelations[e],t.from.isShowInPert()&&this.showingFromRelations.push(t);for(var a=0,n;a<this.toRelations.length;a++)n=this.toRelations[a],n.to.isShowInPert()&&this.showingToRelations.push(n)}}},{key:"setPertRow",value:function(e){var t=e-this.pertRow;if(0<=this.pertRow){this.pertRow==this.pertPredot.pertRow&&(this.pertPredot.pertRow=e);for(var a=0,n;a<this.pertPredot.outPertRelations.length;a++)n=this.pertPredot.outPertRelations[a],n.task==this&&-1!=n.pertRow&&n.setPertRow(n.pertRow+t);this.pertRow==this.pertPostdot.pertRow&&(this.pertPostdot.pertRow=e);for(var s=0,o;s<this.pertPostdot.outPertRelations.length;s++)o=this.pertPostdot.outPertRelations[s],o.task==this&&-1!=o.pertRow&&o.setPertRow(o.pertRow+t)}this.pertRow=e;for(var r=0,l;r<this.pertTasks.length;r++)l=this.pertTasks[r],l.setPertRow(l.pertRow+t)}},{key:"addPertRowDots",value:function(e,t){this.pertRowsDots[e]?(t[0]&&this.pertRowsDots[e][0]&&t[0].time.getTime()<this.pertRowsDots[e][0].time.getTime()&&(this.pertRowsDots[e][0]=t[0]),t[1]&&this.pertRowsDots[e][1]&&t[1].time.getTime()>this.pertRowsDots[e][1].time.getTime()&&(this.pertRowsDots[e][1]=t[1])):(t[0].time.getTime()>this.pertPredot.time.getTime()&&(t[0]=this.pertPredot),t[1].time.getTime()<this.pertPostdot.time.getTime()&&(t[1]=this.pertPostdot),this.pertRowsDots[e]=t)}},{key:"getMsTask",value:function(){return this.owner.datasource.getMsTask(this.data.id)}},{key:"isDiff",value:function(){if(this.owner.isFromMsProject()){var e=this.getMsTask();return null!=e&&(e.finish!=this.data.finish||e.start!=this.data.start||e.duration!=this.data.duration)}return!1}},{key:"isMarked",value:function(){return this.marked}},{key:"dispatchFromRelationsToLeaves",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=this.fromRelations.concat(t),n=this.next();if(n&&n.level()>this.level())for(;n&&n.level()>this.level();)n=n.fromRelations.some(function(t){return t.from.parent==e})?n.dispatchFromRelationsToLeaves():n.dispatchFromRelationsToLeaves(a);else{this.logicFromRelations=[];for(var s=function(a){var n=t[a],s=n.to.leaves(),o=s[0].idx,r=s[s.length-1].idx;e.fromRelations.some(function(e){return e.from.idx>=o&&e.from.idx<=r})||e.logicFromRelations.push(n)},o=0;o<t.length;o++)s(o);this.logicFromRelations=this.logicFromRelations.concat(this.fromRelations)}return n}},{key:"clearLogicRelations",value:function(){this.logicFromRelations=[],this.logicToRelations=[]}},{key:"getSortedDots",value:function(){return[this.pertPredot,this.pertPostdot]}},{key:"onDblClick",value:function(){this.owner.fastPullIn(this)}}]),t}(jl),Yi=function(e){function t(){return hn(this,t),wo(this,(t.__proto__||cn(t)).apply(this,arguments))}return Eo(t,e),yn(t,[{key:"prevCol",value:function e(t){var a=this.cols[t],n=1;if((this.owner.isShowGantt()||this.owner.isShowCompareDiff())&&(n=2),a>n){var e=this.data[a-1];return e?e:null}return null}},{key:"allVisibleCol",value:function(){if(this.owner.isShowGantt()||this.owner.isShowCompareDiff()){var e=this.cols.partition;return this.data.filter(function(t,a){return a!=e})}return this.data}},{key:"getAddHeadNames",value:function(){for(var e=[],t=0,a;t<this.data.length;t++)a=this.data[t],a.name.startsWith("addcol-")&&e.push(a.head_name);return e}},{key:"getAddNames",value:function(){for(var e=[],t=0,a;t<this.data.length;t++)a=this.data[t],a.name.startsWith("addcol-")&&e.push(a.name);return e}},{key:"addColumn",value:function(e,t,a,n){var s=this.getAddNames(),o="addcol-";return o+=n&&""!=n?n:s.length.toString(),s.some(function(e){return e==o})?null:(e&&""!=e||(e="\u81EA\u5B9A\u4E49\u5217"+s.length),"text"!=t&&"number"!=t&&"date"!=t&&(t="text"),a=$a(a),$o(a)&&(a=35),this.data.push({name:o,type:t,width:a+"px",readonly:!1,head_name:e}),this.cols[o]=this.data.length-1,o)}},{key:"setReadonlyStatus",value:function(e,t){if(!0!=t&&(t=!1),"index"!=e){var a=this.getByName(e);a&&(a.readonly=t)}}}]),t}(Wl),qi={m:"\u5206\u949F\u5DE5\u65F6",em:"\u5206\u949F",h:"\u5DE5\u65F6",eh:"\u5C0F\u65F6",d:"\u4E2A\u5DE5\u4F5C\u65E5",ed:"\u5929",w:"\u5468\u5DE5\u65F6",ew:"\u5468",mo:"\u6708\u5DE5\u65F6",emo:"\u6708"},Gi=function(){function e(t){hn(this,e),this.oldData=JSON.parse(t),this.isConverted=!1,this.isFromMsProject=!1,this.messages=[]}return yn(e,[{key:"generate",value:function(){var e={};return 1==this.oldData.version?(e=this.convertToV2(this.oldData),this.isConverted=!0):"msproject"==this.oldData.version?(e=this.convertMsProjectToV2(this.oldData),this.isConverted=!0,this.isFromMsProject=!0):e=this.oldData,this._updateMilestoneType(e),this._setDefaultValue(e),e}},{key:"_setDefaultValue",value:function(e){for(var t=0,a;t<e.tasks.length;t++)a=e.tasks[t],a.unit=a.unit||"",a.price=a.price||0}},{key:"getConvertedMsTasks",value:function(){if("msproject"==this.oldData.version){for(var e={},t=0,a;t<this.oldData.tasks.length;t++)if(a=this.oldData.tasks[t],a){var n=/^(\d+.?\d+)([dehmwo]+)$/.exec(a.duration_str),s=n[1],o=qi[n[2]];e[a.id]={id:a.id,name:a.name,type:a.type,level:a.level,start:a.start/1e3+28800,finish:a.finish/1e3+28800,depends:a.depends,duration:a.duration,durationStr:s+o}}return e}return null}},{key:"_updateMilestoneType",value:function(e){for(var t=1,a;t<e.tasks.length;t++)a=e.tasks[t],a.type!=Vi.WORKAPSCE&&(a.type=0==a.duration?Vi.MILESTONE:Vi.WORK)}},{key:"convertToV2",value:function(e){var t={version:2,task_id_seq:e.task_id_seq,tasks:e.tasks,readonly:!1,plan_type:Ui.ZPLAN,timezone_offset:-28800,default_calendar_id:0,calendars:[{id:0,name:"\u9ED8\u8BA4\u65E5\u5386",rules:[],times:[{start:28800,end:43200},{start:46800,end:61200}],seconds:28800}],columns:ji.NORMAL,view:{show_critical:e.show_critical,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"700px",calendar_id:0},zpet:{current_time:e.current_time,progress_history:e.progress_history}};e.calendars&&e.calendars.default&&(t.calendars[0].rules=e.calendars.default),e.plan_type==Ui.ZPERT&&(t.plan_type=Ui.ZPERT),(!1==e.readonly||!0==e.readonly)&&(t.readonly=e.readonly);var a=!1;(null==t.task_id_seq||null==t.task_id_seq)&&(t.task_id_seq=0,a=!0);var n=[];if(e.views&&e.views.ZPlan){for(var s=function(a){var s=e.views.ZPlan.setting_data.columns[a];["index","partition","name","duration_days","start_date","finish_date","depends","calendar_id"].some(function(e){return e==s.name})||(t.columns.push(s),"date"==s.type&&s.name.startsWith("addcol")&&n.push(s.name))},o=0;o<e.views.ZPlan.setting_data.columns.length;o++)s(o);for(var o=0,r;o<t.columns.length;o++)r=t.columns[o],!0!=r.readonly&&!1!=r.readonly&&(r.readonly=!1);t.view.type=e.views.ZPlan.chart_data.chart_type||Oi.PERT,t.view.calendar_day_px_id=e.views.ZPlan.chart_data.calendar_day_px_id||15,t.view.splitter_pos=e.views.ZPlan.splitter_pos||"700px"}for(var l=null,d=0,p;d<t.tasks.length;d++){p=t.tasks[d],a&&(p.id=t.task_id_seq,t.task_id_seq+=1),p.duration/=3,!0!=p.partition&&(p.partition=null),p.calendar_id=0,null!=p.leave_time&&null!=p.leave_time&&(p.leave_time/=3),null==p.depends&&(p.depends=""),Wr(e.timezone_offset)||(p.start+=28800,p.finish+=28800,Wr(p.constraint_date)&&(p.constraint_date+=28800));for(var c=0,u;c<n.length;c++)if(u=n[c],p.add_column&&p.add_column[u]){var h=dr.parseDayStr(p.add_column[u]);"Invalid Date"==h.toString()?p.add_column[u]=null:(h=dr.convertToUTC(h),p.add_column[u]=dr.getUnix(h))}null==l?0==p.depends.length?(d==t.tasks.length-1||t.tasks[d+1].level<=p.level)&&(null==p.constraint_date||null==p.constraint_date)&&(p.constraint_date=p.start,p.constraint_type=4):l=p.level:p.level<=l&&(0==p.depends.length?(l=null,(d==t.tasks.length-1||t.tasks[d+1].level<=p.level)&&(null==p.constraint_date||null==p.constraint_date)&&(p.constraint_date=p.start,p.constraint_type=4)):l=p.level)}return t.tasks[0]&&(t.tasks[0].constraint_date=null,t.tasks[0].constraint_type=null),t}},{key:"_convertMsProjectHour",value:function(e){var t=e.split(":",2),a=ir(t,2),n=a[0],s=a[1];return 3600*$a(n)+60*$a(s)}},{key:"_convertMsProjectHours",value:function(e){for(var t=0,a=[],n=0;n<e.length;n++){var s=e[n],o=this._convertMsProjectHour(s.start),r=this._convertMsProjectHour(s.finish);0==r&&(r=86400),a.push({start:o,end:r}),t=t+r-o}return[a,t]}},{key:"_convertMsProjectCalendar",value:function(e,t,a){var n=this,s=[],o=["\u661F\u671F\u65E5","\u661F\u671F\u4E00","\u661F\u671F\u4E8C","\u661F\u671F\u4E09","\u661F\u671F\u56DB","\u661F\u671F\u4E94","\u661F\u671F\u516D"],r=new Al;r.add(a);for(var l=0,d;l<e.length;l++)d=e[l],Wr(d.calendar_id)&&r.add(d.calendar_id);for(var p=0,c;p<t.length;p++)if(c=t[p],!(0<p)||r.has(c.id)){r.delete(c.id);for(var u={id:c.id,name:c.name,rules:[]},h=0;h<c.days.length;h++){var m=c.days[h],g=h;0==g&&(g=7);var f={name:o[h],type:"1",start:g.toString(),finish:g.toString(),status:"1"};f.worktype=m.working?"1":"0",u.rules.push(f)}if(c.days)for(var _=1<c.days.length?1:0,y=_,v;y<c.days.length;y++)if(v=c.days[y],v.working&&v.hours){var k=this._convertMsProjectHours(v.hours),w=ir(k,2);u.times=w[0],u.seconds=w[1];break}null==u.times&&(u.times=[{start:28800,end:43200},{start:46800,end:61200}],u.seconds=28800);for(var T=0;T<c.exceptions.length;T++){var R=c.exceptions[T],D="1";R.working||(D="0"),u.rules.push({name:R.name,type:0,start:R.start,finish:R.finish,status:"1",worktype:D})}s.push(u)}r.forEach(function(e){s.push(n._createMissingCal(e))});return r.delete(0),0<r.size&&this.messages.push("\u5B58\u5728\u65E0\u6CD5\u8BFB\u53D6\u7684\u65E5\u5386"),s}},{key:"_createMissingCal",value:function(e){var t="\u7F3A\u5931\u7684\u65E5\u5386"+e,a=[{name:"\u5DE5\u4F5C\u65E5",type:"1",start:"1",finish:"7",status:"1",worktype:"1"}],n=[{start:28800,end:43200},{start:46800,end:61200}],s=28800;return 0==e&&(t="\u81EA\u7136\u65E5",a=[],n=[{start:0,end:86400}],s=86400),{id:e,name:t,rules:a,times:n,seconds:s}}},{key:"convertMsProjectToV2",value:function(e){for(var t=28800,a={version:2,readonly:!1,default_calendar_id:e.default_calendar_id,task_id_seq:null,plan_type:Ui.ZPLAN,timezone_offset:-t,tasks:[],calendars:[],columns:ji.NORMAL,view:{show_critical:!1,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"730px",calendar_id:1},zpet:{current_time:null,progress_history:null}},n=0,s=0;s<e.tasks.length;s++){var o=e.tasks[s],r=o.constraint_type,l=o.constraint_date;if(0<r?l=l/1e3+t:(r=null,l=null),0==o.level&&(r=null,l=null),o){if(o.id>n&&(n=o.id),void 0===o.name&&(void 0===o.depends||null===o.depends||""===o.depends))continue;a.tasks.push({id:o.id,name:o.name,rule:0,type:o.type,level:o.level,start:o.start/1e3+t,finish:o.finish/1e3+t,depends:o.depends,duration:o.duration,notes:o.notes,collapsed:!1,iter_type:0,partition:null,add_column:{},constraint_date:l,constraint_type:r,progress_history:null,calendar_id:o.calendar_id})}}return a.task_id_seq=n+1,a.calendars=this._convertMsProjectCalendar(e.tasks,e.calendars,e.default_calendar_id),a.view.calendar_id=a.calendars[0].id,a.columns[a.columns.length-1].options=a.calendars.map(function(e){return[e.id,e.name]}),a}}]),e}(),$i=h(function(e,t){function a(e){var t=[];for(var a in e)t.push(a);return t}t=e.exports="function"==typeof Object.keys?Object.keys:a,t.shim=a}),Xi=$i.shim,Zi=h(function(e,t){function a(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function n(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}var s="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();t=e.exports=s?a:n,t.supported=a,t.unsupported=n}),Ki=Zi.supported,Ji=Zi.unsupported,Qi=h(function(e){function t(e){return null===e||e===void 0}function n(e){return!!(e&&"object"==typeof e&&"number"==typeof e.length)&&"function"==typeof e.copy&&"function"==typeof e.slice&&!(0<e.length&&"number"!=typeof e[0])}function s(e,s,l){var d,p;if(t(e)||t(s))return!1;if(e.prototype!==s.prototype)return!1;if(Zi(e))return!!Zi(s)&&(e=o.call(e),s=o.call(s),r(e,s,l));if(n(e)){if(!n(s))return!1;if(e.length!==s.length)return!1;for(d=0;d<e.length;d++)if(e[d]!==s[d])return!1;return!0}try{var c=$i(e),u=$i(s)}catch(t){return!1}if(c.length!=u.length)return!1;for(c.sort(),u.sort(),d=c.length-1;0<=d;d--)if(c[d]!=u[d])return!1;for(d=c.length-1;0<=d;d--)if(p=c[d],!r(e[p],s[p],l))return!1;return typeof e==typeof s}var o=Array.prototype.slice,r=e.exports=function(e,t,a){return a||(a={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e&&t&&("object"==typeof e||"object"==typeof t)?s(e,t,a):a.strict?e===t:e==t)}}),ed=da&&da.__extends||function(e,t){function a(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},td=Object.prototype.hasOwnProperty,ad=function(e){function t(t,a,n,s,o){e.call(this,t),this.message=t,this.name=a,this.index=n,this.operation=s,this.tree=o}return ed(t,e),t}(Error),nd={hasOwnProperty:et,_objectKeys:tt,_deepClone:function(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e;}},isInteger:at,escapePathComponent:nt,unescapePathComponent:function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},_getPathRecursive:st,getPath:function(e,t){if(e===t)return"/";var a=st(e,t);if(""===a)throw new Error("Object not found in root");return"/"+a},hasUndefined:ot,PatchError:ad},sd=h(function(e,a){function n(e,t){if(""==t)return e;var a={op:"_get",path:t};return s(e,a),a.value}function s(e,s,o,l){if(void 0===o&&(o=!1),void 0===l&&(l=!0),o&&("function"==typeof o?o(s,0,e,s.path):r(s,0)),""===s.path){var i={newDocument:e};if("add"===s.op)return i.newDocument=s.value,i;if("replace"===s.op)return i.newDocument=s.value,i.removed=e,i;if("move"===s.op||"copy"===s.op)return i.newDocument=n(e,s.from),"move"===s.op&&(i.removed=e),i;if("test"===s.op){if(i.test=d(e,s.value),!1===i.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,s,e);return i.newDocument=e,i}if("remove"===s.op)return i.removed=e,i.newDocument=null,i;if("_get"===s.op)return s.value=e,i;if(o)throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,s,e);else return i}else{l||(e=nd._deepClone(e));var u=s.path||"",h=u.split("/"),m=e,g=1,f=h.length,_=void 0,y=void 0,v=void 0;for(v="function"==typeof o?o:r;;){if(y=h[g],o&&void 0===_&&(void 0===m[y]?_=h.slice(0,g).join("/"):g==f-1&&(_=s.path),void 0!==_&&v(s,0,e,_)),g++,Array.isArray(m)){if("-"===y)y=m.length;else if(o&&!nd.isInteger(y))throw new a.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,s.path,s);else nd.isInteger(y)&&(y=~~y);if(g>=f){if(o&&"add"===s.op&&y>m.length)throw new a.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,s.path,s);var i=c[s.op].call(s,m,y,e);if(!1===i.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,s,e);return i}}else if(y&&-1!=y.indexOf("~")&&(y=nd.unescapePathComponent(y)),g>=f){var i=p[s.op].call(s,m,y,e);if(!1===i.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,s,e);return i}m=m[y]}}}function o(e,t,n,o){if(void 0===o&&(o=!0),n&&!Array.isArray(t))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(e=nd._deepClone(e));for(var r=Array(t.length),l=0,d=t.length;l<d;l++)r[l]=s(e,t[l],n),e=r[l].newDocument;return r.newDocument=e,r}function r(e,t,n,s){if("object"!=typeof e||null===e||Array.isArray(e))throw new a.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);else if(!p[e.op])throw new a.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);else if("string"!=typeof e.path)throw new a.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);else if(0!==e.path.indexOf("/")&&0<e.path.length)throw new a.JsonPatchError("Operation `path` property must start with \"/\"","OPERATION_PATH_INVALID",t,e,n);else if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new a.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&e.value===void 0)throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&nd.hasUndefined(e.value))throw new a.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);else if(n)if("add"==e.op){var o=e.path.split("/").length,r=s.split("/").length;if(o!==r+1&&o!==r)throw new a.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==s)throw new a.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n);}else if("move"===e.op||"copy"===e.op){var i={op:"_get",path:e.from,value:void 0},d=l([i],n);if(d&&"OPERATION_PATH_UNRESOLVABLE"===d.name)throw new a.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function l(e,t,n){try{if(!Array.isArray(e))throw new a.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)o(nd._deepClone(t),nd._deepClone(e),n||!0);else{n=n||r;for(var s=0;s<e.length;s++)n(e[s],s,t,void 0)}}catch(t){if(t instanceof a.JsonPatchError)return t;throw t}}var i={strict:!0},d=function(e,t){return Qi(e,t,i)};a.JsonPatchError=nd.PatchError,a.deepClone=nd._deepClone;var p={add:function(e,t,a){return e[t]=this.value,{newDocument:a}},remove:function(e,t,a){var n=e[t];return delete e[t],{newDocument:a,removed:n}},replace:function(e,t,a){var n=e[t];return e[t]=this.value,{newDocument:a,removed:n}},move:function(e,t,a){var o=n(a,this.path);o&&(o=nd._deepClone(o));var r=s(a,{op:"remove",path:this.from}).removed;return s(a,{op:"add",path:this.path,value:r}),{newDocument:a,removed:o}},copy:function(e,t,a){var o=n(a,this.from);return s(a,{op:"add",path:this.path,value:nd._deepClone(o)}),{newDocument:a}},test:function(e,t,a){return{newDocument:a,test:d(e[t],this.value)}},_get:function(e,t,a){return this.value=e[t],{newDocument:a}}},c={add:function(e,t,a){return nd.isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:a,index:t}},remove:function(e,t,a){var n=e.splice(t,1);return{newDocument:a,removed:n[0]}},replace:function(e,t,a){var n=e[t];return e[t]=this.value,{newDocument:a,removed:n}},move:p.move,copy:p.copy,test:p.test,_get:p._get};a.getValueByPointer=n,a.applyOperation=s,a.applyPatch=o,a.applyReducer=function(e,t){var n=s(e,t);if(!1===n.test)throw new a.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,t,e);return n.newDocument},a.validator=r,a.validate=l}),od=sd.JsonPatchError,rd=sd.deepClone,ld=sd.getValueByPointer,dd=sd.applyOperation,pd=sd.applyPatch,cd=sd.applyReducer,ud=sd.validator,hd=sd.validate,md=sd,gd=md.applyOperation,fd=md.applyPatch,_d=md.applyReducer,yd=md.getValueByPointer,vd=md.validate,kd=md.validator,wd=nd,Td=wd.PatchError,Rd=wd._deepClone,Dd=wd.escapePathComponent,xd=wd.unescapePathComponent,Cd=new WeakMap,Sd=function(){return function(e){this.observers=new Map,this.obj=e}}(),bd=function(){return function(e,t){this.callback=e,this.observer=t}}(),Pd={applyOperation:gd,applyPatch:fd,applyReducer:_d,getValueByPointer:yd,validate:vd,validator:kd,JsonPatchError:Td,deepClone:Rd,escapePathComponent:Dd,unescapePathComponent:xd,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var a=rt(e),n;if(!a)a=new Sd(e),Cd.set(e,a);else{var s=lt(a,t);n=s&&s.observer}if(n)return n;if(n={},a.value=nd._deepClone(e),t){n.callback=t,n.next=null;var o=function(){dt(n)},r=function(){clearTimeout(n.next),n.next=setTimeout(o)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",r),window.addEventListener("keyup",r),window.addEventListener("mousedown",r),window.addEventListener("keydown",r),window.addEventListener("change",r)):(document.documentElement.attachEvent("onmouseup",r),document.documentElement.attachEvent("onkeyup",r),document.documentElement.attachEvent("onmousedown",r),document.documentElement.attachEvent("onkeydown",r),document.documentElement.attachEvent("onchange",r)))}return n.patches=[],n.object=e,n.unobserve=function(){dt(n),clearTimeout(n.next),it(a,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",r),window.removeEventListener("keyup",r),window.removeEventListener("mousedown",r),window.removeEventListener("keydown",r)):(document.documentElement.detachEvent("onmouseup",r),document.documentElement.detachEvent("onkeyup",r),document.documentElement.detachEvent("onmousedown",r),document.documentElement.detachEvent("onkeydown",r)))},a.observers.set(t,new bd(t,n)),n},generate:dt,compare:function(e,t){var a=[];return pt(e,t,a,""),a}},Ed={default:0,iframe:1,client:2,console:3},zd=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Ed.default;hn(this,e),this.type=t}return yn(e,[{key:"pub",value:function(e){Ed.iframe==this.type?this.iframePub(e):Ed.client==this.type?this.clientPub(e):Ed.console==this.type&&this.consolePub(e)}},{key:"iframePub",value:function(e){var t=document.querySelector("#origin_tag").value;window.parent.postMessage(e,t)}},{key:"clientPub",value:function(e){window.cefQuery({request:e,persistent:!1,onSuccess:function(){},onFailure:function(){}})}},{key:"consolePub",value:function(e){console.log(e)}}]),e}(),Id=function(){function e(t,a){hn(this,e),this.project=t,this.originData=a;var n=new Gi(a);this.currentData=n.generate(),this.isFromMsProject=n.isFromMsProject,this.isFromMsProject&&(this.msTasks=n.getConvertedMsTasks()),n.messages.forEach(function(e){t.addErrorMessage(e)}),this.ob=Pd.observe(this.currentData),this.shouldSave=n.isConverted,this.patchDatas=[],this.currentPatchIndex=-1,this.baseData=null,this.lastData=null,this.publisher=null}return yn(e,[{key:"getTaskIdSeq",value:function(){return this.currentData.task_id_seq}},{key:"getNextTaskId",value:function(){return this.currentData.task_id_seq++}},{key:"getTasks",value:function(){return this.currentData.tasks}},{key:"getResKinds",value:function(){return this.currentData.res_kinds}},{key:"updateTasks",value:function(e){this.currentData.tasks=e}},{key:"getColumns",value:function(){return this.currentData.columns}},{key:"getCalendars",value:function(){return this.currentData.calendars}},{key:"addCalendar",value:function(e){this.currentData.calendars.push(e)}},{key:"getDefaultCalendarId",value:function(){var e=this.currentData.default_calendar_id;return(null==e||null==e)&&(e=this.currentData.calendars[0].id),e}},{key:"getProjectReadonly",value:function(){return this.currentData.readonly}},{key:"getViewConfig",value:function(){return this.currentData.view}},{key:"getZpetConfig",value:function(){return this.currentData.zpet}},{key:"getTimezoneOffset",value:function(){return this.currentData.timezone_offset}},{key:"startObserve",value:function(){null==this.ob&&(this.ob=Pd.observe(this.currentData));var e=Pd.generate(this.ob);0<e.length&&(this.shouldSave=!0),null==this.baseData&&(this.baseData=Ao(this.currentData),this.lastData=this.baseData)}},{key:"shouldLayout",value:function(e){for(var t=!0,a=0;a<e.length;a++){var n=e[a].op,s=e[a].path.split("/");if("tasks"==s[1]){if("add"==n||"remove"==n){this.project.shouldUpdateLayout=!0,this.project.shouldCalcCritical=!0,this.project.shouldRescore=!0,this.project.shouldUpdateLogicRelations=!0;break}var o=s[s.length-1];if("level"==o||"depends"==o){this.project.shouldUpdateLayout=!0,this.project.shouldCalcCritical=!0,this.project.shouldRescore=!0,this.project.shouldUpdateLogicRelations=!0;break}t&&("id"==o||"start"==o||"finish"==o||"duration"==o||"partition"==o?(this.project.shouldUpdateLayout=!0,this.project.shouldCalcCritical=!0,this.project.shouldRescore=!0,t=!1):("collapsed"==o||"progress_history"==o)&&(this.project.shouldUpdateLayout=!0,this.project.shouldCalcCritical=!0,t=!1))}}}},{key:"addUndoData",value:function(){var e=Pd.generate(this.ob);if(0<e.length){this.shouldLayout(e),this.currentPatchIndex+=1;var t=null;this.project.currentRow&&(t=this.project.currentRow.idx),this.patchDatas[this.currentPatchIndex]=[Ao(e),t],this.patchDatas=this.patchDatas.slice(0,this.currentPatchIndex+1);var a=Ao(this.currentData);this.pubTaskChange(this.lastData,a),this.lastData=a,this.shouldSave=!0}}},{key:"undo",value:function(){if(0<=this.currentPatchIndex){for(var e=JSON.parse(this.baseData),t=null,a=0;a<this.currentPatchIndex;a++){var n=ir(this.patchDatas[a],2),s=n[0],o=n[1];t=o,e=Pd.applyPatch(e,JSON.parse(s)).newDocument}this.ob.unobserve(),this.ob=null;var r=Ao(this.currentData),l=Ao(e);return this.pubTaskChange(r,l),this.lastData=l,this.currentData=e,this.currentPatchIndex-=1,this.shouldSave=!0,[!0,t]}return[!1,null]}},{key:"redo",value:function(){if(0<this.patchDatas.length&&this.patchDatas.length-1>this.currentPatchIndex){this.currentPatchIndex+=1;var e=ir(this.patchDatas[this.currentPatchIndex],2),t=e[0],a=e[1],n=Ao(this.currentData);Pd.applyPatch(this.currentData,JSON.parse(t));var s=Ao(this.currentData);return this.pubTaskChange(n,s),this.lastData=s,Pd.generate(this.ob),this.shouldSave=!0,[!0,a]}return[!1,null]}},{key:"fallback",value:function(){this.ob.unobserve(),this.ob=null,this.currentData=JSON.parse(this.lastData)}},{key:"addPublisher",value:function(e){this.publisher=new zd(e)}},{key:"compareTaskColumns",value:function(e,t,a){for(var n={},s=0,o;s<e.length;s++)o=e[s],a[o]!=t[o]&&(n[o]=a[o]);var r=Ao(t.add_column),l=Ao(a.add_column);return l!=r&&(n.add_column=a.add_column),n}},{key:"pubTaskChange",value:function(e,t){if(this.publisher){e=JSON.parse(e),t=JSON.parse(t);for(var a=[],n={},s=["id","name","level","collapsed","start","finish","duration","depends","type","rule","iter_type","constraint_type","constraint_date","partition","idx"],o=0,r;o<e.tasks.length;o++)r=e.tasks[o],r.idx=o,n[r.id]=r;for(var l=0,d;l<t.tasks.length;l++)if(d=t.tasks[l],d.idx=l,n[d.id]){var p=this.compareTaskColumns(s,n[d.id],d);0<Ti(p).length&&(p.id=d.id,p.idx=d.idx,a.push({op:"update",data:p})),n[d.id]=null}else a.push({op:"add",data:d});for(var c=$l(n),u=0;u<c.length;u++){var h=ir(c[u],2),m=h[0],g=h[1];g&&a.push({op:"delete",data:g})}if(0<a.length){this.publisher.pub(Ao({type:"task_change",data:a}))}}}},{key:"createNewTask",value:function(e,t,a,n){var s={id:this.getNextTaskId(),calendar_id:this.project.defaultCalendarId,name:"",rule:0,type:0,level:e,start:t,finish:a,depends:"",duration:n,collapsed:!1,iter_type:0,partition:null,unit:"",price:"",add_column:{},constraint_date:null,constraint_type:null,progress_history:null};return s}},{key:"save",value:function(){this.shouldSave=!1;var e="";return this.getViewConfig().type==Oi.COMPARE_DIFF?(this.getViewConfig().type=Oi.PERT,e=Ao(this.currentData),this.getViewConfig().type=Oi.COMPARE_DIFF):e=Ao(this.currentData),e}},{key:"getMsTask",value:function(e){return this.msTasks[e]}}]),e}(),Ld=function(){function e(t,a,n,s,o,r,l){hn(this,e),this.id=r,this.pertPredot=t,this.pertPostdot=a,this.lagDays=n,this.lag=s,this.type=o,this.pertPredot.outPertRelations.push(this),this.pertPostdot.inPertRelations.push(this),this.pertRow=-1,this.isShow=!0,this.pertTasks=[],this.pertRowsDots=[],this.task=l}return yn(e,[{key:"setPertRow",value:function(e){this.pertRow=e}},{key:"getSortedDots",value:function(){return this.pertPredot.time.getTime()>this.pertPostdot.time.getTime()?[this.pertPostdot,this.pertPredot]:[this.pertPredot,this.pertPostdot]}},{key:"getTimeRange",value:function(){return this.pertPredot.time.getTime()>this.pertPostdot.time.getTime()?[this.pertPostdot.time.getTime(),this.pertPredot.time.getTime()]:[this.pertPredot.time.getTime(),this.pertPostdot.time.getTime()]}}]),e}(),Ad=function(){function e(t){hn(this,e),this.targetTask=t,this.tasks=[],this.partitions=[],this.level=0,this.rowNum=0,this.startPertRow=0,this.finishPertRow=0}return yn(e,[{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"addPartition",value:function(e){this.partitions.push(e),e.level=this.level+1}},{key:"getName",value:function(){return this.targetTask.getValue("name")}},{key:"_layoutItem",value:function(e,t,a,n){for(var s=e.getSortedDots(),o;a-t<n.length;a++){o=n[a-t],o||console.log("maybe a bug");for(var r=!1,l=0;l<o.length;l++){var i=o[l],d=i.getSortedDots();if(s[1]==d[0]||s[0]==d[1]||s[0].time.getTime()>d[1].time.getTime()||s[1].time.getTime()<d[0].time.getTime())continue;else{r=!0;break}}if(!r){e.pertRow=a,o.push(e);break}}return-1==e.pertRow&&(e.pertRow=a,n[a-t]=[e]),a}},{key:"_layoutDotV1",value:function(e,t,a,n,s){for(var o=this,r=n,l=[],d=[],p=function(n){var i=e.outPertRelations[n];if(t.includes(i))if(-1!=i.pertRow)0<i.lag&&l.push(i.pertRow);else if(i.pertPostdot.inTasks.some(function(e){return-1<e.pertRow})||i.pertPostdot.outTasks.some(function(e){return-1<e.pertRow})){r=o._layoutItem(i,a,a+s.length,s);var p=o._layoutDotV1(i.pertPostdot,t,a,r,s);if(0<=i.lag){if(null!=p[0]&&r!=p[0]){var c=r-a;s[c]=s[c].filter(function(e){return e!=i}),i.pertRow=-1,r=o._layoutItem(i,a,p[0],s),c=r-a,s[c].push(i)}0<i.lag&&l.push(i.pertRow)}}else d.push(i)},c=0;c<e.outPertRelations.length;c++)p(c);for(var u=function(n){var i=e.outTasks[n];if(t.includes(i)){if(-1==i.pertRow){r=o._layoutItem(i,a,a+s.length,s);var d=o._layoutDotV1(i.pertPostdot,t,a,r,s);if(null!=d[0]&&r!=d[0]){var p=r-a;s[p]=s[p].filter(function(e){return e!=i}),i.pertRow=-1,r=o._layoutItem(i,a,d[0],s),p=r-a,s[p].push(i)}}l.push(i.pertRow)}},c=0;c<e.outTasks.length;c++)u(c);for(var h=function(e){var n=d[e];if(t.includes(n)){if(-1==n.pertRow){0>n.lag&&(r+=1),r=o._layoutItem(n,a,a+s.length,s);var i=o._layoutDotV1(n.pertPostdot,t,a,r,s);if(0<=n.lag&&null!=i[0]&&r!=i[0]){var p=r-a;s[p]=s[p].filter(function(e){return e!=n}),n.pertRow=-1,r=o._layoutItem(n,a,i[0],s),p=r-a,s[p].push(n)}}0<n.lag&&l.push(n.pertRow)}},c=0;c<d.length;c++)h(c);return l.sort()}},{key:"_getLayoutItems",value:function(){for(var e=[],t=0,a;t<this.tasks.length;t++){a=this.tasks[t];for(var n=0,s;n<a.pertPredot.inPertRelations.length;n++)s=a.pertPredot.inPertRelations[n],-1==s.pertRow&&e.push(s);e.push(a);for(var o=0,r;o<a.pertPostdot.inPertRelations.length;o++)r=a.pertPostdot.inPertRelations[o],-1==r.pertRow&&e.push(r)}return e}},{key:"_getItemsHeadDots",value:function(e){for(var t=new Al,a=0;a<e.length;a++){for(var n=e[a],s=!0,o=0;o<n.pertPredot.inTasks.length;o++)e.includes(n.pertPredot.inTasks[o])&&(s=!1);for(var r=0;r<n.pertPredot.inPertRelations.length;r++)e.includes(n.pertPredot.inPertRelations[r])&&(s=!1);s&&t.add(n.pertPredot)}return t}},{key:"_layoutedRowRange",value:function(e){for(var t=[],a=0,n;a<e.length;a++)n=e[a].getSortedDots(),t.push(n[0]),t.push(n[1]);return 0<t.length&&(t=t.sort(function(e,t){return e.time.getTime()-t.time.getTime()}),t=[t[0],t[t.length-1]]),t}},{key:"_reduceLayoutedRows",value:function(e,t){for(var a=[[]],n=[],s=0,o;s<t.length;s++)if(o=t[s],0<o.length){var r=this._layoutedRowRange(o);if(0==n.length||r[1]==n[0]||r[0]==n[1]||r[1].time.getTime()<n[0].time.getTime()||r[0].time.getTime()>n[1].time.getTime()){var l;(l=n).push.apply(l,nl(r)),n=n.sort(function(e,t){return e.time.getTime()-t.time.getTime()}),n=[n[0],n[n.length-1]]}else a.push([]),n=r,e+=1;for(var d=a[a.length-1],p=0,c;p<o.length;p++)c=o[p],c.pertRow=e,d.push(c)}return a}},{key:"autoLayoutV1",value:function(e){var t=this,a=this._getLayoutItems(),n=this._getItemsHeadDots(a),s=[],o=e;return n.forEach(function(n){var r=t._layoutDotV1(n,a,o,e,s);0<r.length&&(e=r[r.length-1]+1)}),s=this._reduceLayoutedRows(o,s),o+s.length}}]),e}(),Md=function e(t){hn(this,e),this.task=t,this.index=-1,this.lowLink=-1,this.onStack=!1,this.visited=!1,this.toRelations=[]},Fd=function(){function e(t,a){hn(this,e),this.fromTask=t.task,this.toTask=a.task,this.from=t,this.to=a}return yn(e,[{key:"clone",value:function(){var t=new e(this.from,this.to);return t.fromTask=this.fromTask,t.toTask=this.toTask,t}}]),e}(),Od=function(){function e(t){hn(this,e),this.tasks=t,this.dots=[],this.leaves=[],this.result={}}return yn(e,[{key:"reset",value:function(){this.result={},this.index=0,this.stack=[],this.errorDepends=[],this.components=[],this.dots=[],this.leaves=[];for(var e=0;e<this.tasks.length;e++){var t=this.tasks[e],a=new Md(t);this.dots.push(a),t.hasChild()||this.leaves.push(a)}for(var n=0;n<this.tasks.length;n++){var s=this.tasks[n],o=this.dots[s.idx],r=[s];s.hasChild()&&(r=s.leaves());for(var l=0;l<s.toRelations.length;l++){var d=s.toRelations[l],p=d.to,c=this.dots[p.idx],u=new Fd(o,c),h=[p];p.hasChild()&&(h=p.leaves());for(var g=0,f;g<r.length;g++){f=r[g];for(var _=0;_<h.length;_++){var y=h[_],v=u.clone();v.from=this.dots[f.idx],v.to=this.dots[y.idx],v.from.toRelations.push(v)}}}}}},{key:"stronglyConnect",value:function(e){e.index=this.index,e.lowLink=this.index,this.index+=1,this.stack.push(e),e.onStack=!0;for(var t=0;t<e.toRelations.length;t++){var a=e.toRelations[t],n=a.to;e==n&&this.components.push([e]),0>n.index?(this.stronglyConnect(n),e.lowLink=Ft(e.lowLink,n.lowLink)):n.onStack&&(e.lowLink=Ft(e.lowLink,n.index))}if(e.lowLink==e.index){var s=[],o=null;do o=this.stack.pop(),o.onStack=!1,s.push(o);while(o!==e);1<s.length&&this.components.push(s)}}},{key:"addResult",value:function(e,t){null==this.result[t]?(this.result[t]=new Al,this.result[t].add(e)):this.result[t].add(e)}},{key:"getCycles",value:function(){this.reset();for(var e=0,t;e<this.leaves.length;e++)t=this.leaves[e],0>t.index&&this.stronglyConnect(t);for(var a=0;a<this.components.length;a++)for(var n=this.components[a],s=n.length-1,o=0,r;o<n[s].toRelations.length;o++)r=n[s].toRelations[o],0==s?n[s].task.idx==r.to.task.idx&&this.addResult(r.fromTask.idx,r.toTask.idx):this.addResult(r.fromTask.idx,r.toTask.idx);return this.result}},{key:"hasCycles",value:function(){return this.getCycles(),0<Ti(this.result).length}}]),e}(),Ud={DATE_TYPE:"0",WEEK_TYPE:"1",MONTH_TYPE:"2",YEAR_TYPE:"3"},Nd=function(){function e(t){hn(this,e),this.project=t}return yn(e,[{key:"_getZpertDaysV1",value:function(e){for(var t=0,a=new Date(Date.UTC(1980,0,1,0,0,0)),n=[],s=[],o=0,r;t<22400;)r=1,0<=e.getDateType(a)&&(r=0),s.push(r),t+=1,o+=1,dr.addDays(a,1),32==o&&(n.push($a(s.reverse().join(),2)),s=[],o=0);return n}},{key:"convertToPertV1",value:function(){var e=new this.project.constructor;e.pertLayoutVersion=Ni.WITHOUT_PARENT_TASK;for(var t=JSON.parse(this.project.datasource.save()),a=0;a<t.tasks.length;a++){var n=t.tasks[a],s=this.project.calendars[this.project.defaultCalendarId];Wr(n.calendar_id)&&(s=this.project.calendars[n.calendar_id]),n.duration=86400*n.duration/s.getDaySeconds(),n.duration=Ut(n.duration);var o=new Date(this.project.rows[a].computedData.start_date),r=s.getMinStartSeconds();dr.getSecondsOfDay(o)==r&&(n.constraint_date==n.start&&(n.constraint_date-=r),n.start-=r)}for(var l=0,d;l<t.calendars.length;l++)d=t.calendars[l],d.times=[{start:0,end:86400}],d.seconds=86400;t.plan_type=Ui.ZPERT,t.view.type=Oi.PERT,e.load(Ao(t));for(var p=[],c=[],u=0,h;u<e.dots.length;u++){h=e.dots[u],p.push({id:h.id,row:h.pertRow});for(var m=0,g;m<h.outPertRelations.length;m++)g=h.outPertRelations[m],c.push({id:g.id,pert_postdot:g.pertPostdot.id,pert_predot:g.pertPredot.id,pert_row:g.pertRow,lag:g.lag,type:g.type})}for(var f=[],_=0;_<e.rows.length;_++){var y=e.rows[_],v=JSON.parse(Ao(y.data));v.pert_row=y.pertRow,v.start+=e.timezoneOffset,v.finish+=e.timezoneOffset,Wr(v.constraint_date)&&(v.constraint_date+=e.timezoneOffset),y.pertPredot&&(v.pert_predot=y.pertPredot.id),y.pertPostdot&&(v.pert_postdot=y.pertPostdot.id),f.push(v)}var k=[];if(1<e.partitions.length)for(var w=0,T;w<e.partitions.length;w++)T=e.partitions[w],k.push({name:T.getName(),tasks:T.tasks.map(function(e){return e.getValue("id")}),pert_row:T.finishPertRow});return Ao({version:1,task_id_seq:e.datasource.getTaskIdSeq(),dots:p,pert_links:c,tasks:f,partitions:k,calendar_data:this._getZpertDaysV1(e.defaultCalendar())})}},{key:"exportPertV1",value:function(){var e=this.project.rows[0].data.name,t=new Blob([this.convertToPertV1()],{type:"text/plain;charset=utf-8"});gi.saveAs(t,e+".zpet",!0)}},{key:"_convertZpertRuleTypeAndTimesV2",value:function(e,t,a){return"0"==e?(t=dr.parseDayStr(t),t=dr.convertToUTC(t),a=dr.parseDayStr(a),a=dr.convertToUTC(a),[dr.getUnix(t),dr.getUnix(a)+86400]):"1"==e?["7"==t?0:$a(t),"7"==a?0:$a(a)]:"2"==e?[$a(t),$a(a)]:"3"==e?[100*Wo(t),100*Wo(a)]:void 0}},{key:"convertToPertV2",value:function(){for(var e=this,t=this.project.datasource.getCalendars(),a=[],n=0,s;n<t.length;n++)s=t[n],a.push({id:s.id,name:s.name,work_periods:s.times.map(function(e){return[e.start,e.end]}),vacation_rules:s.rules.map(function(t){var a=e._convertZpertRuleTypeAndTimesV2(t.type,t.start,t.finish),n=ir(a,2),s=n[0],o=n[1];return{name:t.name,type:$a(t.type),start:s,stop:o,is_vacation:"0"==t.worktype,is_valid:"1"==t.status}})});for(var o=[],r=0;r<this.project.rows.length;r++){var l=this.project.rows[r],d={id:l.data.id,name:l.data.name,type:l.isMilestone()?3:0,level:l.data.level,ask_start_time:4==l.data.constraint_type?l.data.constraint_date:0,plan_start_time:l.data.start,plan_stop_time:l.data.finish,depends:l.data.depends,duration:l.data.duration,collapsed:!0==l.data.collapsed,unit:l.data.unit,price:l.data.price,res_kind_idx:l.data.res_kind_idx,res_code:l.data.res_code,schedule_type:l.data.schedule_type};Wr(l.data.calendar_id)&&(d.calendar_id=l.data.calendar_id),o.push(d)}var p=Ao({version:2,task_id_seq:this.project.datasource.getTaskIdSeq(),default_calendar_id:this.project.defaultCalendarId,tasks:o,calendars:a,res_kinds:this.project.datasource.getResKinds()});return p}},{key:"exportPertV2",value:function(){var e=this.project.rows[0].data.name,t=new Blob([this.convertToPertV2()],{type:"text/plain;charset=utf-8"});gi.saveAs(t,e+".zpet",!0)}},{key:"_convertToExcel",value:function(){var e=["\u4EFB\u52A1\u540D\u79F0","\u5DE5\u671F","\u5F00\u59CB\u65F6\u95F4","\u5B8C\u6210\u65F6\u95F4","\u524D\u7F6E\u4EFB\u52A1"];e=e.concat(this.project.columns.getAddHeadNames());for(var t=[],a=0,n;a<e.length;a++)n=e[a],t.push({v:n});for(var s=[],o=this.project.columns.getAddNames(),r=0;r<this.project.rows.length;r++){for(var l=this.project.rows[r],d=l.getValue("level"),p=l.getValue("name"),c=" ".repeat(d)+p,u=[c,l.getValue("duration_days"),l.getValue("start_date"),l.getValue("finish_date"),l.getValue("depends")],h=0;h<o.length;h++)u.push(l.getValue(o[h]));for(var m=[],g=0,f;g<u.length;g++)f=u[g],m.push({v:f});s.push([{level:d,cols:m}])}return{header:{rows:[{cols:t}]},body:{rows:s}}}},{key:"exportExcel",value:function(){var e=this.project.rows[0].data.name;new fi(e,this._convertToExcel()).export()}},{key:"exportMsXML",value:function(){var e=this.project.rows[0].data.name,t=new Blob([this._convertToMsXML()],{type:"text/plain:charset=utf-8"});gi.saveAs(t,e+".xml")}},{key:"_xmlEncode",value:function(e){if(null==e||null==e)return"";e=e.toString();var t="";return 0==e.length?"":(t=e.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/\'/g,"&apos;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/\t/g,""),t=t.replace(/\n/g,""),t=t.replace(/\r/g,""),t)}},{key:"_formatDateForMsXML",value:function(e){var t=e.getUTCFullYear(),a=e.getUTCMonth()+1,n=e.getUTCDate(),s=e.getUTCHours(),o=e.getUTCMinutes(),r=e.getUTCSeconds(),l=t;return l+=10>a?"-0"+a:"-"+a,l+=10>n?"-0"+n:"-"+n,l+="T",l+=10>s?"0"+s:s,l+=10>o?":0"+o:":"+o,l+=10>r?":0"+r:":"+r,l}},{key:"_generateMsXMLBasicInfo",value:function(){var e=this.project.root(),t=e.getValue("name"),a=e.computedData.start_date;a=this._formatDateForMsXML(a);var n=e.computedData.finish_date;n=this._formatDateForMsXML(n);var s=new Date;return s=dr.convertToUTC(s),s=this._formatDateForMsXML(s),"<SaveVersion>9</SaveVersion><Title>"+this._xmlEncode(t)+"</Title><ScheduleFromStart>1</ScheduleFromStart><FYStartDate>1</FYStartDate>"+("<Name>"+this._xmlEncode(t)+".xml</Name><Company>\u6591\u9A6C\u8FDB\u5EA6</Company><Author>\u6591\u9A6C\u8FDB\u5EA6</Author>")+("<CreationDate>"+s+"</CreationDate>")+("<LastSaved>"+s+"</LastSaved><ScheduleFromStart>1</ScheduleFromStart>")+("<StartDate>"+a+"</StartDate>")+("<FinishDate>"+n+"</FinishDate><ProjectExternallyEdited>0</ProjectExternallyEdited><CalendarUID>1</CalendarUID>")}},{key:"_generateMsXMLWorkingTimes",value:function(e){for(var t="<WorkingTimes>",a=0;a<e.length;a++){var n=ir(e[a],2),s=n[0],o=n[1];t+="<WorkingTime><FromTime>"+s+"</FromTime>"+("<ToTime>"+o+"</ToTime></WorkingTime>")}return t+="</WorkingTimes>",t}},{key:"_generateMsXMLWeekdays",value:function(e){for(var t="<WeekDays>",a=0,n;7>a;a++)n="<WeekDay><DayType>"+(a+1)+"</DayType><DayWorking>1</DayWorking>"+e+"</WeekDay>",t+=n;return t+="</WeekDays>",t}},{key:"_getExceptionData",value:function(e){if(e.getValue("type")==Ud.DATE_TYPE){var t=dr.parseDayStr(e.getValue("start"));t=dr.convertToUTC(t);var a=dr.parseDayStr(e.getValue("finish"));return a=dr.convertToUTC(a),[{name:e.getValue("name"),type:1,fromDate:this._formatDateForMsXML(t),toDate:this._formatDateForMsXML(a),occurrences:(a.getTime()-t.getTime())/864e5+1,period:"",daysOfWeek:"",dayWorking:e.getValue("worktype"),monthDay:"",month:""}]}if(e.getValue("type")==Ud.WEEK_TYPE){for(var n=$a(e.getValue("start")),s=$a(e.getValue("finish")),o={1:2,2:4,3:8,4:16,5:32,6:64,7:1},r=o[s],l=1;n!=s;)r+=o[n],n+=1,l+=1,7<n&&(n=1);return[{name:e.getValue("name"),type:6,fromDate:"1984-01-01T00:00:00",toDate:"2049-12-31T23:29:00",occurrences:3498*l,period:1,daysOfWeek:r,dayWorking:e.getValue("worktype"),monthDay:"",month:""}]}if(e.getValue("type")==Ud.MONTH_TYPE){var i=$a(e.getValue("start")),d=$a(e.getValue("finish")),p=[];if(i==d)p.push({name:e.getValue("name"),type:4,fromDate:"1984-01-01T00:00:00",toDate:"2049-12-31T23:29:00",occurrences:792,period:1,daysOfWeek:"",dayWorking:e.getValue("worktype"),monthDay:i,month:""});else for(;i!=d;)p.push({name:e.getValue("name"),type:4,fromDate:"1984-01-01T00:00:00",toDate:"2049-12-31T23:29:00",occurrences:792,period:1,daysOfWeek:"",dayWorking:e.getValue("worktype"),monthDay:i,month:""}),i+=1,31<i&&(i=1);return p}if(e.getValue("type")==Ud.YEAR_TYPE){var c=function(){var t=e.getValue("start").split(".").map(function(e){return $a(e)}),a=ir(t,2),n=a[0],s=a[1],o=e.getValue("finish").split(".").map(function(e){return $a(e)}),r=ir(o,2),l=r[0],i=r[1],d=[];if(n==l&&s==i)d.push({name:e.getValue("name"),type:2,fromDate:"1984-01-01T00:00:00",toDate:"2049-12-31T23:29:00",occurrences:66,period:"",daysOfWeek:"",month:n,monthDay:s,dayWorking:e.getValue("worktype")});else for(;n!=l&&s!=i;)d.push({name:e.getValue("name"),type:2,fromDate:"1984-01-01T00:00:00",toDate:"2049-12-31T23:29:00",occurrences:66,period:"",daysOfWeek:"",month:n,monthDay:s,dayWorking:e.getValue("worktype")}),s+=1,[1,3,5,7,8,10,12].some(function(e){return e==n})?(31<s&&(n+=1,s=1),12<n&&(n=1)):[4,6,9,11].some(function(e){return e==n})?30<s&&(n+=1,s=1):29<s&&(s=1,n+=1);return{v:d}}();if("object"===("undefined"==typeof c?"undefined":vo(c)))return c.v}}},{key:"_generateMsXMLExceptions",value:function(e,t){for(var a="",n=0;n<e.length;n++)for(var s=e[n],o=this._getExceptionData(s),r=0;r<o.length;r++){var l=o[r],d="";"1"==l.dayWorking&&(d=t);var p="<Exception><EnteredByOccurrences>1</EnteredByOccurrences><TimePeriod><FromDate>"+l.fromDate+"</FromDate>"+("<ToDate>"+l.toDate+"</ToDate></TimePeriod>")+("<Occurrences>"+l.occurrences+"</Occurrences>")+("<Name>"+this._xmlEncode(l.name)+"</Name>")+("<Type>"+l.type+"</Type>")+("<Period>"+l.period+"</Period>")+("<DaysOfWeek>"+l.daysOfWeek+"</DaysOfWeek>")+("<DayWorking>"+l.dayWorking+"</DayWorking>")+("<MonthDay>"+l.monthDay+"</MonthDay>")+("<Month>"+l.month+"</Month>")+d+"</Exception>";a+=p}return a}},{key:"_generateMsXMLCalendars",value:function(){for(var e="<Calendars>",t=ul(this.project.calendars),a=0,n;a<t.length;a++){n=t[a],n.idx=a+1;var s=n.getName(),o=this._generateMsXMLWorkingTimes(n.getTimeRange()),r=this._generateMsXMLWeekdays(o),l=this._generateMsXMLExceptions(n.rows,o),d="<Calendar><UID>"+n.idx+"</UID>"+("<Name>"+this._xmlEncode(s)+"</Name><IsBaseCalendar>1</IsBaseCalendar>")+r+"<Exceptions>"+l+"</Exceptions></Calendar>";e+=d}return e+="</Calendars>",e}},{key:"_generateMsXMLPredecessorLink",value:function(e){for(var t="",a={FF:0,FS:1,SF:2,SS:3},n=0;n<e.length;n++){var s=e[n],o="<PredecessorLink><PredecessorUID>"+s.from.idx+"</PredecessorUID>"+("<Type>"+a[s.type]+"</Type><CrossProject>0</CrossProject>")+("<LinkLag>"+$a((s.lag/6).toString())+"</LinkLag><LagFormat>7</LagFormat></PredecessorLink>");t+=o}return t}},{key:"_generateMsXMLDuration",value:function(e){return"PT"+e/3600+"H"+e%3600/60+"M"+e%60+"S"}},{key:"_generateMsXMLTasks",value:function(e){for(var t="<Tasks>",a=0;a<this.project.rows.length;a++){var n=this.project.rows[a],s=n.getValue("constraint_type");(null==s||null==s)&&(s="");var o=n.getValue("constraint_date");null==o||null==o?o="":Wr(o)&&(o=this._formatDateForMsXML(dr.setUnix(o)),e>o&&(o=e));var r="<Task><UID>"+n.idx+"</UID>"+("<ID>"+n.idx+"</ID>")+("<OutlineLevel>"+n.getValue("level")+"</OutlineLevel><Estimated>0</Estimated>")+("<Name>"+this._xmlEncode(n.getValue("name"))+"</Name>")+("<Start>"+this._formatDateForMsXML(n.computedData.start_date)+"</Start>")+("<Finish>"+this._formatDateForMsXML(n.computedData.finish_date)+"</Finish>")+("<Duration>"+this._generateMsXMLDuration(n.getValue("duration"))+"</Duration>")+("<Milestone>"+(n.isMilestone()?1:0)+"</Milestone>")+("<ConstraintType>"+s+"</ConstraintType>")+("<CalendarUID>"+n.calendar.idx+"</CalendarUID>")+("<ConstraintDate>"+o+"</ConstraintDate>")+this._generateMsXMLPredecessorLink(n.fromRelations)+"</Task>";t+=r}return t+="</Tasks>",t}},{key:"_convertToMsXML",value:function(){var e=this.project.root(),t=e.computedData.start_date;return t=this._formatDateForMsXML(t),"<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><Project xmlns=\"http://schemas.microsoft.com/project\">"+this._generateMsXMLBasicInfo()+this._generateMsXMLCalendars()+this._generateMsXMLTasks(t)+"</Project>"}}]),e}(),Vd=function(){function e(t){hn(this,e),this.project=t,this.score=0,this.fullScore=100,this.notices={},this.markedType="",this.markedTasks=[],this.milestones=[]}return yn(e,[{key:"check",value:function(){this.score=0,this.notices={},this.markedTasks=[],this.milestones=[],this._checkCritical(),this._checkLogicRelations(),this._checkTasksLength(),this._checkTaskDurations(),this._checkOffDay(),this._checkSFRelation(),this._selectMilestone()}},{key:"_checkCritical",value:function(){this.project.isShowCritical()||(this.project.viewConfig.show_critical=!0,this.project.clearCritical(),this.project.shouldCalcCritical=!0,this.project.calcCritical());for(var e="critical",t=[],a=0,n;a<this.project.rows.length;a++)if(n=this.project.rows[a],n.isCritical){for(var s=!0,o=0;o<n.logicFromRelations.length;o++)if(n.logicFromRelations[o].from.isCritical){s=!1;break}s&&t.push(n)}t=t.sort(function(e,t){return e.data.start-t.data.start});var r=0,l="",d=[];0==t.length?l="\u6CA1\u6709\u627E\u5230\u5173\u952E\u8DEF\u7EBF":1<this.project.rows.length&&t[0].data.start==this.project.root().data.start?(r=25,l="\u8BE5\u8BA1\u5212\u5177\u6709\u5B8C\u6574\u7684\u5173\u952E\u8DEF\u5F84"):(l="\u6CA1\u6709\u8D2F\u7A7F\u8BA1\u5212\u59CB\u7EC8\u7684\u5173\u952E\u8DEF\u7EBF\uFF0C\u5DE5\u7A0B\u5DE5\u671F\u53EF\u80FD\u4E0D\u51C6\u786E\u54E6\uFF0C\u5DE5\u671F\u4F18\u5316\u548C\u5DE5\u7A0B\u8D76\u5DE5\u90FD\u8981\u56F4\u7ED5\u5173\u952E\u7EBF\u8DEF\u5F00\u5C55\u5DE5\u4F5C\uFF01\u8BE5\u8BA1\u5212\u5728\u4EE5\u4E0B\u5DE5\u4F5C\u524D\u5173\u952E\u8DEF\u7EBF\u65AD\u88C2\uFF0C\u8BF7\u6838\u67E5:",d=t),this.markedType==e&&(this.markedTasks=d),this.score+=r,this.notices.critical={type:e,title:"\u5173\u952E\u8DEF\u5F84\u5F97\u5206(\u6700\u9AD825)",maxScore:25,score:r,notice:l,tasks:d}}},{key:"_checkLogicRelations",value:function(){for(var e=this.project.root().data.start,t=this.project.root().data.finish,a=[],n=0,s=1,o;s<this.project.rows.length;s++)if(o=this.project.rows[s],!o.hasChild())if(n+=1,o.data.start==e||o.data.finish==t)continue;else(0==o.logicFromRelations.length||0==o.logicToRelations.length)&&a.push(o);var r=40,l="",d="logicRelations",p=[];0<a.length||0==n?(r=0==n?0:r-Ot(a.length/n*r),l="\u903B\u8F91\u5173\u7CFB\u7F3A\u5931\u4F1A\u5F71\u54CD\u5DE5\u7A0B\u5173\u952E\u7EBF\u8DEF\u548C\u5DE5\u671F\u7684\u8BA1\u7B97\u54E6\uFF0C\u4E5F\u4F1A\u5BFC\u81F4\u8F6C\u6362\u751F\u6210\u7684\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u51FA\u73B0\u65AD\u70B9\uFF0C\u8BF7\u5148\u8865\u5168\u5173\u7CFB:",p.push({name:"\u8865\u5168\u5DE5\u4F5C\u5173\u7CFB\u7684\u65B9\u6CD5",href:"http://bbs.zplan.cc/forum.php?mod=viewthread&tid=94"})):l="\u903B\u8F91\u5173\u7CFB\u975E\u5E38\u5B8C\u6574",this.markedType==d&&(this.markedTasks=a),this.score+=r,this.notices.logicRelations={type:d,title:"\u903B\u8F91\u5173\u7CFB\u5F97\u5206(\u6700\u9AD840)",maxScore:40,score:r,notice:l,tasks:a,links:p}}},{key:"_checkTasksLength",value:function(){var e=this.project.rows.length-1,t=10,a=0,n="";1e3<e?(a=t,n="\u60A8\u7684\u8BA1\u5212\u4E0D\u80FD\u518D\u8BE6\u7EC6\u4E86"):500<e?(a=8,n="\u60A8\u7684\u8BA1\u5212\u975E\u5E38\u8BE6\u7EC6"):300<e?(a=5,n="\u60A8\u7684\u8BA1\u5212\u6BD4\u8F83\u8BE6\u7EC6"):100<e?(a=3,n="\u60A8\u7684\u8BA1\u5212\u5185\u5BB9\u6709\u5F85\u4E30\u5BCC"):(a=1,n="\u60A8\u7684\u8BA1\u5212\u5185\u5BB9\u592A\u7B80\u5355\u4E86\u5427"),this.score+=a,this.notices.tasksLength={type:"tasksLength",title:"\u8BE6\u7EC6\u5EA6\u5F97\u5206(\u6700\u9AD8"+t+")",maxScore:t,score:a,notice:n}}},{key:"_checkTaskDurations",value:function(){for(var e=this.project.root().data.duration,t=0,a=this.project.root().leaves(),n=0;n<a.length;n++){var s=a[n],o=100*s.data.duration;o<3*e?t+=1:o<6*e?t+=.7:o<10*e?t+=.5:o<20*e&&(t+=.3)}var r=15,l=r;l=0==a.length?0:Ot(t*l/a.length),this.score+=l,this.notices.taskDurations={type:"taskDurations",title:"\u7CBE\u7EC6\u5EA6\u5F97\u5206(\u6700\u9AD8"+r+")",maxScore:r,score:l,notice:""}}},{key:"_checkOffDay",value:function(){for(var e=dr.clone(this.project.root().computedData.start_date),t=dr.clone(this.project.root().computedData.finish_date),a=this.project.defaultCalendar(),n=!1;e.getTime()<t.getTime();){if(a.dayOff(e)){n=!0;break}dr.addDays(e,1)}var s=10,o=0,r="",l=[];n?o=s:365>this.project.root().computedData.duration_days?o=5:(r="\u8D85\u8FC7\u4E00\u5E74\u7684\u8BA1\u5212\u901A\u5E38\u9700\u8981\u8003\u8651\u6625\u8282\u6216\u5176\u4ED6\u5047\u671F\uFF0C\u5EFA\u8BAE\u4E0D\u8981\u5C06\u5047\u671F\u4F5C\u4E3A\u4E00\u4E2A\u5DE5\u4F5C\u653E\u7F6E\u5728\u8BA1\u5212\u4E2D\uFF0C\u800C\u5E94\u8BE5\u8BBE\u7F6E\u65E5\u5386",l.push({name:"\u8BBE\u7F6E\u65E5\u5386\u7684\u65B9\u6CD5",href:"http://bbs.zplan.cc/forum.php?mod=viewthread&tid=591"})),this.score+=o,this.notices.offDay={type:"offDay",title:"\u5047\u671F\u8BBE\u7F6E\u5F97\u5206(\u6700\u9AD8"+s+")",maxScore:s,score:o,notice:r,links:l}}},{key:"_checkSFRelation",value:function(){for(var e=[],t=0,a;t<this.project.rows.length;t++){a=this.project.rows[t];for(var n=0,s;n<a.fromRelations.length;n++)if(s=a.fromRelations[n],"SF"==s.type){e.push(a);break}}var o="",r="sfRelation";o=0<e.length?"\u60A8\u7684\u8BA1\u5212\u91CC\u6709SF\u5173\u7CFB\uFF0C\u7531\u4E8E\u53CC\u4EE3\u53F7\u7F51\u7EDC\u56FE\u4E0D\u5141\u8BB8\u51FA\u73B0\u95ED\u5408\u56DE\u8DEF\uFF0C\u5EFA\u8BAE\u60A8\u8F6C\u5316\u4E3AFS\u5173\u7CFB":"\u5F88\u597D,\u60A8\u7684\u8BA1\u5212\u91CC\u6CA1\u6709SF\u5173\u7CFB",this.markedType==r&&(this.markedTasks=e),this.notices.sfRelation={type:r,title:"SF\u5173\u7CFB\u68C0\u67E5(\u4E0D\u8BC4\u5206)",score:null,notice:o,tasks:e}}},{key:"_selectMilestone",value:function(){for(var e=1,t;e<this.project.rows.length;e++)t=this.project.rows[e],t.isMilestone()&&this.milestones.push(t)}}]),e}(),jd=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.planInstance=null,e.export=new Nd(e),e.score=new Vd(e),e.disableAutoLayout=!1,e.messages=[],e.pertLayoutVersion=Ni.NORMAL,e.defaultCalendarId=0,e}return Eo(t,e),yn(t,[{key:"create",value:function(e,t,a){var n=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];t=dr.convertToUTC(t),a=dr.convertToUTC(a);var s=dr.getUnix(t),o=dr.getUnix(a),r={version:2,readonly:n,task_id_seq:1,plan_type:Ui.ZPLAN,timezone_offset:60*new Date().getTimezoneOffset(),tasks:[{id:0,calendar_id:0,name:e,rule:0,type:Vi.WORK,level:0,start:s,finish:o,depends:"",duration:o-s,collapsed:!1,iter_type:0,partition:null,unit:"",price:0,add_column:{},constraint_date:null,constraint_type:null,progress_history:null,leave_time:null}],calendars:[{id:0,name:"\u9ED8\u8BA4\u65E5\u5386",rules:[],times:[{start:28800,end:43200},{start:46800,end:61200}],seconds:28800}],columns:ji.NORMAL,view:{show_critical:!1,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"700px",calendar_id:0},zpet:{current_time:null,progress_history:null}};this.load(Ao(r))}},{key:"toUpdateZpertChart",value:function(){this.shouldUpdateZpertChart=!0}},{key:"isNeedUpdateZpertChart",value:function(){return this.shouldUpdateZpertChart}},{key:"updatedZpertChart",value:function(){this.shouldUpdateZpertChart=!1}},{key:"load",value:function(e){this.init(),this.datasource=new Id(this,e),this.readonly=this.datasource.getProjectReadonly(),this.viewConfig=this.datasource.getViewConfig(),this.disableAutoLayout=this.viewConfig.type!=Oi.PERT,this.timezoneOffset=this.datasource.getTimezoneOffset();var t=null;this.calendars&&(0<=this.currentCalendarId?t=this.calendars[this.currentCalendarId].gridInstance:t=this.calendars[this.defaultCalendarId].gridInstance),this.currentCalendarId=this.viewConfig.calendar_id,this.shouldCalcCritical=this.isShowCritical(),this.shouldRescore=this.isShowScore(),this.shouldUpdateLogicRelations=!0,this.loadCalendars(this.datasource.getCalendars()),this.defaultCalendarId=this.datasource.getDefaultCalendarId(),t&&(this.currentCalendar().gridInstance=t),this.loadRows(this.datasource.getTasks()),this.loadColumns(this.datasource.getColumns()),this.createTasksRelations(),this.checkAndBreakTaskRelationLoop(),this.deleteCycle&&(this.addErrorMessage("\u5DF2\u5220\u9664\u5B58\u5728\u7684\u5FAA\u73AF\u4F9D\u8D56"),this.deleteCycle=!1);try{this.recalcTasksTime(),this.updateShowAttrs(),this.isFromMsProject()&&(this.viewConfig.type=Oi.COMPARE_DIFF),this.isShowPert()&&this.autoLayout(),this.calcCritical(),this.scoreIfNeed()}catch(e){this.addErrorMessage("\u5185\u5BB9\u6709\u8BEF\uFF0C\u65E0\u6CD5\u8BFB\u53D6"),this.create("",new Date,new Date)}this.reportMessage(),this.datasource.startObserve(),this.toUpdateZpertChart()}},{key:"search",value:function(e){for(var t=null,a=0,n;a<this.rows.length;a++)n=this.rows[a],n.isSearched=""!=e&&n.data.name.includes(e),n.isSearched&&null==t&&(t=n);t&&t.setAsCurrent(),this.touchShow(),this.updateAll()}},{key:"searchPrevious",value:function(){for(var e=null,t=this.currentRow.idx-1,a=this.rows,n=t;0<=n;n--)if(a[n].isSearched){e=a[n];break}e&&e.setAsCurrent(),this.touchShow(),this.updateAll()}},{key:"searchNext",value:function(){for(var e=null,t=this.currentRow.idx+1,a=this.rows,n=t;n<a.length;n++)if(a[n].isSearched){e=a[n];break}e&&e.setAsCurrent(),this.touchShow(),this.updateAll()}},{key:"addPublisher",value:function(e){this.datasource.addPublisher(e)}},{key:"loadRows",value:function(e){this.rows=[],this.frozenLines={},this.dots=[],this.pertRelations=[],this.partitions=[],this.maxPartitionLevel=0,this.shouldUpdateLayout=!0;var t=!1,a=0;0!=e[0].level&&(e[0].level=0,t=!0);for(var n=0,s;n<e.length;n++)s=new Hi(this,e[n]),s.setIdx(n),0==s.level()&&0!=n&&(t=!0,a=1,s.data.level=a),s.level()>a+1?(t=!0,++a,s.data.level=a):a=s.level(),s.calcParent(),this.rows.push(s);this.syncPartitionCheck(),this.graph=new Od(this.rows),t&&this.addErrorMessage("\u5B58\u5728\u7236\u5B50\u7EA7\u522B\u9519\u8BEF,\u5DF2\u5C1D\u8BD5\u4FEE\u590D")}},{key:"loadCalendars",value:function(e){this.calendars={},this.defaultCalendarId=e[0].id;for(var t=0,a;t<e.length;t++)a=e[t],this.calendars[a.id]=new ai(this,a)}},{key:"defaultCalendar",value:function(){return this.calendars[this.defaultCalendarId]}},{key:"loadColumns",value:function(e){this.columns=new Yi(this,e)}},{key:"reloadData",value:function(){var e=this.currentCalendar();e=null==e||null==e?null:e.gridInstance,this.viewConfig=this.datasource.getViewConfig(),this.timezoneOffset=this.datasource.getTimezoneOffset(),this.currentCalendarId=this.viewConfig.calendar_id,this.shouldCalcCritical=this.isShowCritical(),this.shouldRescore=this.isShowScore(),this.shouldUpdateLogicRelations=!0,this.loadCalendars(this.datasource.getCalendars()),this.defaultCalendarId=this.datasource.getDefaultCalendarId(),(null==this.currentCalendar()||null==this.currentCalendar())&&(this.currentCalendarId=this.defaultCalendarId,this.viewConfig.calendar_id=this.defaultCalendarId),this.currentCalendar().gridInstance=e,this.loadRows(this.datasource.getTasks()),this.loadColumns(this.datasource.getColumns()),this.createTasksRelations(),this.checkAndBreakTaskRelationLoop(),this.deleteCycle&&(this.addErrorMessage("\u5DF2\u5220\u9664\u5B58\u5728\u7684\u5FAA\u73AF\u4F9D\u8D56"),this.deleteCycle=!1);try{this.recalcTasksTime(),this.updateShowAttrs(),this.isShowPert()&&this.autoLayout(),this.scoreIfNeed()}catch(e){this.addErrorMessage("\u5185\u5BB9\u6709\u8BEF\uFF0C\u65E0\u6CD5\u8BFB\u53D6"),this.create("",new Date,new Date)}this.reportMessage(),this.toUpdateZpertChart()}},{key:"undo",value:function(){var e=this.datasource.undo(),t=ir(e,2),a=t[0],n=t[1];a&&(this.showRangeChanged(),this.reloadData(),n&&this.rows[n].setAsCurrent(),this.datasource.startObserve(),this.updateAll())}},{key:"redo",value:function(){var e=this.datasource.redo(),t=ir(e,2),a=t[0],n=t[1];a&&(this.showRangeChanged(),this.reloadData(),n&&this.rows[n].setAsCurrent(),this.updateAll())}},{key:"fallback",value:function(){this.datasource.fallback(),this.showRangeChanged(),this.reloadData(),this.datasource.startObserve(),this.updateAll()}},{key:"pluckDiff",value:function(){this.datasource.addUndoData()}},{key:"root",value:function(){return this.rows[0]}},{key:"calcCritical",value:function(){if(this.isShowCritical()&&this.shouldCalcCritical&&(this.clearCritical(),1<this.rows.length)){for(var e=this.rows[1].data.finish,t=1,a;t<this.rows.length;t++)a=this.rows[t],a.data.finish>e&&(e=a.data.finish);for(var n=1,s;n<this.rows.length;n++)s=this.rows[n],s.data.finish!=e||s.hasChild()||s.calcCritical()}this.shouldCalcCritical=!1}},{key:"afterUpdateAll",value:function(){this.reportMessage()}},{key:"updateAll",value:function(){this.beforeUpdateAll(),this.updateShowAttrs(),this.pluckDiff(),this.reCreateLogicRelations(),this.isShowPert()&&this.autoLayout(),this.calcCritical(),this.scoreIfNeed(),this.planInstance&&(this.planInstance.forceUpdate(),this.shouldScrollGrid&&this.scrollGridInstance()),this.afterUpdateAll()}},{key:"afterUpdateCurrentRow",value:function(){this.toUpdateZpertChart()}},{key:"scoreIfNeed",value:function(){if(this.isShowScore()&&(this.shouldRescore&&(this.score.check(),this.shouldMarked=!0,this.shouldRescore=!1),this.shouldMarked)){for(var e=0;e<this.rows.length;e++)this.rows[e].marked=!1;if(0<this.score.markedTasks.length)for(var t=0;t<this.score.markedTasks.length;t++)this.score.markedTasks[t].marked=!0;this.touchShow(),this.shouldMarked=!1}}},{key:"updateRows",value:function(e){this.rows=e,this.syncPartitionCheck(),this.graph=new Od(this.rows),this.datasource.updateTasks(e.map(function(e){return e.data}))}},{key:"isReadonly",value:function(){return this.readonly}},{key:"isShowCritical",value:function(){return this.viewConfig.show_critical}},{key:"isFromMsProject",value:function(){return!!(this.datasource&&this.datasource.isFromMsProject)}},{key:"isShowGantt",value:function(){return this.getChartType()==Oi.GANTT}},{key:"isShowPert",value:function(){return this.getChartType()==Oi.PERT}},{key:"isShowScore",value:function(){return this.getChartType()==Oi.SCORE}},{key:"isShowCompareDiff",value:function(){return this.getChartType()==Oi.COMPARE_DIFF}},{key:"getChartType",value:function(){return this.viewConfig.type}},{key:"addRow",value:function(e){if(this.isReadonly())return void this.addErrorMessage("\u65E0\u6CD5\u7F16\u8F91\u53EA\u8BFB\u9879\u76EE");var t=!1;null==e&&(e=this.lastShowRow,null==e&&(e=this.rows[0]),t=!0);var a=e.level();0==a&&(a=1);var n=this.defaultCalendar().getDayStartFinishAndDuration(e.computedData.start_date),s=ir(n,3),o=s[0],r=s[1],l=s[2],i=this.datasource.createNewTask(a,dr.getUnix(o),dr.getUnix(r),l),d=new Hi(this,i);d.showIndex=e.showIndex+1,t?(d.setIdx(this.rows.length),d.calcParent(),this.rows.push(d),2==this.rows.length&&this.recalcTasksTime(),this.updateRows(this.rows),this.showRangeChanged(),d.setAsCurrentWithSelect(),this.updateAll()):this.insertRowsBefore(e,[d])}},{key:"createTasksRelations",value:function(){for(var e=0;e<this.rows.length;e++)this.rows[e].clearRelations();for(var t=0;t<this.rows.length;t++)this.rows[t].createRelations();this.reCreateLogicRelations()}},{key:"checkAndBreakTaskRelationLoop",value:function(){var e=this,t=this.graph.getCycles(),a=Ti(t);if(0<a.length){this.deleteCycle=!0;for(var n=function(n){var s=a[n],o=e.rows[s];t[s].forEach(function(t){var a=e.rows[t];o.deleteFromRelation(a)})},s=0;s<a.length;s++)n(s);for(var s=0;s<this.rows.length;s++)this.rows[s].clearRelations();this.createTasksRelations(),this.checkAndBreakTaskRelationLoop()}}},{key:"recalcTasksTime",value:function(){for(var e=[],t=null,a=this.root().getValue("start"),n=0,s;n<this.rows.length;n++){s=this.rows[n],s.reCalculated=!1;var o=s.getValue("start");a>o&&(a=o),null==t?0==s.fromRelations.length?!s.hasChild()&&e.push(s):t=s.level():s.level()<=t&&(0==s.fromRelations.length?(t=null,!s.hasChild()&&e.push(s)):t=s.level())}for(var r=new Al,l=0,d;l<e.length;l++){d=e[l],d.autoRecalcTimes(),d.parent&&0<d.parent.level()&&r.add(d.parent);for(var p=0;p<d.toRelations.length;p++)r.add(d.toRelations[p].to)}this._updateRootTaskStartTime(a),this.recalcNextCalcTasks(r,new Al),this._updateRootTaskFinishTime()}},{key:"_updateRootTaskStartTime",value:function(e){var t=this.root();t.data.start=e,t.computedData.start_date=dr.setUnix(e),t.autoRecalcTimes()}},{key:"_updateRootTaskFinishTime",value:function(){for(var e=this.root(),t=1,a;t<this.rows.length;t++)a=this.rows[t],a.data.finish>e.data.finish&&(e.data.finish=a.data.finish);e.computedData.finish_date=dr.setUnix(e.data.finish),e.recalcDuration()}},{key:"recalcNextCalcTasks",value:function(e,t){if(0!=e.size||0!=t.size){var a=new Al,n=new Al;e.forEach(function(e){if(!e.reCalculated){var t=e.autoRecalcTimes(),s=ir(t,2),o=s[0],r=s[1];if(o){e.parent&&0<e.parent.level()&&a.add(e.parent);for(var l=0;l<e.toRelations.length;l++)a.add(e.toRelations[l].to)}else if(r){for(var d=e.next();d&&d.level()>e.level();)d.reCalculated||d.hasChild()||a.add(d),d=d.next();n.add(e)}else a.add(e)}}),0==e.size&&t.forEach(function(e){for(var t=e.next();t&&t.level()>e.level();)t.reCalculated||t.hasChild()||a.add(t),t=t.next();e.reCalculated||n.add(e)}),this.recalcNextCalcTasks(a,n)}}},{key:"syncPartitionCheck",value:function(){for(var e=0,t;e<this.rows.length;e++)t=this.rows[e],t.getValue("partition")&&(t.parent&&(t.parent.data.partition=!0),!t.hasChild()&&(t.data.partition=!1))}},{key:"addNoticeMessage",value:function(e){this.messages.push({type:"notice",msg:e})}},{key:"addErrorMessage",value:function(e){this.messages.push({type:"error",msg:e})}},{key:"addMessageReporter",value:function(e){this.reporter=e}},{key:"reportMessage",value:function(){if(0<this.messages.length){for(var e=0,t;e<this.messages.length;e++)t=this.messages[e],this.reporter?this.reporter(t):console.log(t.msg);this.messages=[]}}},{key:"afterDeleteSelectedOrCurrentRows",value:function(){this.recalcTasksTime();for(var e=0;e<this.rows.length;e++)this.rows[e].updateDepends()}},{key:"afterInsertRowsBefore",value:function(e){for(var t=0;t<e.length;t++)e[t].createRelations();this.recalcTasksTime();for(var a=0;a<this.rows.length;a++)this.rows[a].updateDepends()}},{key:"afterDragMove",value:function(){if(this.graph.hasCycles())this.fallback(),this.addErrorMessage("\u79FB\u52A8\u540E\u5173\u7CFB\u975E\u6CD5");else{for(var e=0;e<this.rows.length;e++)this.rows[e].updateDepends();this.recalcTasksTime()}}},{key:"afterCutSelectedOrCurrentRows",value:function(){for(var e=0;e<this.rows.length;e++)this.rows[e].updateDepends();this.recalcTasksTime()}},{key:"pasteCuttedOrCopiedRows",value:function(){if(this.currentRow){for(var e=[],t={},a={},n=this.currentRow.idx,s=0;s<this.cuttedOrCopiedRows.length;s++){var o=JSON.parse(this.cuttedOrCopiedRows[s]),r=o.taskData,l=o.fromData,d=o.toData,p=o.parent,c=r.id;r.id=this.datasource.getNextTaskId();var u=new Hi(this,r);t[c]=u,e.push({task:u,fromData:l,toData:d,parent:p})}for(var h=0,m;h<this.rows.length;h++)m=this.rows[h],a[m.data.id]=m;for(var g=0;g<e.length;g++){for(var f=e[g],_=f.task,y=0,v;y<f.fromData.length;y++)if(v=f.fromData[y],t[v.id]){var k=new Ri(t[v.id],_,v.lag,v.type);_.fromRelations.push(k),t[v.id].toRelations.push(k)}else if(a[v.id]){var w=new Ri(a[v.id],_,v.lag,v.type);_.fromRelations.push(w),a[v.id].toRelations.push(w)}for(var T=0,R;T<f.toData.length;T++)if(R=f.toData[T],null==t[R.id]&&a[R.id]){var D=new Ri(_,a[R.id],R.lag,R.type);_.toRelations.push(D),a[R.id].fromRelations.push(D)}t[f.parent]?_.setValue("level",t[f.parent].level()+1):_.setValue("level",this.currentRow.level()),_.setIdx(n),this.rows.splice(n,0,_),n+=1}for(var x=n;x<this.rows.length;x++)this.rows[x].setIdx(x);for(var C=0;C<this.rows.length;C++)this.rows[C].updateDepends();this.updateRows(this.rows),this.showRangeChanged(),this.calcRowsParent(),this.recalcTasksTime(),this.updateAll()}}},{key:"afterUpgradeRows",value:function(){this.graph.hasCycles()?(this.fallback(),this.addErrorMessage("\u5347\u7EA7\u540E\u5173\u7CFB\u975E\u6CD5")):(this.syncPartitionCheck(),this.recalcTasksTime(),this.showRangeChanged())}},{key:"afterDegradeRows",value:function(){this.graph.hasCycles()?(this.fallback(),this.addErrorMessage("\u964D\u7EA7\u540E\u5173\u7CFB\u975E\u6CD5")):(this.syncPartitionCheck(),this.recalcTasksTime(),this.showRangeChanged())}},{key:"aftermoveUpRows",value:function(){if(this.graph.hasCycles())this.fallback(),this.addErrorMessage("\u79FB\u52A8\u540E\u5173\u7CFB\u975E\u6CD5");else{for(var e=0;e<this.rows.length;e++)this.rows[e].updateDepends();this.recalcTasksTime()}}},{key:"aftermoveDownRows",value:function(){if(this.graph.hasCycles())this.fallback(),this.addErrorMessage("\u79FB\u52A8\u540E\u5173\u7CFB\u975E\u6CD5");else{for(var e=0;e<this.rows.length;e++)this.rows[e].updateDepends();this.recalcTasksTime()}}},{key:"iterationGenerateByOrder",value:function(e){if(this.currentRow&&0<e){var t=this.selectedRows;if(0==t.length&&(t=[this.currentRow],this.currentRow.hasChild()))for(var a=this.currentRow.next();a&&a.level()>this.currentRow.level();)t.push(a),a=a.next();for(var n={},s=0;s<t.length;s++)n[t[s].idx]=!0;for(var o=[],r=0,l;r<t.length;r++)l=t[r],n[l.parent.idx]?o[o.length-1].push(l):o.push([l]);for(var d=o[0][0].idx,p=0;p<o.length;p++){for(var c=o[p],u=c[0],h=c[c.length-1],m=[],g=0,f;g<e;g++)for(var _=0;_<c.length;_++){var y=c[_],v=Ao(y.data),k=JSON.parse(v);k.id=this.datasource.getNextTaskId(),m.push(new Hi(this,k))}for(var w=0;w<e;w++)if(0==w){var T=c[0],R=m[0],D=new Ri(T,R,0,"FS");T.toRelations.push(D),R.fromRelations.push(D)}else{var x=m[(w-1)*c.length],C=m[w*c.length],S=new Ri(x,C,0,"FS");x.toRelations.push(S),C.fromRelations.push(S)}for(var b=function(t){for(var a=c[t],n=0,s;n<a.fromRelations.length;n++)if(s=a.fromRelations[n],s.from.idx>=u.idx&&s.from.idx<=h.idx)for(var o=0;o<e;o++){var r=t+o*c.length,l=m[r],i=s.from.idx-u.idx+o*c.length,d=m[i],p=new Ri(d,l,s.lag,s.type);l.fromRelations.push(p),d.toRelations.push(p)}for(var g=[],f=0,_;f<a.toRelations.length;f++)_=a.toRelations[f],_.to.idx>h.idx&&(g.push(_),_.to.fromRelations=_.to.fromRelations.filter(function(e){return e.from!=a}));for(var y=function(n){var s=g[n];a.toRelations=a.toRelations.filter(function(e){return e.to!=s.to});var o=s.to,r=m[t+(e-1)*c.length],l=new Ri(r,o,s.lag,s.type);o.fromRelations.push(l),r.toRelations.push(l)},v=0;v<g.length;v++)y(v)},P=0;P<c.length;P++)b(P);(f=this.rows).splice.apply(f,[d+c.length,0].concat(m)),d+=m.length+c.length}for(var E=0,z;E<this.rows.length;E++)z=this.rows[E],z.setIdx(E),z.calcParent();for(var I=0;I<this.rows.length;I++)this.rows[I].updateDepends();this.recalcTasksTime(),this.updateRows(this.rows),this.showRangeChanged(),this.updateAll()}}},{key:"iterationGenerateByPipeline",value:function(e){if(this.currentRow&&0<e){var t=this.selectedRows;if(0==t.length&&(t=[this.currentRow],this.currentRow.hasChild()))for(var a=this.currentRow.next();a&&a.level()>this.currentRow.level();)t.push(a),a=a.next();for(var n={},s=0;s<t.length;s++)n[t[s].idx]=!0;for(var o=[],r=0,l;r<t.length;r++)l=t[r],n[l.parent.idx]?o[o.length-1].push(l):o.push([l]);for(var d=o[0][0].idx,p=0;p<o.length;p++){for(var c=o[p],u=c[0],h=c[c.length-1],m=[],g=0,f;g<e;g++)for(var _=0;_<c.length;_++){var y=c[_],v=Ao(y.data),k=JSON.parse(v);k.id=this.datasource.getNextTaskId(),m.push(new Hi(this,k))}var w=c[1];if(w){for(var T=[],R=0,D;R<c.length;R++)D=c[R],D.level()==w.level()&&T.push(R);for(var x=0;x<e;x++)for(var C=0;C<T.length;C++){var S=null,b=null,P=T[C];0==x?(S=c[P],b=m[P]):(S=m[(x-1)*c.length+P],b=m[x*c.length+P]);var E=new Ri(S,b,0,"FS");S.toRelations.push(E),b.fromRelations.push(E)}}for(var z=function(t){for(var a=c[t],n=0,s;n<a.fromRelations.length;n++)if(s=a.fromRelations[n],s.from.idx>=u.idx&&s.from.idx<=h.idx)for(var o=0;o<e;o++){var r=t+o*c.length,l=m[r],i=s.from.idx-u.idx+o*c.length,d=m[i],p=new Ri(d,l,s.lag,s.type);l.fromRelations.push(p),d.toRelations.push(p)}for(var g=[],f=0,_;f<a.toRelations.length;f++)_=a.toRelations[f],_.to.idx>h.idx&&(g.push(_),_.to.fromRelations=_.to.fromRelations.filter(function(e){return e.from!=a}));for(var y=function(n){var s=g[n];a.toRelations=a.toRelations.filter(function(e){return e.to!=s.to});var o=s.to,r=m[t+(e-1)*c.length],l=new Ri(r,o,s.lag,s.type);o.fromRelations.push(l),r.toRelations.push(l)},v=0;v<g.length;v++)y(v)},I=0;I<c.length;I++)z(I);(f=this.rows).splice.apply(f,[d+c.length,0].concat(m)),d+=m.length+c.length}for(var L=0,A;L<this.rows.length;L++)A=this.rows[L],A.setIdx(L),A.calcParent();for(var M=0;M<this.rows.length;M++)this.rows[M].updateDepends();this.recalcTasksTime(),this.updateRows(this.rows),this.showRangeChanged(),this.updateAll()}}},{key:"iterationGenerateByParallel",value:function(e){if(this.currentRow&&0<e){var t=this.selectedRows;if(0==t.length&&(t=[this.currentRow],this.currentRow.hasChild()))for(var a=this.currentRow.next();a&&a.level()>this.currentRow.level();)t.push(a),a=a.next();for(var n={},s=0;s<t.length;s++)n[t[s].idx]=!0;for(var o=[],r=0,l;r<t.length;r++)l=t[r],n[l.parent.idx]?o[o.length-1].push(l):o.push([l]);for(var d=o[0][0].idx,p=0;p<o.length;p++){for(var c=o[p],u=c[0],h=c[c.length-1],m=[],g=0,f;g<e;g++)for(var _=0;_<c.length;_++){var y=c[_],v=Ao(y.data),k=JSON.parse(v);k.id=this.datasource.getNextTaskId(),m.push(new Hi(this,k))}for(var w=0,T;w<c.length;w++){T=c[w];for(var R=0,D;R<T.fromRelations.length;R++)if(D=T.fromRelations[R],D.from.idx>=u.idx&&D.from.idx<=h.idx)for(var x=0;x<e;x++){var C=w+x*c.length,S=m[C],b=D.from.idx-u.idx+x*c.length,P=m[b],E=new Ri(P,S,D.lag,D.type);S.fromRelations.push(E),P.toRelations.push(E)}else for(var z=0;z<e;z++){var I=w+z*c.length,L=m[I],A=D.from,M=new Ri(A,L,D.lag,D.type);L.fromRelations.push(M),A.toRelations.push(M)}for(var F=0,O;F<T.toRelations.length;F++)if(O=T.toRelations[F],O.to.idx<u.idx||O.to.idx>h.idx)for(var U=0;U<e;U++){var N=O.to,V=O.from.idx-u.idx+U*c.length,W=m[V],B=new Ri(W,N,O.lag,O.type);N.fromRelations.push(B),W.toRelations.push(B)}}(f=this.rows).splice.apply(f,[d+c.length,0].concat(m)),d+=m.length+c.length}for(var H=0,Y;H<this.rows.length;H++)Y=this.rows[H],Y.setIdx(H),Y.calcParent();for(var q=0;q<this.rows.length;q++)this.rows[q].updateDepends();this.recalcTasksTime(),this.updateRows(this.rows),this.showRangeChanged(),this.updateAll()}}},{key:"isSupportCMD",value:function(){return!0}},{key:"getCMDTips",value:function(){return"1: \u4F9D\u6B21\u6D41\u6C34 2: \u6D41\u6C34 3: \u5E76\u884C\u6D41\u6C34"}},{key:"execCMD",value:function(e){if(e){var t=e.split(" ",2),a=ir(t,2),n=a[0],s=a[1];"1"==n?this.iterationGenerateByOrder($a(s)):"2"==n?this.iterationGenerateByPipeline($a(s)):"3"==n&&this.iterationGenerateByParallel($a(s))}}},{key:"clearCritical",value:function(){for(var e=0,t;e<this.rows.length;e++)t=this.rows[e],t.isCritical=!1,t.calcedCritical=!1}},{key:"criticalSwitch",value:function(){this.viewConfig.show_critical=!this.viewConfig.show_critical,this.clearCritical(),this.isShowCritical()&&(this.shouldCalcCritical=!0),this.toUpdateZpertChart(),this.updateAll()}},{key:"switchToGantt",value:function(){this.viewConfig.type!=Oi.GANTT&&(this.viewConfig.type=Oi.GANTT,this.disableAutoLayout=!0,this.touchShow(),this.updateAll())}},{key:"switchToPert",value:function(){this._loadNomalColumns(),this.viewConfig.type!=Oi.PERT&&(this.viewConfig.type=Oi.PERT,this.disableAutoLayout=!1,this.touchShow(),this.toUpdateZpertChart(),this.updateAll())}},{key:"switchToScore",value:function(){this._loadNomalColumns(),this.viewConfig.type!=Oi.SCORE&&(this.viewConfig.type=Oi.SCORE,this.disableAutoLayout=!0,this.shouldRescore=!0,this.touchShow(),this.updateAll())}},{key:"switchToCompareDiff",value:function(){this._loadNomalColumns(),this.viewConfig.type!=Oi.COMPARE_DIFF&&(this.viewConfig.type=Oi.COMPARE_DIFF,this.disableAutoLayout=!0,this.touchShow(),this.updateAll())}},{key:"_loadNomalColumns",value:function(){this.viewConfig.type==Oi.TEMPLATE&&this.loadColumns(this.datasource.getColumns())}},{key:"switchToTemplate",value:function(){this.viewConfig.type!=Oi.TEMPLATE&&(this.viewConfig.type=Oi.TEMPLATE,this.disableAutoLayout=!0,this.loadColumns(ji.TEMPLATE),this.touchShow(),this.updateAll())}},{key:"reCreateLogicRelations",value:function(){if(this.shouldUpdateLogicRelations){var e=this.root().leaves();0==e.length&&(e=[this.root()]);for(var t=0;t<this.rows.length;t++)this.rows[t].clearLogicRelations();this._createLogicRelations(e),this.shouldUpdateLogicRelations=!1}}},{key:"_createLogicRelations",value:function(e){this.root().dispatchFromRelationsToLeaves();for(var t=0;t<e.length;t++){for(var a=e[t],n=[],s=0,o;s<a.logicFromRelations.length;s++)if(o=a.logicFromRelations[s],o.from.hasChild())(function(){for(var e=o.from.leaves(),t=o.from.idx,s=e[e.length-1].idx,r=0,l;r<e.length;r++)if(l=e[r],"F"==o.type.charAt(0)){var i=l.logicToRelations.some(function(e){return e.to.idx>=t&&e.to.idx<=s});if(!i){var d=new Ri(l,a,o.lag,o.type);n.push(d),l.logicToRelations.push(d)}}else{var p=l.logicFromRelations.some(function(e){return e.from.idx>=t&&e.from.idx<=s});if(!p){var c=new Ri(l,a,o.lag,o.type);n.push(c),l.logicToRelations.push(c)}}})();else{var r=new Ri(o.from,a,o.lag,o.type);n.push(r),o.from.logicToRelations.push(r)}a.logicFromRelations=n}for(var l=0,d;l<e.length;l++)d=e[l],d.logicFromRelations=[].concat(nl(new Al(d.logicFromRelations))),d.logicToRelations=[].concat(nl(new Al(d.logicToRelations)))}},{key:"resetPertState",value:function(){this.frozenLines={},this.dots=[],this.pertRelations=[],this.partitions=[];for(var e=[],t=0,a;t<this.rows.length;t++)a=this.rows[t],a.showingFromRelations=[],a.showingToRelations=[],a.pertRow=-1,a.pertPredot=null,a.pertPostdot=null,a.pertTasks=[],a.pertRowsDots=[],a.isShowInPert()&&(a.addPertPredot(),a.addPertPostdot(),a.isMilestone()&&(a.pertPredot.pertRow=0,a.pertPostdot.pertRow=0),e.push(a));return e}},{key:"updateShowingRelations",value:function(e){for(var t=0;t<e.length;t++)e[t].updateShowingRelations()}},{key:"fusionDotByShowingRelations",value:function(e){for(var t=[],a=[],n=0,s;n<e.length;n++){s=e[n];for(var o=0;o<s.showingFromRelations.length;o++){var r=s.showingFromRelations[o],l=""+r.from.idx+r.lag+r.toTime().getTime()+r.type;"S"==r.type.charAt(1)?(null==t[s.idx]&&(t[s.idx]=[]),t[s.idx].push(l)):(null==a[s.idx]&&(a[s.idx]=[]),a[s.idx].push(l))}for(var d=0;d<s.showingToRelations.length;d++){var p=s.showingToRelations[d],c=""+p.to.idx+p.lag+p.fromTime().getTime()+p.type;"S"==p.type.charAt(0)?("S"==t[s.idx]&&console.error("how it could be!!!!!!!!"),null==t[s.idx]&&(t[s.idx]=[]),t[s.idx].push(c)):(null==a[s.idx]&&(a[s.idx]=[]),a[s.idx].push(c))}}for(var u=0;u<t.length;u++)t[u]&&(t[u]=t[u].sort(function(e,t){return e-t}).join(","));for(var h=0;h<a.length;h++)a[h]&&(a[h]=a[h].sort(function(e,t){return e-t}).join(","));for(var m={},g={},f=0,_;f<e.length;f++)_=e[f],t[_.idx]&&""!=t[_.idx]&&(m[t[_.idx]]?(_.pertPredot.deleted=!0,m[t[_.idx]].pertPredot.fusion(_.pertPredot)):m[t[_.idx]]=_),a[_.idx]&&""!=a[_.idx]&&(g[a[_.idx]]?(_.pertPostdot.deleted=!0,g[a[_.idx]].pertPostdot.fusion(_.pertPostdot)):g[a[_.idx]]=_)}},{key:"furtherFusionForTasks",value:function(e){for(var t={},a=0;a<e.length;a++)t[e[a].idx]=!0;for(var n=0;n<e.length;n++){for(var s=e[n],o=[],r=[],l=[],d=[],p=0,c;p<s.showingToRelations.length;p++)c=s.showingToRelations[p],t[c.to.idx]&&("S"==c.type.charAt(0)?r.push(c):d.push(c));for(var u=0,h;u<s.showingFromRelations.length;u++)h=s.showingFromRelations[u],t[h.from.idx]&&("S"==h.type.charAt(1)?o.push(h):l.push(h));if(1==o.length&&0==r.length){var m=o[0],g=m.fromDot();g!=s.pertPredot&&0!=g.pertRow&&0!=s.pertPredot.pertRow&&0==m.lag&&(s.pertPredot.deleted=!0,g.fusion(s.pertPredot))}if(0==l.length&&1==d.length){var f=d[0],_=f.toDot();_!=s.pertPostdot&&0!=_.pertRow&&0!=s.pertPostdot.pertRow&&0==f.lag&&(s.pertPostdot.deleted=!0,_.fusion(s.pertPostdot))}}}},{key:"createPertRelations",value:function(e){for(var t={},a=0,n=0,s;n<e.length;n++){s=e[n];for(var o=0,r;o<s.showingToRelations.length;o++)if(r=s.showingToRelations[o],r.fromDot()!=r.toDot()){var l=r.fromDot().id+","+r.toDot().id;t[l]?t[l].lag<r.lag&&(t[l].lag=r.lag):(t[l]=new Ld(r.fromDot(),r.toDot(),r.lagDays(),r.lag,r.type,a,s),a+=1)}}}},{key:"buildDotRelations",value:function(e){this.fusionDotByShowingRelations(e),this.furtherFusionForTasks(e),this.createPertRelations(e)}},{key:"buildPartitions",value:function(e){var t={};this.maxPartitionLevel=0;var a=this.root();t[a.idx]=new Ad(a),this.partitions.push(t[a.idx]);for(var n=0,s;n<e.length;n++)if(s=e[n],s.getValue("partition")&&!s.collapsed()){var o=new Ad(s);o.addTask(s),t[s.idx]=o,s.parent&&0<s.parent.level()?(t[s.parent.idx].addPartition(o),o.level>this.maxPartitionLevel&&(this.maxPartitionLevel=o.level)):this.partitions.push(o)}else for(var r=s.parent;r;)if(t[r.idx]){t[r.idx].addTask(s);break}else r=r.parent;0==t[a.idx].tasks.length&&this.partitions.shift()}},{key:"buildPartitionsV1",value:function(e){for(var t={},a=0;a<e.length;a++)for(var n=e[a],s=n;s;)if(s.getValue("partition")&&!s.collapsed()||0==s.level()){null==t[s.idx]&&(t[s.idx]=new Ad(s),this.partitions.push(t[s.idx])),s!=n&&t[s.idx].addTask(n);break}else s=s.parent}},{key:"layoutTasks",value:function(e,t,a,n){for(var s=0,o=this.defaultCalendar().getMinStartSeconds(),r=this.defaultCalendar().getMaxEndSeconds(),l=0;l<e.length;l++){var d=e[l],p=[];p=p.concat(d.outTasks);for(var c=0,u;c<d.outPertRelations.length;c++)u=d.outPertRelations[c],a[u.task.idx]&&u.pertPredot.time.getTime()!=u.pertPostdot.time.getTime()&&(u.pertRowsDots=[u.getSortedDots()],p.push(u));for(var h=0,m;h<p.length;h++)if(m=p[h],0>m.pertRow&&("Task"==m.constructor.name&&a[m.idx]||"Task"!=m.constructor.name)){s=0,"PertRelation"==m.constructor.name&&(s=n);for(var g=0,f=s,_;f<t.length;f++){if(_=m.pertRowsDots[g],!(_ instanceof Array)){if(g+=1,g>=m.pertRowsDots.length)break;continue}var y=ir(_,2),v=y[0],k=y[1],w=t[f],T=!1;if(w instanceof Array)for(var R=0;R<w.length;R++){var D=w[R],x=D.pertRowsDots[f-D.pertRow];if(x instanceof Array){var C=ir(x,2),S=C[0],b=C[1],P=v.time>b.time&&!(86400>dr.getUnix(v.time)-dr.getUnix(b.time)&&dr.getSecondsOfDay(v.time)<=o&&dr.getSecondsOfDay(b.time)>=r)||v==b,E=k.time<S.time&&!(86400>dr.getUnix(S.time)-dr.getUnix(k.time)&&dr.getSecondsOfDay(S.time)<=o&&dr.getSecondsOfDay(k.time)>=r)||k==S;if(!(P||E)){T=!0;break}}else if(g+=1,g>=m.pertRowsDots.length)break}if(T)s=f+1;else if(g+=1,g>=m.pertRowsDots.length)break}if(-1==m.pertRow&&m.setPertRow(s),-1==m.pertPostdot.pertRow&&0<m.pertPostdot.inTasks.length){for(var z=m.pertPostdot.inTasks[0].pertRow,I=0,L;I<m.pertPostdot.inTasks.length;I++)L=m.pertPostdot.inTasks[I],L.pertRow<z&&(z=L.pertRow);m.pertPostdot.pertRow=z}for(var A=0;A<m.pertRowsDots.length;A++)null==t[m.pertRow+A]&&(t[m.pertRow+A]=[]),t[m.pertRow+A].push(m);this.layoutTasks([m.pertPostdot],t,a,s)}}}},{key:"layoutParent",value:function(e){for(var t=[],a={},n=0,s;n<e.length;n++)s=e[n],a[s.idx]=!0,null==t[s.level()]&&(t[s.level()]={}),null==t[s.level()][s.parent.idx]?t[s.level()][s.parent.idx]=[s]:t[s.level()][s.parent.idx].push(s),a[s.parent.idx]&&s.parent.pertTasks.push(s);for(var o=t.length-1,r;0<=o;o--)if(r=t[o],null!=r)for(var l=$l(r),d=0;d<l.length;d++){for(var p=ir(l[d],2),c=p[0],u=p[1],h=[],m={},g=0,f;g<u.length;g++){f=u[g],h.push(f.pertPredot),m[f.idx]=!0,f.pertRowsDots.push([f.pertPredot,f.pertPostdot]);for(var _=0,y;_<f.pertTasks.length;_++){y=f.pertTasks[_];for(var v=0,k;v<y.pertRowsDots.length;v++)k=y.pertRowsDots[v],f.addPertRowDots(y.pertRow+v+1,k);for(var w=0,T;w<y.pertPredot.outPertRelations.length;w++)T=y.pertPredot.outPertRelations[w],T.task==y&&f.addPertRowDots(T.pertRow+1,T.getSortedDots());for(var R=0,D;R<y.pertPostdot.outPertRelations.length;R++)D=y.pertPostdot.outPertRelations[R],D.task==y&&f.addPertRowDots(D.pertRow+1,D.getSortedDots())}}this.layoutTasks(h,[],m,0)}}},{key:"layoutPartitions",value:function(e){if(0<e.partitions.length)for(var t=0;t<e.partitions.length;t++)this.layoutPartitions(e.partitions[t]);this.layoutParent(e.tasks);for(var a=[],n=0,s;n<e.tasks.length;n++){s=e.tasks[n],a.push(s.pertRow);for(var o=0,r;o<s.pertPredot.outPertRelations.length;o++)r=s.pertPredot.outPertRelations[o],a.push(r.pertRow);for(var l=0,d;l<s.pertPostdot.outPertRelations.length;l++)d=s.pertPostdot.outPertRelations[l],a.push(d.pertRow)}a=a.sort(function(e,t){return e-t});var p=a[0],c=a[a.length-1];e.rowNum=0,Wr(p)&&Wr(c)&&(0>p&&(p=0),e.rowNum=c-p+1)}},{key:"layoutPartitionsV1",value:function(){for(var e=0,t=0,a;t<this.partitions.length;t++)a=this.partitions[t],a.startPertRow=e-1,e=a.autoLayoutV1(e),0<a.tasks.length?(a.finishPertRow=e,e+=1):a.finishPertRow=e-1}},{key:"flattenPartition",value:function(e,t,a){e.push(t),t.startPertRow=a;for(var n=0;n<t.tasks.length;n++){var s=t.tasks[n],o=a+s.pertRow+1;s.pertPredot.pertRow==s.pertRow&&(s.pertPredot.pertRow=o),s.pertPostdot.pertRow==s.pertRow&&(s.pertPostdot.pertRow=o),s.pertRow=o;for(var r=0,l;r<s.pertPredot.outPertRelations.length;r++)l=s.pertPredot.outPertRelations[r],l.task==s&&-1!=l.pertRow&&l.setPertRow(l.pertRow+a+1);for(var d=0,p;d<s.pertPostdot.outPertRelations.length;d++)p=s.pertPostdot.outPertRelations[d],p.task==s&&-1!=p.pertRow&&p.setPertRow(p.pertRow+a+1)}a=a+t.rowNum+1;for(var c=0;c<t.partitions.length;c++)a=this.flattenPartition(e,t.partitions[c],a);return t.finishPertRow=a,a}},{key:"flattenPartitions",value:function(){for(var e=[],t=0,a=0;a<this.partitions.length;a++)t=this.flattenPartition(e,this.partitions[a],t);this.partitions=e}},{key:"pertLayout",value:function(){if(!this.disableAutoLayout){var e=this.resetPertState();if(this.updateShowingRelations(e),this.buildDotRelations(e),this.isPertWithoutParent())this.buildPartitionsV1(e),this.layoutPartitionsV1();else{this.buildPartitions(e);for(var t=0;t<this.partitions.length;t++)this.layoutPartitions(this.partitions[t]);this.flattenPartitions()}this.dots=this.dots.filter(function(e){return!1==e.deleted}),this.dots=this.dots.sort(function(e,t){return e.time.getTime()>=t.time.getTime()?1:-1});for(var a=0,n;a<this.dots.length;a++){n=this.dots[a],n.id=a+1;for(var s=null,o=0,r;o<n.inTasks.length;o++)r=n.inTasks[o],0<=r.pertRow&&(null==s?s=r.pertRow:s>r.pertRow&&(s=r.pertRow));if(null==s)for(var l=0,d;l<n.outTasks.length;l++)d=n.outTasks[l],0<=d.pertRow&&(null==s?s=d.pertRow:s>d.pertRow&&(s=d.pertRow));n.pertRow=s,n.uniq()}}}},{key:"autoLayout",value:function(){this.shouldUpdateLayout&&(this.shouldUpdateLayout=!1,this.toUpdateZpertChart(),this.pertLayout())}},{key:"toJson",value:function(){return this.datasource.save()}},{key:"currentCalendar",value:function(){return(+this.currentCalendarId!==this.currentCalendarId||0>this.currentCalendarId)&&(this.currentCalendarId=this.defaultCalendarId,this.viewConfig.calendar_id=this.defaultCalendarId),this.calendars[this.currentCalendarId]}},{key:"changeCurrentCalendar",value:function(e){if(e!=this.currentCalendarId&&this.calendars[e]){var t=this.calendars[this.currentCalendarId],a=this.calendars[e];this.currentCalendarId=e,this.viewConfig.calendar_id=e,a.gridInstance=t.gridInstance,a.visibleRowNum=t.visibleRowNum,t.gridInstance=null;for(var n=0;n<t.rows.length;n++)t.rows[n].comInstance=null;return a.dayOff(this.root().computedData.start_date),a.dayOff(this.root().computedData.finish_date),this.toUpdateZpertChart(),!0}return!1}},{key:"updateCalendarOptions",value:function(){this.columns.getByName("calendar_id").options=$l(this.calendars).map(function(e){var t=ir(e,2),a=t[0],n=t[1];return[a,n.getName()]}),this.touchShow(),this.updateAll()}},{key:"deleteCurrentCalendar",value:function(){if(this.currentCalendarId!=this.defaultCalendarId){for(var e=this.currentCalendar(),t=0,a;t<e.tasks.length;t++)a=e.tasks[t],a.data.calendar_id=this.defaultCalendarId,a.calendar=this.defaultCalendar(),a.calendar.addTask(a),a.updateDurationDays(),a.updateDepends();this.recalcTasksTime(),this.defaultCalendar().gridInstance=e.gridInstance,e.gridInstance=null;for(var n=0;n<e.rows.length;n++)e.rows[n].comInstance=null;delete this.calendars[this.currentCalendarId],this.currentCalendarId=this.defaultCalendarId,this.viewConfig.calendar_id=this.defaultCalendarId,this.updateCalendarOptions()}}},{key:"addCalendar",value:function(){for(var e=0,t=0,a=ul(this.calendars),n=/^新建日历(\d*)$/,s=0,o;s<a.length;s++){o=a[s],e<=o.data.id&&(e=o.data.id+1);var r=n.exec(o.data.name);null!=r&&(""==r[1]?t=1:t=$a(r[1])+1)}var l="\u65B0\u5EFA\u65E5\u5386";0<t&&(l+=t);var d={id:e,name:l,rules:[],times:[{start:28800,end:43200},{start:46800,end:61200}],seconds:28800},p=new ai(this,d);p.dayOff(this.root().computedData.start_date),p.dayOff(this.root().computedData.finish_date),this.calendars[e]=p,this.changeCurrentCalendar(e),p.visibleRowNum=p.gridInstance.getVisibleRowNum(),this.datasource.addCalendar(d),this.updateCalendarOptions()}},{key:"isPertWithoutParent",value:function(){return this.pertLayoutVersion==Ni.WITHOUT_PARENT_TASK}},{key:"addPullInCallback",value:function(e){this.pullInCallback=e}},{key:"fastPullIn",value:function(e){for(var t=0,a;t<this.rows.length;t++)a=this.rows[t],a.shouldPullIn=!1,a.touch();e.setPullIn(!0),this.collectPullInIdxs()}},{key:"collectPullInIdxs",value:function(){for(var e=[],t=1;t<this.rows.length;t++)this.rows[t].shouldPullIn&&e.push(t);this.pullInCallback(e)}}]),t}(Hl),Wd=function(){function e(t,a){hn(this,e),this.id=null,this.calendarId=0,this.name=t,this.rule=0,this.type=Vi.WORK,this.level=null,this.start=null,this.finish=null,this.duration=a*28800,this.collapsed=!1,this.iterType=0,this.partition=null,this.addColumn={},this.constraintDate=null,this.constraintType=null,this.progressHistory=null,this.leaveTime=null,this.dependTasks=[],this.unit="",this.price=0}return yn(e,[{key:"generate",value:function(){return{id:this.id,calendar_id:this.calendarId,name:this.name,rule:this.rule,type:this.type,level:this.level,start:this.start,finish:this.finish,depends:this.dependTasks.map(function(e){return e.id+"FS"}).join(""),duration:this.duration,collapsed:this.collapsed,iter_type:this.iterType,partition:this.partition,unit:this.unit,price:this.price,add_column:this.addColumn,constraint_date:this.constraintDate,constraint_type:this.constraintType,progress_history:this.progressHistory,leave_time:this.leaveTime}}}]),e}(),Bd=function(e){function t(e,a){hn(this,t);var n=wo(this,(t.__proto__||cn(t)).call(this,e,a));return n.visualData={shouldGenerate:!0,startFloor:null,finishFloor:null,depend:null,dependFloor:null},n.successors=[],n.generatedTasks={},n}return Eo(t,e),yn(t,[{key:"isReadonly",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return!!this.owner.isReadonly()||!!this.data.readonly||!!(e&&""!=e&&this.owner.columns.isReadonly(e))}},{key:"hasRightFloorSetting",value:function(){return null!=this.visualData.startFloor&&null!=this.visualData.finishFloor&&(0!=this.visualData.startFloor||0!=this.visualData.finishFloor)}},{key:"getFloorOptions",value:function(){if(this.hasRightFloorSetting()){var e=this.visualData.startFloor,t=this.visualData.finishFloor;e>t&&(e=this.visualData.finishFloor,t=this.visualData.startFloor);for(var a=[],n=e;n<=t;n++)0!=n&&a.push([n,n]);return a}return[["",""]]}},{key:"shouldNoCircle",value:function(e){for(var t=0,a;t<this.successors.length;t++)if(a=this.successors[t],a==e||!a.shouldNoCircle(e))return!1;return!0}},{key:"getOptions",value:function(e){if("startFloor"==e||"finishFloor"==e)return this.owner.floorOptions;if("depend"==e){for(var t=[["",""]],a=0,n;a<this.owner.rows.length;a++)n=this.owner.rows[a],n.visualData.shouldGenerate&&n!=this&&n.hasRightFloorSetting()&&this.shouldNoCircle(n)&&t.push([n.data.id,n.data.name]);return t}return"dependFloor"==e?this.visualData.depend?this.visualData.depend.getFloorOptions():[["",""]]:[["",""]]}},{key:"getGridRowIndex",value:function(){return this.idx+1}},{key:"getValue",value:function(e){return"shouldGenerate"==e?this.visualData.shouldGenerate:"startFloor"==e?this.visualData.startFloor:"finishFloor"==e?this.visualData.finishFloor:"depend"==e?this.visualData.depend?this.visualData.depend.data.id:"":"dependFloor"==e?this.visualData.dependFloor:this.data[e]}},{key:"setValue",value:function(e,t){if("shouldGenerate"==e)this.setShouldGenerate(t);else if("startFloor"==e)this.setStartFloor(t);else if("finishFloor"==e)this.setFinishFloor(t);else if("depend"==e)this.setDepend(t);else if("dependFloor"==e){var a=$a(t);Wr(a)&&(this.visualData.dependFloor=t)}else if("name"!=e)"durationDay"==e?(t=Wo(t),+t===t&&(this.data.durationDay=t)):this.data[e]=t;else if(this.data.name!=t){this.data.name=t;for(var n=0;n<this.successors.length;n++)this.successors[n].touch()}}},{key:"setShouldGenerate",value:function(e){if(this.visualData.shouldGenerate=e,this.touch(),!this.visualData.shouldGenerate)for(var t=0,a;t<this.successors.length;t++)a=this.successors[t],a.visualData.depend=null,a.visualData.dependFloor=null,a.touch();this.owner.updateAll()}},{key:"setStartFloor",value:function(e){var t=$a(e);Wr(t)&&this.visualData.startFloor!=t&&(this.visualData.startFloor=t,this.updateSuccessorsDependFloor())}},{key:"setFinishFloor",value:function(e){var t=$a(e);Wr(t)&&this.visualData.finishFloor!=t&&(this.visualData.finishFloor=t,this.updateSuccessorsDependFloor())}},{key:"updateSuccessorsDependFloor",value:function(){var e=this.visualData.startFloor,t=this.visualData.finishFloor;e>t&&(e=this.visualData.finishFloor,t=this.visualData.startFloor);for(var a=0;a<this.successors.length;a++){var n=this.successors[a],s=n.visualData.dependFloor;(s<e||s>t)&&(n.visualData.dependFloor=this.visualData.startFloor,n.touch())}}},{key:"setDepend",value:function(e){var a=this,n=$a(e),s=null;Wr(n)&&(s=this.owner.rows.find(function(e){return e.data.id==n&&e.visualData.shouldGenerate&&e.hasRightFloorSetting()})),s&&this.visualData.depend!=s?(this.visualData.depend&&(this.visualData.depend.successors=this.visualData.depend.successors.filter(function(e){return e!=a})),this.visualData.depend=s,this.visualData.depend.successors.push(this),this.visualData.dependFloor=this.visualData.depend.visualData.startFloor,this.touch()):(this.visualData.depend&&(this.visualData.depend.successors=this.visualData.depend.successors.filter(function(e){return e!=a})),this.visualData.depend=null,this.visualData.dependFloor=null,this.touch())}},{key:"level",value:function(){return 0}},{key:"shouldRemove",value:function(){for(var e=this,t=0,a;t<this.successors.length;t++)a=this.successors[t],a.visualData.depend=null,a.visualData.dependFloor=null,a.touch();this.visualData.depend&&(this.visualData.depend.successors=this.visualData.depend.successors.filter(function(a){return a!=e}))}},{key:"toCopyData",value:function(){return Ao({taskData:this.data,shouldGenerate:this.visualData.shouldGenerate,startFloor:this.visualData.startFloor,finishFloor:this.visualData.finishFloor,dependId:this.visualData.depend?this.visualData.depend.data.id:null,dependFloor:this.visualData.dependFloor})}},{key:"generate",value:function(){if(this.headTask=null,this.generatedTasks=[],this.visualData.shouldGenerate&&null!=this.visualData.startFloor&&null!=this.visualData.finishFloor){var e=this.visualData.startFloor,t=this.visualData.finishFloor,a=!0;e>t&&(e=this.visualData.finishFloor,t=this.visualData.startFloor,a=!1);for(var n=null,s=e;s<=t;s++)if(0!=s){var o=new Wd(this.data.name,this.data.durationDay);this.generatedTasks[s]=o,n&&(a?o.dependTasks.push(n):n.dependTasks.push(o)),n=o}this.headTask=a?this.generatedTasks[e]:this.generatedTasks[t]}}}]),t}(jl),Hd=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.messages=[],e.undergroundFloor=null,e.groundFloor=null,e.buildingPrefix="",e.shouldAddBuildingPrefixBeforeFloorName=!0,e.shouldAddBuildingPrefixBeforeTaskName=!1,e.shouldAddFloorNameBeforeTaskName=!0,e.floorOptions=[["",""]],e}return Eo(t,e),yn(t,[{key:"load",value:function(e){this.init(),this.data=JSON.parse(e),this.readonly=this.data.readonly,this.loadRows(this.data.tasks),this.loadColumns(this.data.columns),this.updateShowAttrs()}},{key:"loadRows",value:function(e){this.rows=[];for(var t=0,a;t<e.length;t++)a=new Bd(this,e[t]),a.setIdx(t),a.setShow(),this.rows.push(a)}},{key:"updateAll",value:function(){this.beforeUpdateAll(),this.updateShowAttrs(),this.scaffoldInstance&&(this.scaffoldInstance.forceUpdate(),this.shouldScrollGrid&&this.scrollGridInstance()),this.afterUpdateAll()}},{key:"afterUpdateAll",value:function(){this.reportMessage()}},{key:"getMinAndMaxFloor",value:function(){var e=this.undergroundFloor;e&&(e=-e);var t=this.groundFloor;return e&&!t&&(t=-1),!e&&t&&(e=1),[e,t]}},{key:"initUndergroundFloor",value:function(e){for(var t=0,a;t<this.rows.length;t++)a=this.rows[t],a.visualData.startFloor=e,a.updateSuccessorsDependFloor(),a.touch()}},{key:"initGroundFloor",value:function(e){for(var t=0,a;t<this.rows.length;t++)a=this.rows[t],a.visualData.finishFloor=e,a.updateSuccessorsDependFloor(),a.touch()}},{key:"afterFloorSettingChanged",value:function(){if(this.floorOptions=[],null!=this.undergroundFloor&&0<this.undergroundFloor)for(var e=this.undergroundFloor;0<e;e--)this.floorOptions.push([-e,-e]);if(null!=this.groundFloor&&0<this.groundFloor)for(var t=1;t<=this.groundFloor;t++)this.floorOptions.push([t,t]);for(var a=this.getMinAndMaxFloor(),n=ir(a,2),s=n[0],o=n[1],r=0;r<this.rows.length;r++){var l=this.rows[r],d=!1;(null==l.visualData.startFloor||null==s||l.visualData.startFloor<s||l.visualData.startFloor>o)&&(l.visualData.startFloor=s,d=!0),(null==l.visualData.finishFloor||null==o||l.visualData.finishFloor<s||l.visualData.finishFloor>o)&&(l.visualData.finishFloor=o,d=!0),d&&(l.updateSuccessorsDependFloor(),l.touch())}}},{key:"isReadonly",value:function(){return this.readonly}},{key:"nextTaskId",value:function(){return this.data.task_id_seq++}},{key:"addRow",value:function(e){if(this.isReadonly())return void this.addErrorMessage("\u65E0\u6CD5\u7F16\u8F91\u53EA\u8BFB\u9879\u76EE");var t=!1;null==e&&(e=this.lastShowRow,null==e&&(e=this.rows[0]),t=!0);var a={id:this.nextTaskId(),name:"",durationDay:1},n=new Bd(this,a),s=this.getMinAndMaxFloor(),o=ir(s,2),r=o[0],l=o[1];n.visualData.startFloor=r,n.visualData.finishFloor=l,n.showIndex=e.showIndex+1,t?(n.setIdx(this.rows.length),n.setShow(),this.rows.push(n),this.updateRows(this.rows),this.showRangeChanged(),n.setAsCurrentWithSelect(),this.updateAll()):this.insertRowsBefore(e,[n])}},{key:"addNoticeMessage",value:function(e){this.messages.push({type:"notice",msg:e})}},{key:"addErrorMessage",value:function(e){this.messages.push({type:"error",msg:e})}},{key:"reportMessage",value:function(){if(0<this.messages.length){for(var e=0,t;e<this.messages.length;e++)t=this.messages[e],this.reporter?this.reporter(t):console.log(t.msg);this.messages=[]}}},{key:"pasteCuttedOrCopiedRows",value:function(){var e=this;if(this.currentRow){for(var t=this.currentRow.idx,a=this.getMinAndMaxFloor(),n=ir(a,2),s=n[0],o=n[1],r=function(a){var n=JSON.parse(e.cuttedOrCopiedRows[a]);n.taskData.id=e.nextTaskId();var r=new Bd(e,n.taskData);r.visualData.shouldGenerate=n.shouldGenerate,r.visualData.startFloor=null==n.startFloor?s:n.startFloor,r.visualData.finishFloor=null==n.finishFloor?o:n.finishFloor;var l=e.rows.find(function(e){return e.data.id==n.dependId&&e.visualData.shouldGenerate&&e.hasRightFloorSetting()});if(l){var i=l.visualData.startFloor,d=l.visualData.finishFloor;d<i&&(i=l.visualData.finishFloor,d=l.visualData.startFloor),r.visualData.depend=l,r.visualData.depend.successors.push(r),r.visualData.dependFloor=!n.dependFloor||n.dependFloor<i||n.dependFloor>d?i:n.dependFloor}r.setIdx(t),e.rows.splice(t,0,r),t+=1},l=0;l<this.cuttedOrCopiedRows.length;l++)r(l);for(var l=t;l<this.rows.length;l++)this.rows[l].setIdx(l);this.updateRows(this.rows),this.showRangeChanged(),this.calcRowsParent(),this.updateAll()}}},{key:"appendFloorTasks",value:function(e,t,a){var n=a+"\u5C42",s=new Wd(n,0);s.start=t,s.finish=t,s.level=1,s.partition=!0,s.id=e.length,this.shouldAddBuildingPrefixBeforeFloorName&&(s.name=""+this.buildingPrefix+s.name),e.push(s);for(var o=0;o<this.rows.length;o++){var r=this.rows[o],l=r.generatedTasks[a];l&&(this.shouldAddFloorNameBeforeTaskName&&(l.name=""+n+l.name),this.shouldAddBuildingPrefixBeforeTaskName&&(l.name=""+this.buildingPrefix+l.name),l.level=2,l.id=e.length,e.push(l))}}},{key:"generateTasks",value:function(){for(var e=0;e<this.rows.length;e++)this.rows[e].generate();for(var t=0,a;t<this.rows.length;t++)a=this.rows[t],a.visualData.shouldGenerate&&a.visualData.depend&&a.headTask.dependTasks.push(a.visualData.depend.generatedTasks[a.visualData.dependFloor]);var n=new Wd("\u697C\u5C42\u5F62\u8C61\u56FE",0),s=new Date;s=dr.convertToUTC(s),n.start=dr.getUnix(dr.getStartOfDay(s)),n.finish=n.start,n.level=0,n.partition=!0,n.id=0;var o=[n];if(null!=this.groundFloor&&0<this.groundFloor)for(var r=this.groundFloor;1<=r;r--)this.appendFloorTasks(o,n.start,r);if(null!=this.undergroundFloor&&0<this.undergroundFloor)for(var l=1;l<=this.undergroundFloor;l++)this.appendFloorTasks(o,n.start,-l);return o.map(function(e){return e.generate()})}},{key:"generate",value:function(){var e=this.generateTasks(),t=Ao({version:2,readonly:!1,task_id_seq:e.length,plan_type:Ui.ZPERT,timezone_offset:60*new Date().getTimezoneOffset(),tasks:e,calendars:[{id:0,name:"\u9ED8\u8BA4\u65E5\u5386",rules:[],times:[{start:28800,end:43200},{start:46800,end:61200}],seconds:28800}],columns:ji.NORMAL,view:{show_critical:!1,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"700px",calendar_id:0},zpet:{current_time:null,progress_history:null}}),a=new jd;return a.load(t),a.export.convertToPertV1()}}]),t}(Hl),Yd=function(e){function t(e,a){hn(this,t);var n=wo(this,(t.__proto__||cn(t)).call(this,e,a));return n.shouldGenerate=!0,n.dependTask=null,n.successors=[],n.setDepend(n.data.depend),n}return Eo(t,e),yn(t,[{key:"isReadonly",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return!!this.owner.isReadonly()||!!this.data.readonly||!!(e&&""!=e&&this.owner.columns.isReadonly(e))}},{key:"shouldNoCircle",value:function(e){for(var t=0,a;t<this.successors.length;t++)if(a=this.successors[t],a==e||!a.shouldNoCircle(e))return!1;return!0}},{key:"getOptions",value:function(e){if("depend"==e){var t=[["",""]];if(this.owner.headTask!=this)for(var a=0,n;a<this.owner.rows.length;a++)n=this.owner.rows[a],n.shouldGenerate&&n!=this&&this.shouldNoCircle(n)&&t.push([n.data.id,n.data.name]);return t}return[["",""]]}},{key:"getGridRowIndex",value:function(){return this.idx+1}},{key:"getValue",value:function(e){return"shouldGenerate"==e?this.shouldGenerate:this.data[e]}},{key:"setValue",value:function(e,t){if("shouldGenerate"==e)this.setShouldGenerate(t);else if("depend"==e)this.setDepend(t);else if("name"!=e)"durationDay"==e?(t=Wo(t),+t===t&&(this.data.durationDay=t)):this.data[e]=t;else if(this.data.name!=t){this.data.name=t;for(var a=0;a<this.successors.length;a++)this.successors[a].touch()}}},{key:"setShouldGenerate",value:function(e){if(this.shouldGenerate=e,this.touch(),this.shouldGenerate)(null==this.owner.headTask||this.owner.headTask.idx>this.idx)&&(this.owner.headTask=this);else{for(var t=0,a;t<this.successors.length;t++)a=this.successors[t],a.data.depend=null,a.dependTask=null,a.touch();if(this.owner.headTask==this){var n=this.next();for(this.owner.headTask=null;n;)if(n.shouldGenerate){this.owner.headTask=n;break}}}this.owner.updateAll()}},{key:"setDepend",value:function(e){var a=this,n=$a(e),s=null;Wr(n)&&n!=this.data.id&&(s=this.owner.rows.find(function(e){return e.data.id==n&&e.shouldGenerate})),s&&this.dependTask!=s?(this.dependTask&&(this.dependTask.successors=this.dependTask.successors.filter(function(e){return e!=a})),this.data.depend=n,this.dependTask=s,this.dependTask.successors.push(this),this.touch()):(this.dependTask&&(this.dependTask.successors=this.dependTask.successors.filter(function(e){return e!=a})),this.data.depend=null,this.dependTask=null,this.touch())}},{key:"level",value:function(){return 0}},{key:"shouldRemove",value:function(){for(var e=this,t=0,a;t<this.successors.length;t++)a=this.successors[t],a.data.depend=null,a.dependTask=null,a.touch();this.dependTask&&(this.dependTask.successors=this.dependTask.successors.filter(function(a){return a!=e}))}},{key:"toCopyData",value:function(){return Ao({taskData:this.data,shouldGenerate:this.shouldGenerate})}}]),t}(jl),qd=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.messages=[],e.undergroundFloor=null,e.groundFloor=null,e.buildingPrefix="",e.shouldAddBuildingPrefixBeforeFloorName=!0,e.shouldAddBuildingPrefixBeforeTaskName=!1,e.shouldAddFloorNameBeforeTaskName=!0,e}return Eo(t,e),yn(t,[{key:"load",value:function(e){this.init(),this.data=JSON.parse(e),this.readonly=this.data.readonly,this.loadRows(this.data.tasks),this.loadColumns(this.data.columns),this.updateShowAttrs()}},{key:"loadRows",value:function(e){this.rows=[],this.headTask=null;for(var t=0,a;t<e.length;t++)a=new Yd(this,e[t]),a.setIdx(t),a.setShow(),this.rows.push(a),null==this.headTask&&a.shouldGenerate&&(this.headTask=a)}},{key:"updateAll",value:function(){this.beforeUpdateAll(),this.updateShowAttrs(),this.scaffoldInstance&&(this.scaffoldInstance.forceUpdate(),this.shouldScrollGrid&&this.scrollGridInstance()),this.afterUpdateAll()}},{key:"afterUpdateAll",value:function(){this.reportMessage()}},{key:"getMinAndMaxFloor",value:function(){var e=this.undergroundFloor;null!=e&&(e=-e);var t=this.groundFloor;return null!=e&&null==t&&(t=-1),null==e&&null!=t&&(e=1),[e,t]}},{key:"initUndergroundFloor",value:function(){}},{key:"initGroundFloor",value:function(){}},{key:"afterFloorSettingChanged",value:function(){}},{key:"isReadonly",value:function(){return this.readonly}},{key:"nextTaskId",value:function(){return this.data.task_id_seq++}},{key:"addRow",value:function(e){if(this.isReadonly())return void this.addErrorMessage("\u65E0\u6CD5\u7F16\u8F91\u53EA\u8BFB\u9879\u76EE");var t=!1;null==e&&(e=this.lastShowRow,null==e&&(e=this.rows[0]),t=!0);var a={id:this.nextTaskId(),name:"",durationDay:1,depend:null},n=new Yd(this,a);n.showIndex=e.showIndex+1,t?(n.setIdx(this.rows.length),n.setShow(),null==this.headTask&&(this.headTask=n),this.rows.push(n),this.updateRows(this.rows),this.showRangeChanged(),n.setAsCurrentWithSelect(),this.updateAll()):this.insertRowsBefore(e,[n])}},{key:"afterInsertRowsBefore",value:function(e){0<e.length&&(null==this.headTask||e[0].idx<this.headTask.idx)&&(this.headTask=e[0])}},{key:"resetHeadTask",value:function(){this.headTask=null;for(var e=0;e<this.rows.length;e++)if(this.rows[e].shouldGenerate){this.headTask=this.rows[e],this.headTask.data.depend=null,this.headTask.dependTask=null;break}}},{key:"afterDeleteSelectedOrCurrentRows",value:function(){this.resetHeadTask()}},{key:"aftermoveUpRows",value:function(){this.resetHeadTask()}},{key:"aftermoveDownRows",value:function(){this.resetHeadTask()}},{key:"afterDragMove",value:function(){this.resetHeadTask()}},{key:"addNoticeMessage",value:function(e){this.messages.push({type:"notice",msg:e})}},{key:"addErrorMessage",value:function(e){this.messages.push({type:"error",msg:e})}},{key:"reportMessage",value:function(){if(0<this.messages.length){for(var e=0,t;e<this.messages.length;e++)t=this.messages[e],this.reporter?this.reporter(t):console.log(t.msg);this.messages=[]}}},{key:"pasteCuttedOrCopiedRows",value:function(){if(this.currentRow){for(var e=this.currentRow.idx,t=0,a;t<this.cuttedOrCopiedRows.length;t++){a=JSON.parse(this.cuttedOrCopiedRows[t]),a.taskData.id=this.nextTaskId();var n=new Yd(this,a.taskData);n.shouldGenerate=a.shouldGenerate,n.setIdx(e),this.rows.splice(e,0,n),e+=1}for(var s=e;s<this.rows.length;s++)this.rows[s].setIdx(s);this.resetHeadTask(),this.updateRows(this.rows),this.showRangeChanged(),this.calcRowsParent(),this.updateAll()}}},{key:"appendFloorTasks",value:function(e,t,a,n){var s=a+"\u5C42",o=new Wd(s,0);o.start=t,o.finish=t,o.level=1,o.partition=!0,o.id=e.length,this.shouldAddBuildingPrefixBeforeFloorName&&(o.name=""+this.buildingPrefix+o.name),e.push(o);for(var r={},l=0,d;l<this.rows.length;l++)if(d=this.rows[l],d.shouldGenerate){var p=new Wd(d.data.name,d.data.durationDay);p.level=2,p.id=e.length,this.shouldAddFloorNameBeforeTaskName&&(p.name=""+s+p.name),this.shouldAddBuildingPrefixBeforeTaskName&&(p.name=""+this.buildingPrefix+p.name),this.headTask==d&&(n&&n.dependTasks.push(p),n=p),r[d.idx]=p,e.push(p)}for(var c=0,u;c<this.rows.length;c++)u=this.rows[c],u.shouldGenerate&&u.dependTask&&r[u.idx].dependTasks.push(r[u.dependTask.idx]);return n}},{key:"generateTasks",value:function(){var e=new Wd("\u697C\u5C42\u9636\u68AF\u56FE",0),t=new Date;t=dr.convertToUTC(t),e.start=dr.getUnix(dr.getStartOfDay(t)),e.finish=e.start,e.level=0,e.partition=!0,e.id=0;var a=[e],n=null;if(this.groundFloor&&0<this.groundFloor)for(var s=this.groundFloor;1<=s;s--)n=this.appendFloorTasks(a,e.start,s,n);if(this.undergroundFloor&&0<this.undergroundFloor)for(var o=1;o<=this.undergroundFloor;o++)n=this.appendFloorTasks(a,e.start,-o,n);return a.map(function(e){return e.generate()})}},{key:"generate",value:function(){var e=this.generateTasks(),t=Ao({version:2,readonly:!1,task_id_seq:e.length,plan_type:Ui.ZPERT,timezone_offset:60*new Date().getTimezoneOffset(),tasks:e,calendars:[{id:0,name:"\u9ED8\u8BA4\u65E5\u5386",rules:[],times:[{start:28800,end:43200},{start:46800,end:61200}],seconds:28800}],columns:PROJECT_CLOUMNS.NORMAL,view:{show_critical:!1,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"700px",calendar_id:0},zpet:{current_time:null,progress_history:null}}),a=new jd;return a.load(t),a.export.convertToPertV1()}}]),t}(Hl),Gd=function(){function e(t,a,n){hn(this,e),this.secondsInDay=86400,this.ranges=[{start:0,end:86400}],this._parseData(t,a,n)}return yn(e,[{key:"_rjust",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:" ";return a=a.substr(0,1),e.length<t?a.repeat(t-e.length)+e:e}},{key:"_parseData",value:function(e,t,a){var n=dr.getUnix(new Date(Date.UTC(1980,0,1,0,0,0))),s=dr.getUnix(t),o=dr.getUnix(a),r=Ot((s-n)/86400/32);this.startUnix=n+32*(86400*r);var l=Ut((o-n)/86400/32);this.endUnix=n+32*(86400*l);for(var d=[],p=r;p<=l;p++){for(var c=[],u=this._rjust(e[p].toString(2),32,"0"),h=0,m;32>h;h++)m=u.charAt(h),c.unshift("0"==m);d=d.concat(c)}this.calData=d}},{key:"getZpertTimeDiff",value:function(e,t){if(e&&t){var a=dr.getUnix(e),n=dr.getUnix(t);return ti.roundTwoDecimals((a-n)/this.secondsInDay)}return null}},{key:"getZpertDay",value:function(e){return ti.roundTwoDecimals(e/this.secondsInDay)}},{key:"_getSecondsInWorkday",value:function(e){for(var t=0,a=dr.getSecondsOfDay(e),n=0,s;n<this.ranges.length&&(s=this.ranges[n],!(s.start>=a));n++)t+=s.end<=a?s.end-s.start:a-s.start;return t}},{key:"calDuration",value:function(e,t,a){if(e&&t){var n=dr.getUnix(e),s=dr.getUnix(t),o=s-n;if(a){o=0;var r=$a((n-this.startUnix)/this.secondsInDay),l=$a((s-this.startUnix)/this.secondsInDay);if(r==l)this.calData[r]||(o=0);else{for(this.calData[r]&&(o=this.secondsInDay-this._getSecondsInWorkday(e)),r+=1;r<l;)this.calData[r]&&(o+=this.secondsInDay),r+=1;this.calData[l]&&(o+=this._getSecondsInWorkday(t))}}return o}return null}},{key:"_calcFinishInWorkday",value:function(e,t){for(var a=0,n=dr.getSecondsOfDay(e),s=dr.getStartOfDay(e),o=0,r;o<this.ranges.length;o++)if(r=this.ranges[o],r.end<=n)continue;else if(r.start<=n){if(a=r.end-n,a>=t){dr.addSeconds(s,t);break}}else if(a+r.end-r.start>=t){dr.addSeconds(s,r.start+t-a);break}else a+=r.end-r.start;return s}},{key:"calFinish",value:function(e,t,a){var n=new Date(e);if(a){var s=0,o=$a((dr.getUnix(e)-this.startUnix)/86400);if(this.calData[o]&&(s=this.secondsInDay-this._getSecondsInWorkday(e),o+=1),s>=t)n=this._calcFinishInWorkday(n,t);else{for(;s+this.secondsInDay<t;)this.calData[o]&&(s+=this.secondsInDay),o+=1;for(;!this.calData[o];)o+=1;n=dr.setUnix(this.startUnix+86400*o),n=this._calcFinishInWorkday(n,t-s)}}else dr.addSeconds(n,t);return n}}]),e}(),$d=28800,Xd={_getZpertTime:function(e){return e=$a(e),e?dr.setUnix(e):null},_getDurationDiff:function(e,t){return+e===e&&+t===t?ti.roundTwoDecimals((e-t)/86400):null},_convertToDays:function(e){return ti.roundTwoDecimals(e/86400)},_initResultAndCalendar:function(e,t){var a={freeze_time:"",start:0,finish:0,tasks:[]},n=e.compute_start_time;(null==n||n==null)&&(n=e.start);var s=e.compute_stop_time;(null==s||s==null)&&(s=e.start+e.duration),a.start=n,a.finish=s;var o=n,r=s;e.estimate_start_time&&e.estimate_start_time<o&&(o=e.estimate_start_time),e.estimate_stop_time&&e.estimate_stop_time>r&&(r=e.estimate_stop_time);var l=dr.setUnix(o),i=dr.setUnix(r);return[a,new Gd(t,l,i)]},_formatStopTime:function(e){var t=dr.setUnix(dr.getUnix(e)-1);return dr.formatUTC(t)},_appendStartTimes:function(e,t,a,n){var s=this._getZpertTime(t.compute_start_time),o=a?this._getZpertTime(t.estimate_start_time):this._getZpertTime(t.real_start_time),r=this._getZpertTime(t.last_plan_start_time);return s?(e.compute_start_time=dr.formatUTC(s),e.start=dr.getUnix(s)):(e.compute_start_time="",e.start=null),e.real_start_time=o?dr.formatUTC(o):"",e.last_plan_start_time=r?dr.formatUTC(r):"",e.progress_start_diff=n.getZpertTimeDiff(o,r),e.change_start_diff=n.getZpertTimeDiff(s,r),{computeStartTime:s,realStartTime:o,lastPlanStartTime:r}},_appendStopTimes:function(e,t,a,n,s){var o=null;o=Wr(t.compute_stop_time)?this._getZpertTime(t.compute_stop_time):s.calFinish(t.compute_start_time,t.duration,n);var r=a?this._getZpertTime(t.estimate_stop_time):this._getZpertTime(t.real_stop_time),l=this._getZpertTime(t.last_plan_stop_time);return o?(e.finish=dr.getUnix(o),e.compute_stop_time=this._formatStopTime(o)):(e.finish=null,e.compute_stop_time=""),e.real_stop_time=r?this._formatStopTime(r):"",e.last_plan_stop_time=l?this._formatStopTime(l):"",e.progress_stop_diff=s.getZpertTimeDiff(r,l),e.change_stop_diff=s.getZpertTimeDiff(o,l),{computeStopTime:o,realStopTime:r,lastPlanStopTime:l}},_appendDurations:function(e,t,a,n,s,o){var r=a.calDuration(s.computeStartTime,o.computeStopTime,n),l=a.calDuration(s.realStartTime,o.realStopTime,n),i=a.calDuration(s.lastPlanStartTime,o.lastPlanStopTime,n);e.compute_duration=this._convertToDays(r),e.real_duration=this._convertToDays(l),e.last_plan_duration=this._convertToDays(i),e.progress_dur_diff=this._getDurationDiff(l,i),e.change_dur_diff=this._getDurationDiff(r,i)},_appendLeftTimes:function(e,t,a,n,s,o,r){var l=0<=t.leave_time?t.leave_time:null,i=null;if(r.lastPlanStopTime)if(dr.isAfterOrSame(s,r.lastPlanStopTime))i=0;else{var d=dr.isAfterOrSame(s,o.lastPlanStartTime)?s:o.lastPlanStartTime;i=n.calDuration(d,r.lastPlanStopTime,a)}e.real_left=null==l?null:n.getZpertDay(l),e.last_plan_left=this._convertToDays(i),e.progress_left_diff=this._getDurationDiff(l,i)},_getDetails:function(e,t){if(e.time_history){for(var a="",n=dr.getUnix(t),s=0,o=0,r;o<e.time_history.length;o++)r=e.time_history[o],r.feedback_time<=n&&r.feedback_time>s&&(s=r.feedback_time,a=r.details);return a}return""},_extractZpertTask:function(e,t,a,n){var s=Wr(e.estimate_start_time),o=1==e.is_valid_vaction,r={id:e.id,name:e.name,leader:e.leader,notes:e.notes,details:this._getDetails(e,t),resolution:""},l=this._appendStartTimes(r,e,s,n),d=this._appendStopTimes(r,e,s,o,n);this._appendDurations(r,e,n,o,l,d),this._appendLeftTimes(r,e,o,n,t,l,d);var p=!1;(r.progress_start_diff||r.progress_stop_diff||r.progress_dur_diff||r.progress_left_diff)&&(p=!0);var c=null;s&&dr.isAfterOrSame(l.realStartTime,t)&&(c=p,p=!1);var u=!1;(r.change_start_diff||r.change_stop_diff||r.change_dur_diff)&&(u=!0);for(var h=0,m;h<a.length;h++)if(m=a[h],m.pert_row>e.pert_row){r.name=m.name+"/"+r.name,r.pt_pert_row=m.pert_row;break}return r.progress_diff=p,r.change_diff=u,r.progress_estimate_diff=c,r.computeStartUnix=e.compute_start_time||0,r},_convertUTC:function(e){for(var t=["current_time","gcstop_time","gczero_time"],a=0,n;a<t.length;a++)n=t[a],e.global[n]&&(e.global[n]+=$d);for(var s=["start","stop","ask_start_time","ask_stop_time","compute_start_time","compute_stop_time","estimate_start_time","estimate_stop_time","last_plan_start_time","last_plan_stop_time","real_start_time","real_stop_time"],o=0,r;o<e.tasks.length;o++){r=e.tasks[o];for(var l=0,d;l<s.length;l++)d=s[l],r[d]&&(r[d]+=$d);if(r.time_history)for(var p=0;p<r.time_history.length;p++)r.time_history[p].feedback_time+=$d}},getZpertDiff:function(e){if(e&&e.global){this._convertUTC(e);var t=this._initResultAndCalendar(e.tasks[0],e.info_base.vaca_array),a=ir(t,2),n=a[0],s=a[1],o=dr.setUnix(e.global.current_time);n.freeze_time=dr.formatUTC(dr.setUnix(e.global.current_time-1)),n.last_freeze_time=e.global.last_current_time,n.refresh_sel=e.global.refresh_sel;var r=e.task_types;(null==r||r==null)&&(r=[]),r=r.sort(function(e,t){return e.pert_row-t.pert_row});for(var l=1,d;l<e.tasks.length;l++)d=e.tasks[l],(0==d.job_type||3==d.job_type||4==d.job_type)&&n.tasks.push(this._extractZpertTask(d,o,r,s));n.tasks=0==r.length?n.tasks.sort(function(e,t){return e.computeStartUnix-t.computeStartUnix}):n.tasks.sort(function(e,t){return e.pt_pert_row-t.pt_pert_row||e.computeStartUnix-t.computeStartUnix});for(var p=0;p<n.tasks.length;p++)n.tasks[p].idx=p;return n}return{freeze_time:"",start:0,finish:0,tasks:[]}},_displayForwardLines:function(e){var t=e.progresses,a=e.tasks[0],n=e.progress_history,s=[];if(e.progresses!=null)for(var o=0;o<t.length;o++)t[o].is_display&&s.push({time:this._startTime(a)+60*t[o].time});else if(null!=e.progress_history&&(0<e.global.current_time&&s.push({time:e.global.current_time}),0<n.length)){var r=n.sort(function(e,t){return e.time-t.time});(2==e.pert_prop.progress_history_style||1==e.pert_prop.progress_history_style)&&s.push({time:this._startTime(a)+60*r[r.length-1]})}return s},_hasForwardLine:function(e){return 0<this._displayForwardLines(e).length},_startTime:function(e){return e.start||e.ask_start_time},_getLastForwardLine:function(e,t){var a=e.pop();return null==a&&(a={time:this._startTime(t)}),a},_getCurrentAndLastForwardLine:function(e){var t=e.tasks[0],a=this._displayForwardLines(e);a=a.sort(function(e,t){return e.time-t.time});var n=a.pop(),s=this._getLastForwardLine(a,t);return[n,s]},_notStartedAfterCurrentForwardLine:function(e,t){var a=e.time_history.sort(function(e,t){return t.feedback_time-e.feedback_time});return e.compute_start_time>t.time&&(0>=a.length||0==a[0].status)},_doneBeforeLastForwardLine:function(e,t){for(var a=!1,n=e.time_history.sort(function(e,t){return t.feedback_time-e.feedback_time}),s=0;s<n.length;s++)if(n[s].feedback_time<=t.time&&2==n[s].status){a=!0;break}return a},_getCurrentAndLastFeedback:function(e,t,a){for(var n=e.time_history.sort(function(e,t){return t.feedback_time-e.feedback_time}),s=null,o=null,r=0;r<n.length;r++)if(n[r].feedback_time<=t.time){s=n[r];break}for(var l=0;l<n.length;l++)if(n[l].feedback_time<=a.time){o=n[l];break}return[s,o]},_taskStatusDisplay:function(e){return 0==e?"\u672A\u5F00\u59CB":1==e?"\u8FDB\u884C\u4E2D":"\u5DF2\u5B8C\u6210"},_formatTime:function(e){var t=dr.setUnix(e);return dr.formatUTC(t)},_taskStartTime:function(e){if(0==e.status)return"";var t=dr.setUnix(e.real_start_time+$d);return dr.formatUTC(t)},_taskStopTime:function(e){if(1==e.status){var t=dr.setUnix(e.predict_stop_time+$d-1);return dr.formatUTC(t)}if(2==e.status){var a=dr.setUnix(e.real_stop_time+$d-1);return dr.formatUTC(a)}return""},_generateDisplayTask:function(e,t,a){var n={name:e.name,compute_start_time:this._formatTime(e.compute_start_time),compute_stop_time:this._formatTime(e.compute_stop_time-1),last_status:"\u672A\u5F00\u59CB",last_start_time:"",last_stop_time:"",current_status:"\u672A\u5F00\u59CB",current_start_time:"",current_stop_time:""},s=this._getCurrentAndLastFeedback(e,t,a),o=ir(s,2),r=o[0],l=o[1];return null!=r&&(n.current_status=this._taskStatusDisplay(r.status),n.current_start_time=this._taskStartTime(r),n.current_stop_time=this._taskStopTime(r)),null!=l&&(n.last_status=this._taskStatusDisplay(l.status),n.last_start_time=this._taskStartTime(l),n.last_stop_time=this._taskStopTime(l)),n},_isOldVersion:function(e){var t=e.tasks[1];return!(t&&t.time_history)},getZpertProgressState:function(e){if(this._isOldVersion(e))return null;var t={has_forward_line:!1,last_forward_line_time:0,current_forward_line_time:0,refresh_sel:e.global.refresh_sel,no_change_count:0,tasks:[]};if(this._hasForwardLine(e)){t.has_forward_line=!0,this._convertUTC(e);var a=this._getCurrentAndLastForwardLine(e),n=ir(a,2),s=n[0],o=n[1];t.current_forward_line_time=this._formatTime(s.time-1),t.last_forward_line_time=this._formatTime(o.time-1);for(var r=1,l;r<e.tasks.length;r++)if(l=e.tasks[r],!(this._notStartedAfterCurrentForwardLine(l,s)||this._doneBeforeLastForwardLine(l,o)||0!=l.job_type)){var d=this._generateDisplayTask(l,s,o);t.tasks.push(d),d.last_status==d.current_status&&(t.no_change_count+=1)}}for(var p=0;p<t.tasks.length;p++)t.tasks[p].idx=p;return t}},Zd={_getZpertTime:function(e){return e=$a(e),e?dr.setUnix(e):null},_getDurationDiff:function(e,t,a){return+e===e&&+t===t?a.calcDurDaysByDuration(e-t):null},_formatStopTime:function(e){var t=dr.setUnix(dr.getUnix(e)-1);return dr.formatUTC(t)},_appendStartTimes:function(e,t,a,n){var s=this._getZpertTime(t.plan_start_time),o=a?this._getZpertTime(t.estimate_start_time):this._getZpertTime(t.real_start_time),r=this._getZpertTime(t.last_plan_start_time);return s?(e.plan_start_time=dr.formatUTC(s),e.start=t.plan_start_time):(e.plan_start_time="",e.start=null),e.real_start_time=o?dr.formatUTC(o):"",e.last_plan_start_time=r?dr.formatUTC(r):"",o&&r?(e.progress_start_diff=n.calcDuration(r,o),e.progress_start_diff=n.calcDurDaysByDuration(e.progress_start_diff)):e.progress_start_diff=null,s&&r?(e.change_start_diff=n.calcDuration(r,s),e.change_start_diff=n.calcDurDaysByDuration(e.change_start_diff)):e.change_start_diff=null,{planStartTime:s,realStartTime:o,lastPlanStartTime:r}},_appendStopTimes:function(e,t,a,n){var s=this._getZpertTime(t.plan_stop_time),o=a?this._getZpertTime(t.estimate_stop_time):this._getZpertTime(t.real_stop_time),r=this._getZpertTime(t.last_plan_stop_time);return s?(e.finish=t.plan_stop_time,e.plan_stop_time=e.finish==e.start?e.plan_start_time:this._formatStopTime(s)):(e.finish=null,e.plan_stop_time=""),o?(e.real_stop_time=this._formatStopTime(o),e.real_start_time&&e.real_stop_time<e.real_start_time&&(e.real_stop_time=e.real_start_time)):e.real_stop_time="",e.last_plan_stop_time=r?this._formatStopTime(r):"",""!=e.last_plan_start_time&&""!=e.last_plan_stop_time&&e.last_plan_stop_time<e.last_plan_start_time&&(e.last_plan_stop_time=e.last_plan_start_time),o&&r?(e.progress_stop_diff=n.calcDuration(r,o),e.progress_stop_diff=n.calcDurDaysByDuration(e.progress_stop_diff)):e.progress_stop_diff=null,s&&r?(e.change_stop_diff=n.calcDuration(r,s),e.change_stop_diff=n.calcDurDaysByDuration(e.change_stop_diff)):e.change_stop_diff=null,{planStopTime:s,realStopTime:o,lastPlanStopTime:r}},_appendDurations:function(e,t,a,n,s){var o=null,r=null;n.planStartTime&&s.planStopTime&&(r=a.calcDuration(n.planStartTime,s.planStopTime),o=a.calcDurDaysByDuration(r));var l=null,i=null;n.realStartTime&&s.realStopTime&&(i=a.calcDuration(n.realStartTime,s.realStopTime),l=a.calcDurDaysByDuration(i));var d=null,p=null;n.lastPlanStartTime&&s.lastPlanStopTime&&(p=a.calcDuration(n.lastPlanStartTime,s.lastPlanStopTime),d=a.calcDurDaysByDuration(p)),e.plan_duration=o,e.real_duration=l,e.last_plan_duration=d,e.progress_dur_diff=this._getDurationDiff(i,p,a),e.change_dur_diff=this._getDurationDiff(r,p,a)},_appendLeftTimes:function(e,t,a,n,s,o){var r=null,l=null,d=null;if(t.hasChild)t.real_stop_time&&(d=0);else{for(var p=null,c=0,u;c<t.feedbacks.length;c++)u=t.feedbacks[c],u.feedback_time<=n&&(null==p||u.feedback_time>p.feedback_time)&&(p=u);if(p)if(p.real_stop_time)d=0;else{var h=dr.setUnix(p.predict_stop_time);d=a.calcDuration(n,h)}}null!=d&&(0<=d?(l=d,r=a.calcDurDaysByDuration(l)):0>d&&(l=a.getDaySeconds(),r=a.calcDurDaysByDuration(l)));var m=null,g=null;if(o.lastPlanStopTime)if(dr.isAfterOrSame(n,o.lastPlanStopTime))m=0,g=0;else{var _=dr.isAfterOrSame(n,s.lastPlanStartTime)?n:s.lastPlanStartTime;_&&o.lastPlanStopTime&&(g=a.calcDuration(_,o.lastPlanStopTime),m=a.calcDurDaysByDuration(g))}e.real_left=r,e.last_plan_left=m,e.progress_left_diff=this._getDurationDiff(l,g,a)},_getDetailsAndResolution:function(e,t){if(e.feedbacks){for(var a="",n="",s=dr.getUnix(t),o=0,r=0,l;r<e.feedbacks.length;r++)l=e.feedbacks[r],l.feedback_time<=s&&l.feedback_time>o&&(o=l.feedback_time,a=l.details,n=l.resolution);return[a,n]}return["",""]},_extractZpertTask:function(e,t,a){var n=Wr(e.estimate_start_time),s=this._getDetailsAndResolution(e,t),o=ir(s,2),r=o[0],l=o[1],i={id:e.id,name:e.name,level:e.level,collapsed:!1,hasChild:e.hasChild,show:!0,leader:e.leader,notes:e.notes,details:r,resolution:l},d=this._appendStartTimes(i,e,n,a),p=this._appendStopTimes(i,e,n,a);this._appendDurations(i,e,a,d,p),this._appendLeftTimes(i,e,a,t,d,p);var c=!1;(i.progress_start_diff||i.progress_stop_diff||i.progress_dur_diff||i.progress_left_diff)&&(c=!0);var u=null;n&&dr.isAfterOrSame(d.realStartTime,t)&&(u=c,c=!1);var h=!1;return(i.change_start_diff||i.change_stop_diff||i.change_dur_diff)&&(h=!0),i.progress_diff=c,i.change_diff=h,i.progress_estimate_diff=u,i},_initCalendar:function(e){for(var t={},a=0,n;a<e.length;a++)n=new Vl(e[a]),t[e[a].id]=new ai(null,n.convert());return t},_setDefaultValues:function(e){e.progresses==null&&(e.progresses=[]),e.default_calendar_id==null&&(e.default_calendar_id=0);for(var t=null,a=0,n;a<e.tasks.length;a++)n=e.tasks[a],null==n.feedbacks&&(n.feedbacks=[]),n.hasChild=!1,t&&t.level==n.level-1&&(t.hasChild=!0),t=n;return e},getZpertDiff:function(e){e=this._setDefaultValues(e);for(var t=this._initCalendar(e.calendars),a=dr.setUnix(e.count_time),n=e.tasks[0],s={freeze_time:dr.formatUTC(dr.setUnix(e.count_time-1)),last_freeze_time:e.frozen_time,refresh_sel:e.plan_state,start:n.plan_start_time,ask_start:n.ask_start_time,finish:n.plan_stop_time,tasks:[]},o=t[e.default_calendar_id],r=1;r<e.tasks.length;r++){var l=e.tasks[r],d=o;if(l.calendar_id!=null&&null!=l.calendar_id&&-1<l.calendar_id){var p=t[l.calendar_id];p&&(d=p)}s.tasks.push(this._extractZpertTask(l,a,d))}for(var c=null,u=0,h;u<s.tasks.length;u++){if(h=s.tasks[u],h.id=u+1,!c)h.parentIdx=null;else if(c.level==h.level-1)h.parentIdx=u-1;else{for(var m=c;m.level!=h.level;)m=s.tasks[m.parentIdx];h.parentIdx=m.parentIdx}c=h}return s},_displayForwardLines:function(e){for(var t=[],a=0;a<e.length;a++)e[a].is_display&&t.push(e[a]);return t},_hasForwardLine:function(e){return 0<this._displayForwardLines(e).length},_startTime:function(e){return e.start||e.ask_start_time},_getCurrentAndLastForwardLine:function(e,t){var a=this._displayForwardLines(e);a=a.sort(function(e,t){return e.time-t.time});var n=a.pop(),s=a.pop();return null==s&&(s={time:this._startTime(t),notes:"",is_display:!0}),[n,s]},_notStartedAfterCurrentForwardLine:function(e,t){return e.plan_start_time>t.time},_doneBeforeLastForwardLine:function(e,t){return e.real_stop_time&&e.real_stop_time<=t.time},_getCurrentAndLastFeedback:function(e,t,a){for(var n=e.feedbacks.sort(function(e,t){return t.feedback_time-e.feedback_time}),s=null,o=null,r=0;r<n.length;r++)if(n[r].feedback_time<=t.time){s=n[r];break}for(var l=0;l<n.length;l++)if(n[l].feedback_time<=a.time){o=n[l];break}return[s,o]},_taskStatusDisplay:function(e){return 0==e?"\u672A\u5F00\u59CB":1==e?"\u8FDB\u884C\u4E2D":"\u5DF2\u5B8C\u6210"},_formatTime:function(e){var t=dr.setUnix(e);return dr.formatUTC(t)},_taskStartTime:function(e){if(0==e.status)return"";var t=dr.setUnix(e.real_start_time);return dr.formatUTC(t)},_taskStopTime:function(e){if(1==e.status){var t=dr.setUnix(e.predict_stop_time-1);return dr.formatUTC(t)}if(2==e.status){var a=dr.setUnix(e.real_stop_time-1);return dr.formatUTC(a)}return""},_generateDisplayTask:function(e,t,a){var n={name:e.name,plan_start_time:this._formatTime(e.plan_start_time),plan_stop_time:this._formatTime(e.plan_stop_time-1),last_status:"\u672A\u5F00\u59CB",last_start_time:"",last_stop_time:"",current_status:"\u672A\u5F00\u59CB",current_start_time:"",current_stop_time:"",level:e.level,hasChild:e.hasChild,collapsed:!1,show:!0},s=this._getCurrentAndLastFeedback(e,t,a),o=ir(s,2),r=o[0],l=o[1];return null!=r&&(n.current_status=this._taskStatusDisplay(r.status),n.current_start_time=this._taskStartTime(r),n.current_stop_time=this._taskStopTime(r)),null!=l&&(n.last_status=this._taskStatusDisplay(l.status),n.last_start_time=this._taskStartTime(l),n.last_stop_time=this._taskStopTime(l)),n},getZpertProgressState:function(e){e=this._setDefaultValues(e);var t={has_forward_line:!1,last_forward_line_time:0,current_forward_line_time:0,refresh_sel:e.plan_state,no_change_count:0,tasks:[]};if(this._hasForwardLine(e.progresses)){t.has_forward_line=!0;var a=this._getCurrentAndLastForwardLine(e.progresses,e.tasks[0]),n=ir(a,2),s=n[0],o=n[1];t.current_forward_line_time=this._formatTime(s.time-1),t.last_forward_line_time=this._formatTime(o.time-1);for(var r=1,l;r<e.tasks.length;r++)if(l=e.tasks[r],!(this._notStartedAfterCurrentForwardLine(l,s)||this._doneBeforeLastForwardLine(l,o)||0!=l.type)){var d=this._generateDisplayTask(l,s,o);t.tasks.push(d),d.last_status==d.current_status&&(t.no_change_count+=1)}}for(var p=0;p<t.tasks.length;p++)t.tasks[p].idx=p;return t}},Kd=function(){function e(t){hn(this,e),this.data=JSON.parse(t),this.analysis=2==this.data.version?Zd:Xd}return yn(e,[{key:"getZpertDiff",value:function(){return this.analysis.getZpertDiff(this.data)}},{key:"getZpertProgressState",value:function(){return this.analysis.getZpertProgressState(this.data)}}]),e}(),Jd=h(function(e){(function(t,a){e.exports=a()})("Clusterize",function(){function e(e,t,a){return t.addEventListener?t.addEventListener(e,a,!1):t.attachEvent("on"+e,a)}function t(e,t,a){return t.removeEventListener?t.removeEventListener(e,a,!1):t.detachEvent("on"+e,a)}function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,t){return window.getComputedStyle?window.getComputedStyle(t)[e]:t.currentStyle[e]}var s=function(){for(var e=3,t=document.createElement("b"),a=t.all||[];t.innerHTML="<!--[if gt IE "+ ++e+"]><i><![endif]-->",a[0];);return 4<e?e:document.documentMode}(),o=navigator.platform.toLowerCase().indexOf("mac")+1,r=function(n){if(!(this instanceof r))return new r(n);var s=this,l={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};s.options={};for(var d=["rows_in_block","blocks_in_cluster","show_no_data_row","no_data_class","no_data_text","keep_parity","tag","callbacks"],p=0,c;c=d[p];p++)s.options[c]="undefined"!=typeof n[c]&&null!=n[c]?n[c]:l[c];for(var u=["scroll","content"],p=0,h;h=u[p];p++)if(s[h+"_elem"]=n[h+"Id"]?document.getElementById(n[h+"Id"]):n[h+"Elem"],!s[h+"_elem"])throw new Error("Error! Could not find "+h+" element");s.content_elem.hasAttribute("tabindex")||s.content_elem.setAttribute("tabindex",0);var m=a(n.rows)?n.rows:s.fetchMarkup(),g={},f=s.scroll_elem.scrollTop;s.insertToDOM(m,g),s.scroll_elem.scrollTop=f;var _=!1,y=0,v=!1,k=function(){o&&(!v&&(s.content_elem.style.pointerEvents="none"),v=!0,clearTimeout(y),y=setTimeout(function(){s.content_elem.style.pointerEvents="auto",v=!1},50)),_!=(_=s.getClusterNum())&&s.insertToDOM(m,g),s.options.callbacks.scrollingProgress&&s.options.callbacks.scrollingProgress(s.getScrollProgress())},w=0,T=function(){clearTimeout(w),w=setTimeout(s.refresh,100)};e("scroll",s.scroll_elem,k),e("resize",window,T),s.destroy=function(e){t("scroll",s.scroll_elem,k),t("resize",window,T),s.html((e?s.generateEmptyRow():m).join(""))},s.refresh=function(e){(s.getRowsHeight(m)||e)&&s.update(m)},s.update=function(e){m=a(e)?e:[];var t=s.scroll_elem.scrollTop;m.length*s.options.item_height<t&&(s.scroll_elem.scrollTop=0,_=0),s.insertToDOM(m,g),s.scroll_elem.scrollTop=t},s.clear=function(){s.update([])},s.getRowsAmount=function(){return m.length},s.getScrollProgress=function(){return 100*(this.options.scroll_top/(m.length*this.options.item_height))||0};var R=function(e,t){var n=a(t)?t:[];n.length&&(m="append"==e?m.concat(n):n.concat(m),s.insertToDOM(m,g))};s.append=function(e){R("append",e)},s.prepend=function(e){R("prepend",e)}};return r.prototype={constructor:r,fetchMarkup:function(){for(var e=[],t=this.getChildNodes(this.content_elem);t.length;)e.push(t.shift().outerHTML);return e},exploreEnvironment:function(e,t){var a=this.options;a.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(s&&9>=s&&!a.tag&&(a.tag=e[0].match(/<([^>\s/]*)/)[1].toLowerCase()),1>=this.content_elem.children.length&&(t.data=this.html(e[0]+e[0]+e[0])),!a.tag&&(a.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))},getRowsHeight:function(e){var t=this.options,a=t.item_height;if(t.cluster_height=0,!!e.length){var s=this.content_elem.children;if(s.length){var o=s[Ot(s.length/2)];if(t.item_height=o.offsetHeight,"tr"==t.tag&&"collapse"!=n("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(n("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){var r=parseInt(n("marginTop",o),10)||0,l=parseInt(n("marginBottom",o),10)||0;t.item_height+=Mt(r,l)}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,a!=t.item_height}}},getClusterNum:function(){return this.options.scroll_top=this.scroll_elem.scrollTop,Ot(this.options.scroll_top/(this.options.cluster_height-this.options.block_height))||0},generateEmptyRow:function(){var e=this.options;if(!e.tag||!e.show_no_data_row)return[];var t=document.createElement(e.tag),a=document.createTextNode(e.no_data_text),n;return t.className=e.no_data_class,"tr"==e.tag&&(n=document.createElement("td"),n.colSpan=100,n.appendChild(a)),t.appendChild(n||a),[t.outerHTML]},generate:function(e,t){var a=this.options,n=e.length;if(n<a.rows_in_block)return{top_offset:0,bottom_offset:0,rows_above:0,rows:n?e:this.generateEmptyRow()};var s=Mt((a.rows_in_cluster-a.rows_in_block)*t,0),o=s+a.rows_in_cluster,r=Mt(s*a.item_height,0),l=Mt((n-o)*a.item_height,0),d=[],p=s;1>r&&p++;for(var c=s;c<o;c++)e[c]&&d.push(e[c]);return{top_offset:r,bottom_offset:l,rows_above:p,rows:d}},renderExtraTag:function(e,t){var a=document.createElement(this.options.tag);return a.className=["clusterize-extra-row","clusterize-"+e].join(" "),t&&(a.style.height=t+"px"),a.outerHTML},insertToDOM:function(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);var a=this.generate(e,this.getClusterNum()),n=a.rows.join(""),s=this.checkChanges("data",n,t),o=this.checkChanges("top",a.top_offset,t),r=this.checkChanges("bottom",a.bottom_offset,t),l=this.options.callbacks,i=[];s||o?(a.top_offset&&(this.options.keep_parity&&i.push(this.renderExtraTag("keep-parity")),i.push(this.renderExtraTag("top-space",a.top_offset))),i.push(n),a.bottom_offset&&i.push(this.renderExtraTag("bottom-space",a.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.html(i.join("")),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",a.rows_above),this.content_elem.style["counter-increment"]="clusterize-counter "+(a.rows_above-1),l.clusterChanged&&l.clusterChanged()):r&&(this.content_elem.lastChild.style.height=a.bottom_offset+"px")},html:function(e){var t=this.content_elem;if(s&&9>=s&&"tr"==this.options.tag){var a=document.createElement("div"),n;for(a.innerHTML="<table><tbody>"+e+"</tbody></table>";n=t.lastChild;)t.removeChild(n);for(var o=this.getChildNodes(a.firstChild.firstChild);o.length;)t.appendChild(o.shift())}else t.innerHTML=e},getChildNodes:function(e){for(var t=e.children,a=[],n=0,s=t.length;n<s;n++)a.push(t[n]);return a},checkChanges:function(e,t,a){var n=t!=a[e];return a[e]=t,n}},r})}),Qd=50,ep=function(){function e(t,a,n,s){hn(this,e),this.headerEl=t,this.contentEl=a,this.buttonsEl=n,this.name=s,this.diff=null,this.showAll=!0,this.allTime=!0,this.init()}return yn(e,[{key:"init",value:function(){this.headerValues=[],this.tripleValues=[],this.mergedRanges=[],this.startRangeInputId="",this.finishRangeInputId="",this.allRowRadioId="",this.diffRowRadioId="",this.allTimeRadioId="",this.limitTimeRadioId="",this.rowRadioName="",this.timeRadioName="",this.diffColumn="",this.contentAreaId="",this.title="",this.showAlert=!1,this.alertMessage="",this.cellsNum=0,this.resizingCol=null,this.relatedResizingCol=null,this.oldHeaderWidth=0,this.oldColWidth=0,this.oldWindowWidth=0}},{key:"destroy",value:function(){if(this.isRendered&&(this.clusterize.destroy(),this.isRendered=!1),this.headerEl){var e=this.headerEl;this.headerEl=e.cloneNode(!0),e.parentNode.replaceChild(this.headerEl,e),this.headerEl.innerHTML=""}if(this.buttonsEl){var t=this.buttonsEl;this.buttonsEl=t.cloneNode(!0),t.parentNode.replaceChild(this.buttonsEl,t),this.buttonsEl.innerHTML=""}if(this.contentEl){var a=this.contentEl;this.contentEl=a.cloneNode(!0),a.parentNode.replaceChild(this.contentEl,a)}this.contentEl.innerHTML="",window.removeEventListener("resize",this.fitHeaderWidth.bind(this))}},{key:"checkDiff",value:function(){}},{key:"setDiff",value:function(e){this.diff=e,this.checkDiff(),this.showAlert?this._alert():(this._renderHeader(),this._setTimerange(),this._updateTable())}},{key:"_renderHeader",value:function(){this.isRendered||(this.headerEl&&(this.headerEl.innerHTML=this._renderShowOptions()),this.buttonsEl&&(this.buttonsEl.innerHTML=this._renderButtons()))}},{key:"_alert",value:function(){this.destroy(),this.contentEl.innerHTML="<div class='zplan-analysis-alert'>"+this.alertMessage+"</div>"}},{key:"_setTimerange",value:function(){this.startTime=this.diff.start,this.lastStartTime=this.startTime;var e=dr.setUnix(this.diff.finish);if(this.diff.finish>this.diff.start&&0==e.getUTCHours()&&0==e.getUTCMinutes()&&0==e.getUTCSeconds()?dr.subtractDays(e,1):e=dr.getStartOfDay(e),this.finishTime=dr.getUnix(e),this.lastFinishTime=this.finishTime,this.headerEl){var t=dr.formatUTC(dr.setUnix(this.startTime)),a=dr.formatUTC(dr.setUnix(this.finishTime));this.headerEl.querySelector("#"+this.startRangeInputId).value=t,this.headerEl.querySelector("#"+this.finishRangeInputId).value=a,this.binded||(this.binded=!0,this._bindCalendar(t,a))}}},{key:"_updateTable",value:function(){var e=this;this.isRendered?this.clusterize.update(this._tbodyRows()):(this.contentEl.innerHTML=this._renderContent(),this.clusterize=new Jd({rows:this._tbodyRows(),scrollElem:this.contentEl.querySelector(".clusterize-scroll"),contentId:this.contentAreaId,item_height:40,no_data_text:"\u65E0",callbacks:{clusterChanged:function(){!0!=e.isRendered&&(e.isRendered=!0,e.fitHeaderWidth())}}}),this.clusterize.refresh(!0),this._bindResize(),window.addEventListener("resize",this.fitHeaderWidth.bind(this)))}},{key:"fitHeaderWidth",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(this.isRendered&&(window.innerWidth!=this.oldWindowWidth||e)){this.contentEl.querySelector(".zplan-analysis-table-header-con").style.width=this.contentEl.querySelector(".clusterize-scroll").clientWidth+"px",this.contentEl.querySelector(".zplan-analysis-table-header").style.width=this.contentEl.querySelector(".zplan-analysis-table").clientWidth+"px";for(var t=0;t<this.cellsNum;t++){var a=".zplan-diff-cell-"+t,n=this.contentEl.querySelector(".zplan-analysis-table "+a),s=this.contentEl.querySelector(".zplan-analysis-table-header "+a),o=Mt(Qd,n.clientWidth,s.clientWidth);s.style.width=o+"px",n.style.width=o+"px"}this.oldWindowWidth=window.innerWidth}}},{key:"_bindResize",value:function(){var e=this;this.contentEl.querySelector(".clusterize-scroll").addEventListener("scroll",function(t){e.contentEl.querySelector(".zplan-analysis-table-header-con").scrollLeft=t.target.scrollLeft});var t=this.contentEl.querySelector(".zplan-analysis-table-header");t.addEventListener("mousedown",function(a){var n=a.target.closest("th");if(n){var s=a.pageX-n.getBoundingClientRect().left,o=/zplan-diff-cell-(\d+)/.exec(n.className)[1];s<Qd?(--o,e.resizingCol=t.querySelector(".zplan-diff-cell-"+o)):n.clientWidth-s<Qd&&(e.resizingCol=t.querySelector(".zplan-diff-cell-"+o)),e.resizingCol&&(e.relatedResizingCol=e.contentEl.querySelector(".zplan-analysis-table .zplan-diff-cell-"+o),e.oldColWidth=e.resizingCol.clientWidth,e.oldHeaderWidth=t.clientWidth)}}),t.addEventListener("mousemove",function(e){var t=e.target.closest("th");if(t){var a=e.pageX-t.getBoundingClientRect().left;!t.classList.contains("zplan-diff-cell-0")&&a<Qd||t.clientWidth-a<Qd?t.classList.add("resizing"):t.classList.remove("resizing")}}),this.contentEl.addEventListener("mousemove",function(t){if(e.resizingCol){var a=t.pageX-e.resizingCol.getBoundingClientRect().left;if(a>Qd){e.resizingCol.style.width=a+"px",e.relatedResizingCol.style.width=a+"px";var n=e.oldHeaderWidth+a-e.oldColWidth+"px";e.contentEl.querySelector(".zplan-analysis-table-header").style.width=n,e.contentEl.querySelector(".zplan-analysis-table").style.width=n}}}),this.contentEl.addEventListener("mouseup",function(){if(e.resizingCol){for(var t=e.contentEl.querySelectorAll(".resizing"),a=0;a<t.length;a++)t[a].classList.remove("resizing");e.resizingCol=null,e.relatedResizingCol=null,e.oldColWidth=0,e.oldHeaderWidth=0}})}},{key:"_changeTimerange",value:function(){var e=!1;this.lastStartTime!=this.startTime&&(this.lastStartTime=this.startTime,e=!0),this.lastFinishTime!=this.finishTime&&(this.lastFinishTime=this.finishTime,e=!0),e&&this._updateTable()}},{key:"_htmlEncode",value:function(e){if(null==e||null==e)return"";e=e.toString();var t="";return 0==e.length?"":(t=e.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"),t)}},{key:"_onClickStartRangeInput",value:function(e,t,a){var n=this;if(!(e.target.id!=this.startRangeInputId||this.allTime)){var s=document.querySelector("#"+this.startRangeInputId),o=document.querySelector("#"+this.finishRangeInputId),r=dr.parseDayStr(o.value);r=dr.convertToUTC(r);var l=a.getTime()>r.getTime()?new Date(r):new Date(a);this.startCal&&this.startCal.destroy(),this.startCal=new Pikaday({showTime:!1,i18n:Yo.pikaday,field:s,trigger:s,minDate:dr.convertToLocal(t),maxDate:dr.convertToLocal(l),format:"YYYY-MM-DD",toString:function(e){return dr.format(e)},onClose:function(){dr.isValid(s.value)||(s.value=n.startCal.toString("YYYY-MM-DD"));var e=s.value,t=dr.parseDayStr(e);"Invalid Date"!=t&&(n.startTime=dr.getUnix(dr.convertToUTC(t)),n._changeTimerange(),n.startCal.destroy())}}),this.startCal.show()}}},{key:"_onClickFinishRangeInput",value:function(e,t,a){var n=this;if(!(e.target.id!=this.finishRangeInputId||this.allTime)){var s=document.querySelector("#"+this.startRangeInputId),o=document.querySelector("#"+this.finishRangeInputId),r=dr.parseDayStr(s.value);r=dr.convertToUTC(r);var l=t.getTime()>r.getTime()?new Date(t):new Date(r);this.finishCal&&this.finishCal.destroy(),this.finishCal=new Pikaday({showTime:!1,i18n:Yo.pikaday,field:o,trigger:o,minDate:dr.convertToLocal(l),maxDate:dr.convertToLocal(a),format:"YYYY-MM-DD",toString:function(e){return dr.format(e)},onClose:function(){dr.isValid(o.value)||(o.value=n.finishCal.toString("YYYY-MM-DD"));var e=o.value,t=dr.parseDayStr(e);n.finishTime=dr.getUnix(dr.convertToUTC(t)),n._changeTimerange(),n.finishCal.destroy()}}),this.finishCal.show()}}},{key:"_bindCalendar",value:function(e,t){var a=this,n=dr.parseDayStr(e),s=dr.parseDayStr(t);n=dr.convertToUTC(n),s=dr.convertToUTC(s),this.headerEl.addEventListener("click",function(e){a._onClickStartRangeInput(e,n,s),a._onClickFinishRangeInput(e,n,s)})}},{key:"_bindRadio",value:function(){var e=this;this.headerEl.addEventListener("click",function(t){t.target.id==e.allRowRadioId?!0!=e.showAll&&(e.showAll=!0,e._updateTable()):t.target.id==e.diffRowRadioId?!1!=e.showAll&&(e.showAll=!1,e._updateTable()):t.target.id==e.allTimeRadioId?!0!=e.allTime&&(e.allTime=!0,e.headerEl.querySelectorAll(".zplan-analysis-time-range").forEach(function(e){return e.setAttribute("disabled","disabled")}),e._updateTable()):t.target.id==e.limitTimeRadioId&&!1!=e.allTime&&(e.allTime=!1,e.headerEl.querySelectorAll(".zplan-analysis-time-range").forEach(function(e){return e.removeAttribute("disabled")}),e._updateTable())})}},{key:"_renderShowOptions",value:function(){return this._bindRadio(),"\n\t\t\t<h3>"+this.title+"</h3>\n\t\t\t<div class='zplan-analysis-row'>\n\t\t\t\t<span class='zplan-analysis-row-title'>\u663E\u793A\u9009\u9879\uFF1A</span>\n\t\t\t\t<label class='zplan-analysis-row-radio'>\n\t\t\t\t\t<input id='"+this.allRowRadioId+"' name='"+this.rowRadioName+"' type='radio' "+(this.showAll?"checked='checked'":"")+">\u5168\u90E8</label>\n\t\t\t\t<label class='zplan-analysis-row-radio'>\n\t\t\t\t\t<input id='"+this.diffRowRadioId+"' name='"+this.rowRadioName+"' type='radio' "+(this.showAll?"":"checked='checked'")+">\u4EC5\u663E\u793A\u6709\u5DEE\u5F02</label>\n\t\t\t</div>\n\t\t\t<div class='zplan-analysis-row'>\n\t\t\t\t<span class='zplan-analysis-row-title'>\u65F6\u95F4\u8303\u56F4\uFF1A</span>\n\t\t\t\t<label class='zplan-analysis-row-radio'>\n\t\t\t\t\t<input id='"+this.allTimeRadioId+"' name='"+this.timeRadioName+"' type='radio' "+(this.allTime?"checked='checked'":"")+">\u5168\u90E8</label>\n\t\t\t\t<label class='zplan-analysis-row-radio'>\n\t\t\t\t\t<input id='"+this.limitTimeRadioId+"' name='"+this.timeRadioName+"' type='radio' "+(this.allTime?"":"checked='checked'")+">\u4ECE</label>\n\t\t\t\t<input id='"+this.startRangeInputId+"' class='zplan-analysis-time-range' "+(this.allTime?"disabled='disabled'":"")+"></input>\n\t\t\t\t<span>\u5230</span>\n\t\t\t\t\t<input id='"+this.finishRangeInputId+"' class='zplan-analysis-time-range' "+(this.allTime?"disabled='disabled'":"")+"></input>\n\t\t\t</div>\n\t\t\t"}},{key:"_renderButtons",value:function(){var e=this;return this.buttonsEl.addEventListener("click",function(t){if(t.target.classList.contains("export_diff_btn")){var a=t.target.getAttribute("export-type");e._exportExcel(a)}}),"\n\t\t\t<div class='zplan-dropdown'>\n\t\t\t\t<button class='zplan-btn zplan-dropdown-toggle' type='button'>\n\t\t\t\t\t\u5BFC\u51FAexcel\n\t\t\t\t\t<span class='zplan-caret'></span>\n\t\t\t\t</button>\n\t\t\t\t<ul class='zplan-dropdown-menu'>\n\t\t\t\t\t<li><a class='export_diff_btn'>\u5355\u884C\u5F0F</a></li>\n\t\t\t\t\t<li><a class='export_diff_btn' export-type='triple'>\u4E09\u884C\u5F0F</a></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t"}},{key:"_partialRowTempl",value:function(e,t,a){for(var n="",s=0;s<t.length;s++)n+="<"+e+" class='zplan-diff-row-cell zplan-diff-cell-"+(a+s)+"'>"+t[s]+"</"+e+">";return n}},{key:"_rowTemplate",value:function(){return[]}},{key:"_beforeOrAfter",value:function(e,t,a){var n="";return null!=e&&(0==e?(n="\u6B63\u5E38(0)","json"==t&&(n={v:n})):0<e?(n="\u6EDE\u540E"+e+"\u5929(+"+e+")",a&&(n="\u53EF\u80FD"+n),"html"==t?n="<span class='zplan-analysis-after'>"+this._htmlEncode(n)+"</span>":"json"==t&&(n={v:n,style:{fontColor:"FF0000"}})):0>e&&(n="\u63D0\u524D"+-1*e+"\u5929("+e+")",a&&(n="\u53EF\u80FD"+n),"html"==t?n="<span class='zplan-analysis-before'>"+this._htmlEncode(n)+"</span>":"json"==t&&(n={v:n,style:{fontColor:"00B050"}}))),n}},{key:"_dayDiff",value:function(e,t,a){var n="";return null!=e&&(0==e?(n="\u6B63\u5E38(0)","json"==t&&(n={v:n})):0<e?(n="\u5EF6\u957F"+e+"\u5929(+"+e+")",a&&(n="\u53EF\u80FD"+n),"html"==t?n="<span class='zplan-analysis-after'>"+this._htmlEncode(n)+"</span>":"json"==t&&(n={v:n,style:{fontColor:"FF0000"}})):0>e&&(n="\u7F29\u77ED"+-1*e+"\u5929("+e+")",a&&(n="\u53EF\u80FD"+n),"html"==t?n="<span class='zplan-analysis-before'>"+this._htmlEncode(n)+"</span>":"json"==t&&(n={v:n,style:{fontColor:"00B050"}}))),n}},{key:"_extractTaskValues",value:function(){return[]}},{key:"_filterRows",value:function(){return[]}},{key:"_tbodyRows",value:function(){for(var e=this._filterRows(),t=[],a=0,n;a<e.length;a++)n=e[a],t=t.concat(this._rowTemplate("td",this._extractTaskValues(n,"html")));return t}},{key:"_renderContent",value:function(){}},{key:"_convertToTriple",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=[],n=0;n<this.tripleValues.length;n++){for(var s=this.tripleValues[n],o=[],r=0;r<s.length;r++)o.push(e[s[r]]);a.push({level:t,cols:o})}return a}},{key:"_excelHeaderRows",value:function(e){var t=this.headerValues.map(function(e){return{v:e}}),a=void 0;return a="triple"==e?this._convertToTriple(t):[{cols:t}],a}},{key:"_excelMergedRanges",value:function(e){return"triple"==e?this.mergedRanges:[]}},{key:"_excelBodyRows",value:function(e){for(var t=this._filterRows(),a=[],n=0;n<t.length;n++){var s=t[n],o=this._extractTaskValues(s,"json"),r=s.level;0<r&&--r,"triple"==e?a.push(this._convertToTriple(o,r)):a.push([{level:r,cols:o}])}return a}},{key:"_exportExcel",value:function(e){var t={header:{rows:this._excelHeaderRows(e),mergedRanges:this._excelMergedRanges(e)},body:{rows:this._excelBodyRows(e),mergedRanges:this._excelMergedRanges(e)}};new fi(this.name,t).export()}}]),e}(),tp=function(e){function t(e,a,n,s){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s))}return Eo(t,e),yn(t,[{key:"_filterRows",value:function(){for(var e=[],t=this.finishTime+86400,a=0,n;a<this.diff.tasks.length;a++)if(n=this.diff.tasks[a],this.showAll||n[this.diffColumn]){var s=n.start&&n.start>t,o=n.finish&&n.finish<=this.startTime;!this.allTime&&(this.allTime||s||o)||e.push(n)}return e}}]),t}(ep),ap=function(e){function t(e,a,n,s){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s))}return Eo(t,e),yn(t,[{key:"init",value:function(){this.headerValues=["\u5E8F\u53F7","\u5DE5\u4F5C\u540D\u79F0","\u539F\u8BA1\u5212\u5F00\u59CB","\u539F\u8BA1\u5212\u7ED3\u675F","\u539F\u8BA1\u5212\u5DE5\u671F","\u8BA1\u5212\u5F00\u59CB","\u8BA1\u5212\u7ED3\u675F","\u8BA1\u5212\u5DE5\u671F","\u65F6\u95F4\u5DEE","\u65F6\u95F4\u5DEE","\u5DE5\u671F\u5DEE","\u8D1F\u8D23\u4EBA","\u5907\u6CE8","\u504F\u5DEE\u539F\u56E0","\u89E3\u51B3\u63AA\u65BD"],this.startRangeInputId="change_start_range_input",this.finishRangeInputId="change_finish_range_input",this.allRowRadioId="all_tasks_radio",this.diffRowRadioId="change_tasks_radio",this.allTimeRadioId="change_all_time_radio",this.limitTimeRadioId="change_time_range_radio",this.rowRadioName="show_tasks_radio",this.timeRadioName="show_change_time_radio",this.diffColumn="change_diff",this.colNum=3,this.contentAreaId="taskChangeContentArea",this.title="\u8BA1\u5212\u53D8\u52A8\u5206\u6790",this.tripleValues=[[0,1,2,3,4,11,12,13,14],[0,1,5,6,7,11,12,13,14],[0,1,8,9,10,11,12,13,14]],this.mergedRanges=[[0,0,2,0],[0,1,2,1],[0,5,2,5],[0,6,2,6],[0,7,2,7],[0,8,2,8]],this.alertMessage="\u6CA1\u6709\u53EF\u5BF9\u6BD4\u7684\u8BA1\u5212\uFF0C\u8BF7\u5728\u5BA2\u6237\u7AEF\u62C9\u76F4\u524D\u950B\u7EBF\u540E\uFF0C\u518D\u67E5\u770B",this.cellsNum=9}},{key:"checkDiff",value:function(){this.showAlert=315504e3==this.diff.last_freeze_time||0==this.diff.last_freeze_time}},{key:"_rowTemplate",value:function(e,t){return["<tr>\n        <th rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-0' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[0]+"</div>\n        </th>\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-1'>\n          <div class=\"zplan-analysis-auto\">"+t[1]+"</div>\n        </"+e+">\n        "+this._partialRowTempl(e,[t[2],t[3],t[4]],2)+"\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-5' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[11]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-6' style='min-width:40px'>\n          <div class='zplan-analysis-auto'>"+t[12]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-7' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[13]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-8' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[14]+"</div>\n        </"+e+"></tr>","<tr>"+this._partialRowTempl(e,[t[5],t[6],t[7]],2)+"</tr>","<tr>"+this._partialRowTempl(e,[t[8],t[9],t[10]],2)+"</tr>"]}},{key:"_extractTaskValues",value:function(e,t){var a=[e.idx+1,e.name,e.last_plan_start_time,e.last_plan_stop_time,e.last_plan_duration,e.compute_start_time,e.compute_stop_time,e.compute_duration],n=this;return a="json"==t?a.map(function(e){return{v:e}}):a.map(function(e){return n._htmlEncode(e)}),a.push(n._beforeOrAfter(e.change_start_diff,t)),a.push(n._beforeOrAfter(e.change_stop_diff,t)),a.push(n._dayDiff(e.change_dur_diff,t)),"json"==t?(a.push({v:e.leader}),a.push({v:e.notes}),a.push({v:e.details}),a.push({v:e.resolution})):(a.push(n._htmlEncode(e.leader)),a.push(n._htmlEncode(e.notes)),a.push(n._htmlEncode(e.details)),a.push(n._htmlEncode(e.resolution))),a}},{key:"_renderContent",value:function(){var e=this._rowTemplate("th",this.headerValues);return"\n      <div class='zplan-analysis-table-header-con'>\n        <table class='zplan-analysis-table-header'>\n          <thead>"+e.join("")+"</thead>\n        </table>\n      </div>\n      <div class='clusterize-scroll'>\n        <table class='zplan-analysis-table'>\n          <thead>\n            <tr>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-0\" style='min-width:50px'>\u5E8F\u53F7</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-1\">\u5DE5\u4F5C\u540D\u79F0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-2\">\u539F\u8BA1\u5212\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-3\">\u539F\u8BA1\u5212\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-4\">\u539F\u8BA1\u5212\u5DE5\u671F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-5\" style='min-width:50px'>\u8D1F\u8D23\u4EBA</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-6\" style='min-width:40px'>\u5907\u6CE8</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-7\" style='min-width:70px'>\u504F\u5DEE\u539F\u56E0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-8\" style='min-width:70px'>\u89E3\u51B3\u63AA\u65BD</th>\n            </tr>\n          </thead>\n          <tbody id='"+this.contentAreaId+"' class='clusterize-content'></tbody>\n        </table>\n      </div>"}}]),t}(tp),np=function(e){function t(e,a,n,s){hn(this,t);var o=wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s));return o._bindRowExpand(),o}return Eo(t,e),yn(t,[{key:"_onClickExpanded",value:function(e){if(e.target.classList.contains("zplan-diff-expanded")){var t=e.target.closest("tr").getAttribute("row-id");t=$a(t);var a=this.diff.tasks[t-1];a.collapsed=!0;for(var n=t,s=this.diff.tasks[n];s&&s.level>a.level;)s.show=!1,n+=1,s=this.diff.tasks[n];this._updateTable()}}},{key:"_onClickCollapsed",value:function(e){if(e.target.classList.contains("zplan-diff-collapsed")){var t=e.target.closest("tr").getAttribute("row-id");t=$a(t);var a=this.diff.tasks[t-1];a.collapsed=!1;var n={};n[a.level]=a.collapsed;for(var s=t,o=this.diff.tasks[s];o&&o.level>a.level;)n[o.level-1]?n[o.level]=!0:(o.show=!0,n[o.level]=o.collapsed),s+=1,o=this.diff.tasks[s];this._updateTable()}}},{key:"_bindRowExpand",value:function(){var e=this;this.contentEl.addEventListener("click",function(t){e._onClickExpanded(t),e._onClickCollapsed(t)})}},{key:"_filterRows",value:function(){for(var e=[],t=new Al,a=this.finishTime+86400,n=0,s;n<this.diff.tasks.length;n++)if(s=this.diff.tasks[n],this.showAll||s[this.diffColumn]){var o=s.start&&s.start>a,r=s.finish&&s.finish<=this.startTime;if(this.allTime||!this.allTime&&!o&&!r){t.add(s.id);for(var l=s.parentIdx,d;l;)d=this.diff.tasks[l],t.add(d.id),l=d.parentIdx}}t=tl(t),t=t.sort(function(e,t){return e-t});for(var p=0;p<t.length;p++){var c=t[p],u=this.diff.tasks[c-1];u.show&&e.push(u)}return e}}]),t}(ep),sp=function(e){function t(e,a,n,s){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s))}return Eo(t,e),yn(t,[{key:"init",value:function(){this.headerValues=["\u5E8F\u53F7","\u5DE5\u4F5C\u540D\u79F0","\u539F\u8BA1\u5212\u5F00\u59CB","\u539F\u8BA1\u5212\u7ED3\u675F","\u539F\u8BA1\u5212\u5DE5\u671F","\u8BA1\u5212\u5F00\u59CB","\u8BA1\u5212\u7ED3\u675F","\u8BA1\u5212\u5DE5\u671F","\u65F6\u95F4\u5DEE","\u65F6\u95F4\u5DEE","\u5DE5\u671F\u5DEE","\u8D1F\u8D23\u4EBA","\u5907\u6CE8","\u504F\u5DEE\u539F\u56E0","\u89E3\u51B3\u63AA\u65BD"],this.startRangeInputId="change_start_range_input",this.finishRangeInputId="change_finish_range_input",this.allRowRadioId="all_tasks_radio",this.diffRowRadioId="change_tasks_radio",this.allTimeRadioId="change_all_time_radio",this.limitTimeRadioId="change_time_range_radio",this.rowRadioName="show_tasks_radio",this.timeRadioName="show_change_time_radio",this.diffColumn="change_diff",this.colNum=3,this.contentAreaId="taskChangeContentArea",this.title="\u8BA1\u5212\u53D8\u52A8\u5206\u6790",this.tripleValues=[[0,1,2,3,4,11,12,13,14],[0,1,5,6,7,11,12,13,14],[0,1,8,9,10,11,12,13,14]],this.mergedRanges=[[0,0,2,0],[0,1,2,1],[0,5,2,5],[0,6,2,6],[0,7,2,7],[0,8,2,8]],this.alertMessage="\u6CA1\u6709\u53EF\u5BF9\u6BD4\u7684\u8BA1\u5212\uFF0C\u8BF7\u5728\u5BA2\u6237\u7AEF\u62C9\u76F4\u524D\u950B\u7EBF\u540E\uFF0C\u518D\u67E5\u770B",this.cellsNum=9}},{key:"checkDiff",value:function(){this.showAlert=null==this.diff.last_freeze_time||0==this.diff.last_freeze_time||this.diff.last_freeze_time==this.diff.ask_start}},{key:"_rowTemplate",value:function(e,t){var a=t[15],n=t[16]||1,s=t[17]||!1,o=t[18]||!1,r="zplan-diff-rowspan-cell",l=0,i="";return"td"==e&&(r+=" zplan-diff-name-cell",l=10*(n-1)+12,s?o?i="<i class=\"zplan-diff-collapsed\"></i>":i="<i class=\"zplan-diff-expanded\"></i>":l+=18),["<tr row-id='"+a+"'>\n        <th rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-0' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[0]+"</div>\n        </th>\n        <"+e+" rowspan='3' class='"+r+" zplan-diff-cell-1'>\n          <div class=\"zplan-analysis-auto\" style='margin-left: "+l+"px'>\n            "+i+"\n            "+t[1]+"\n          </div>\n        </"+e+">\n        "+this._partialRowTempl(e,[t[2],t[3],t[4]],2)+"\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-5' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[11]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-6' style='min-width:40px'>\n          <div class='zplan-analysis-auto'>"+t[12]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-7' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[13]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-8' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[14]+"</div>\n        </"+e+"></tr>","<tr>"+this._partialRowTempl(e,[t[5],t[6],t[7]],2)+"</tr>","<tr>"+this._partialRowTempl(e,[t[8],t[9],t[10]],2)+"</tr>"]}},{key:"_extractTaskValues",value:function(e,t){var a=[e.id,e.name,e.last_plan_start_time,e.last_plan_stop_time,e.last_plan_duration,e.plan_start_time,e.plan_stop_time,e.plan_duration],n=this;return a="json"==t?a.map(function(e){return{v:e}}):a.map(function(e){return n._htmlEncode(e)}),a.push(n._beforeOrAfter(e.change_start_diff,t)),a.push(n._beforeOrAfter(e.change_stop_diff,t)),a.push(n._dayDiff(e.change_dur_diff,t)),"json"==t?(a.push({v:e.leader}),a.push({v:e.notes}),a.push({v:e.details}),a.push({v:e.resolution})):(a.push(n._htmlEncode(e.leader)),a.push(n._htmlEncode(e.notes)),a.push(n._htmlEncode(e.details)),a.push(n._htmlEncode(e.resolution))),a.push(e.id,e.level,e.hasChild,e.collapsed),a}},{key:"_renderContent",value:function(){var e=this._rowTemplate("th",this.headerValues,-1);return"\n      <div class='zplan-analysis-table-header-con'>\n        <table class='zplan-analysis-table-header'>\n          <thead>"+e.join("")+"</thead>\n        </table>\n      </div>\n      <div class='clusterize-scroll'>\n        <table class='zplan-analysis-table'>\n          <thead>\n            <tr>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-0\" style='min-width:50px'>\u5E8F\u53F7</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-1\">\u5DE5\u4F5C\u540D\u79F0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-2\">\u539F\u8BA1\u5212\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-3\">\u539F\u8BA1\u5212\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-4\">\u539F\u8BA1\u5212\u5DE5\u671F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-5\" style='min-width:50px'>\u8D1F\u8D23\u4EBA</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-6\" style='min-width:40px'>\u5907\u6CE8</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-7\" style='min-width:70px'>\u504F\u5DEE\u539F\u56E0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-8\" style='min-width:70px'>\u89E3\u51B3\u63AA\u65BD</th>\n            </tr>\n          </thead>\n          <tbody id='"+this.contentAreaId+"' class='clusterize-content'></tbody>\n        </table>\n      </div>"}}]),t}(np),op=function(){function e(t,a,n,s){hn(this,e),this.headerEl=this._getElement(t),this.tableEl=this._getElement(a),this.buttonsEl=this._getElement(n),this.name=s}return yn(e,[{key:"_getElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument?e:e&&""!=e?document.querySelector(e):void 0}},{key:"setZpert",value:function(e){var t=new Kd(e);this.instance&&this.instance.destroy(),this.instance=2==t.data.version?new sp(this.headerEl,this.tableEl,this.buttonsEl,this.name):new ap(this.headerEl,this.tableEl,this.buttonsEl,this.name),this.instance.setDiff(t.getZpertDiff())}}]),e}(),rp=function(e){function t(e,a,n,s){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s))}return Eo(t,e),yn(t,[{key:"init",value:function(){this.headerValues=["\u5E8F\u53F7","\u5DE5\u4F5C\u540D\u79F0","\u8BA1\u5212\u5F00\u59CB","\u8BA1\u5212\u7ED3\u675F","\u8BA1\u5212\u5DE5\u671F","\u8BA1\u5212\u5269\u4F59\u65F6\u95F4","\u5B9E\u9645\u5F00\u59CB","\u5B9E\u9645\u7ED3\u675F","\u5B9E\u9645\u5DE5\u671F","\u9884\u8BA1\u5269\u4F59\u65F6\u95F4","\u5F00\u59CB\u65F6\u95F4\u5DEE","\u7ED3\u675F\u65F6\u95F4\u5DEE","\u5DE5\u671F\u5DEE\u5F02","\u5269\u4F59\u5DEE\u5F02","\u8D1F\u8D23\u4EBA","\u5907\u6CE8","\u504F\u5DEE\u539F\u56E0","\u89E3\u51B3\u63AA\u65BD"],this.startRangeInputId="progress_start_range_input",this.finishRangeInputId="progress_finish_range_input",this.allRowRadioId="all_progress_radio",this.diffRowRadioId="diff_progress_radio",this.allTimeRadioId="progress_all_time_radio",this.limitTimeRadioId="progress_time_range_radio",this.rowRadioName="show_progress_radio",this.timeRadioName="show_progress_time_radio",this.diffColumn="progress_diff",this.contentAreaId="progressDiffContentArea",this.title="\u8FDB\u5EA6\u5BF9\u6BD4\u5206\u6790",this.tripleValues=[[0,1,2,3,4,5,14,15,16,17],[0,1,6,7,8,9,14,15,16,17],[0,1,10,11,12,13,14,15,16,17]],this.mergedRanges=[[0,0,2,0],[0,1,2,1],[0,6,2,6],[0,7,2,7],[0,8,2,8],[0,9,2,9]],this.alertMessage="\u8BF7\u5728\u5BA2\u6237\u7AEF\u5148\u8BBE\u7F6E\u524D\u950B\u7EBF\u5E76\u8F93\u5165\u5B9E\u9645\u8FDB\u5EA6\u6570\u636E\u540E\uFF0C\u518D\u67E5\u770B",this.cellsNum=10}},{key:"checkDiff",value:function(){this.showAlert=1!=this.diff.refresh_sel}},{key:"_rowTemplate",value:function(e,t){return["<tr>\n        <th rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-0' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[0]+"</div>\n        </th>\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-1'>\n          <div class=\"zplan-analysis-auto\">"+t[1]+"</div>\n        </"+e+">\n        "+this._partialRowTempl(e,[t[2],t[3],t[4],t[5]],2)+"\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-6' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[14]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-7' style='min-width:40px'>\n          <div class='zplan-analysis-auto'>"+t[15]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-8' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[16]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-9' style='min-width:70px'>\n          <div class='zplan-analysis-auto'>"+t[17]+"</div>\n        </"+e+">\n\t\t\t</tr>","<tr>"+this._partialRowTempl(e,[t[6],t[7],t[8],t[9]],2)+"</tr>","<tr>"+this._partialRowTempl(e,[t[10],t[11],t[12],t[13]],2)+"</tr>"]}},{key:"_extractTaskValues",value:function(e,t){var a=[e.idx+1,e.name,e.last_plan_start_time,e.last_plan_stop_time,e.last_plan_duration,e.last_plan_left,e.real_start_time,e.real_stop_time,e.real_duration,e.real_left],n=this;return a="json"==t?a.map(function(e){return{v:e}}):a.map(function(e){return n._htmlEncode(e)}),a.push(n._beforeOrAfter(e.progress_start_diff,t,e.progress_estimate_diff)),a.push(n._beforeOrAfter(e.progress_stop_diff,t,e.progress_estimate_diff)),a.push(n._dayDiff(e.progress_dur_diff,t,e.progress_estimate_diff)),a.push(n._dayDiff(e.progress_left_diff,t,e.progress_estimate_diff)),"json"==t?(a.push({v:e.leader}),a.push({v:e.notes}),a.push({v:e.details}),a.push({v:e.resolution})):(a.push(n._htmlEncode(e.leader)),a.push(n._htmlEncode(e.notes)),a.push(n._htmlEncode(e.details)),a.push(n._htmlEncode(e.resolution))),a}},{key:"_renderContent",value:function(){var e=this._rowTemplate("th",this.headerValues);return"\n      <h5>\u5F53\u524D\u8FDB\u5EA6\u7684\u7EDF\u8BA1\u65F6\u95F4\u4E3A\uFF1A"+this.diff.freeze_time+"</h5>\n      <div class='zplan-analysis-table-header-con'>\n        <table class='zplan-analysis-table-header'>\n          <thead>"+e.join("")+"</thead>\n        </table>\n      </div>\n      <div class='clusterize-scroll'>\n        <table class='zplan-analysis-table'>\n          <thead>\n            <tr>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-0\" style='min-width:50px'>\u5E8F\u53F7</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-1\">\u5DE5\u4F5C\u540D\u79F0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-2\">\u8BA1\u5212\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-3\">\u8BA1\u5212\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-4\">\u8BA1\u5212\u5DE5\u671F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-5\">\u8BA1\u5212\u5269\u4F59\u65F6\u95F4</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-6\" style='min-width:50px'>\u8D1F\u8D23\u4EBA</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-7\" style='min-width:40px'>\u5907\u6CE8</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-8\" style='min-width:70px'>\u504F\u5DEE\u539F\u56E0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-9\" style='min-width:70px'>\u89E3\u51B3\u63AA\u65BD</th>\n            </tr>\n          </thead>\n          <tbody id='"+this.contentAreaId+"' class='clusterize-content'></tbody>\n        </table>\n      </div>\n\t\t\t"}}]),t}(tp),lp=function(e){function t(e,a,n,s){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n,s))}return Eo(t,e),yn(t,[{key:"init",value:function(){this.headerValues=["\u5E8F\u53F7","\u5DE5\u4F5C\u540D\u79F0","\u8BA1\u5212\u5F00\u59CB","\u8BA1\u5212\u7ED3\u675F","\u8BA1\u5212\u5DE5\u671F","\u8BA1\u5212\u5269\u4F59\u65F6\u95F4","\u5B9E\u9645\u5F00\u59CB","\u5B9E\u9645\u7ED3\u675F","\u5B9E\u9645\u5DE5\u671F","\u9884\u8BA1\u5269\u4F59\u65F6\u95F4","\u5F00\u59CB\u65F6\u95F4\u5DEE","\u7ED3\u675F\u65F6\u95F4\u5DEE","\u5DE5\u671F\u5DEE\u5F02","\u5269\u4F59\u5DEE\u5F02","\u8D1F\u8D23\u4EBA","\u5907\u6CE8","\u504F\u5DEE\u539F\u56E0","\u89E3\u51B3\u63AA\u65BD"],this.startRangeInputId="progress_start_range_input",this.finishRangeInputId="progress_finish_range_input",this.allRowRadioId="all_progress_radio",this.diffRowRadioId="diff_progress_radio",this.allTimeRadioId="progress_all_time_radio",this.limitTimeRadioId="progress_time_range_radio",this.rowRadioName="show_progress_radio",this.timeRadioName="show_progress_time_radio",this.diffColumn="progress_diff",this.colNum=4,this.contentAreaId="progressDiffContentArea",this.title="\u8FDB\u5EA6\u5BF9\u6BD4\u5206\u6790",this.tripleValues=[[0,1,2,3,4,5,14,15,16,17],[0,1,6,7,8,9,14,15,16,17],[0,1,10,11,12,13,14,15,16,17]],this.mergedRanges=[[0,0,2,0],[0,1,2,1],[0,6,2,6],[0,7,2,7],[0,8,2,8],[0,9,2,9]],this.alertMessage="\u8BF7\u5728\u5BA2\u6237\u7AEF\u5148\u8BBE\u7F6E\u524D\u950B\u7EBF\u5E76\u8F93\u5165\u5B9E\u9645\u8FDB\u5EA6\u6570\u636E\u540E\uFF0C\u518D\u67E5\u770B",this.cellsNum=10}},{key:"checkDiff",value:function(){this.showAlert=1!=this.diff.refresh_sel}},{key:"_rowTemplate",value:function(e,t){var a=t[18],n=t[19]||1,s=t[20]||!1,o=t[21]||!1,r="zplan-diff-rowspan-cell",l=0,i="";return"td"==e&&(r+=" zplan-diff-name-cell",l=10*(n-1)+12,s?o?i="<i class=\"zplan-diff-collapsed\"></i>":i="<i class=\"zplan-diff-expanded\"></i>":l+=18),["<tr row-id='"+a+"'>\n        <th rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-0' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[0]+"</div>\n        </th>\n\t\t\t\t<"+e+" rowspan='3' class='"+r+" zplan-diff-cell-1'>\n\t\t\t\t\t<div class=\"zplan-analysis-auto\" style='margin-left: "+l+"px'>\n\t\t\t\t\t\t"+i+"\n\t\t\t\t\t\t"+t[1]+"\n\t\t\t\t\t</div>\n\t\t\t\t</"+e+">\n\t\t\t\t"+this._partialRowTempl(e,[t[2],t[3],t[4],t[5]],2)+"\n\t\t\t\t<"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-6' style='min-width:50px'>\n          <div class='zplan-analysis-auto'>"+t[14]+"</div>\n\t\t\t\t</"+e+">\n\t\t\t\t<"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-7' style='min-width:40px'>\n\t\t\t\t\t<div class='zplan-analysis-auto'>"+t[15]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-8' style='min-width:70px'>\n\t\t\t\t\t<div class='zplan-analysis-auto'>"+t[16]+"</div>\n        </"+e+">\n        <"+e+" rowspan='3' class='zplan-diff-rowspan-cell zplan-diff-cell-9' style='min-width:70px'>\n\t\t\t\t\t<div class='zplan-analysis-auto'>"+t[17]+"</div>\n\t\t\t\t</"+e+">\n\t\t\t</tr>","<tr>"+this._partialRowTempl(e,[t[6],t[7],t[8],t[9]],2)+"</tr>","<tr>"+this._partialRowTempl(e,[t[10],t[11],t[12],t[13]],2)+"</tr>"]}},{key:"_extractTaskValues",value:function(e,t){var a=[e.id,e.name,e.last_plan_start_time,e.last_plan_stop_time,e.last_plan_duration,e.last_plan_left,e.real_start_time,e.real_stop_time,e.real_duration,e.real_left],n=this;return a="json"==t?a.map(function(e){return{v:e}}):a.map(function(e){return n._htmlEncode(e)}),a.push(n._beforeOrAfter(e.progress_start_diff,t,e.progress_estimate_diff)),a.push(n._beforeOrAfter(e.progress_stop_diff,t,e.progress_estimate_diff)),a.push(n._dayDiff(e.progress_dur_diff,t,e.progress_estimate_diff)),a.push(n._dayDiff(e.progress_left_diff,t,e.progress_estimate_diff)),"json"==t?(a.push({v:e.leader}),a.push({v:e.notes}),a.push({v:e.details}),a.push({v:e.resolution})):(a.push(n._htmlEncode(e.leader)),a.push(n._htmlEncode(e.notes)),a.push(n._htmlEncode(e.details)),a.push(n._htmlEncode(e.resolution))),a.push(e.id,e.level,e.hasChild,e.collapsed),a}},{key:"_renderContent",value:function(){var e=this._rowTemplate("th",this.headerValues,-1);return"\n      <h5>\u5F53\u524D\u8FDB\u5EA6\u7684\u7EDF\u8BA1\u65F6\u95F4\u4E3A\uFF1A"+this.diff.freeze_time+"</h5>\n      <div class='zplan-analysis-table-header-con'>\n        <table class='zplan-analysis-table-header'>\n          <thead>"+e.join("")+"</thead>\n        </table>\n      </div>\n\t\t\t<div class='clusterize-scroll'>\n        <table class='zplan-analysis-table'>\n          <thead>\n            <tr>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-0\" style='min-width:50px'>\u5E8F\u53F7</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-1\">\u5DE5\u4F5C\u540D\u79F0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-2\">\u8BA1\u5212\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-3\">\u8BA1\u5212\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-4\">\u8BA1\u5212\u5DE5\u671F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-5\">\u8BA1\u5212\u5269\u4F59\u65F6\u95F4</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-6\" style='min-width:50px'>\u8D1F\u8D23\u4EBA</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-7\" style='min-width:40px'>\u5907\u6CE8</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-8\" style='min-width:70px'>\u504F\u5DEE\u539F\u56E0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-diff-cell-9\" style='min-width:70px'>\u89E3\u51B3\u63AA\u65BD</th>\n            </tr>\n          </thead>\n          <tbody id='"+this.contentAreaId+"' class='clusterize-content'></tbody>\n        </table>\n      </div>\n\t\t\t"}}]),t}(np),ip=function(){function e(t,a,n,s){hn(this,e),this.headerEl=this._getElement(t),this.tableEl=this._getElement(a),this.buttonsEl=this._getElement(n),this.name=s}return yn(e,[{key:"_getElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument?e:e&&""!=e?document.querySelector(e):void 0}},{key:"setZpert",value:function(e){var t=new Kd(e);this.instance&&this.instance.destroy(),this.instance=2==t.data.version?new lp(this.headerEl,this.tableEl,this.buttonsEl,this.name):new rp(this.headerEl,this.tableEl,this.buttonsEl,this.name),this.instance.setDiff(t.getZpertDiff())}}]),e}(),dp=50,pp=function(){function e(t,a,n){hn(this,e),this.headerEl=t,this.contentEl=a,this.name=n,this.init()}return yn(e,[{key:"init",value:function(){this.headerValues=["\u5E8F\u53F7","\u5DE5\u4F5C\u540D\u79F0","\u8BA1\u5212\u5F00\u59CB","\u8BA1\u5212\u7ED3\u675F","\u4E0A\u6B21\u524D\u950B\u7EBF\u5B9E\u9645\u8FDB\u5C55","\u5F53\u524D\u524D\u950B\u7EBF\u5B9E\u9645\u8FDB\u5C55","\u5DE5\u4F5C\u72B6\u6001","\u5B9E\u9645\u5F00\u59CB","\u5B9E\u9645/\u9884\u8BA1\u7ED3\u675F"],this.scrollAreaId="progressStateScrollArea",this.contentAreaId="progressStateContentArea",this.title="\u8FDB\u5EA6\u53D8\u52A8\u5206\u6790",this.cellsNum=10,this.resizingCol=null,this.relatedResizingCol=null,this.oldHeaderWidth=0,this.oldColWidth=0,this.oldWindowWidth=0}},{key:"destroy",value:function(){if(this.isRendered&&(this.clusterize.destroy(),this.isRendered=!1),this.headerEl){var e=this.headerEl;this.headerEl=e.cloneNode(!0),e.parentNode.replaceChild(this.headerEl,e),this.headerEl.innerHTML=""}if(this.contentEl){var t=this.contentEl;this.contentEl=t.cloneNode(!0),t.parentNode.replaceChild(this.contentEl,t)}this.contentEl.innerHTML="",window.removeEventListener("resize",this.fitHeaderWidth.bind(this))}},{key:"_renderHeader",value:function(){!this.isRendered&&this.headerEl&&(this.headerEl.innerHTML="<h3>"+this.title+"</h3>")}},{key:"checkDiff",value:function(){this.progressState?1==this.progressState.refresh_sel?this.showAlert=!1:(this.showAlert=!0,this.alertMessage="\u8BF7\u5728\u5BA2\u6237\u7AEF\u5148\u8BBE\u7F6E\u524D\u950B\u7EBF\u5E76\u8F93\u5165\u5B9E\u9645\u8FDB\u5EA6\u6570\u636E\u540E\uFF0C\u518D\u67E5\u770B"):(this.showAlert=!0,this.alertMessage="\u8BE5\u7248\u672C\u8BA1\u5212\u4E0D\u652F\u6301\u8FDB\u5EA6\u52A8\u6001")}},{key:"setProgressState",value:function(e){this.progressState=e,this.checkDiff(),this.showAlert?this._alert():(this._renderHeader(),this._updateTable())}},{key:"_alert",value:function(){this.destroy(),this.contentEl.innerHTML="<div class='zplan-analysis-alert'>"+this.alertMessage+"</div>"}},{key:"_updateTable",value:function(){var e=this;this.isRendered?this.clusterize.update(this._tbodyRows()):(this.contentEl.innerHTML=this._renderContent(),this.clusterize=new Jd({rows:this._tbodyRows(),scrollElem:this.contentEl.querySelector(".clusterize-scroll"),contentId:this.contentAreaId,item_height:40,no_data_text:"\u65E0",callbacks:{clusterChanged:function(){!0!=e.isRendered&&(e.isRendered=!0,e.fitHeaderWidth())}}}),this.clusterize.refresh(!0),this.isRendered=!0,this._bindResize(),window.addEventListener("resize",this.fitHeaderWidth.bind(this)))}},{key:"fitHeaderWidth",value:function(){var e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(this.isRendered&&(window.innerWidth!=this.oldWindowWidth||e)){this.contentEl.querySelector(".zplan-analysis-table-header-con").style.width=this.contentEl.querySelector(".clusterize-scroll").clientWidth+"px",this.contentEl.querySelector(".zplan-analysis-table-header").style.width=this.contentEl.querySelector(".zplan-analysis-table").clientWidth+"px";for(var t=0;t<this.cellsNum;t++){var a=".zplan-state-cell-"+t,n=this.contentEl.querySelector(".zplan-analysis-table "+a),s=this.contentEl.querySelector(".zplan-analysis-table-header "+a),o=Mt(dp,n.clientWidth,s.clientWidth);s.style.width=o+"px",n.style.width=o+"px"}this.oldWindowWidth=window.innerWidth}}},{key:"_bindResize",value:function(){var e=this;this.contentEl.querySelector(".clusterize-scroll").addEventListener("scroll",function(t){e.contentEl.querySelector(".zplan-analysis-table-header-con").scrollLeft=t.target.scrollLeft});var t=this.contentEl.querySelector(".zplan-analysis-table-header");t.addEventListener("mousedown",function(a){var n=a.target.closest("th");if(n&&!n.classList.contains("disable-resizing")){var s=a.pageX-n.getBoundingClientRect().left,o=/zplan-state-cell-(\d+)/.exec(n.className)[1];s<dp?(--o,e.resizingCol=t.querySelector(".zplan-state-cell-"+o)):n.clientWidth-s<dp&&(e.resizingCol=t.querySelector(".zplan-state-cell-"+o)),e.resizingCol&&(e.relatedResizingCol=e.contentEl.querySelector(".zplan-analysis-table .zplan-state-cell-"+o),e.oldColWidth=e.resizingCol.clientWidth,e.oldHeaderWidth=t.clientWidth)}}),t.addEventListener("mousemove",function(e){var t=e.target.closest("th");if(t){var a=e.pageX-t.getBoundingClientRect().left;t.classList.contains("disable-resizing")||(!t.classList.contains("zplan-state-cell-0")&&a<dp||t.clientWidth-a<dp?t.classList.add("resizing"):t.classList.remove("resizing"))}}),this.contentEl.addEventListener("mousemove",function(t){if(e.resizingCol){var a=t.pageX-e.resizingCol.getBoundingClientRect().left;if(a>dp){e.resizingCol.style.width=a+"px",e.relatedResizingCol.style.width=a+"px";var n=e.oldHeaderWidth+a-e.oldColWidth+"px";e.contentEl.querySelector(".zplan-analysis-table-header").style.width=n,e.contentEl.querySelector(".zplan-analysis-table").style.width=n}}}),this.contentEl.addEventListener("mouseup",function(){if(e.resizingCol){for(var t=e.contentEl.querySelectorAll(".resizing"),a=0;a<t.length;a++)t[a].classList.remove("resizing");e.resizingCol=null,e.relatedResizingCol=null,e.oldColWidth=0,e.oldHeaderWidth=0}})}},{key:"_htmlEncode",value:function(e){if(null==e||null==e)return"";e=e.toString();var t="";return 0==e.length?"":(t=e.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"),t)}},{key:"_partialRowTempl",value:function(e,t){for(var a="",n=0;n<t.length;n++)a+="<"+e+" class='zplan-diff-row-cell'>"+t[n]+"</"+e+">";return a}},{key:"_extractTaskValues",value:function(e){var t=this,a=[e.idx+1,e.name,e.compute_start_time,e.compute_stop_time,e.last_status,e.last_start_time,e.last_stop_time,e.current_status,e.current_start_time,e.current_stop_time];return a.map(function(e){return t._htmlEncode(e)})}},{key:"_tbodyRows",value:function(){for(var e=[],t=0,a;t<this.progressState.tasks.length;t++)a=this.progressState.tasks[t],e=e.concat(this._rowTemplate(this._extractTaskValues(a)));return e}},{key:"_rowTemplate",value:function(e){var t=e[4]==e[7]&&e[6]==e[9],a=t?"clusterize-no-data bgColor":"clusterize-no-data";return["<tr  class='"+a+"'>\n          <td><div class='zplan-analysis-auto'>"+e[0]+"</div></td>\n          <td><div class='zplan-analysis-auto'>"+e[1]+"</div></td>\n          <td>"+e[2]+"</td>\n          <td>"+e[3]+"</td>\n          <td>"+e[4]+"</td>\n          <td>"+e[5]+"</td>\n          <td>"+e[6]+"</td>\n          <td>"+e[7]+"</td>\n          <td>"+e[8]+"</td>\n          <td>"+e[9]+"</td>\n        </tr>"]}},{key:"_renderHeaderTrs",value:function(){return["<tr>\n        <th rowspan='2' class='zplan-state-rowspan-cell zplan-state-cell-0 resizing'>\n          <div class='zplan-analysis-auto'>"+this.headerValues[0]+"</div>\n        </th>\n        <th rowspan='2' class='zplan-state-rowspan-cell zplan-state-cell-1 resizing'>\n          <div class='zplan-analysis-auto'>"+this.headerValues[1]+"</div>\n        </th>\n        <th rowspan='2' class='zplan-state-rowspan-cell zplan-state-cell-2 resizing'>\n          "+this.headerValues[2]+"\n        </th>\n        <th rowspan='2' class='zplan-state-rowspan-cell zplan-state-cell-3 resizing'>\n          "+this.headerValues[3]+"\n        </th>\n        <th colspan='3' class='disable-resizing'>"+this.headerValues[4]+"</th>\n        <th colspan='3' class='disable-resizing'>"+this.headerValues[5]+"</th>\n      </tr>","<tr>\n        <th class='zplan-state-cell-4 disable-resizing'>"+this.headerValues[6]+"</th>\n        <th class='zplan-state-cell-5 disable-resizing'>"+this.headerValues[7]+"</th>\n        <th class='zplan-state-cell-6 disable-resizing'>"+this.headerValues[8]+"</th>\n        <th class='zplan-state-cell-7 disable-resizing'>"+this.headerValues[6]+"</th>\n        <th class='zplan-state-cell-8 disable-resizing'>"+this.headerValues[7]+"</th>\n        <th class='zplan-state-cell-9 disable-resizing'>"+this.headerValues[8]+"</th>\n      </tr>"]}},{key:"_renderContent",value:function(){var e=this._renderHeaderTrs(),t=this.progressState.no_change_count,a=this.progressState.tasks;return"\n      <div class='zplan-analysis-row'>\u4E0B\u8868\u5217\u51FA\u4E86\u4E0A\u6B21\u524D\u950B\u7EBF\uFF08"+this.progressState.last_forward_line_time+"\uFF09\u5230\u5F53\u524D\u524D\u950B\u7EBF\uFF08"+this.progressState.current_forward_line_time+"\uFF09\u65F6\u95F4\u6BB5\u5185\u5404\u9879\u5DE5\u4F5C\u7684\u5B9E\u9645\u6267\u884C\u8FDB\u5C55\u6570\u636E</div>\n      <div class='zplan-analysis-row'>\u8BE5\u65F6\u95F4\u6BB5\u5185\u6309\u8BA1\u5212\u5E94\u8BE5\u5F00\u59CB\u6216\u5B8C\u6210\u7684\u5DE5\u4F5C\u603B\u6570\u4E3A"+this.progressState.tasks.length+"\u4E2A</div>\n      <div class='zplan-analysis-row'>\u5176\u4E2D\u5728\u4E24\u6B21\u524D\u950B\u7EBF\u7EDF\u8BA1\u4E2D\u5B9E\u9645\u65E0\u53D8\u5316\u7684\u5DE5\u4F5C\uFF08\u9EC4\u8272\u6807\u8BB0\uFF09"+t+"\u4E2A\uFF0C\u5360\u6BD4\uFF1A"+parseInt(100*(t/a.length))+"%</div>\n      <div class='zplan-analysis-table-header-con'>\n        <table class='zplan-analysis-table-header'>\n          <thead>"+e.join("")+"</thead>\n        </table>\n      </div>\n      <div class='clusterize-scroll'>\n        <table class='zplan-analysis-table zplan-state-table'>\n          <thead>\n            <tr>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-0\" style='min-width:50px'>\u5E8F\u53F7</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-1\">\u5DE5\u4F5C\u540D\u79F0</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-2\">\u8BA1\u5212\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-3\">\u8BA1\u5212\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-4\">\u5DE5\u4F5C\u72B6\u6001</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-5\">\u5B9E\u9645\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-6\">\u5B9E\u9645/\u9884\u8BA1\u7ED3\u675F</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-7\">\u5DE5\u4F5C\u72B6\u6001</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-8\">\u5B9E\u9645\u5F00\u59CB</th>\n              <th class=\"zplan-diff-hidden-cell zplan-state-cell-9\">\u5B9E\u9645/\u9884\u8BA1\u7ED3\u675F</th>\n            </tr>\n          </thead>\n          <tbody id='"+this.contentAreaId+"' class='clusterize-content'></tbody>\n        </table>\n      </div>\n    "}}]),e}(),cp=function(e){function t(e,a,n){return hn(this,t),wo(this,(t.__proto__||cn(t)).call(this,e,a,n))}return Eo(t,e),yn(t,[{key:"_extractTaskValues",value:function(e){var t=this,a=[e.idx+1,e.name,e.compute_start_time,e.compute_stop_time,e.last_status,e.last_start_time,e.last_stop_time,e.current_status,e.current_start_time,e.current_stop_time];return a.map(function(e){return t._htmlEncode(e)})}}]),t}(pp),up=function(e){function t(e,a,n){hn(this,t);var s=wo(this,(t.__proto__||cn(t)).call(this,e,a,n));return s._bindRowExpand(),s}return Eo(t,e),yn(t,[{key:"_onClickExpanded",value:function(e){if(e.target.classList.contains("zplan-diff-expanded")){var t=e.target.closest("tr").getAttribute("row-id");t=$a(t);var a=this.progressState.tasks[t-1];a.collapsed=!0;for(var n=t,s=this.progressState.tasks[n];s&&s.level>a.level;)s.show=!1,n+=1,s=this.progressState.tasks[n];this._updateTable()}}},{key:"_onClickCollapsed",value:function(e){if(e.target.classList.contains("zplan-diff-collapsed")){var t=e.target.closest("tr").getAttribute("row-id");t=$a(t);var a=this.progressState.tasks[t-1];a.collapsed=!1;var n={};n[a.level]=a.collapsed;for(var s=t,o=this.progressState.tasks[s];o&&o.level>a.level;)n[o.level-1]?n[o.level]=!0:(o.show=!0,n[o.level]=o.collapsed),s+=1,o=this.progressState.tasks[s];this._updateTable()}}},{key:"_bindRowExpand",value:function(){var e=this;this.contentEl.addEventListener("click",function(t){e._onClickExpanded(t),e._onClickCollapsed(t)})}},{key:"_tbodyRows",value:function(){for(var e=[],t=0,a;t<this.progressState.tasks.length;t++)a=this.progressState.tasks[t],a.show&&(e=e.concat(this._rowTemplate(this._extractTaskValues(a))));return e}},{key:"_extractTaskValues",value:function(e){var t=this,a=[e.idx+1,e.name,e.plan_start_time,e.plan_stop_time,e.last_status,e.last_start_time,e.last_stop_time,e.current_status,e.current_start_time,e.current_stop_time];return a=a.map(function(e){return t._htmlEncode(e)}),a.push(e.level,e.hasChild,e.collapsed),a}},{key:"_rowTemplate",value:function(e){var t=e[0],a=e[10]||1,n=e[11]||!1,s=e[12]||!1,o=10*(a-1)+12,r="";n?s?r="<i class=\"zplan-diff-collapsed\"></i>":r="<i class=\"zplan-diff-expanded\"></i>":o+=18;var l=e[4]==e[7]&&e[6]==e[9],i=l?"clusterize-no-data bgColor":"clusterize-no-data";return["<tr  class='"+i+"' row-id='"+t+"'>\n          <td><div class='zplan-analysis-auto'>"+e[0]+"</div></td>\n          <td><div class='zplan-analysis-auto' style='margin-left: "+o+"px'>\n          "+r+e[1]+"</div></td>\n          <td>"+e[2]+"</td>\n          <td>"+e[3]+"</td>\n          <td>"+e[4]+"</td>\n          <td>"+e[5]+"</td>\n          <td>"+e[6]+"</td>\n          <td>"+e[7]+"</td>\n          <td>"+e[8]+"</td>\n          <td>"+e[9]+"</td>\n        </tr>"]}}]),t}(pp),hp=function(){function e(t,a,n,s){hn(this,e),this.headerEl=this._getElement(t),this.tableEl=this._getElement(a),this.buttonsEl=this._getElement(n),this.name=s}return yn(e,[{key:"_getElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument?e:e&&""!=e?document.querySelector(e):void 0}},{key:"setZpert",value:function(e){var t=new Kd(e);this.instance&&this.instance.destroy(),this.instance=2==t.data.version?new up(this.headerEl,this.tableEl,this.name):new cp(this.headerEl,this.tableEl,this.name),this.instance.setProgressState(t.getZpertProgressState())}}]),e}(),mp=-2147483648,gp=4,fp=function(){function e(t,a,n,s,o,r){hn(this,e),this.id=t.id,this.name=t.name,this.level=a,this.start=t.compute_start_time,this.duration=t.duration,this._constraintDate=t.ask_start_time?t.ask_start_time:null,this._constraintType=this._constraintDate?gp:null,this.leaveTime=t.leave_time||null,this.progressHistory=this._convertProgressHistory(t.progress_history,o,r),this.startTime=n,this.finishTime=s,this.depends="",this.fromTasks=[],this.startLimit=!1,this.collapsed=!1,this.type=t.job_type==3?Vi.MILESTONE:Vi.WORK,this.groupId=t.group_id,this.pertRow=t.pert_row,this.partition=null,t.source_count&&(this.unit=t.source_count.unit,this.price=t.source_count.price,this.resCode=t.source_count.code),this.unit=this.unit||"",this.price=this.price||0,this.resCode=this.resCode||"",this.scheduleType=t.schedule_type}return yn(e,[{key:"convert",value:function(){return{id:this.id,name:this.name,level:this.level,start:this.start,finish:this.finishTime.getTime()/1e3,collapsed:this.collapsed,type:this.type,duration:this.duration,leave_time:this.leaveTime,depends:[].concat(nl(new Al(this.depends.split(",")))).join(","),constraint_type:this.constraintType(),constraint_date:this.constraintDate(),partition:this.partition,unit:this.unit,price:this.price,res_code:this.resCode,schedule_type:this.scheduleType,progress_history:this.progressHistory}}},{key:"constraintType",value:function(){return this.startLimit?this._constraintType:gp}},{key:"constraintDate",value:function(){return this.startLimit?this._constraintDate:this.start}},{key:"setDot",value:function(e,t){this.predot=e,this.postdot=t,this.predot.outs.push(this),this.postdot.ins.push(this)}},{key:"isRelated",value:function(e,t){var a=this;if(t.push(this),this.fromTasks.some(function(t){return t==e}))return[!0,t];for(var n=function(n){var s=a.fromTasks[n];if(t.some(function(e){return e==s}))return"continue";var o=s.isRelated(e,t);if(o[0])return{v:[!0,o[1]]}},s=0,o;s<this.fromTasks.length;s++)switch(o=n(s),o){case"continue":continue;default:if("object"===("undefined"==typeof o?"undefined":vo(o)))return o.v;}return[!1,t]}},{key:"appendDepend",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",n=this.isRelated(e,[]),s=ir(n,1),o=s[0];if(!o){var r=e.isRelated(this,[]),l=ir(r,1);if(o=l[0],!o){this.fromTasks.push(e);var i=""+e.idx+t+a;"S"==t.charAt(1)&&(this.startLimit=!0),""==this.depends?this.depends=i:this.depends+=","+i}}}},{key:"_convertProgressHistory",value:function(t,a,n){if(!t||0==n)return null;for(var o=[],r=0;r<t.length;r++){var l=ir(t[r],2),d=l[0],p=l[1],c=d==mp?null:a+60*d,s=p==mp?null:a+60*p;o.push([c,s])}return 1==n&&(o=[o[o.length-1]]),o}}]),e}(),_p=function e(t,a,n){hn(this,e),this.from=t,this.to=a,this.lag=n,this.from.outLinks.push(this),this.to.inLinks.push(this)},yp="0",vp="1",kp="0",wp={1:"\u661F\u671F\u4E00",2:"\u661F\u671F\u4E8C",3:"\u661F\u671F\u4E09",4:"\u661F\u671F\u56DB",5:"\u661F\u671F\u4E94",6:"\u661F\u671F\u516D",0:"\u661F\u671F\u65E5"},Tp=function(){function e(t){hn(this,e),this.minTime=new Date(Date.UTC(1980,0,1,0,0,0)),this.maxTime=new Date(Date.UTC(2038,0,1,0,0,0)),this.calendar=this._parseCalendar(t)}return yn(e,[{key:"convert",value:function(){var e=this._checkWeekRule(),t=this._checkMonthRule(),a=this._checkYearRule(),n=this._checkDayRule(e,t,a),s=ir(n,2),o=s[0],r=s[1],l=this._convertWeekRules(e);return l=l.concat(this._convertMonthRules(t)),l=l.concat(this._convertYearRules(a)),l=l.concat(this._convertWorkDayRules(o)),l=l.concat(this._convertOffDayRules(r)),l}},{key:"calculateFinishTime",value:function(e,t,a){var n=new Date(e);if(a){var s=$a((e.getTime()-this.minTime.getTime())/1e3),o=$a(s/86400),r=0;if(0<=t){for(this.calendar[o]||(r=86400-s%86400),o+=1;r+86400<t;)this.calendar[o]||(r+=86400),o+=1;for(;this.calendar[o];)o+=1;n=new Date(this.minTime.getTime()+1e3*(86400*o+t-r))}else if(!this.calendar[o]){for(r=-1*(s%86400),o-=1;r-86400>t;)this.calendar[o]||(r-=86400),o-=1;for(;this.calendar[o];)o-=1;n=new Date(this.minTime.getTime()+1e3*(86400*o+t-r+86400))}}else dr.addSeconds(n,t);return n}},{key:"calculateDuration",value:function(e,t,a){if(!e||!t)return null;var n=0,s=new Date(e),o=new Date(t),r=1;s.getTime()>o.getTime()&&(s=new Date(t),o=new Date(e),r=-1);var l=$a((t.getTime()-e.getTime())/1e3);if(a){var i=$a((s.getTime()-this.minTime.getTime())/864e5),d=$a((o.getTime()-this.minTime.getTime())/864e5);if(i==d)n=this.calendar[i]?0:l;else{for(this.calendar[i]||(n=86400-dr.getSecondsOfDay(s)),i+=1;i<d;)this.calendar[i]||(n+=86400),i+=1;this.calendar[d]||(n+=dr.getSecondsOfDay(o))}}else n=l;return ti.roundTwoDecimals(n)*r}},{key:"_rjust",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:" ";return a=a.substr(0,1),e.length<t?a.repeat(t-e.length)+e:e}},{key:"_parseCalendar",value:function(e){for(var t=[],a=(this.maxTime.getTime()-this.minTime.getTime())/864e5,n=0;n<e.length;n++){for(var s=[],o=this._rjust(e[n].toString(2),32,"0"),r=0,l;32>r;r++)l=o.charAt(r),s.unshift("1"==l);if(t=t.concat(s),t.length>a)break}return t.slice(0,a)}},{key:"_checkWeekRule",value:function(){for(var e=[],t=0;7>t;t++)this.calendar[t]&&this.calendar[t+7]&&e.push(new Date(this.minTime.getTime()+864e5*t));return e}},{key:"_checkMonthRule",value:function(){for(var e=[],t=0;31>t;t++)this.calendar[t]&&this.calendar[t+29+31]&&e.push(new Date(this.minTime.getTime()+864e5*t));return e}},{key:"_checkYearRule",value:function(){for(var e=[],t=0;366>t;t++)this.calendar[t]&&this.calendar[t+366+365+365+365]&&e.push(new Date(this.minTime.getTime()+864e5*t));return e}},{key:"_applyWeekRules",value:function(e,t){for(var a=this,n=e.map(function(e){return new Date(e)});n.some(function(e){return e.getTime()<=a.maxTime.getTime()});)for(var s=0,o;s<n.length;s++)o=n[s],o.getTime()<=this.maxTime.getTime()&&(t[(o.getTime()-this.minTime.getTime())/864e5]=!0,dr.addDays(n[s],7))}},{key:"_applyMonthRules",value:function(e,t){for(var a=this,n=e.map(function(e){return new Date(e)});n.some(function(e){return e.getTime()<=a.maxTime.getTime()});)for(var s=0,o;s<n.length;s++)if(o=n[s],o.getTime()<=this.maxTime.getTime()){t[(o.getTime()-this.minTime.getTime())/864e5]=!0;var r=new Date(o),l=1;for(r.setUTCMonth(r.getUTCMonth()+l);r.getUTCDate()!=o.getUTCDate();)r=new Date(o),l+=1,r.setUTCMonth(r.getUTCMonth()+l);n[s]=r}}},{key:"_applyYearRules",value:function(e,t){for(var a=this,n=e.map(function(e){return new Date(e)});n.some(function(e){return e.getTime()<=a.maxTime.getTime()});)for(var s=0,o;s<n.length;s++)if(o=n[s],o.getTime()<=this.maxTime.getTime()){t[(o.getTime()-this.minTime.getTime())/864e5]=!0;var r=new Date(o),l=1;for(r.setUTCFullYear(r.getUTCFullYear()+l);r.getUTCDate()!=o.getUTCDate();)r=new Date(o),l+=1,r.setUTCFullYear(r.getUTCFullYear()+l);n[s]=r}}},{key:"_checkDayRule",value:function(e,t,a){var n=Array(this.calendar.length);n.fill(!1),this._applyWeekRules(e,n),this._applyMonthRules(t,n),this._applyYearRules(a,n);for(var s=[],o=[],r=[],l="",p=0,c=0,u;c<this.calendar.length;c++)if(u=this.calendar[c],u&&!1==n[c]){var h=new Date(this.minTime.getTime()+864e5*c);c==p+1&&"off"==l?r[r.length-1]=new Date(h):("off"==l?o.push(r):"work"==l&&s.push(r),l="off",r=[new Date(h),new Date(h)]),p=c}else if(!1==u&&n[c]){var d=new Date(this.minTime.getTime()+864e5*c);c==p+1&&"work"==l?r[r.length-1]=new Date(d):("off"==l?o.push(r):"work"==l&&s.push(r),l="work",r=[new Date(d),new Date(d)]),p=c}return 0<r.length&&("off"==l?o.push(r):"work"==l&&s.push(r)),[s,o]}},{key:"_convertWeekRules",value:function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],s=0<n.getUTCDay()?n.getUTCDay().toString():"7";t.push({name:wp[n.getUTCDay()],type:"1",start:s,finish:s,worktype:yp,status:vp})}return t}},{key:"_convertMonthRules",value:function(e){for(var t=[],a=0,n;a<e.length;a++)n=e[a],t.push({name:"\u6309\u6708\u4F11\u606F",type:"2",start:n.getUTCDate().toString(),finish:n.getUTCDate().toString(),worktype:yp,status:vp});return t}},{key:"_convertYearRules",value:function(e){for(var t=[],a=0,n;a<e.length;a++)n=e[a],t.push({name:"\u6309\u5E74\u4F11\u606F",type:"3",start:n.getUTCMonth()+1+"."+n.getUTCDate(),finish:n.getUTCMonth()+1+"."+n.getUTCDate(),worktype:yp,status:vp});return t}},{key:"_convertWorkDayRules",value:function(e){for(var t=[],a=0,n;a<e.length;a++)n=e[a],t.push({name:"\u6309\u65E5\u671F\u5DE5\u4F5C",type:kp,start:dr.formatUTC(n[0]),finish:dr.formatUTC(n[1]),worktype:"1",status:vp});return t}},{key:"_convertOffDayRules",value:function(e){for(var t=[],a=0,n;a<e.length;a++)n=e[a],t.push({name:"\u6309\u65E5\u671F\u4F11\u606F",type:kp,start:dr.formatUTC(n[0]),finish:dr.formatUTC(n[1]),worktype:yp,status:vp});return t}}]),e}(),Rp=function(){function e(){hn(this,e),this._init()}return yn(e,[{key:"_init",value:function(){this.ins=[],this.outs=[],this.inLinks=[],this.outLinks=[],this.dotTime=null}},{key:"clear",value:function(){this._init()}}]),e}(),Dp=function(){function e(t,a,n){hn(this,e),this.name=t,this.groupId=a,this.tasks=[],this.depends="",this.calendar=n,this.fromTasks=[],this.startLimit=!1,this.collapsed=!0,this.predot=new Rp,this.postdot=new Rp,this.id=null,this.level=null,this.type=null,this.duration=null,this.leaveTime=null,this.partition=null,this.progressHistory=null,this.pertRow=null,this.start=null}return yn(e,[{key:"constraintType",value:function(){return this.startLimit?null:4}},{key:"constraintDate",value:function(){return this.startLimit?null:this.start}},{key:"convert",value:function(){return{id:this.id,name:this.name,level:this.level,start:this.start,finish:this.finishTime.getTime()/1e3,collapsed:this.collapsed,type:this.type,duration:this.duration,leave_time:this.leaveTime,depends:[].concat(nl(new Al(this.depends.split(",")))).join(","),constraint_type:this.constraintType(),constraint_date:this.constraintDate(),partition:this.partition,progress_history:this.progressHistory}}},{key:"addTask",value:function(e){null==this.pertRow&&(this.pertRow=e.pertRow),this.tasks.push(e),null==this.start?(this.start=e.start,this.startTime=new Date(e.startTime),this.finishTime=new Date(e.finishTime),this.id=e.id,this.level=e.level):(this.start>e.start&&(this.start=e.start,this.startTime=new Date(e.startTime)),this.finishTime<e.finishTime&&(this.finishTime=new Date(e.finishTime)))}},{key:"isRelated",value:function(e,t){var a=this;if(t.push(this),this.fromTasks.some(function(t){return t==e}))return[!0,t];for(var n=function(n){var s=a.fromTasks[n];if(t.some(function(e){return e==s}))return"continue";var o=s.isRelated(e,t);if(o[0])return{v:[!0,o[1]]}},s=0,o;s<this.fromTasks.length;s++)switch(o=n(s),o){case"continue":continue;default:if("object"===("undefined"==typeof o?"undefined":vo(o)))return o.v;}return[!1,t]}},{key:"appendDepend",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",n=this.isRelated(e,[]),s=ir(n,1),o=s[0];if(!o){var r=e.isRelated(this,[]),l=ir(r,1);if(o=l[0],!o){this.fromTasks.push(e);var i=""+e.idx+t+a;"S"==t.charAt(1)&&(this.startLimit=!0),""==this.depends?this.depends=i:this.depends+=","+i}}}},{key:"actAsTask",value:function(e){this.duration=this.calendar.calculateDuration(this.startTime,this.finishTime,!0);for(var t=null,a=null,n=0,s=[],o=0,r;o<this.tasks.length;o++){if(r=this.tasks[o],r.progressHistory){r.progressHistory.length>n&&(n=r.progressHistory.length);for(var l=[],d=r.progressHistory.length-1;0<=d;d--)l.push(r.progressHistory[d]);s.push(l)}if(null!=r.leaveTime||null!=r.leaveTime)if(0<r.leaveTime){var p=this.calendar.calculateFinishTime(r.finishTime,-r.leaveTime,!0);0==this.calendar.calculateDuration(e,r.finishTime,!0)&&(p=new Date(e)),(null==a||a.getTime()<p.getTime())&&(a=new Date(p)),(null==t||t.getTime()>p.getTime())&&(t=new Date(p))}else 0==r.leaveTime?(null==a||r.finishTime.getTime()>a.getTime())&&(a=new Date(r.finishTime)):(null==t||t.getTime()>r.startTime)&&(t=new Date(r.startTime))}t&&t.getTime()<=e.getTime()?this.leaveTime=this.calendar.calculateDuration(t,this.finishTime,!0):a&&a.getTime()>=e.getTime()&&(this.leaveTime=this.calendar.calculateDuration(a,this.finishTime,!0));for(var c=[],u=0;u<n;u++)for(var h=0,m;h<s.length;h++)m=s[h],m[u]&&(!c[u]&&(c[u]=m[u]),(null==c[u][0]||null==c[u][0]||null!=m[u][0]&&null!=m[u][0]&&c[u][0]>m[u][0])&&(c[u][0]=m[u][0]),(null==c[u][1]||null==c[u][1]||null!=m[u][1]&&null!=m[u][1]&&c[u][1]<m[u][1])&&(c[u][1]=m[u][1]));this.progressHistory=c.reverse()}}]),e}(),xp=5,Cp=function(){function e(t){hn(this,e),this._convertUTC(t),this.calendar=new Tp(t.info_base.vaca_array);var a=t.global.gczero_time,n=t.pert_prop.progress_history_style;this.progressHistory=this._parseProgressHistory(t.progress_history,n,a),this.currentTime=t.global.current_time,this.zpertDots=[];var s=0;s=Wr(t.dot_size)?t.dot_size:t.dots.length;for(var o=0;o<s;o++)this.zpertDots[o]=new Rp;this.groups={};for(var r=0,l;r<t.groups.length;r++)l=t.groups[r],this.groups[l.id]=new Dp(l.name,l.id,this.calendar);this.partitions=t.task_types||[],this.taskIdSeq=0,this.tasks=this._parseTasks(t.tasks,a,n),this._buildDepends()}return yn(e,[{key:"_convertUTC",value:function(e){for(var t=28800,a=["current_time","gcstop_time","gczero_time"],n=0,s;n<a.length;n++)s=a[n],e.global[s]&&(e.global[s]+=t);for(var o=["start","stop","ask_start_time","ask_stop_time","compute_start_time","compute_stop_time","estimate_start_time","estimate_stop_time","last_plan_start_time","last_plan_stop_time","real_start_time","real_stop_time"],r=0,l;r<e.tasks.length;r++){l=e.tasks[r];for(var d=0,p;d<o.length;d++)p=o[d],l[p]&&(l[p]+=t)}}},{key:"convert",value:function(){return{version:1,readonly:!0,plan_type:Ui.ZPERT,timezone_offset:-28800,current_time:this.currentTime,progress_history:this.progressHistory,task_id_seq:this.taskIdSeq,show_critical:!0,tasks:this.tasks.map(function(e){return e.convert()}),calendars:{default:this.calendar.convert()}}}},{key:"_parseProgressHistory",value:function(e,t,a){if(e&&0<t){var n=e.map(function(e){return $a(a+60*e)});return 1==t&&(n=[n[n.length-1]]),n}return null}},{key:"_convertLag",value:function(e){return 0==e?"":0<e?"+"+$a(e/86400)+"\u65E5":$a(e/86400)+"\u65E5"}},{key:"_parseTasks",value:function(e,t,a){var n=[],s=dr.setUnix(e[0].start),o=this.calendar.calculateFinishTime(s,e[0].duration,!0),r=new fp(e[0],0,s,o,t,a);r.start=e[0].start,n.push(r);for(var l=1;l<e.length;l++){var d=e[l],p=this.zpertDots[d.pert_predot-1],c=this.zpertDots[d.pert_postdot-1];if(d.job_type==0||d.job_type==3||d.job_type==4||d.job_type==xp&&null!=d.name&&null!=d.name&&""!=d.name){var u=dr.setUnix(d.compute_start_time),h=null;h=Wr(d.compute_stop_time)?dr.setUnix(d.compute_stop_time):this.calendar.calculateFinishTime(u,d.duration,1==d.is_valid_vaction),d.duration=this.calendar.calculateDuration(u,h,1==d.is_valid_vaction),p.dotTime=new Date(u),c.dotTime=new Date(h);var m=new fp(d,1,u,h,t,a);m.setDot(p,c);var f=this.groups[d.group_id];0<d.group_id&&f?(0==f.tasks.length&&n.push(f),f.addTask(m)):n.push(m)}else(d.job_type==1||d.job_type==xp)&&new _p(p,c,d.duration)}n=n.sort(function(e,t){return e.id-t.id}),n=this._convertPartitions(n,t,a);for(var _=ul(this.groups),y=0,v;y<_.length;y++){v=_[y],v.actAsTask(dr.setUnix(this.currentTime)),v.id=-1*v.id;var k=v.tasks.map(function(e){return e});k=k.sort(function(e,t){return e.start-t.start});for(var w=v.level+1,T=0;T<k.length;T++)k[T].level=w;for(var R=n.indexOf(v),D=[],x=0;x<n.length;x++)D.push(n[x]),x==R&&(D=D.concat(k));n=D}for(var C=0;C<n.length;C++)n[C].idx=C;return n}},{key:"_convertPartitions",value:function(e,a,n){if(0<this.partitions.length){for(var s={},o=[],r=[],l=[e[0]],d=0,p;d<this.partitions.length;d++)p=this.partitions[d],s[p.pert_row]={name:p.name,tasks:[]},o.push(p.pert_row);o=o.sort(function(e,t){return e-t});for(var c=1;c<e.length;){for(var u=e[c],h=!1,m=0,g;m<o.length;m++)if(g=o[m],u.pertRow<g){s[g].tasks.push(u),(null==s[g].start_time||null==s[g].start_time||s[g].start_time>u.startTime)&&(s[g].start_time=new Date(u.startTime)),(null==s[g].finish_time||null==s[g].finish_time||s[g].finish_time<u.finishTime)&&(s[g].finish_time=new Date(u.finishTime)),h=!0;break}h||r.push(u),c+=1}for(var f=$l(s),_=0;_<f.length;_++){var y=ir(f[_],2),v=y[0],k=y[1];if(0<k.tasks.length){var w={id:-1*v,name:k.name,compute_start_time:dr.getUnix(k.start_time),duration:this.calendar.calculateDuration(k.start_time,k.finish_time,!0)},T=new fp(w,1,k.start_time,k.finish_time,a,n);T.partition=!0,l.push(T);for(var R=0,D;R<k.tasks.length;R++)D=k.tasks[R],D.level=2,l.push(D)}}return l=l.concat(r),l[0].partition=!0,l}return e}},{key:"_buildDepends",value:function(){for(var e=this,t=[],a=1,n;a<this.tasks.length;a++)if(n=this.tasks[a],0<=n.id){n.id>this.taskIdSeq&&(this.taskIdSeq=n.id),t=t.concat(n.predot.outLinks),t=t.concat(n.postdot.outLinks);for(var s=0;s<n.postdot.outs.length;s++)n.postdot.outs[s].appendDepend(n,"FS")}for(var o=function(a){var n=t[a],o=n.from.ins.filter(function(e){return e.postdot==n.from}),r=n.to.outs.filter(function(e){return e.predot==n.to});if(0<o.length&&0<r.length)for(var l=e._convertLag(n.lag),i=0,d;i<r.length;i++){d=r[i];for(var p=0,c;p<o.length;p++)c=o[p],d.appendDepend(c,"FS",l)}},r=0;r<t.length;r++)o(r)}}]),e}(),Sp=function(){function e(t){hn(this,e),this.id=t.id,this.calendarId=t.calendar_id,this.name=t.name,this.rule=0,this.type=t.type==3?Vi.MILESTONE:Vi.WORK,this.level=t.level,this.start=null,this.finish=null,this.depends=t.depends||"",this.duration=t.duration,this.collapsed=t.collapsed,this.iterType=0,this.partition=!1,this.addColumn={},this.constraintDate=t.ask_start_time||null,this.constraintType=this.constraintDate?4:null,this.leaveTime=null,this.progressHistory=null,t.source_count&&(t.source_count.res&&(this.resKindIdx=t.source_count.res.res_kind_idx),this.unit=t.source_count.unit,this.price=t.source_count.contract_price),this.unit=this.unit||"",this.price=this.price||0,this.scheduleType=t.schedule_type}return yn(e,[{key:"convert",value:function(){return{id:this.id,calendar_id:this.calendarId,name:this.name,rule:this.rule,type:this.type,level:this.level,start:this.start,finish:this.finish,depends:this.depends,duration:this.duration,collapsed:this.collapsed,iter_type:this.iterType,partition:this.partition,unit:this.unit,price:this.price,res_kind_idx:this.resKindIdx,schedule_type:this.scheduleType,add_column:this.addColumn,constraint_date:this.constraintDate,constraint_type:this.constraintType,progress_history:this.progressHistory,leave_time:this.leaveTime}}},{key:"setDefaultCalendar",value:function(e){(null==this.calendarId||null==this.calendarId||-1==this.calendarId)&&(this.calendarId=e)}}]),e}(),bp={WORK:0,MILESTONE:3},Pp=function(){function e(t){hn(this,e);var a=this._parseCalendars(t.calendars),n=ir(a,2);this.calendars=n[0],this.calendarOptions=n[1],this.calendarId=t.default_calendar_id,this.taskIdSeq=t.task_id_seq,this.resKinds=t.res_kinds,this.tasks=this._parseTasks(t.tasks)}return yn(e,[{key:"_parseCalendars",value:function(e){for(var t=[],a=[],n=0,s;n<e.length;n++)s=e[n],t.push(new Vl(s)),a.push([n,s.name]);return[t,a]}},{key:"_parseTasks",value:function(e){for(var t=[],a=0,n;a<e.length;a++)if(n=e[a],n.type==bp.WORK||n.type==bp.MILESTONE){var s=new Sp(n,this.resKinds);s.setDefaultCalendar(this.calendarId),t.push(s)}return t}},{key:"convert",value:function(){return{version:2,readonly:!0,task_id_seq:this.taskIdSeq,default_calendar_id:this.calendarId,plan_type:Ui.ZPERT,timezone_offset:-28800,calendars:this.calendars.map(function(e){return e.convert()}),view:{show_critical:!0,type:Oi.PERT,calendar_day_px_id:15,splitter_pos:"700px",calendar_id:this.calendarId},columns:[{name:"index",type:"text",width:"45px",readonly:!0,head_name:""},{name:"partition",type:"checkbox",width:"35px",readonly:!0,head_name:"\u5206\u533A"},{name:"name",type:"text",width:"200px",readonly:!0,indent:!0,head_name:"\u4EFB\u52A1\u540D\u79F0"},{name:"duration_days",type:"number",width:"50px",readonly:!0,head_name:"\u5DE5\u671F"},{name:"start_date",type:"date",width:"100px",readonly:!0,head_name:"\u5F00\u59CB\u65F6\u95F4"},{name:"finish_date",type:"date",width:"100px",readonly:!0,head_name:"\u5B8C\u6210\u65F6\u95F4"},{name:"depends",type:"text",width:"70px",readonly:!0,head_name:"\u524D\u7F6E\u4EFB\u52A1"},{name:"calendar_id",type:"select",width:"90px",readonly:!0,head_name:"\u4EFB\u52A1\u65E5\u5386",options:this.calendarOptions}],tasks:this.tasks.map(function(e){return e.convert()}),res_kinds:this.resKinds}}}]),e}(),Ep=function(){function e(t){hn(this,e),1==t.version?this.converter=new Cp(t):2==t.version&&(this.converter=new Pp(t))}return yn(e,[{key:"convert",value:function(){return this.converter?this.converter.convert():null}}]),e}(),zp=h(function(e){!function(t){function a(e,t,a,n){var o=t&&t.prototype instanceof s?t:s,r=Object.create(o.prototype),l=new h(n||[]);return r._invoke=d(e,a,l),r}function n(e,t,a){try{return{type:"normal",arg:e.call(t,a)}}catch(e){return{type:"throw",arg:e}}}function s(){}function o(){}function r(){}function l(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function i(e){function t(a,s,o,r){var l=n(e[a],e,s);if("throw"===l.type)r(l.arg);else{var i=l.arg,d=i.value;return d&&"object"==typeof d&&_.call(d,"__await")?Promise.resolve(d.__await).then(function(e){t("next",e,o,r)},function(e){t("throw",e,o,r)}):Promise.resolve(d).then(function(e){i.value=e,o(i)},r)}}function a(e,a){function n(){return new Promise(function(n,s){t(e,a,n,s)})}return s=s?s.then(n,n):n()}var s;this._invoke=a}function d(e,t,a){var s="suspendedStart";return function(o,r){if(s==="executing")throw new Error("Generator is already running");if("completed"===s){if("throw"===o)throw r;return g()}for(a.method=o,a.arg=r;;){var l=a.delegate;if(l){var i=p(l,a);if(i){if(i===D)continue;return i}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";var d=n(e,t,a);if("normal"===d.type){if(s=a.done?"completed":"suspendedYield",d.arg===D)continue;return{value:d.arg,done:a.done}}"throw"===d.type&&(s="completed",a.method="throw",a.arg=d.arg)}}}function p(e,t){var a=e.iterator[t.method];if(a===R){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=R,p(e,t),"throw"===t.method))return D;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return D}var s=n(a,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,D;var o=s.arg;if(!o)return t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,D;if(o.done)t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=R);else return o;return t.delegate=null,D}function c(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function u(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(c,this),this.reset(!0)}function m(e){if(e){var t=e[v];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function t(){for(;++a<e.length;)if(_.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=R,t.done=!0,t};return n.next=n}}return{next:g}}function g(){return{value:R,done:!0}}var f=Object.prototype,_=f.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},v=y.iterator||"@@iterator",k=y.asyncIterator||"@@asyncIterator",w=y.toStringTag||"@@toStringTag",T=t.regeneratorRuntime,R;if(T)return void(e.exports=T);T=t.regeneratorRuntime=e.exports,T.wrap=a;var D={},x={};x[v]=function(){return this};var C=Object.getPrototypeOf,S=C&&C(C(m([])));S&&S!==f&&_.call(S,v)&&(x=S);var b=r.prototype=s.prototype=Object.create(x);o.prototype=b.constructor=r,r.constructor=o,r[w]=o.displayName="GeneratorFunction",T.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},T.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,r):(e.__proto__=r,!(w in e)&&(e[w]="GeneratorFunction")),e.prototype=Object.create(b),e},T.awrap=function(e){return{__await:e}},l(i.prototype),i.prototype[k]=function(){return this},T.AsyncIterator=i,T.async=function(e,t,n,s){var o=new i(a(e,t,n,s));return T.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},l(b),b[w]="Generator",b[v]=function(){return this},b.toString=function(){return"[object Generator]"},T.keys=function(e){var t=[];for(var a in e)t.push(a);return t.reverse(),function a(){for(;t.length;){var n=t.pop();if(n in e)return a.value=n,a.done=!1,a}return a.done=!0,a}},T.values=m,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=R,this.done=!1,this.delegate=null,this.method="next",this.arg=R,this.tryEntries.forEach(u),!e)for(var t in this)"t"===t.charAt(0)&&_.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=R)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,n){return o.type="throw",o.arg=e,a.next=t,n&&(a.method="next",a.arg=R),!!n}if(this.done)throw e;for(var a=this,n=this.tryEntries.length-1;0<=n;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return t("end");if(s.tryLoc<=this.prev){var r=_.call(s,"catchLoc"),l=_.call(s,"finallyLoc");if(r&&l){if(this.prev<s.catchLoc)return t(s.catchLoc,!0);if(this.prev<s.finallyLoc)return t(s.finallyLoc)}else if(r){if(this.prev<s.catchLoc)return t(s.catchLoc,!0);}else if(!l)throw new Error("try statement without catch or finally");else if(this.prev<s.finallyLoc)return t(s.finallyLoc)}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1,n;0<=a;--a)if(n=this.tryEntries[a],n.tryLoc<=this.prev&&_.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,D):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),D},finish:function(e){for(var t=this.tryEntries.length-1,a;0<=t;--t)if(a=this.tryEntries[t],a.finallyLoc===e)return this.complete(a.completion,a.afterLoc),u(a),D},catch:function(e){for(var t=this.tryEntries.length-1,a;0<=t;--t)if(a=this.tryEntries[t],a.tryLoc===e){var n=a.completion;if("throw"===n.type){var s=n.arg;u(a)}return s}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:m(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=R),D}}}(function(){return this}()||Function("return this")())}),Ip=function(){return this}()||Function("return this")(),g=Ip.regeneratorRuntime&&0<=Object.getOwnPropertyNames(Ip).indexOf("regeneratorRuntime"),Lp=g&&Ip.regeneratorRuntime;Ip.regeneratorRuntime=void 0;if(g)Ip.regeneratorRuntime=Lp;else try{delete Ip.regeneratorRuntime}catch(t){Ip.regeneratorRuntime=void 0}var Ap=zp,Mp=Wn("species"),Fp=function(e,t){var a=fa(e).constructor,n;return a===void 0||(n=fa(a)[Mp])==null?t:ha(n)},Op=function(e,t,a){var n=a===void 0;switch(t.length){case 0:return n?e():e.call(a);case 1:return n?e(t[0]):e.call(a,t[0]);case 2:return n?e(t[0],t[1]):e.call(a,t[0],t[1]);case 3:return n?e(t[0],t[1],t[2]):e.call(a,t[0],t[1],t[2]);case 4:return n?e(t[0],t[1],t[2],t[3]):e.call(a,t[0],t[1],t[2],t[3]);}return e.apply(a,t)},Up=pa.process,Np=pa.setImmediate,Vp=pa.clearImmediate,jp=pa.MessageChannel,Wp=pa.Dispatch,Bp=0,Hp={},Yp="onreadystatechange",qp=function(){var e=+this;if(Hp.hasOwnProperty(e)){var t=Hp[e];delete Hp[e],t()}},Gp=function(e){qp.call(e.data)},$p,Xp,Zp;Np&&Vp||(Np=function(e){for(var t=[],a=1;arguments.length>a;)t.push(arguments[a++]);return Hp[++Bp]=function(){Op("function"==typeof e?e:Function(e),t)},$p(Bp),Bp},Vp=function(e){delete Hp[e]},"process"==Dn(Up)?$p=function(e){Up.nextTick(ma(qp,e,1))}:Wp&&Wp.now?$p=function(e){Wp.now(ma(qp,e,1))}:jp?(Xp=new jp,Zp=Xp.port2,Xp.port1.onmessage=Gp,$p=ma(Zp.postMessage,Zp,1)):pa.addEventListener&&"function"==typeof postMessage&&!pa.importScripts?($p=function(e){pa.postMessage(e+"","*")},pa.addEventListener("message",Gp,!1)):Yp in wa("script")?$p=function(e){Fn.appendChild(wa("script"))[Yp]=function(){Fn.removeChild(this),qp.call(e)}}:$p=function(e){setTimeout(ma(qp,e,1),0)});var Kp={set:Np,clear:Vp},Jp=Kp.set,Qp=pa.MutationObserver||pa.WebKitMutationObserver,ec=pa.process,tc=pa.Promise,ac="process"==Dn(ec),nc={f:function(e){return new ct(e)}},sc=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}},oc=function(e,t){if(fa(e),ga(t)&&t.constructor===e)return t;var a=nc.f(e),n=a.resolve;return n(t),a.promise},rc=Kp.set,lc=function(){var e=function(){var e,s;for(ac&&(e=ec.domain)&&e.exit();t;){s=t.fn,t=t.next;try{s()}catch(s){throw t?n():a=void 0,s}}a=void 0,e&&e.enter()},t,a,n;if(ac)n=function(){ec.nextTick(e)};else if(Qp&&!(pa.navigator&&pa.navigator.standalone)){var s=!0,o=document.createTextNode("");new Qp(e).observe(o,{characterData:!0}),n=function(){o.data=s=!s}}else if(tc&&tc.resolve){var r=tc.resolve();n=function(){r.then(e)}}else n=function(){Jp.call(pa,e)};return function(e){var s={fn:e,next:void 0};a&&(a.next=s),t||(t=s,n()),a=s}}(),ic="Promise",dc=pa.TypeError,pc=pa.process,cc=pa[ic],uc="process"==Jo(pc),hc=function(){},mc=Dc=nc.f,gc=!!function(){try{var e=cc.resolve(1),t=(e.constructor={})[Wn("species")]=function(e){e(hc,hc)};return(uc||"function"==typeof PromiseRejectionEvent)&&e.then(hc)instanceof t}catch(t){}}(),fc=function(e){var t;return!!(ga(e)&&"function"==typeof(t=e.then))&&t},_c=function(e,t){if(!e._n){e._n=!0;var a=e._c;lc(function(){for(var n=e._v,s=1==e._s,o=0,r=function(t){var a=s?t.ok:t.fail,o=t.resolve,r=t.reject,l=t.domain,i,d,p;try{a?(!s&&(2==e._h&&kc(e),e._h=1),!0===a?i=n:(l&&l.enter(),i=a(n),l&&(l.exit(),p=!0)),i===t.promise?r(dc("Promise-chain cycle")):(d=fc(i))?d.call(i,o,r):o(i)):r(n)}catch(t){l&&!p&&l.exit(),r(t)}};a.length>o;)r(a[o++]);e._c=[],e._n=!1,t&&!e._h&&yc(e)})}},yc=function(e){rc.call(pa,function(){var t=e._v,a=vc(e),n,s,o;if(a&&(n=sc(function(){uc?pc.emit("unhandledRejection",t,e):(s=pa.onunhandledrejection)?s({promise:e,reason:t}):(o=pa.console)&&o.error&&o.error("Unhandled promise rejection",t)}),e._h=uc||vc(e)?2:1),e._a=void 0,a&&n.e)throw n.v})},vc=function(e){return 1!==e._h&&0===(e._a||e._c).length},kc=function(e){rc.call(pa,function(){var t;uc?pc.emit("rejectionHandled",e):(t=pa.onrejectionhandled)&&t({promise:e,reason:e._v})})},wc=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,!t._a&&(t._a=t._c.slice()),_c(t,!0))},Tc=function(e){var t=this,a;if(!t._d){t._d=!0,t=t._w||t;try{if(t===e)throw dc("Promise can't be resolved itself");(a=fc(e))?lc(function(){var n={_w:t,_d:!1};try{a.call(e,ma(Tc,n,1),ma(wc,n,1))}catch(t){wc.call(n,t)}}):(t._v=e,t._s=1,_c(t,!1))}catch(a){wc.call({_w:t,_d:!1},a)}}},Rc,Dc,xc,Cc;gc||(cc=function(e){ml(this,cc,ic,"_h"),ha(e),Rc.call(this);try{e(ma(Tc,this,1),ma(wc,this,1))}catch(e){wc.call(this,e)}},Rc=function(){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},Rc.prototype=hl(cc.prototype,{then:function(e,t){var a=mc(Fp(this,cc));return a.ok="function"!=typeof e||e,a.fail="function"==typeof t&&t,a.domain=uc?pc.domain:void 0,this._c.push(a),this._a&&this._a.push(a),this._s&&_c(this,!1),a.promise},catch:function(e){return this.then(void 0,e)}}),xc=function(){var e=new Rc;this.promise=e,this.resolve=ma(Tc,e,1),this.reject=ma(wc,e,1)},nc.f=mc=function(e){return e===cc||e===Cc?new xc(e):Dc(e)}),Ia(Ia.G+Ia.W+Ia.F*!gc,{Promise:cc}),Yn(cc,ic),_l(ic),Cc=ca[ic],Ia(Ia.S+Ia.F*!gc,ic,{reject:function(e){var t=mc(this),a=t.reject;return a(e),t.promise}}),Ia(Ia.S+Ia.F*(kn||!gc),ic,{resolve:function(e){return oc(kn&&this===Cc?cc:this,e)}}),Ia(Ia.S+Ia.F*!(gc&&Jr(function(e){cc.all(e)["catch"](hc)})),ic,{all:function(e){var t=this,a=mc(t),n=a.resolve,s=a.reject,o=sc(function(){var a=[],o=0,r=1;gl(e,!1,function(e){var l=o++,i=!1;a.push(void 0),r++,t.resolve(e).then(function(e){i||(i=!0,a[l]=e,--r||n(a))},s)}),--r||n(a)});return o.e&&s(o.v),a.promise},race:function(e){var t=this,a=mc(t),n=a.reject,s=sc(function(){gl(e,!1,function(e){t.resolve(e).then(a.resolve,n)})});return s.e&&n(s.v),a.promise}}),Ia(Ia.P+Ia.R,"Promise",{finally:function(t){var a=Fp(this,ca.Promise||pa.Promise),e="function"==typeof t;return this.then(e?function(e){return oc(a,t()).then(function(){return e})}:t,e?function(n){return oc(a,t()).then(function(){throw n})}:t)}}),Ia(Ia.S,"Promise",{try:function(e){var t=nc.f(this),a=sc(e);return(a.e?t.reject:t.resolve)(a.v),t.promise}});var Sc=ca.Promise,bc=h(function(e){e.exports={default:Sc,__esModule:!0}});n(bc);var Pc=h(function(e,t){t.__esModule=!0;var a=function(e){return e&&e.__esModule?e:{default:e}}(bc);t.default=function(e){return function(){var t=e.apply(this,arguments);return new a.default(function(e,n){function s(o,r){try{var l=t[o](r),i=l.value}catch(e){return void n(e)}return l.done?void e(i):a.default.resolve(i).then(function(e){s("next",e)},function(e){s("throw",e)})}return s("next")})}}}),Ec=n(Pc),zc=0,Ic=function(){function e(t,a,n){var s=this;hn(this,e),this.canvas=this._getElement(n),this.scale=1,this.imageX=this.canvas.getBoundingClientRect().left+window.pageXOffset,this.imageY=this.canvas.getBoundingClientRect().top+window.pageYOffset,DebuggerInit({locateFile:function(e){return t+e}}).ready().then(function(e){s.skia=e,s.player=new e.SkpPlayer,s._load(a)})}return yn(e,[{key:"_getElement",value:function(e){return e instanceof Element||e instanceof HTMLDocument?e:e&&""!=e?document.querySelector(e):void 0}},{key:"_getSkpContent",value:function(){var e=Ec(Ap.mark(function e(t){var a,n;return Ap.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:"get",responseType:"arraybuffer",credentials:"same-origin"});case 2:return a=e.sent,e.next=5,a.arrayBuffer();case 5:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 7:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_load",value:function(){var e=Ec(Ap.mark(function e(t){var a,n,s,o;return Ap.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getSkpContent(t);case 2:a=e.sent,n=a.byteLength,s=this.skia._malloc(n),o=new Uint8Array(this.skia.buffer,s,n),o.set(a),this.player.loadSkp(s,n),this._drawImage(),this._bindCanvasEvents(),this._changeCanvasSize();case 11:case"end":return e.stop();}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_drawImage",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];if(this.canvas.width=this.canvas.parentElement.clientWidth,this.canvas.height=this.canvas.parentElement.clientHeight,this.surface=WebGLRenderingContext?this.skia.MakeWebGLCanvasSurface(this.canvas):this.skia.MakeSWCanvasSurface(this.canvas),e){var t=this.player.getBounds(),a=void 0,n=t.fBottom-t.fTop,s=t.fRight-t.fLeft;a=n>s?this.canvas.width/s:this.canvas.height/n,this._scale(a)}else{var o=this.scale;this.scale=1,this._scale(o),this.scale=o}this.player.drawTo(this.surface),this.surface.flush()}},{key:"_changeCanvasSize",value:function(){var e=this;window.onresize=function(){e._drawImage(!1),e._translate(e.imageX-e.canvas.getBoundingClientRect().left-window.pageXOffset,e.imageY-e.canvas.getBoundingClientRect().top-window.pageYOffset)}}},{key:"_bindCanvasEvents",value:function(){var e=this,t=zc,a=zc,n=function(n){n.preventDefault(),t+=n.movementX,a+=n.movementY,e._translate(n.movementX,n.movementY)};this.canvas.addEventListener("mousedown",function(){e.canvas.addEventListener("mousemove",n)});var s=function(){e.imageX+=t,e.imageY+=a,t=0,a=0};this.canvas.addEventListener("mouseup",function(){s(),e.canvas.removeEventListener("mousemove",n)}),this.canvas.addEventListener("mouseover",function(){s(),e.canvas.removeEventListener("mousemove",n)}),this.canvas.addEventListener("wheel",function(t){return e._onWheel(t)})}},{key:"_onWheel",value:function(e){e.preventDefault(),0<e.wheelDelta?this._scale(2,e.clientX,e.clientY):0>e.wheelDelta&&this._scale(.5,e.clientX,e.clientY)}},{key:"_scale",value:function(e,t,a){if(this.scale*=e,this.player.scale(this.surface,e,e),t||a){var n=(t+window.pageXOffset-this.imageX)*(e-1),s=(a+window.pageYOffset-this.imageY)*(e-1);this._translate(-n,-s),this.imageX-=n,this.imageY-=s}}},{key:"_translate",value:function(e,t){this.player.translate(this.surface,e/this.scale,t/this.scale)}}]),e}(),Lc=h(function(e){(function(){var t="undefined"!=typeof window&&"undefined"!=typeof window.document?window.document:{},a=e.exports,n=function(){for(var e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],a=0,n=e.length,s={},o;a<n;a++)if(o=e[a],o&&o[1]in t){for(a=0;a<o.length;a++)s[e[0][a]]=o[a];return s}return!1}(),s={change:n.fullscreenchange,error:n.fullscreenerror},o={request:function(e){return new Promise(function(a,s){var o=function(){this.off("change",o),a()}.bind(this);this.on("change",o),e=e||t.documentElement;var r=e[n.requestFullscreen]();r instanceof Promise&&r.then(o).catch(s)}.bind(this))},exit:function(){return new Promise(function(e,a){if(!this.isFullscreen)return void e();var s=function(){this.off("change",s),e()}.bind(this);this.on("change",s);var o=t[n.exitFullscreen]();o instanceof Promise&&o.then(s).catch(a)}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,a){var n=s[e];n&&t.addEventListener(n,a,!1)},off:function(e,a){var n=s[e];n&&t.removeEventListener(n,a,!1)},raw:n};return n?void(Object.defineProperties(o,{isFullscreen:{get:function(){return!!t[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return t[n.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!t[n.fullscreenEnabled]}}}),a?e.exports=o:window.screenfull=o):void(a?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1})})()}),Ac=Lc.isEnabled,Mc=function(e,t){return Mc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])},Mc(e,t)},Fc=function(){return Fc=Object.assign||function(e){for(var t=1,a=arguments.length,n;t<a;t++)for(var o in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},Fc.apply(this,arguments)},Oc=function(){function e(){this.listenersMap={}}return e.prototype.target=function(e){var t=this;return{on:function(a,n){t.on(a,n,{target:e})}}},e.prototype.on=function(e,t,a){var n=(void 0===a?{}:a).target;void 0===this.listenersMap[e]&&(this.listenersMap[e]=[]),void 0!==n&&(t.target=n),this.listenersMap[e].push(t)},e.prototype.off=function(e,t){var a=this.listenersMap[e];if(void 0!==a)if(void 0===t)delete this.listenersMap[e];else{var n=a.findIndex(function(e){return e===t});a.splice(n,1)}},e.prototype.emit=function(e,t,a){var n,s;void 0===a&&(a=function(){return!0});var o=this.listenersMap[e];if(void 0!==o&&0<o.length)try{for(var r=mt(o),l=r.next();!l.done;l=r.next()){var i=l.value,d=i.target;a({target:d})&&i(t)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(s=r.return)&&s.call(r)}finally{if(n)throw n.error}}},e.prototype.destroy=function(){this.listenersMap={}},e}(),Uc=Object.prototype.toString,Nc="start",Vc="move",jc="cancel",Wc="end",Bc="touch",Hc="mouse",Yc=Bc+Nc,qc="on"+Yc in window,Gc=function(){return function(){}}(),$c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ut(t,e),t.prototype.load=function(e){var t=[],a=Array.from(e.touches).map(function(e){var a=e.clientX,n=e.clientY,s=e.target;return t.push(s),{clientX:a,clientY:n,target:s}}),n=Array.from(e.changedTouches).map(function(e){var t=e.clientX,a=e.clientY,n=e.target;return{clientX:t,clientY:a,target:n}});return{inputType:e.type.replace("touch",""),changedPoints:n,points:a,nativeEvent:e,target:e.target,targets:t}},t}(Gc),Xc=function(e){function t(){var t=e.call(this)||this;return t.target=null,t.isPressed=!1,t}return ut(t,e),t.prototype.load=function(e){var t=e.clientX,a=e.clientY,n=e.type,s=e.button,o=e.target,r=[{clientX:t,clientY:a,target:o}],l;Hc+"down"===n&&0===s?(this.target=o,this.isPressed=!0,l=Nc):this.isPressed&&(Hc+Vc===n?l=Vc:Hc+"up"===n&&(r=[],l=Wc,this.isPressed=!1));var i=this.prevPoints||[{clientX:t,clientY:a,target:o}];if(this.prevPoints=[{clientX:t,clientY:a,target:o}],void 0!==l)return{inputType:l,changedPoints:i,points:r,target:this.target,targets:[this.target],nativeEvent:e}},t}(Gc),Zc=function(){function e(){var e=qc?$c:Xc;this.adapter=new e,this.id=0}return e.prototype.transform=function(e){var t=Number.MAX_SAFE_INTEGER;this.prevInput=this.activeInput;var a=this.adapter.load(e);if(void 0!==a){var n=t>this.id?++this.id:1,s=Fc(Fc({},a),{id:n}),o=kt(s);this.activeInput=o;var r=o.isStart,l=o.pointLength;return r&&(this.startInput=o,this.prevInput=void 0,this.startMultiInput=1<l?o:void 0),Fc(Fc({},o),{prevInput:this.prevInput,startMultiInput:this.startMultiInput,startInput:this.startInput})}},e}(),Kc=[Yc,Bc+Vc,Bc+Wc,Bc+jc],Jc={domEvents:{bubbles:!0,cancelable:!0},isPreventDefault:!0,preventDefaultExclude:/^(?:INPUT|TEXTAREA|BUTTON|SELECT)$/},Qc=function(e){function t(a,n){var s=e.call(this)||this;if(s.recognizerMap={},s.recognizers=[],s.cacheComputedFunctionGroup=Object.create(null),s.el=a,s.input=new Zc,s.options=Fc(Fc({},Jc),n),s.recognizerMap=t.recognizerMap,s.recognizers=t.recognizers,void 0!==a){a.style.webkitTapHighlightColor="rgba(0,0,0,0)";var o=!1;try{var r={};Object.defineProperty(r,"passive",{get:function(){o=!0}}),window.addEventListener("_",function(){},r)}catch(e){}s.on("unbind",Rt(a,s.catchEvent.bind(s),!s.options.isPreventDefault&&o&&{passive:!0}))}return s}return ut(t,e),t.prototype.use=function(e,t){Dt(this,e,t)},t.prototype.removeUse=function(e){xt(this,e)},t.prototype.catchEvent=function(e){var t=this,a,n;Tt(e,this.options)&&e.preventDefault();var s=this.input.transform(e);if(void 0!==s){var o="at:"+Bc,r=o+s.inputType;this.emit(o,s),this.emit(r,s);var l=this.options.domEvents;if(!1!==l){var i=e.target;null!==i&&(wt(i,Fc(Fc({},s),{type:o}),l),wt(i,Fc(Fc({},s),{type:r}),l))}var d=Object.create(null),p=function(e){return e.disabled?"continue":void(e.computedGroup=d,e.computeFunctionMap=c.cacheComputedFunctionGroup,e.recognize(s,function(a,n){var o=Fc(Fc(Fc({},s),n),{type:a,baseType:e.name});Object.freeze(o),void 0===t.beforeEachHook?Ct(t,o):t.beforeEachHook(e,function(){Ct(t,o)})}),d=e.computedGroup,c.cacheComputedFunctionGroup=e.computeFunctionMap)},c=this;try{for(var u=mt(this.recognizers),h=u.next(),m;!h.done;h=u.next())m=h.value,p(m)}catch(e){a={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(a)throw a.error}}}},t.prototype.beforeEach=function(e){this.beforeEachHook=e},t.prototype.get=function(e){return this.recognizerMap[e]},t.prototype.set=function(e){this.options=Fc(Fc({},this.options),e)},t.prototype.destroy=function(){this.emit("unbind"),this.listenersMap={}},t.version="0.7.0",t.recognizers=[],t.recognizerMap={},t.use=function(e,a){Dt(t,e,a)},t.removeUse=function(e){xt(t,e)},t}(Oc),eu=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};Pt._id="ComputeVectorForMutli";var tu=function(){function e(e){this.disabled=!1,this.status="p",this.isRecognized=!1,this.recognizerMap={},this.computedGroup={},this.computed={},this.computeFunctionMap={},this.options=e,this.name=this.options.name}return e.prototype.set=function(e){return void 0!==e&&(this.options=Fc(Fc({},this.options),e)),this},e.prototype.isValidPointLength=function(e){return 0===this.options.pointLength||this.options.pointLength===e},e.prototype.compute=function(e,t){var a=Object.create(null),n,s;try{for(var o=mt(e),r=o.next();!r.done;r=o.next()){var l=r.value,i=l._id,d=this,p=d.computedGroup,c=d.computeFunctionMap;for(var u in void 0===c[i]&&(c[i]=l()),p[i]=p[i]||c[i](t),p[i])a[u]=p[i][u]}}catch(e){n={error:e}}finally{try{r&&!r.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}return a},e}(),au={name:"pinch",threshold:0,pointLength:2},nu=function(e){function t(t){return e.call(this,Fc(Fc({},au),t))||this}return ut(t,e),t.prototype.test=function(e){var t=e.pointLength,a=this.computed.scale;return this.isValidPointLength(t)&&void 0!==a&&(this.options.threshold<At(a-1)||this.isRecognized)},t.prototype.recognize=function(e,t){var a=this.compute([Pt],e);"activeV"in a&&(this.computed=Fc(Fc({},this.computed),St(a))),It(this,e,t)},t}(tu),su=1,ou=-1,ru={LOAD:"load",IMAGE:"img",MESSAGE:"msg",EXPAND:"expand",FULLSCREEN:"fullscreen",CO_MESSAGE:"co_msg"},lu=8192,iu=10,du=2,pu="ershiye",cu=function(){function e(t,a,n,s,o){var r=this;hn(this,e),this.el=a,console.log(this.el),console.log(this.el.id),this.project=n,this.onMessage=o,this.images={},this.engine=null,this.enableFullScreen=Lc.isEnabled,this.principals={},Qc.use(nu),this.touch=new Qc(this.canvas,{domEvents:!1}),ZWebViewInit({locateFile:function(e){return t+e},id:this.el.id,project:this.project.type,isTemplate:this.project.isTemplate,messageBox:function(e){r.onMessage({type:ru.MESSAGE,data:e})},getResPath:function(){return t},OnReceiveCoEditMessage:function(e){r.onMessage({type:ru.CO_MESSAGE,data:e})},getProjectInfo:function(e){var t=[];return e.project==pu&&(e.message=="zerenren"?t=r.project.bim5dProductUsers:e.message=="canyuren"?t=r.project.bim5dProductUsers:e.message=="zerendanwei"&&(t=r.project.subcontractors)),t}}).then(function(e){r.engine=e,s()})}return yn(e,[{key:"load",value:function(e,t){this.viewer=this.project.type==pu?this.engine.loadershiye(e,t):this.engine.load(e,t.length()),this.onMessage({type:ru.LOAD,data:!0})}},{key:"joinCoEdit",value:function(e,t,a,n,s){this.viewer=this.engine.joincoedit(e,t,a,n,s)}},{key:"quitCoEdit",value:function(){this.viewer.LeaveCoEdit()}},{key:"coeditMessage",value:function(e){this.engine.sendtocoeditclient(this.viewer,e)}},{key:"resize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this._resizeCanvas(e,t),this.viewer.Draw()}},{key:"pertMode",value:function(){var e=this.viewer.GetPertMode();return e==0?"TIME":"GANTT"}},{key:"getPredictStatus",value:function(){return this.viewer.GetPlanShowStatus()}},{key:"getFinishRatioStatus",value:function(){return this.viewer.GetFinishRatioStatus()}},{key:"predictRealProgress",value:function(){this.viewer.OnSetPlanShow()}},{key:"showFinishRatio",value:function(){this.viewer.OnShowFinishRatio()}},{key:"goIn",value:function(){this.viewer.OnGoIn()}},{key:"goOut",value:function(){this.viewer.OnGoOut()}},{key:"showPertMode",value:function(e){this.viewer.OnChangePertMode(this.engine["ID_VIEW_PERT_"+e])}},{key:"expand",value:function(){this.viewer.OnCollapsed(this.engine.ID_BUTTON_EXPAND),this._syncExpandStatus()}},{key:"expandTo",value:function(e){var t="ALL";1<=e&&9>=e&&(t=e.toString()),this.viewer.OnCollapsed(this.engine["ID_BUTTON_EXPAND_"+t])}},{key:"_convertPertColor",value:function(e){var t=e.toString(16).padStart(6,"0");return"FF"+t}},{key:"exportExcel",value:function(e){for(var t=JSON.parse(this.viewer.ToExcel()),a=t.colwidth,n=t.rowheight,s=t.grids,o=t.groups,r=[],l=0;l<o.length;l++)for(var d=o[l],p=d.startrow,c=d.endrow,u=p,h;u<=c;u++)h=r[u]||0,h+=1,r[u]=h;for(var m=new xlsx.File,g=m.addSheet(e),f=0;f<s.length;f++){var _=s[f],y=g.addRow(),v=r[f];y.setHeight(n[f]),v&&y.setLevel(v);for(var k=0;k<_.length;k++){var w=_[k],T=y.addCell();T.value=w.showstring,T.style.font.color=this._convertPertColor(w.fontcolor),T.style.font.size=w.font.fontsize,T.style.font.bold=w.font.isbold,T.style.font.italic=w.font.isitalic,T.style.font.underline=w.font.isunderline,T.style.fill.fgColor=this._convertPertColor(w.backcolor),T.style.fill.patternType="solid",T.style.border.top="thin",T.style.border.bottom="thin",T.style.border.left="thin",T.style.border.right="thin"}}for(var R=0;R<a.length;R++)g.col(R).width=a[R];m.saveAs("blob").then(function(t){return gi.saveAs(t,e+".xlsx")})}},{key:"toggleFullScreen",value:function(){Lc.toggle(this.el)}},{key:"_syncExpandStatus",value:function(){var e=this.viewer.GetCurrentCollapsedStatus();e==1?this.onMessage({type:ru.EXPAND,data:!0}):e==2&&this.onMessage({type:ru.EXPAND,data:!1})}},{key:"_createCanvas",value:function(){var e=document.createElement("canvas");e.style.backgroundColor="white",e.style.touchAction="none",e.width=iu,e.height=iu,this.canvasContainer.appendChild(e),this.canvas=e}},{key:"_resizeCanvas",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=t?t:this.canvasContainer.clientWidth,n=e?e:this.canvasContainer.clientHeight;a>lu?a=lu:a<iu&&(a=iu),n>lu?n=lu:n<iu&&(n=iu),this.canvas.width=a,this.canvas.height=n,this.originX=this.canvas.getBoundingClientRect().left+window.pageXOffset,this.originY=this.canvas.getBoundingClientRect().top+window.pageYOffset,this.viewer&&this.viewer.SetDrawSize(a,n)}},{key:"_sendMessage",value:function(e,t,a){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;this.viewer.OnMessage(e,t-this.originX,a-this.originY,n,0)}},{key:"_touchEventPagePos",value:function(e){return[e.x+window.pageXOffset,e.y+window.pageYOffset]}},{key:"_bindCanvasEvents",value:function(){var t=this,a=this.engine.ZWM_LBUTTONDOWN,n=this.engine.ZWM_LBUTTONUP,s=this.engine.ZWM_RBUTTONDOWN,o=this.engine.ZWM_RBUTTONUP,r=this.engine.ZWM_MOUSEMOVE,l=this.engine.ZWM_MOUSEWHEEL;Lc.isEnabled&&(document.onkeydown=function(e){e=e||window.event,27==e.keyCode&&Lc.exit()},this.onScreenFullChange=function(){t.onMessage({type:ru.FULLSCREEN,data:Lc.isFullscreen})},Lc.on("change",this.onScreenFullChange)),this.touch.on("at:touchstart",function(n){var e=t._touchEventPagePos(n),s=ir(e,2),o=s[0],r=s[1];t._sendMessage(a,o,r)}),this.touch.on("at:touchmove",function(a){var e=t._touchEventPagePos(a),n=ir(e,2),s=n[0],o=n[1];t._sendMessage(r,s,o)});var i=function(a){var e=t._touchEventPagePos(a),s=ir(e,2),o=s[0],r=s[1];t._sendMessage(n,o,r),t._syncExpandStatus()};this.touch.on("at:touchend",i),this.touch.on("at:touchcancel",i),this.touch.on("pinch",function(a){if(1!=a.deltaScale){var e=1<a.deltaScale?su:ou,n=t._touchEventPagePos(a),s=ir(n,2),o=s[0],r=s[1];t._sendMessage(l,o,r,e)}}),this.canvas.addEventListener("contextmenu",function(t){t.preventDefault()}),this.canvas.addEventListener("mousedown",function(a){if(a.button===du){var e=t._touchEventPagePos(a),n=ir(e,2),o=n[0],r=n[1];t._sendMessage(s,o,r)}}),this.canvas.addEventListener("mouseup",function(a){if(a.button===du){var e=t._touchEventPagePos(a),n=ir(e,2),s=n[0],r=n[1];t._sendMessage(o,s,r)}}),this.canvas.addEventListener("mousemove",function(e){t._sendMessage(r,e.pageX,e.pageY)}),this.canvas.addEventListener("wheel",function(e){e.preventDefault();var a=0;e.deltaY?a=e.deltaY:e.wheelDelta&&(a=-e.wheelDelta);var n=0>=a?su:ou;t._sendMessage(l,e.pageX,e.pageY,n)})}},{key:"destroy",value:function(){this.touch.destroy(),this.onScreenFullChange&&Lc.off("change",this.onScreenFullChange),this.viewer&&this.viewer.Destroy()}},{key:"startEdit",value:function(){this.engine.startedit()}},{key:"stopEdit",value:function(){this.engine.stopedit()}},{key:"getPertContent",value:function(){return JSON.parse(this.viewer.ToJson())}},{key:"generatePeriodPlan",value:function(e){this.viewer.GeneratePeriodPlan(e)}},{key:"importFromTemplate",value:function(e){this.viewer.ImportFromTemplate(e)}}]),e}(),uu=[{name:"index",type:"text",width:"45px",readonly:!0,head_name:""},{name:"name",type:"text",width:"200px",readonly:!0,indent:!0,hint:!0,head_name:"\u4EFB\u52A1\u540D\u79F0"},{name:"department",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u90E8\u95E8"},{name:"workSite",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u5DE5\u4F5C\u90E8\u4F4D"}],hu=[{name:"planAmount",type:"number",width:"100px",readonly:!0,head_name:"\u8BBE\u8BA1\u6570\u91CF"},{name:"unit",type:"text",width:"100px",readonly:!0,head_name:"\u5355\u4F4D"},{name:"amount",type:"number",width:"100px",readonly:!0,head_name:"\u5F53\u671F\u8BA1\u5212\u91CF"},{name:"realAmount",type:"number",width:"100px",readonly:!0,head_name:"\u5F53\u671F\u5B8C\u6210\u91CF"},{name:"percent",type:"text",width:"100px",readonly:!0,head_name:"\u5F53\u671F\u5B8C\u6210\u5360\u6BD4"},{name:"totalAmount",type:"number",width:"100px",readonly:!0,head_name:"\u7D2F\u8BA1\u5B8C\u6210\u91CF"},{name:"totalPercent",type:"text",width:"100px",readonly:!0,head_name:"\u7D2F\u8BA1\u5B8C\u6210\u5360\u6BD4"}],mu=[{name:"value",type:"number",width:"100px",readonly:!0,head_name:"\u8BA1\u5212\u4EA7\u503C"},{name:"realValue",type:"number",width:"100px",readonly:!0,head_name:"\u5B9E\u9645\u4EA7\u503C"},{name:"totalValue",type:"number",width:"100px",readonly:!0,head_name:"\u7D2F\u8BA1\u5B8C\u6210\u4EA7\u503C"}],gu=[{name:"desc",type:"text",width:"300px",readonly:!0,hint:!0,head_name:"\u5907\u6CE8"},{name:"images",type:"action",width:"100px",readonly:!1,head_name:"\u56FE\u7247"}],fu=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.columns=[].concat(uu,hu,mu,gu),e}return Eo(t,e),yn(t,[{key:"_convertTask",value:function(e){var t=this.quantities[e.id],a=t.amount,n=t.realAmount,s=t.planAmount,o=t.totalAmount,r=t.unit,l="",i=t.desc||"";a&&(l=ti.roundTwoDecimals(100*n/a)+"%"),a=ti.roundTwoDecimals(a),n=ti.roundTwoDecimals(n);var d="";s&&(d=ti.roundTwoDecimals(100*o/s)+"%",s=ti.roundTwoDecimals(s)),o=ti.roundTwoDecimals(o);var p=ti.roundTwoDecimals(t.value),c=ti.roundTwoDecimals(t.realValue),u=ti.roundTwoDecimals(t.totalValue);return{id:e.id,quantityId:t.id,level:e.level,collapsed:!1,name:e.name,workSite:e.work_site,department:e.department?e.department.first_sector:"",originDepartment:e.department,planAmount:s,unit:r,amount:a,realAmount:n,finished:n>=a,totalFinished:o>=s,valid:0!=a||0!=n,percent:l,totalAmount:o,totalPercent:d,exceeding:o>s,value:p,realValue:c,totalValue:u,desc:i,imagesSize:t.imagesSize}}},{key:"filter",value:function(e){for(var t=[],a=!1,n=!1,s=0;s<e.options.length;s++){var o=ir(e.options[s],2),r=o[0],l=o[1];"showQuantity"==r?a=l:"showValue"==r?n=l:t.push(e.options[s])}var d=[].concat(uu);a&&(d=[].concat(nl(d),hu)),n&&(d=[].concat(nl(d),mu)),d=[].concat(nl(d),gu),this.columns=d,this.statistics.loadColumns(this.columns),this.statistics.setShowConditions({options:t,idxs:e.idxs}),this.statistics.showByConditions()}},{key:"fetchTasks",value:function(e){for(var t={},a=0;a<e.length;a++)for(var n=e[a],s=this.statistics.rows[n],o=s.next();o&&o.level()>s.level();)o.parent==s&&(t[o.data.name]?t[o.data.name].push(o.idx):t[o.data.name]=[o.idx]),o=o.next();return t}}]),t}(yi),_u=[{name:"index",type:"text",width:"45px",readonly:!0,head_name:""},{name:"firstLevelDepartment",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u4E00\u7EA7\u90E8\u95E8"},{name:"secondLevelDepartment",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u4E8C\u7EA7\u90E8\u95E8"},{name:"thirdLevelDepartment",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u4E09\u7EA7\u90E8\u95E8"},{name:"value",type:"number",width:"100px",readonly:!0,head_name:"\u8BA1\u5212\u4EA7\u503C"},{name:"realValue",type:"number",width:"100px",readonly:!0,head_name:"\u5B9E\u9645\u4EA7\u503C"},{name:"percent",type:"text",width:"100px",readonly:!0,head_name:"\u5F53\u671F\u5B8C\u6210\u5360\u6BD4"},{name:"totalValue",type:"number",width:"100px",readonly:!0,head_name:"\u7D2F\u8BA1\u5B8C\u6210\u4EA7\u503C"},{name:"schedules",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u8BA1\u5212\u8FDB\u5EA6"},{name:"realSchedules",type:"text",width:"100px",readonly:!0,hint:!0,head_name:"\u5B9E\u9645\u8FDB\u5EA6"}],yu=function(e){function t(){hn(this,t);var e=wo(this,(t.__proto__||cn(t)).call(this));return e.columns=_u,e}return Eo(t,e),yn(t,[{key:"_beforeUpdate",value:function(e){for(var t={},a=new Al,n=1,s;n<e.rows.length;n++)if(s=e.rows[n],!s.isParent){var o=""+s.firstLevelDepartment+s.secondLevelDepartment+s.thirdLevelDepartment;a.add(o);var r=t[o];r?(r.value+=s.value,r.realValue+=s.realValue,r.totalValue+=s.totalValue,r.planValue+=s.planValue,r.schedules.push(s.desc),r.realSchedules.push(s.realDesc)):t[o]={level:1,department:s.department,firstLevelDepartment:s.firstLevelDepartment,secondLevelDepartment:s.secondLevelDepartment,thirdLevelDepartment:s.thirdLevelDepartment,value:s.value,realValue:s.realValue,totalValue:s.totalValue,planValue:s.planValue,percent:"",schedules:[s.desc],realSchedules:[s.realDesc]}}for(var l=[{level:0,name:e.rows[0].name,firstLevelDepartment:"",secondLevelDepartment:"",thirdLevelDepartment:"",workSite:"",value:0,realValue:0,percent:"",totalValue:0,schedules:"",realSchedules:""}],d=tl(a).sort(function(e,t){return e.localeCompare(t,"zh")}),p=0;p<d.length;p++){var c=d[p],u=t[c];0!=u.schedules.length&&(0!=u.value||0!=u.realValue)&&(u.value&&(u.percent=(100*u.realValue/u.value).toFixed()+"%"),u.schedules=u.schedules.join(", "),u.realSchedules=u.realSchedules.join(", "),u.finished=u.realValue>=u.value,u.totalFinished=u.totalValue>=u.planValue,u.valid=0!=u.realValue||0!=u.value,u.value=ti.roundTwoDecimals(u.value),u.realValue=ti.roundTwoDecimals(u.realValue),u.totalValue=ti.roundTwoDecimals(u.totalValue),u.planValue=ti.roundTwoDecimals(u.planValue),l.push(u))}e.rows=l}},{key:"_convertTask",value:function(e){var t=this.quantities[e.id],a=t.unit,n=t.amount,s=t.realAmount,o=ti.roundTwoDecimals(t.value),r=ti.roundTwoDecimals(t.realValue),l=ti.roundTwoDecimals(t.totalValue),i=ti.roundTwoDecimals(t.planValue),d="",p="",c="";return e.department&&(d=e.department.first_sector||"",p=e.department.second_sector||"",c=e.department.third_sector||""),{id:e.id,isParent:e.is_parent,level:e.level,collapsed:!1,name:e.name,workSite:e.work_site||"",department:d,firstLevelDepartment:d,secondLevelDepartment:p,thirdLevelDepartment:c,value:o,realValue:r,totalValue:l,planValue:i,desc:e.name+"\u5B8C\u6210"+n+a,realDesc:e.name+"\u5B8C\u6210"+s+a}}}]),t}(yi);e.mountGrid=function(e,t){var a=je(Je(ur,{model:e,scrollY:!0}),Lt(t));return e.planInstance=e.gridInstance,a},e.mountAll=function(e,t){return je(Je(Nr,{model:e}),Lt(t))},e.mountScaffold=function(e,t){return je(Je(Br,{model:e}),Lt(t))},e.mountScore=function(e){return je(Je(oi,{}),Lt(e))},e.mountGb=function(e){return je(Je(ri,{}),Lt(e))},e.mountMilestone=function(e){return je(Je(hi,{}),Lt(e))},e.mountStatistics=function(e,t){return je(Je(vi,{model:e}),Lt(t))},e.unmount=function(e){return je(null,Lt(e))},e.PublisherConfig=Ed,e.TaskChange=op,e.ProgressDiff=ip,e.ProgressState=hp,e.ZpertConvert=Ep,e.Inspect=ni,e.SkpPreviewer=Ic,e.Previewer=cu,e.QuantityStatistics=fu,e.ValueStatistics=yu,e.Project=jd,e.Visual=Hd,e.Ladder=qd,Object.defineProperty(e,"__esModule",{value:!0})});
